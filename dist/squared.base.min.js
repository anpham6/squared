!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t=t||self).squared=t.squared||{},t.squared.base={}))}(this,function(t){"use strict";const e=squared.lib.css,i=squared.lib.util;class s extends squared.lib.base.Container{constructor(t){super(t),this._currentId=0}static outerRegion(t){let e=t.item(0),i=e,s=e,n=e;for(let o=1;o<t.children.length;o++){const a=t.children[o];a.actualRect("top")<e.actualRect("top")&&(e=a),a.actualRect("right")>i.actualRect("right")&&(i=a),a.actualRect("bottom")>s.actualRect("bottom")&&(s=a),a.actualRect("left")<n.actualRect("left")&&(n=a)}return{top:e.linear.top,right:i.linear.right,bottom:s.linear.bottom,left:n.linear.left}}static actualParent(t){for(const e of t)if(e.naturalElement){if(e.actualParent)return e.actualParent}else if(e.groupParent){const t=s.actualParent(e.actualChildren);if(t)return t}return null}static baseline(t,s=!1){const n=i.filterArray(t,t=>(t.baseline||e.isLength(t.verticalAlign))&&!t.floating&&!t.baselineAltered&&(0===t.length||t.every(t=>t.baseline&&!t.multiline)));if(!n.length)return n;if(t=n,s&&i.spliceArray(t,t=>!(t.textElement&&t.naturalElement)),t.length>1){let e=0,s=0;for(let i=0;i<t.length;i++){const n=t[i];if(n.layoutVertical&&n.length>1||n.plainText&&n.multiline)t.splice(i--,1);else{let t;n.multiline&&n.cssTry("whiteSpace","nowrap")?(t=n.element.getBoundingClientRect().height,n.cssFinally("whiteSpace")):t=n.bounds.height,e=Math.max(e,t),s=Math.max(s,n.lineHeight)}}i.spliceArray(t,t=>s>e?t.lineHeight!==s:t.bounds.height<e),t.sort((t,e)=>{if(t.groupParent||t.length||!t.baseline&&e.baseline)return 1;if(e.groupParent||e.length||t.baseline&&!e.baseline)return-1;if(!t.imageElement||!e.imageElement){if(t.textElement&&e.textElement)return t.fontSize===e.fontSize?t.htmlElement&&!e.htmlElement?-1:!t.htmlElement&&e.htmlElement?1:t.siblingIndex<e.siblingIndex?-1:1:t.fontSize>e.fontSize?-1:1;if(t.containerType!==e.containerType)return t.textElement?-1:e.textElement?1:t.imageElement?-1:e.imageElement?1:t.containerType<e.containerType?-1:1}const i=Math.max(t.actualHeight,t.lineHeight),s=Math.max(e.actualHeight,e.lineHeight);return i!==s?i>s?-1:1:0})}return t}static linearData(t,e=!1){const s=[],n=new Set,o={},a=new Set,r=new Map;let l=!1,c=!1;for(const e of t)if(e.pageFlow){if(n.size){const t=[],i=e.css("clear");switch(i){case"left":t.push(o.left);break;case"right":t.push(o.right);break;case"both":t.push(o.left,o.right)}for(const i of t)i&&n.has(i.float)&&!e.floating&&e.linear.top>=i.linear.bottom&&(n.delete(i.float),o[i.float]=void 0);"both"===i?(r.set(e,2===n.size?"both":n.values().next().value),n.clear(),o.left=void 0,o.right=void 0):n.has(i)&&(r.set(e,i),n.delete(i),o[i]=void 0)}e.floating&&(n.add(e.float),a.add(e.float),o[e.float]=e),s.push(e)}if(s.length&&!e){const t=[s[0]];let e=1,n=1;for(let i=1;i<s.length;i++)s[i].alignedVertically(s[i].previousSiblings(),t,r)?n++:e++,t.push(s[i]);if(c=n===s.length,(l=e===s.length)&&a.size){let t=1/0,e=-1/0,n=-1/0,o=1/0;for(const i of s)t=Math.min(t,i.linear.left),e=Math.max(e,i.linear.right),i.floating&&("left"===i.float?n=Math.max(n,i.linear.right):o=Math.min(o,i.linear.left));for(let a=0,r=0,c=0,h=0,d=0;a<s.length;a++){const u=s[a];if(Math.floor(u.linear.left)<=t&&r++,Math.ceil(u.linear.right)>=e&&c++,u.floating||(u.linear.left===n&&h++,u.linear.right===o&&d++),0===a)continue;if(2===r||2===c||2===h||2===d){l=!1;break}const g=s[a-1];if(g.floating&&u.linear.top>=g.linear.bottom||i.withinRange(u.linear.left,g.linear.left)){l=!1;break}}}}return{linearX:l,linearY:c,cleared:r,floated:a}}static partitionRows(t){const e=this.actualParent(t),s=e?e.actualChildren:t,n=this.linearData(t,!0).cleared,o=i.filterArray(t,t=>t.groupParent),a=[];let r=[];for(let e=0;e<s.length;e++){const i=s[e];let l=!1;for(let t=0;t<o.length;t++){const e=o[t];if(e.contains(i)||e===i){r.length&&a.push(r),a.push([e]),r=[],o.splice(t,1),l=!0;break}}if(l)continue;const c=i.previousSiblings();0===e||0===c.length?t.includes(i)&&r.push(i):i.alignedVertically(c,r,n)?(r.length&&a.push(r),r=t.includes(i)?[i]:[]):t.includes(i)&&r.push(i),e===s.length-1&&r.length&&a.push(r)}return a}static siblingIndex(t,e){return t.siblingIndex<e.siblingIndex?-1:1}append(t,e=!0){return super.append(t),e&&this.afterAppend&&this.afterAppend.call(this,t),this}reset(){return this._currentId=0,this.clear(),this}get nextId(){return++this._currentId}}const n=squared.lib.util;class o extends squared.lib.base.Container{constructor(t,e,i=0,s=0,n){super(n),this.parent=t,this.node=e,this.containerType=i,this.alignmentType=s,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,n&&this.init()}init(){const t=s.linearData(this.children);this._floated=t.floated,this._cleared=t.cleared,this._linearX=t.linearX,this._linearY=t.linearY,t.floated.size&&(this.add(512),this.some(t=>t.blockStatic)&&this.add(64)),this.every(t=>t.rightAligned)&&this.add(1024),this.itemCount=this.children.length}reset(t,e){this.containerType=0,this.alignmentType=0,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,this._linearX=void 0,this._linearY=void 0,this._floated=void 0,this._cleared=void 0,t&&(this.parent=t),e&&(this.node=e),this.clear()}setType(t,...e){this.containerType=t;for(const t of e)this.add(t)}hasAlign(t){return n.hasBit(this.alignmentType,t)}add(t){return n.hasBit(this.alignmentType,t)||(this.alignmentType|=t),this.alignmentType}delete(t){return n.hasBit(this.alignmentType,t)&&(this.alignmentType^=t),this.alignmentType}retain(t){return super.retain(t),this.init(),this}get linearX(){return void 0===this._linearX||this._linearX}get linearY(){return void 0!==this._linearY&&this._linearY}get floated(){return this._floated||new Set}get cleared(){return this._cleared||new Map}get singleRowAligned(){if(void 0===this._singleRow){let t=1/0;for(const e of this.children){if(!e.inlineVertical&&!e.plainText||e.multiline)return!1;{const i=n.convertFloat(e.verticalAlign);if(e.linear.top-i>=t)return!1;t=e.linear.bottom+i}}this._singleRow=!0}return this._singleRow}get visible(){return this.filter(t=>t.visible)}}var a,r,l;!function(t){t[t.DOM_TRAVERSE=2]="DOM_TRAVERSE",t[t.EXTENSION=4]="EXTENSION",t[t.RENDER=8]="RENDER",t[t.ALL=14]="ALL"}(a||(a={})),function(t){t[t.BOX_STYLE=2]="BOX_STYLE",t[t.BOX_SPACING=4]="BOX_SPACING",t[t.FONT_STYLE=8]="FONT_STYLE",t[t.VALUE_STRING=16]="VALUE_STRING",t[t.IMAGE_SOURCE=32]="IMAGE_SOURCE",t[t.ASSET=56]="ASSET",t[t.ALL=126]="ALL"}(r||(r={})),function(t){t[t.CONSTRAINT=2]="CONSTRAINT",t[t.LAYOUT=4]="LAYOUT",t[t.ALIGNMENT=8]="ALIGNMENT",t[t.AUTOFIT=16]="AUTOFIT",t[t.OPTIMIZATION=32]="OPTIMIZATION",t[t.CUSTOMIZATION=64]="CUSTOMIZATION",t[t.ACCESSIBILITY=128]="ACCESSIBILITY",t[t.LOCALIZATION=256]="LOCALIZATION",t[t.NONPOSITIONAL=208]="NONPOSITIONAL",t[t.ALL=510]="ALL"}(l||(l={}));var c=Object.freeze({get APP_SECTION(){return a},get NODE_RESOURCE(){return r},get NODE_PROCEDURE(){return l}});const h=squared.lib.css,d=squared.lib.dom,u=squared.lib.regex,g=squared.lib.session,f=squared.lib.util,p=squared.lib.xml,m={};let b;function y(t,e){if(t.dataset.use){const i=t.dataset.use.split(u.XML.SEPARATOR),s=[],n=[];for(const t of e){const e=i.indexOf(t.name);-1!==e?s[e]=t:n.push(t)}if(s.length)return f.concatArray(f.spliceArray(s,t=>void 0===t),n)}return e}function x(t,e){const i=RegExp(`^@${t}([^{]+)`).exec(e);return i&&(e=i[1].trim()),e}const S=squared.lib.color,_=squared.lib.client,v=squared.lib.css,T=squared.lib.session,E=squared.lib.util,A=squared.lib.xml,w=t=>!(t.left<0&&t.top<0&&Math.abs(t.left)>=t.width&&Math.abs(t.top)>=t.height);const I=squared.lib.css,C=squared.lib.util;class k{constructor(t,e,i,s){this.name=t,this.framework=e,this.eventOnly=!1,this.preloaded=!1,this.documentBase=!1,this.options={},this.dependencies=[],this.subscribers=new Set,this.tagNames=Array.isArray(i)?C.replaceMap(i,t=>t.trim().toUpperCase()):[],s&&Object.assign(this.options,s)}static findNestedElement(t,e){if(I.hasComputedStyle(t))for(let i=0;i<t.children.length;i++){const s=t.children[i];if(C.includes(s.dataset.use,e))return s}return null}is(t){return!!t.styleElement&&(0===this.tagNames.length||this.tagNames.includes(t.element.tagName))}require(t,e=!1){this.dependencies.push({name:t,preload:e})}included(t){return C.includes(t.dataset.use,this.name)}beforeInit(t,e=!1){if(!e&&this.included(t))for(const e of this.dependencies)if(e.preload){const i=this.application.extensionManager.retrieve(e.name);i&&!i.preloaded&&(i.beforeInit(t,!0),i.preloaded=!0)}}init(t){return!1}afterInit(t,e=!1){if(!e&&this.included(t))for(const e of this.dependencies)if(e.preload){const i=this.application.extensionManager.retrieve(e.name);i&&i.preloaded&&(i.afterInit(t,!0),i.preloaded=!1)}}condition(t,e){return!!I.hasComputedStyle(t.element)&&(t.dataset.use?this.included(t.element):this.tagNames.length>0)}processNode(t,e){}processChild(t,e){}addDescendant(t){const e=this.application.session.extensionMap.get(t.id)||[];e.includes(this)||e.push(this),this.application.session.extensionMap.set(t.id,e)}postBaseLayout(t){}postConstraints(t){}postParseDocument(t){}postOptimize(t){}postBoxSpacing(t){}beforeParseDocument(){}afterBaseLayout(){}afterConstraints(){}afterResources(){}afterParseDocument(){}beforeCascade(){}afterFinalize(){}get installed(){return!!this.application&&this.application.extensions.includes(this)}}const R=squared.lib.util;const B=squared.lib.util;class L{constructor(t){this.resource=t,this.appName="",this.assets=[],t.fileHandler=this}static downloadToDisk(t,e,i=""){const s=new Blob([t],{type:i||"application/octet-stream"}),n=window.URL.createObjectURL(s),o=document.createElement("a");o.style.setProperty("display","none"),o.setAttribute("href",n),o.setAttribute("download",e),void 0===o.download&&o.setAttribute("target","_blank"),document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>window.URL.revokeObjectURL(n),1)}addAsset(t,e,i="",s=""){if(i||s){const n=this.assets.findIndex(i=>i.pathname===t&&i.filename===e);-1!==n?(this.assets[n].content=i,this.assets[n].uri=s):this.assets.push({pathname:t,filename:e,content:i,uri:s})}}reset(){this.assets.length=0}saveToDisk(t,e){if(location.protocol.startsWith("http")){if(t.length){const i=this.userSettings;B.concatArray(t,this.assets),fetch("/api/savetodisk"+`?directory=${encodeURIComponent(B.trimString(i.outputDirectory,"/"))}`+(e?`&appname=${encodeURIComponent(e.trim())}`:"")+`&filetype=${i.outputArchiveFileType.toLowerCase()}`+`&processingtime=${(""+i.outputMaxProcessingTime).trim()}`,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(t)}).then(t=>t.json()).then(t=>{t&&(t.zipname?fetch(`/api/downloadtobrowser?filename=${encodeURIComponent(t.zipname)}`).then(t=>t.blob()).then(e=>L.downloadToDisk(e,B.fromLastIndexOf(t.zipname,"/"))):t.system&&alert(`${t.application}\n\n${t.system}`))}).catch(t=>alert(`ERROR: ${t}`))}}else alert("SERVER (required): See README for instructions")}get stored(){return this.resource.stored}}const P=new Map([[2,"marginTop"],[4,"marginRight"],[8,"marginBottom"],[16,"marginLeft"],[32,"paddingTop"],[64,"paddingRight"],[128,"paddingBottom"],[256,"paddingLeft"]]),M={ACCESSIBILITY:"squared.accessibility",CSS_GRID:"squared.css-grid",EXTERNAL:"squared.external",FLEXBOX:"squared.flexbox",GRID:"squared.grid",LIST:"squared.list",RELATIVE:"squared.relative",SPRITE:"squared.sprite",SUBSTITUTE:"squared.substitute",TABLE:"squared.table",VERTICAL_ALIGN:"squared.verticalalign",WHITESPACE:"squared.whitespace"};var N=Object.freeze({CSS_SPACING:P,EXT_NAME:M});const F=squared.lib.css,W=squared.lib.dom,O=squared.lib.regex,D=squared.lib.session,H=squared.lib.util,z=["position","display","verticalAlign","float","clear","zIndex"],q=Array.from(P.keys());class V extends squared.lib.base.Container{constructor(t,e="0",i){super(),this.id=t,this.sessionId=e,this.alignmentType=0,this.depth=-1,this.siblingIndex=1/0,this.documentRoot=!1,this.visible=!0,this.excluded=!1,this.rendered=!1,this.baselineActive=!1,this.baselineAltered=!1,this.lineBreakLeading=!1,this.lineBreakTrailing=!1,this.positioned=!1,this.controlId="",this._initial={iteration:-1,children:[],styleMap:{}},this._data={},this._excludeSection=0,this._excludeProcedure=0,this._excludeResource=0,this._inlineText=!1,this._element=null,i?(this._element=i,this.init()):(this._styleMap={},this.style={})}cloneBase(t){Object.assign(t.localSettings,this.localSettings),t.tagName=this.tagName,t.alignmentType=this.alignmentType,t.depth=this.depth,t.visible=this.visible,t.excluded=this.excluded,t.rendered=this.rendered,t.siblingIndex=this.siblingIndex,this.inlineText&&t.setInlineText(!0,!0),t.lineBreakLeading=this.lineBreakLeading,t.lineBreakTrailing=this.lineBreakTrailing,t.renderParent=this.renderParent,t.documentParent=this.documentParent,t.documentRoot=this.documentRoot,this.length&&t.retain(this.duplicate()),t.inherit(this,"initial","base","alignment","styleMap","textStyle"),Object.assign(t.unsafe("cached"),this._cached)}init(){const t=this._element;if(t&&("0"!==this.sessionId&&D.setElementCache(t,"node",this.sessionId,this),this.style=D.getElementCache(t,"style","0")||F.getStyle(t,void 0,!1),this._styleMap=Object.assign({},D.getElementCache(t,"styleMap",this.sessionId)),F.hasComputedStyle(t)&&!this.pseudoElement&&"0"!==this.sessionId)){const e=parseFloat(this.style.getPropertyValue("font-size"));for(let i of Array.from(t.style)){let s=t.style.getPropertyValue(i);i=H.convertCamelCase(i),(s=F.checkStyleValue(t,i,s,this.style,1e3,e))&&(this._styleMap[i]=s)}}}saveAsInitial(t=!1){(-1===this._initial.iteration||t)&&(this._initial.children=this.duplicate(),this._initial.styleMap=Object.assign({},this._styleMap)),this._bounds&&(this._initial.bounds=W.assignRect(this._bounds),this._initial.linear=W.assignRect(this.linear),this._initial.box=W.assignRect(this.box)),this._initial.iteration++}is(...t){return t.some(t=>this.containerType===t)}of(t,...e){return this.containerType===t&&e.some(t=>this.hasAlign(t))}unsafe(t,e=!1){if(!e)return this[`_${t}`];delete this[`_${t}`]}attr(t,e,i,s=!0){let n=this[`__${t}`];return i?(void 0===n&&(this._namespaces.includes(t)||this._namespaces.push(t),this[`__${t}`]=n={}),!s&&n[e]?"":(n[e]=""+i,n[e])):n&&n[e]||""}namespace(t){return this[`__${t}`]||{}}delete(t,...e){const i=this[`__${t}`];if(i)for(const t of e)if(-1!==t.indexOf("*"))for(const[e]of H.searchObject(i,t))delete i[e];else delete i[t]}apply(t){for(const e in t){const i=t[e];if("object"==typeof i){for(const t in i)this.attr(e,t,i[t]);delete t[e]}}}render(t){this.renderParent=t,this.rendered=!0}renderEach(t){for(let e=0;e<this.renderChildren.length;e++)this.renderChildren[e].visible&&t(this.renderChildren[e],e,this.renderChildren);return this}renderFilter(t){return H.filterArray(this.renderChildren,t)}hide(t){this.rendered=!0,this.visible=!1}data(t,e,i,s=!0){return H.hasValue(i)?("object"!=typeof this._data[t]&&(this._data[t]={}),(s||void 0===this._data[t][e])&&(this._data[t][e]=i)):null===i&&delete this._data[t],void 0===this._data[t]||void 0===this._data[t][e]?void 0:this._data[t][e]}unsetCache(...t){if(t.length)for(const e of t){switch(e){case"position":return void(this._cached={});case"width":this._cached.actualWidth=void 0;case"minWidth":this._cached.width=void 0;break;case"height":this._cached.actualHeight=void 0;case"minHeight":this._cached.height=void 0;break;case"verticalAlign":this._cached.baseline=void 0;break;case"display":this._cached.inline=void 0,this._cached.inlineVertical=void 0,this._cached.inlineFlow=void 0,this._cached.block=void 0,this._cached.blockDimension=void 0,this._cached.blockStatic=void 0,this._cached.autoMargin=void 0;break;case"pageFlow":this._cached.positionAuto=void 0,this._cached.blockStatic=void 0,this._cached.baseline=void 0,this._cached.floating=void 0,this._cached.autoMargin=void 0,this._cached.rightAligned=void 0,this._cached.bottomAligned=void 0;break;case"float":this._cached.floating=void 0;break;default:e.startsWith("margin")&&(this._cached.autoMargin=void 0),(e.startsWith("padding")||e.startsWith("border"))&&(this._cached.contentBoxWidth=void 0,this._cached.contentBoxHeight=void 0)}this._cached[e]=void 0}else this._cached={}}ascend(t=!1,e,i){const s=[],n=t?this.renderParent?"renderParent":"parent":"actualParent";let o=this[n];for(;o&&0!==o.id&&!s.includes(o);){if(e){if(e(o))return[o]}else s.push(o);if(o===i)break;o=o[n]}return s}inherit(t,...e){const i=t.unsafe("initial");for(const s of e)switch(s){case"initial":H.cloneObject(i,this._initial);break;case"base":this._documentParent=t.documentParent,this._bounds=W.assignRect(t.bounds),this._linear=W.assignRect(t.linear),this._box=W.assignRect(t.box);const e=t.actualParent;e&&(this.dir=e.dir);break;case"alignment":for(const e of z)this._styleMap[e]=t.css(e),this._initial.styleMap[e]=i.styleMap[e];if(!this.positionStatic)for(const e of F.BOX_POSITION)t.has(e)&&(this._styleMap[e]=t.css(e)),this._initial.styleMap[e]=i.styleMap[e];if(t.autoMargin.horizontal||t.autoMargin.vertical)for(const e of F.BOX_MARGIN)"auto"===t.cssInitial(e)&&(this._styleMap[e]="auto"),"auto"===t.cssInitial(e)&&(this._initial.styleMap[e]="auto");break;case"styleMap":H.assignEmptyProperty(this._styleMap,t.unsafe("styleMap"));break;case"textStyle":this.cssApply({fontFamily:t.css("fontFamily"),fontSize:t.css("fontSize"),fontWeight:t.css("fontWeight"),fontStyle:t.css("fontStyle"),color:t.css("color"),whiteSpace:t.css("whiteSpace"),textDecoration:t.css("textDecoration"),textTransform:t.css("textTransform"),wordSpacing:t.css("wordSpacing"),opacity:t.css("opacity")})}}alignedVertically(t,e,i,s){if(this.lineBreak)return 2;if(this.pageFlow&&t.length){if(H.isArray(e)){const t=e[e.length-1];if(i&&i.has(this))return 5;if(this.floating&&t.floating){if(this.linear.top>=Math.floor(t.linear.bottom))return 4}else if(this.blockStatic&&void 0!==s){if(i&&i.size&&e.some(t=>i.has(t)))return this.textElement&&e.some(t=>this.linear.top<t.linear.top&&this.linear.bottom>t.linear.bottom)?7:6;if(s){const t=e.find(t=>t.floating);if(t){let{top:e,bottom:i}=this.linear;if(this.textElement&&!this.plainText){const t=D.getRangeClientRect(this._element,this.sessionId);t.top>e&&(e=t.top),t.bottom>i&&(i=t.bottom)}return!H.withinRange(e,t.linear.top)&&(this.multiline?i>t.linear.bottom:e>=t.linear.bottom)?6:0}}else if(e.every(t=>"right"===t.float))return 6}}const n=this.actualParent,o=this.blockStatic||"table"===this.display;for(const s of t){if(s.lineBreak)return 2;if(i&&"both"===i.get(s)&&(!H.isArray(e)||e[0]!==s))return 5;if(o&&(!s.floating||n&&"right"!==s.float&&H.withinRange(s.linear.right,n.box.right)||i&&i.has(s))||s.blockStatic||s.autoMargin.leftRight||"left"===s.float&&this.autoMargin.right||"right"===s.float&&this.autoMargin.left)return 1;if(this.blockDimension){if(H.isArray(e)&&this.linear.top>=Math.floor(e[e.length-1].linear.bottom)&&(!s.floating||this.has("width",32))||"100%"===this.css("width")&&!this.has("maxWidth"))return 3}}}return 0}intersectX(t,e="linear"){const i=this[e];return t.left>=i.left&&t.left<i.right||t.right>i.left&&t.right<=i.right||i.left>=t.left&&i.right<=t.right||t.left>=i.left&&t.right<=i.right}intersectY(t,e="linear"){const i=this[e];return t.top>=i.top&&t.top<i.bottom||t.bottom>i.top&&t.bottom<=i.bottom||i.top>=t.top&&i.bottom<=t.bottom||t.top>=i.top&&t.bottom<=i.bottom}withinX(t,e="linear"){const i=this[e];return Math.ceil(i.left)>=Math.floor(t.left)&&Math.floor(i.right)<=Math.ceil(t.right)}withinY(t,e="linear"){const i=this[e];return Math.ceil(i.top)>=Math.floor(t.top)&&Math.floor(i.bottom)<=Math.ceil(t.bottom)}outsideX(t,e="linear"){const i=this[e];return Math.ceil(i.left)<Math.floor(t.left)||Math.floor(i.right)>Math.ceil(t.right)}outsideY(t,e="linear"){const i=this[e];return Math.ceil(i.top)<Math.floor(t.top)||Math.floor(i.bottom)>Math.ceil(t.bottom)}css(t,e,i=!1){return arguments.length>=2&&(e?this._styleMap[t]=e:delete this._styleMap[t],i&&this.unsetCache(t)),this._styleMap[t]||this.style[t]||""}cssApply(t,e=!1){if(Object.assign(this._styleMap,t),e)for(const e in t)this.unsetCache(e);return this}cssInitial(t,e=!1,i=!1){-1!==this._initial.iteration||e||(i=!0);let s=e?this._styleMap[t]:this._initial.styleMap[t];return i&&!s&&(s=this.style[t]),s||""}cssAny(t,...e){for(const i of e)if(this.css(t)===i)return!0;return!1}cssInitialAny(t,...e){for(const i of e)if(this.cssInitial(t)===i)return!0;return!1}cssAscend(t,e=!1,i=!1){let s="",n=e?this:this.actualParent;for(;n;){if(""!==(s=n.cssInitial(t))){if(!i||n.visible)break;s=""}if(n.documentBody)break;n=n.actualParent}return s}cssSort(t,e=!0,i=!1){const s=i?this.duplicate():this.children;return s.sort((i,s)=>{const n=i.toFloat(t),o=s.toFloat(t);return n===o?0:e?n<o?-1:1:n>o?-1:1}),s}cssPX(t,e,i=!1,s=!1){const n=this._styleMap[t];if(n&&F.isLength(n)){e+=F.parseUnit(n,this.fontSize),!i&&e<0&&(e=0);const o=F.formatPX(e);return this.css(t,o),s&&this.unsetCache(t),o}return""}cssSpecificity(t){if(this.styleElement){const e=this._element,i=this.pseudoElement?D.getElementCache(e,"pseudoType",this.sessionId):"",s=D.getElementCache(e,`styleSpecificity${i?"::"+i:""}`,this.sessionId);if(s)return s[t]||0}return 0}cssTry(t,e){if(this.styleElement){const i=this._element;let s=this.css(t);if(e===s&&(s=i.style[t]),i.style[t]=e,i.style[t]===e)return D.setElementCache(i,t,this.sessionId,s),!0}return!1}cssFinally(t){if(this.styleElement){const e=this._element,i=D.getElementCache(e,t,this.sessionId);if(i)return e.style[t]=i,D.deleteElementCache(e,t,this.sessionId),!0}return!1}toInt(t,e=!1,i=0){const s=parseInt((e?this._initial.styleMap:this._styleMap)[t]);return isNaN(s)?i:s}toFloat(t,e=!1,i=0){const s=parseFloat((e?this._initial.styleMap:this._styleMap)[t]);return isNaN(s)?i:s}parseUnit(t,e=!0,i=!0){if(t){if(F.isPercent(t)){const s=e?"width":"height";let n=parseFloat(t)/100;if(i){const t=this.absoluteParent;if(t)return n*=t.has(s,2)?t.toFloat(s):t.box[s]}return n*(this.has(s,2)?this.toFloat(s):this.bounds[s])}return F.parseUnit(t,this.fontSize)}return 0}convertPX(t,e=!0,i=!0){return`${Math.round(this.parseUnit(t,e,i))}px`}has(t,e=0,i){const s=(i&&"initial"===i.map?this._initial.styleMap:this._styleMap)[t];if(s)switch(s){case"0px":if(H.hasBit(e,64))return!0;switch(t){case"top":case"right":case"bottom":case"left":return!0}case"left":if(H.hasBit(e,8))return!0;case"baseline":if(H.hasBit(e,16))return!0;case"auto":if(H.hasBit(e,4))return!0;case"none":case"initial":case"unset":case"normal":case"transparent":case"rgba(0, 0, 0, 0)":return!1;default:if(i){if(i.not){if(s===i.not)return!1;if(Array.isArray(i.not))for(const t of i.not)if(s===t)return!1}if(i.all)return!0}if(e>0){if(H.hasBit(e,2)&&F.isLength(s))return!0;if(H.hasBit(e,32)&&F.isPercent(s))return!0}return 0===e}return!1}hasAlign(t){return H.hasBit(this.alignmentType,t)}hasProcedure(t){return!H.hasBit(this.excludeProcedure,t)}hasResource(t){return!H.hasBit(this.excludeResource,t)}hasSection(t){return!H.hasBit(this.excludeSection,t)}exclude({section:t=0,procedure:e=0,resource:i=0}){t>0&&!H.hasBit(this._excludeSection,t)&&(this._excludeSection|=t),e>0&&!H.hasBit(this._excludeProcedure,e)&&(this._excludeProcedure|=e),i>0&&!H.hasBit(this._excludeResource,i)&&(this._excludeResource|=i)}setExclusions(){if(this.styleElement){const t=this.actualParent,e=(e,i)=>{let s=this.dataset[`exclude${e}`]||"";if(t&&t.dataset[`exclude${e}Child`]&&(s+=(""!==s?"|":"")+t.dataset[`exclude${e}Child`]),""!==s){let t=0;for(let e of s.split("|"))i[e=e.trim().toUpperCase()]&&!H.hasBit(t,i[e])&&(t|=i[e]);t>0&&this.exclude({[e.toLowerCase()]:t})}};e("Section",a),e("Procedure",l),e("Resource",r)}}setBounds(t=!0){if(this.styleElement){if(this._bounds=W.assignRect(D.getClientRect(this._element,this.sessionId,t),!0),this.documentBody){let t=this.marginTop;if(t>0){const e=this.firstChild;e&&e.blockStatic&&!e.lineBreak&&e.marginTop>=t&&(t=0)}this._bounds.top=t}}else if(this.plainText){const e=D.getRangeClientRect(this._element,this.sessionId,t);this._bounds=W.assignRect(e,!0),this._cached.multiline=e.numberOfLines>0}t||(this._linear=void 0,this._box=void 0)}setInlineText(t,e=!1){if(e)this._inlineText=t;else if(this.htmlElement&&!this.svgElement){switch(this._element.tagName){case"INPUT":case"IMG":case"SELECT":case"TEXTAREA":case"HR":case"SVG":break;default:this._inlineText=t}}}appendTry(t,e,i=!0){let s=!1;for(let i=0;i<this.length;i++)if(this.children[i]===t){this.children[i]=e,e.parent=this,e.innerWrapped=t,s=!0;break}return i&&(e.parent=this,s=!0),s}modifyBox(t,e,i=!0){if(0!==e){const s=P.get(t);s&&(null===e?this._boxReset[s]=1:i?this._boxAdjustment[s]+=e:this[s]+this._boxAdjustment[s]+e<=0?(this._boxReset[s]=1,this._boxAdjustment[s]=0):this._boxAdjustment[s]+=e)}}getBox(t){const e=P.get(t);return e?[this._boxReset[e],this._boxAdjustment[e]]:[0,0]}resetBox(t,e,i=!1){const s=(t,s)=>{for(let n=0;n<t.length;n++)if(1!==this._boxReset[t[n]]){this._boxReset[t[n]]=1;const o=P.get(q[n+s]),a=this[o];e&&0!==a&&(e.naturalElement||0!==e[o]?e.modifyBox(q[n+(i?0:4)],a):e.css(o,F.formatPX(a),!0))}};H.hasBit(t,30)&&s(F.BOX_MARGIN,0),H.hasBit(t,480)&&s(F.BOX_PADDING,4)}inheritBox(t,e){const i=(t,i)=>{for(let s=0;s<t.length;s++){const n=this._boxAdjustment[t[s]];n>0&&(e.modifyBox(q[s+i],n,!1),this._boxAdjustment[t[s]]=0)}};H.hasBit(t,30)&&i(F.BOX_MARGIN,0),H.hasBit(t,480)&&i(F.BOX_PADDING,4)}previousSiblings(t={}){const{floating:e,pageFlow:i,lineBreak:s,excluded:n}=t,o=[];let a=null;if(this._element)a=this._element.previousSibling;else{const t=this.firstChild;t&&(a=t.element.previousSibling)}for(;a;){const t=D.getElementAsNode(a,this.sessionId);if(t)if(!1!==s&&t.lineBreak||!1!==n&&t.excluded)o.push(t);else if(!t.excluded&&t.pageFlow){if(!1===i)break;if(o.push(t),!1!==e||!t.floating&&(t.visible||t.rendered))break}a=a.previousSibling}return o}nextSiblings(t={}){const{floating:e,pageFlow:i,lineBreak:s,excluded:n}=t,o=[];let a=null;if(this._element)a=this._element.nextSibling;else{const t=this.lastChild;t&&(a=t.element.nextSibling)}for(;a;){const t=D.getElementAsNode(a,this.sessionId);if(t)if(!1!==s&&t.lineBreak||!1!==n&&t.excluded)o.push(t);else if(!t.excluded&&t.pageFlow){if(!1===i)break;if(o.push(t),!1!==e||!t.floating&&(t.visible||t.rendered))break}a=a.nextSibling}return o}getFirstChildElement(t={}){const{lineBreak:e,excluded:i}=t;if(this.htmlElement)for(const t of this.actualChildren)if(!t.pseudoElement&&(!t.excluded||!1!==e&&t.lineBreak||!1!==i&&t.excluded))return t.element;return null}getLastChildElement(t={}){const{lineBreak:e,excluded:i}=t;if(this.htmlElement){const t=this.actualChildren;for(let s=t.length-1;s>=0;s--){const n=t[s];if(!n.pseudoElement&&(!n.excluded||!1!==e&&n.lineBreak||!1!==i&&n.excluded))return n.element}}return null}actualRect(t,e="linear"){let i;switch(t){case"top":case"left":i=this.companion&&!this.companion.visible&&this.companion[e][t]<this[e][t]?this.companion:this;break;case"right":case"bottom":i=this.companion&&!this.companion.visible&&this.companion[e][t]>this[e][t]?this.companion:this;break;default:return NaN}return i[e][t]}setDimensions(t){const e=this.unsafe(t);if(e){if(e.width=this.bounds.width,this.plainText)e.height=e.bottom-e.top;else switch(e.height=this.bounds.height,t){case"box":e.width-=this.contentBoxWidth,e.height-=this.contentBoxHeight;break;case"linear":e.width+=(this.marginLeft>0?this.marginLeft:0)+this.marginRight,e.height+=(this.marginTop>0?this.marginTop:0)+this.marginBottom}void 0===this._initial[t]&&(this._initial[t]=W.assignRect(e))}}convertPosition(t){let e=0;if(!this.positionStatic){const i=this.cssInitial(t,!0);(F.isLength(i)||F.isPercent(i))&&(e=H.convertFloat(this.convertLength(t,i,"left"===t||"right"===t)))}return e}convertBorderWidth(t){if(this.styleElement){const e=this.css(`border${t}Style`);if("none"!==e){const i=Math.round(H.convertFloat(this.css(`border${t}Width`)));return 2!==i||"inset"!==e&&"outset"!==e?i:1}}return 0}convertBox(t,e){const i=t+e;switch(this.display){case"table":if("padding"===t&&"collapse"===this.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if("margin"===t)return 0}return H.convertFloat(this.convertLength(i,this.css(i),"Left"===e||"Right"===e))}convertLength(t,e,i,s=!0){return F.isPercent(e)?F.isLength(this.style[t])?this.style[t]:this.convertPX(e,i,s):e}set parent(t){t&&(t!==this._parent&&(this._parent&&this._parent.remove(this),this._parent=t),t.contains(this)||t.append(this),-1===this.depth&&(this.depth=t.depth+1))}get parent(){return this._parent}set tagName(t){this._cached.tagName=t.toUpperCase()}get tagName(){if(void 0===this._cached.tagName){const t=this._element;let e="";t&&(e="#text"===t.nodeName?"PLAINTEXT":"INPUT"===t.tagName?t.type:t.tagName),this._cached.tagName=e.toUpperCase()}return this._cached.tagName}get element(){if(!this.naturalElement&&this.innerWrapped){const t=this.innerWrapped.unsafe("element");if(t)return t}return this._element}get elementId(){return this._element?this._element.id:""}get htmlElement(){return void 0===this._cached.htmlElement&&(this._cached.htmlElement=null!==this._element&&!this.plainText&&!this.svgElement),this._cached.htmlElement}get svgElement(){return null!==this._element&&"svg"===this._element.tagName}get styleElement(){return this.htmlElement||this.svgElement}get naturalElement(){return null!==this._element&&"__squared.placeholder"!==this._element.className}get pseudoElement(){return null!==this._element&&"__squared.pseudo"===this._element.className}get imageElement(){return"IMG"===this.tagName}get flexElement(){return"flex"===this.display||"inline-flex"===this.display}get gridElement(){return"grid"===this.display||"inline-grid"===this.display}get textElement(){return this.plainText||this.inlineText&&!this.inputElement}get tableElement(){return"TABLE"===this.tagName||"table"===this.display}get inputElement(){if(void 0===this._cached.inputElement){const t=this.tagName;this._cached.inputElement=null!==this._element&&"INPUT"===this._element.tagName||"BUTTON"===t||"SELECT"===t||"TEXTAREA"===t}return this._cached.inputElement}get layoutElement(){return this.flexElement||this.gridElement}get groupParent(){return!1}get plainText(){return"PLAINTEXT"===this.tagName}get lineBreak(){return"BR"===this.tagName}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||W.newBoxRectDimension()}get linear(){if(void 0===this._linear&&this._bounds){if(this._element){const t=this._bounds;this._linear={top:t.top-(this.marginTop>0?this.marginTop:0),right:t.right+this.marginRight,bottom:t.bottom+this.marginBottom,left:t.left-(this.marginLeft>0?this.marginLeft:0),width:0,height:0}}else this._linear=W.assignRect(this._bounds);this.setDimensions("linear")}return this._linear||W.newBoxRectDimension()}get box(){if(void 0===this._box&&this._bounds){if(this._element){const t=this._bounds;this._box={top:t.top+(this.paddingTop+this.borderTopWidth),right:t.right-(this.paddingRight+this.borderRightWidth),bottom:t.bottom-(this.paddingBottom+this.borderBottomWidth),left:t.left+(this.paddingLeft+this.borderLeftWidth),width:0,height:0}}else this._box=W.assignRect(this._bounds);this.setDimensions("box")}return this._box||W.newBoxRectDimension()}set renderAs(t){this.rendered||!t||t.rendered||(this._renderAs=t)}get renderAs(){return this._renderAs}get dataset(){return this.htmlElement?this._element.dataset:{}}get excludeSection(){return this._excludeSection}get excludeProcedure(){return this._excludeProcedure}get excludeResource(){return this._excludeResource}get extensions(){return void 0===this._cached.extensions&&(this._cached.extensions=this.dataset.use?H.spliceArray(this.dataset.use.split(/\s*,\s*/),t=>""===t):[]),this._cached.extensions}set flexbox(t){this._cached.flexbox=t}get flexbox(){if(void 0===this._cached.flexbox){const t=this.actualParent,e=this.css("alignSelf"),i=this.css("justifySelf"),s=(e,i,n)=>{const o=(n||this).css(e);return H.isNumber(o)?parseFloat(o):"inherit"===o&&t&&void 0===n?s(e,i,t):i};this._cached.flexbox={alignSelf:"auto"===e&&t&&t.has("alignItems",16,{all:!0})?t.css("alignItems"):e,justifySelf:"auto"===i&&t&&t.has("justifyItems")?t.css("justifyItems"):i,basis:this.css("flexBasis"),grow:s("flexGrow",0),shrink:s("flexShrink",1),order:this.toInt("order")}}return this._cached.flexbox}get width(){return void 0===this._cached.width&&(this._cached.width=Math.max(this.parseUnit(this._styleMap.width),this.parseUnit(this._styleMap.minWidth))),this._cached.width}get height(){return void 0===this._cached.height&&(this._cached.height=Math.max(this.parseUnit(this._styleMap.height,!1),this.parseUnit(this._styleMap.minHeight,!1))),this._cached.height}get hasWidth(){return this.width>0}get hasHeight(){const t=this.cssInitial("height",!0);if(F.isPercent(t)){const e=this.actualParent;return!(!e||!e.hasHeight)&&parseFloat(t)>0}return this.height>0}get lineHeight(){if(void 0===this._cached.lineHeight)if(this.imageElement||this.svgElement)this._cached.lineHeight=0;else{let t=this.has("lineHeight"),e=0;if(t)e=this.toFloat("lineHeight");else if(this.naturalElement&&(e=H.convertFloat(this.cssAscend("lineHeight",!0)),!this.plainText)){const i=D.getElementCache(this.styleElement?this._element:this.documentParent.element,"fontSize",""+this.cssSpecificity("fontSize"));if(i&&i.endsWith("em")){const s=parseFloat(i);s<1&&(this.css("lineHeight",F.formatPX(e*=s)),t=!0)}}this._cached.lineHeight=t||e>this.actualHeight||this.multiline||this.block&&this.actualChildren.some(t=>t.textElement)?e:0}return this._cached.lineHeight}get display(){return this.css("display")}get position(){return this.css("position")}set positionStatic(t){this._cached.positionStatic=t,this.unsetCache("pageFlow")}get positionStatic(){if(void 0===this._cached.positionStatic)switch(this.position){case"fixed":case"absolute":this._cached.positionStatic=!1;break;case"sticky":case"relative":this._cached.positionStatic=!(this.has("top")||this.has("right")||this.has("bottom")||this.has("left")),this._cached.positionStatic&&(this._cached.positionRelative=!1);break;case"inherit":const t=this._element?F.getInheritedStyle(this._element.parentElement,"position"):"";this._cached.positionStatic=""!==t&&!("absolute"===t||"fixed"===t);break;default:this._cached.positionStatic=!0}return this._cached.positionStatic}get positionRelative(){if(void 0===this._cached.positionRelative){const t=this.position;this._cached.positionRelative="relative"===t||"sticky"===t}return this._cached.positionRelative}set positionAuto(t){this._cached.positionAuto=t}get positionAuto(){if(void 0===this._cached.positionAuto){const t=-1===this._initial.iteration?this._styleMap:this._initial.styleMap;this._cached.positionAuto=!(this.pageFlow||void 0!==t.top&&"auto"!==t.top||void 0!==t.right&&"auto"!==t.right||void 0!==t.bottom&&"auto"!==t.bottom||void 0!==t.left&&"auto"!==t.left)}return this._cached.positionAuto}get top(){return void 0===this._cached.top&&(this._cached.top=this.convertPosition("top")),this._cached.top}get right(){return void 0===this._cached.right&&(this._cached.right=this.convertPosition("right")),this._cached.right}get bottom(){return void 0===this._cached.bottom&&(this._cached.bottom=this.convertPosition("bottom")),this._cached.bottom}get left(){return void 0===this._cached.left&&(this._cached.left=this.convertPosition("left")),this._cached.left}get marginTop(){return void 0===this._cached.marginTop&&(this._cached.marginTop=this.inlineStatic?0:this.convertBox("margin","Top")),this._cached.marginTop}get marginRight(){return void 0===this._cached.marginRight&&(this._cached.marginRight=this.convertBox("margin","Right")),this._cached.marginRight}get marginBottom(){return void 0===this._cached.marginBottom&&(this._cached.marginBottom=this.inlineStatic||0===this.bounds.height&&this.every(t=>!t.pageFlow||t.floating&&"none"===t.css("clear"))&&!this.overflowY?0:this.convertBox("margin","Bottom")),this._cached.marginBottom}get marginLeft(){return void 0===this._cached.marginLeft&&(this._cached.marginLeft=this.convertBox("margin","Left")),this._cached.marginLeft}get borderTopWidth(){return void 0===this._cached.borderTopWidth&&(this._cached.borderTopWidth=this.convertBorderWidth("Top")),this._cached.borderTopWidth}get borderRightWidth(){return void 0===this._cached.borderRightWidth&&(this._cached.borderRightWidth=this.convertBorderWidth("Right")),this._cached.borderRightWidth}get borderBottomWidth(){return void 0===this._cached.borderBottomWidth&&(this._cached.borderBottomWidth=this.convertBorderWidth("Bottom")),this._cached.borderBottomWidth}get borderLeftWidth(){return void 0===this._cached.borderLeftWidth&&(this._cached.borderLeftWidth=this.convertBorderWidth("Left")),this._cached.borderLeftWidth}get paddingTop(){if(void 0===this._cached.paddingTop){const t=this.convertBox("padding","Top");if(this.length&&t>0&&!this.layoutElement){let e=0;for(const t of this.children){if(!t.inline||t.has("lineHeight")){e=0;break}e=Math.max(e,t.paddingTop)}this._cached.paddingTop=Math.max(0,t-e)}else this._cached.paddingTop=this.inlineStatic&&!this.visibleStyle.background?0:t}return this._cached.paddingTop}get paddingRight(){return void 0===this._cached.paddingRight&&(this._cached.paddingRight=this.convertBox("padding","Right")),this._cached.paddingRight}get paddingBottom(){if(void 0===this._cached.paddingBottom){const t=this.convertBox("padding","Bottom");if(this.length&&t>0&&!this.layoutElement){let e=0;for(const t of this.children){if(!t.inline||t.has("lineHeight")){e=0;break}e=Math.max(e,t.paddingBottom)}this._cached.paddingBottom=Math.max(0,t-e)}else this._cached.paddingBottom=this.inlineStatic&&!this.visibleStyle.background?0:t}return this._cached.paddingBottom}get paddingLeft(){return void 0===this._cached.paddingLeft&&(this._cached.paddingLeft=this.convertBox("padding","Left")),this._cached.paddingLeft}get contentBox(){return"border-box"!==this.css("boxSizing")}get contentBoxWidth(){return void 0===this._cached.contentBoxWidth&&(this._cached.contentBoxWidth=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth),this._cached.contentBoxWidth}get contentBoxHeight(){return void 0===this._cached.contentBoxHeight&&(this._cached.contentBoxHeight=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth),this._cached.contentBoxHeight}get inline(){if(void 0===this._cached.inline){const t=this.display;this._cached.inline="inline"===t||("initial"===t||"unset"===t)&&!W.ELEMENT_BLOCK.includes(this.tagName)}return this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement),this._cached.inlineStatic}get inlineVertical(){if(void 0===this._cached.inlineVertical){const t=this.display;this._cached.inlineVertical=(t.startsWith("inline")||"table-cell"===t)&&!this.floating&&!this.plainText}return this._cached.inlineVertical}get inlineText(){return this._inlineText}get block(){if(void 0===this._cached.block){switch(this.display){case"block":case"flex":case"grid":case"list-item":this._cached.block=!0;break;case"initial":this._cached.block=W.ELEMENT_BLOCK.includes(this.tagName);break;default:this._cached.block=!1}}return this._cached.block}get blockStatic(){return void 0===this._cached.blockStatic&&(this._cached.blockStatic=this.pageFlow&&this.block&&(!this.floating||"100%"===this.cssInitial("width")&&!this.has("maxWidth"))||this.hasAlign(64)),this._cached.blockStatic}get blockDimension(){if(void 0===this._cached.blockDimension){const t=this.display;this._cached.blockDimension=this.block||t.startsWith("inline-")||"table"===t||this.imageElement}return this._cached.blockDimension}get pageFlow(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=this.positionStatic||this.positionRelative),this._cached.pageFlow}get inlineFlow(){if(void 0===this._cached.inlineFlow){const t=this.display;this._cached.inlineFlow=this.inline||t.startsWith("inline")||"table-cell"===t||this.imageElement||this.floating}return this._cached.inlineFlow}get centerAligned(){return void 0===this._cached.centerAligned&&(this._cached.centerAligned=this.autoMargin.leftRight||this.textElement&&this.blockStatic&&"center"===this.cssInitial("textAlign")),this._cached.centerAligned}get rightAligned(){return void 0===this._cached.rightAligned&&(this._cached.rightAligned="right"===this.float||this.autoMargin.left||!this.pageFlow&&this.has("right")||this.textElement&&this.blockStatic&&"right"===this.cssInitial("textAlign")),this._cached.rightAligned||this.hasAlign(1024)}get bottomAligned(){return void 0===this._cached.bottomAligned&&(this._cached.bottomAligned=!this.pageFlow&&this.has("bottom")&&this.bottom>=0),this._cached.bottomAligned}get horizontalAligned(){return void 0===this._cached.horizontalAligned&&(this._cached.horizontalAligned=!(this.blockStatic||this.autoMargin.horizontal||this.blockDimension&&"100%"===this.css("width"))),this._cached.horizontalAligned}get autoMargin(){if(void 0===this._cached.autoMargin)if(!this.pageFlow||this.blockStatic||"table"===this.display){const t=-1===this._initial.iteration?this._styleMap:this._initial.styleMap,e="auto"===t.marginLeft&&(this.pageFlow||this.has("right")),i="auto"===t.marginRight&&(this.pageFlow||this.has("left")),s="auto"===t.marginTop&&(this.pageFlow||this.has("bottom")),n="auto"===t.marginBottom&&(this.pageFlow||this.has("top"));this._cached.autoMargin={horizontal:e||i,left:e&&!i,right:!e&&i,leftRight:e&&i,vertical:s||n,top:s&&!n,bottom:!s&&n,topBottom:s&&n}}else this._cached.autoMargin={horizontal:!1,left:!1,right:!1,leftRight:!1,top:!1,bottom:!1,vertical:!1,topBottom:!1};return this._cached.autoMargin}get floating(){return void 0===this._cached.floating&&(this._cached.floating=!!this.pageFlow&&this.cssAny("float","left","right")),this._cached.floating}get float(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.css("float"):"none"),this._cached.float}get zIndex(){return this.toInt("zIndex")}set textContent(t){this._cached.textContent=t}get textContent(){return void 0===this._cached.textContent&&(this._cached.textContent=(this.htmlElement||this.plainText)&&this._element.textContent||""),this._cached.textContent}get textEmpty(){return this.inlineText&&(""===this.textContent||!this.preserveWhiteSpace&&""===this.textContent.trim())}get src(){const t=this._element;return t&&(this.imageElement||"image"===t.type)?t.src:""}set overflow(t){0!==t&&16!==t&&8!==t&&24!==t||(this._cached.overflow=t)}get overflow(){if(void 0===this._cached.overflow){const t=this._element;let e=0;if(!this.documentBody){const i=this.css("overflow"),s=this.css("overflowX"),n=this.css("overflowY");this.has("width")&&("scroll"===i||"scroll"===s||"auto"===s&&t&&t.clientWidth!==t.scrollWidth)&&(e|=8),this.has("height")&&("scroll"===i||"scroll"===n||"auto"===n&&t&&t.clientHeight!==t.scrollHeight)&&(e|=16)}this._cached.overflow=e}return this._cached.overflow}get overflowX(){return H.hasBit(this.overflow,8)}get overflowY(){return H.hasBit(this.overflow,16)}set baseline(t){this._cached.baseline=t}get baseline(){if(void 0===this._cached.baseline){const t=this.verticalAlign,e=this.cssInitial("verticalAlign");this._cached.baseline=this.pageFlow&&!this.floating&&!this.svgElement&&("baseline"===t||"initial"===t||F.isLength(e)&&0===parseInt(e))}return this._cached.baseline}get verticalAlign(){if(void 0===this._cached.verticalAlign){let t=this.css("verticalAlign");F.isPercent(t)&&(t=F.formatPX(parseInt(t)/100*this.bounds.height)),this._cached.verticalAlign=t}return this._cached.verticalAlign}set multiline(t){this._cached.multiline=t}get multiline(){return void 0===this._cached.multiline&&(this._cached.multiline=!!(this.plainText||this.inlineText&&(this.inlineFlow||0===this.length))&&D.getRangeClientRect(this._element,this.sessionId).numberOfLines>0),this._cached.multiline}get positiveAxis(){return void 0===this._cached.positiveAxis&&(this._cached.positiveAxis=(!this.positionRelative||this.positionRelative&&this.top>=0&&this.left>=0&&(this.right<=0||this.has("left"))&&(this.bottom<=0||this.has("top")))&&this.marginTop>=0&&this.marginLeft>=0&&this.marginRight>=0),this._cached.positiveAxis}get leftTopAxis(){return"absolute"===this.cssInitial("position")&&this.absoluteParent===this.documentParent||"fixed"===this.position}set renderExclude(t){this._cached.renderExclude=t}get renderExclude(){return void 0===this._cached.renderExclude&&(this._cached.renderExclude=this.pseudoElement&&'""'===this.css("content")&&0===this.contentBoxWidth&&0===this.contentBoxHeight||0===this.bounds.height&&(this.marginTop<0||this.marginBottom<0)),this._cached.renderExclude}get visibleStyle(){if(void 0===this._cached.visibleStyle){const t=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,e=O.CSS.URL.test(this.css("backgroundImage"))||O.CSS.URL.test(this.css("background")),i=this.has("backgroundColor");this._cached.visibleStyle={background:t||e||i,borderWidth:t,backgroundImage:e,backgroundColor:i,backgroundRepeat:"no-repeat"!==this.css("backgroundRepeat")}}return this._cached.visibleStyle}get preserveWhiteSpace(){if(void 0===this._cached.preserveWhiteSpace){const t=this.css("whiteSpace");this._cached.preserveWhiteSpace="pre"===t||"pre-wrap"===t}return this._cached.preserveWhiteSpace}get layoutHorizontal(){return this.hasAlign(8)}get layoutVertical(){return this.hasAlign(16)}set controlName(t){this.rendered&&void 0!==this._controlName||(this._controlName=t)}get controlName(){return this._controlName||""}set documentParent(t){this._documentParent=t}get documentParent(){return this._documentParent||this.actualParent||this.parent||this}get absoluteParent(){if(void 0===this._cached.absoluteParent){let t=this.actualParent;if(!this.pageFlow)for(;t&&0!==t.id;){const e=t.cssInitial("position",!1,!0);if(t.documentBody||"static"!==e&&"initial"!==e&&"unset"!==e)break;t=t.actualParent}this._cached.absoluteParent=t||null}return this._cached.absoluteParent}get actualParent(){return void 0===this._cached.actualParent&&(this._cached.actualParent=this._element&&this._element.parentElement&&D.getElementAsNode(this._element.parentElement,this.sessionId)||null),this._cached.actualParent}set actualChildren(t){this._cached.actualChildren=t}get actualChildren(){if(void 0===this._cached.actualChildren)if(this.htmlElement&&this.naturalElement){const t=[];this._element.childNodes.forEach(e=>{const i=D.getElementAsNode(e,this.sessionId);i&&t.push(i)}),this._cached.actualChildren=t}else this._cached.actualChildren=this._initial.children;return this._cached.actualChildren}get actualWidth(){if(void 0===this._cached.actualWidth){if(this.plainText)this._cached.actualWidth=this.bounds.right-this.bounds.left;else if(!this.documentParent.flexElement&&"table-cell"!==this.display){let t=this.parseUnit(this.cssInitial("width",!0));if(t>0){const e=this.parseUnit(this.css("maxWidth"));return e>0&&(t=Math.min(t,e)),this.contentBox&&!this.tableElement&&(t+=this.contentBoxWidth),this._cached.actualWidth=t,t}}this._cached.actualWidth=this.bounds.width}return this._cached.actualWidth}get actualHeight(){if(void 0===this._cached.actualHeight){if(this.plainText)this._cached.actualHeight=this.bounds.bottom-this.bounds.top;else if(!this.documentParent.flexElement&&"table-cell"!==this.display){let t=this.parseUnit(this.cssInitial("height",!0),!1);if(t>0){const e=this.parseUnit(this.css("maxHeight"));return e>0&&(t=Math.min(t,e)),this.contentBox&&!this.tableElement&&(t+=this.contentBoxHeight),this._cached.actualHeight=t,t}}this._cached.actualHeight=this.bounds.height}return this._cached.actualHeight}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}get firstChild(){for(const t of this.actualChildren)if(t.naturalElement)return t;return null}get lastChild(){for(let t=this.actualChildren.length-1;t>=0;t--){const e=this.actualChildren[t];if(e.naturalElement)return e}return null}get singleChild(){return this.renderParent?1===this.renderParent.length:!(!this.parent||0===this.parent.id)&&1===this.parent.length}get previousSibling(){if(void 0===this._cached.previousSibling){if(this.naturalElement){let t=this._element.previousSibling;for(;t;){const e=D.getElementAsNode(t,this.sessionId);if(e&&(!e.excluded||e.lineBreak))return this._cached.previousSibling=e,e;t=t.previousSibling}}this._cached.previousSibling=null}return this._cached.previousSibling}get nextSibling(){if(void 0===this._cached.nextSibling){if(this.naturalElement){let t=this._element.nextSibling;for(;t;){const e=D.getElementAsNode(t,this.sessionId);if(e&&(!e.excluded||e.lineBreak))return this._cached.nextSibling=e,e;t=t.nextSibling}}this._cached.nextSibling=null}return this._cached.nextSibling}set dir(t){this._cached.dir=t}get dir(){if(void 0===this._cached.dir){let t=this.naturalElement&&this.styleElement&&!this.pseudoElement?this._element.dir:"";switch(t){case"ltr":case"rtl":break;default:let e=this.actualParent;for(;e;){if(t=e.dir){this._cached.dir=t;break}e=e.actualParent}}this._cached.dir=t||document.body.dir}return this._cached.dir}get nodes(){return this.rendered?this.renderChildren:this.children}get center(){return{x:this.bounds.left+Math.floor(this.bounds.width/2),y:this.bounds.top+Math.floor(this.actualHeight/2)}}}const X=squared.lib.color,U=squared.lib.client,$=squared.lib.css,G=squared.lib.math,j=squared.lib.regex,Y=squared.lib.session,K=squared.lib.util,Z=`(rgba?\\(\\d+, \\d+, \\d+(?:, [\\d.]+)?\\)|#[A-Za-z\\d]{3,8}|[a-z]+)\\s*(${j.STRING.LENGTH_PERCENTAGE}|${j.STRING.CSS_ANGLE}|(?:${j.STRING.CSS_CALC}(?=,)|${j.STRING.CSS_CALC}))?,?\\s*`,Q=RegExp(`(?:initial|url\\([^)]+\\)|(repeating)?-?(linear|radial|conic)-gradient\\(((?:to [a-z ]+|(?:from )?-?[\\d.]+(?:deg|rad|turn|grad)|(?:circle|ellipse)?\\s*(?:closest-side|closest-corner|farthest-side|farthest-corner)?)?(?:\\s*at [\\w %]+)?),?\\s*((?:${Z})+)\\))`,"g"),J=/\s*<br[^>]*>\s*/g,tt=/\n/g;function et(t,e,i){let s=e[i];for(let e=0;e<t.actualChildren.length;e++){const n=t.actualChildren[e];(n.excluded||n.pseudoElement||!n.pageFlow||n.dataset.target)&&(K.isString(n[i])?s=s.replace(n[i],""):0===e?s=K.trimStart(s," "):e===t.actualChildren.length-1&&(s=K.trimEnd(s," ")))}return"innerHTML"===i&&(s=s.replace(j.ESCAPE.ENTITY,(t,e)=>String.fromCharCode(parseInt(e)))),s}function it(t,e,i,s){const n=e,o=!0===n.repeating,a=o&&"radial"===e.type?n.radiusExtent/n.radius:1,r=RegExp(Z,"g"),l=[];let c;for(;null!==(c=r.exec(i));){const i=X.parseColor(c[1],s,!0);if(i){const s={color:i,offset:-1};if("conic"===e.type)c[3]&&c[4]&&(s.offset=$.convertAngle(c[3],c[4])/360);else if(c[2]){if($.isPercent(c[2]))s.offset=parseFloat(c[2])/100;else if(o){const i=n.horizontal,o="radial"===e.type?n.radius:e.dimension[i?"width":"height"];$.isLength(c[2])?s.offset=t.parseUnit(c[2],i,!1)/o:$.isCalc(c[2])&&(s.offset=$.calculate(c[6],o,t.fontSize)/o)}o&&-1!==s.offset&&(s.offset*=a)}0===l.length&&(-1===s.offset?s.offset=0:s.offset>0&&l.push({color:i,offset:0})),l.push(s)}}const h=l[l.length-1];-1===h.offset&&(h.offset=1);let d=0;for(let t=0;t<l.length;t++){const e=l[t];if(-1===e.offset)if(0===t)e.offset=0;else{for(let i=t+1,s=2;i<l.length-1;i++,s++)if(-1!==l[i].offset){e.offset=(d+l[i].offset)/s;break}-1===e.offset&&(e.offset=d+h.offset/(l.length-1))}d=e.offset}if(o){if(d<100){const t=l.slice(0);t:{let e=d;for(;d<100;){for(let i=0;i<t.length;i++)if(l.push(Object.assign({},t[i],{offset:d=Math.min(e+t[i].offset,1)})),1===d)break t;e=d}}}}else d<1&&l.push(Object.assign({},l[l.length-1],{offset:1}));return l}function st(t){if(t){let e=$.parseAngle(t.trim());return e<0&&(e+=360),e}return 0}function nt(t,e,i,s){switch(s=s.replace(j.ESCAPE.U00A0,"&#160;"),e.css("whiteSpace")){case"nowrap":s=s.replace(tt," ");break;case"pre":case"pre-wrap":t.layoutVertical||(s=s.replace(/^\s*?\n/,"")),s=s.replace(tt,"\\n").replace(/\s/g,"&#160;");break;case"pre-line":s=s.replace(tt,"\\n").replace(/\s+/g," ");break;default:return i.previousSibling&&Y.causesLineBreak(i.previousSibling,e.sessionId)&&(s=s.replace(j.CHAR.LEADINGSPACE,"")),i.nextSibling&&Y.causesLineBreak(i.nextSibling,e.sessionId)&&(s=s.replace(j.CHAR.TRAILINGSPACE,"")),[s,!1]}return[s,!0]}function ot(t,e,i){if(i){const s=i.split(j.XML.SEPARATOR);return lt.getBackgroundSize(t,s[e%s.length])}}function at(t,e){if("none"===t||"initial"===t)return e;const i=e.split(j.XML.BREAKWORD);switch(t){case"uppercase":for(const t of i)j.XML.ENTITY.test(t)||(e=e.replace(t,t.toUpperCase()));break;case"lowercase":for(const t of i)j.XML.ENTITY.test(t)||(e=e.replace(t,t.toLowerCase()));break;case"capitalize":for(const t of i)e=e.replace(t,K.capitalize(t))}return e}const rt=t=>t?/(.+?)?\s*at (.+?)$/.exec(t):null;class lt{constructor(t,e){this.application=t,this.cache=e}static generateId(t,e,i=1){const s=e;let n=i;1===i&&(e+=`_${""+n}`);const o=this.ASSETS.ids.get(t)||[];for(;;){if(!o.includes(e)){o.push(e);break}e=`${s}_${""+ ++n}`}return this.ASSETS.ids.set(t,o),e}static insertStoredAsset(t,e,i){const s=lt.STORED[t];if(s&&K.hasValue(i)){let n=this.getStoredName(t,i);if(""===n){K.isNumber(e)&&(e=`__${e}`);let t=0;do{n=e,t>0&&(n+=`_${t}`),s.has(n)||s.set(n,i),t++}while(s.has(n)&&s.get(n)!==i)}return n}return""}static getOptionArray(t){const e=[],i=$.getStyle(t).getPropertyValue("text-transform");let s=[],n=-1;for(;++n<t.children.length;){const o=t.children[n].text.trim();if(""!==o)if(s&&0===e.length&&K.isNumber(o))s.push(o);else{if(s&&s.length){n=-1,s=void 0;continue}""!==o&&e.push(at(i,o))}}return[e.length?e:void 0,s&&s.length?s:void 0]}static isBackgroundVisible(t){return void 0!==t&&(void 0!==t.backgroundImage||void 0!==t.borderTop||void 0!==t.borderRight||void 0!==t.borderBottom||void 0!==t.borderLeft)}static getBackgroundSize(t,e){let i=0,s=0;switch(e){case"":case"cover":case"contain":case"100% 100%":case"auto":case"auto auto":case"initial":return;default:const n=e.split(" ");1===n.length&&(n[1]=n[0]);for(let e=0;e<n.length;e++)"auto"===n[e]&&(n[e]="100%"),0===e?i=t.parseUnit(n[e],!0,!1):s=t.parseUnit(n[e],!1,!1)}return i>0&&s>0?{width:Math.round(i),height:Math.round(s)}:void 0}static isInheritedStyle(t,e){if(t.styleElement){const i=t.actualParent;if(i&&!t.cssInitial(e))return t.style[e]===i.style[e]}return!1}static causesLineBreak(t){return t.lineBreak||t.excluded&&t.blockStatic}static hasLineBreak(t,e=!1,i=!1){if(t.actualChildren.length)return t.actualChildren.some(t=>t.lineBreak);if(!e&&t.element&&t.element.textContent){let e=t.element.textContent;if(i&&(e=e.trim()),/\n/.test(e))return!(!t.plainText||!$.isParentStyle(t.element,"whiteSpace","pre","pre-wrap"))||t.css("whiteSpace").startsWith("pre")}return!1}static getStoredName(t,e){if(lt.STORED[t])for(const[i,s]of lt.STORED[t].entries())if(K.isEqual(e,s))return i;return""}finalize(t){}reset(){for(const t in lt.ASSETS)lt.ASSETS[t].clear();for(const t in lt.STORED)lt.STORED[t].clear();this.fileHandler&&this.fileHandler.reset()}addImage(t){if(t&&t.complete){const e=t.src.trim();""!==e&&lt.ASSETS.images.set(e,{width:t.naturalWidth,height:t.naturalHeight,uri:e})}}getImage(t){return lt.ASSETS.images.get(t)}addFont(t){const e=lt.ASSETS.fonts.get(t.fontFamily)||[];e.push(t),lt.ASSETS.fonts.set(t.fontFamily,e)}getFont(t,e="normal",i="400"){const s=lt.ASSETS.fonts.get(t);if(s){const t=this.application.controllerHandler.localSettings.supported.fontFormat;return s.find(s=>s.fontStyle===e&&s.fontWeight===parseInt(i)&&t.includes(s.srcFormat))}}setBoxStyle(t){if(t.visible&&t.styleElement){const e={backgroundColor:"",backgroundSize:"",backgroundRepeat:"",backgroundPositionX:"",backgroundPositionY:"",backgroundImage:void 0,borderRadius:void 0,outline:void 0,backgroundClip:void 0};t.css("border").startsWith("0px none")||(e.borderTop=void 0,e.borderRight=void 0,e.borderBottom=void 0,e.borderLeft=void 0);for(const i in e){const s=t.css(i);switch(i){case"backgroundColor":{if(!t.has("backgroundColor")&&(s===t.cssAscend("backgroundColor",!1,!0)||t.documentParent.visible&&lt.isInheritedStyle(t,"backgroundColor")))continue;const i=X.parseColor(s,t.css("opacity"));i&&(e.backgroundColor=i.valueAsRGBA);break}case"backgroundSize":case"backgroundRepeat":case"backgroundPositionX":case"backgroundPositionY":e[i]=s;break;case"backgroundImage":if("none"!==s&&t.hasResource(r.IMAGE_SOURCE)){const i=[],n=t.css("opacity");let o,a=0;for(;null!==(o=Q.exec(s));){if("initial"===o[0]||o[0].startsWith("url"))i.push(o[0]);else{const s="repeating"===o[1],r=o[2],l=o[3],c=ot(t,a,e.backgroundSize)||t.actualDimension;let h;switch(r){case"conic":{const e=rt(l),i={type:r,dimension:c,angle:st(l)};i.center=$.getBackgroundPosition(e&&e[2]||"center",c,t.fontSize),i.colorStops=it(t,i,o[4],n),h=i;break}case"radial":{const e=rt(l),i={type:r,repeating:s,horizontal:t.actualWidth<=t.actualHeight,dimension:c,shape:e&&e[1]&&e[1].startsWith("circle")?"circle":"ellipse"};i.center=$.getBackgroundPosition(e&&e[2]||"center",c,t.fontSize),i.closestCorner=1/0,i.farthestCorner=-1/0;for(const t of[[0,0],[c.width,0],[c.width,c.height],[0,c.height]]){const e=Math.round(Math.sqrt(Math.pow(Math.abs(t[0]-i.center.left),2)+Math.pow(Math.abs(t[1]-i.center.top),2)));e<i.closestCorner&&(i.closestCorner=e),e>i.farthestCorner&&(i.farthestCorner=e)}i.closestSide=i.center.top,i.farthestSide=i.center.top;for(const t of[c.width-i.center.left,c.height-i.center.top,i.center.left])t<i.closestSide&&(i.closestSide=t),t>i.farthestSide&&(i.farthestSide=t);i.radius=i.farthestCorner;const a=e&&e[1]?e[1].split(" ").pop():"";switch(a){case"closest-corner":case"closest-side":case"farthest-side":const t=i[K.convertCamelCase(a)];s?i.radiusExtent=t:i.radius=t;break;default:i.radiusExtent=i.farthestCorner}i.colorStops=it(t,i,o[4],n),h=i;break}case"linear":{let e=180;switch(l){case"to top":e=0;break;case"to right top":e=45;break;case"to right":e=90;break;case"to right bottom":e=135;break;case"to bottom":break;case"to left bottom":e=225;break;case"to left":e=270;break;case"to left top":e=315;break;default:l&&(e=st(l))}const i={type:r,repeating:s,horizontal:e>=45&&e<=135||e>=225&&e<=315,dimension:c,angle:e};i.colorStops=it(t,i,o[4],n);const a=c.width,d=c.height;let u=G.truncateFraction(G.offsetAngleX(e,a)),g=G.truncateFraction(G.offsetAngleY(e,d));if(u!==a&&g!==d&&!G.isEqual(Math.abs(u),Math.abs(g))){let t;t=e<=90?G.relativeAngle({x:0,y:d},{x:a,y:0}):e<=180?G.relativeAngle({x:0,y:0},{x:a,y:d}):e<=270?G.relativeAngle({x:0,y:0},{x:-a,y:d}):G.relativeAngle({x:0,y:d},{x:-a,y:0});let i=Math.abs(t-e),s=90-i;const n=G.triangulateASA(i,s,Math.sqrt(Math.pow(a,2)+Math.pow(d,2)));u=G.truncateFraction(G.offsetAngleX(e,n[1]));const o=G.triangulateASA(i=90,s=90-e,u);g=G.truncateFraction(G.offsetAngleY(e,o[0]))}i.angleExtent={x:u,y:g},h=i;break}}i.push(h||"initial")}a++}i.length&&(e.backgroundImage=i)}break;case"backgroundClip":switch(s){case"content-box":e.backgroundClip={top:t.borderTopWidth+t.paddingTop,right:t.borderRightWidth+t.paddingRight,bottom:t.borderBottomWidth+t.paddingBottom,left:t.borderLeftWidth+t.paddingLeft};break;case"padding-box":e.backgroundClip={top:t.borderTopWidth,right:t.borderRightWidth,bottom:t.borderBottomWidth,left:t.borderLeftWidth}}break;case"borderTop":case"borderRight":case"borderBottom":case"borderLeft":case"outline":{const s=t.css(`${i}Style`)||"none";let n=t.convertPX(t.css(`${i}Width`),"borderLeft"===i||"borderRight"===i,!1)||"0px",o=t.css(`${i}Color`)||"initial";switch(o.toLowerCase()){case"initial":o="rgb(0, 0, 0)";break;case"inherit":case"currentcolor":o=$.getInheritedStyle(t.element,`${i}Color`)}if("none"!==s&&"0px"!==n){"2px"!==n||"inset"!==s&&"outset"!==s||(n="1px");const a=X.parseColor(o,t.css("opacity"),!0);a&&(e[i]={width:n,style:s,color:a.valueAsRGBA})}break}case"borderRadius":if("0px"!==s){const i=t.actualWidth>=t.actualHeight,[s,n]=t.css("borderTopLeftRadius").split(" "),[o,a]=t.css("borderTopRightRadius").split(" "),[r,l]=t.css("borderBottomRightRadius").split(" "),[c,h]=t.css("borderBottomLeftRadius").split(" ");let d;if((d=n||a||l||h?[s,n||s,o,a||o,r,l||r,c,h||c]:[s,o,r,c]).every(t=>t===d[0])){if("0px"===d[0]||""===d[0])continue;d.length=1}for(let e=0;e<d.length;e++)d[e]=t.convertPX(d[e],i,!1);e.borderRadius=d}}}if(e.borderTop&&e.borderRight&&e.borderBottom&&e.borderLeft){let t=!0;for(const i in e.borderTop){const s=e.borderTop[i];if(s!==e.borderRight[i]||s!==e.borderBottom[i]||s!==e.borderLeft[i]){t=!1;break}}t&&(e.border=e.borderTop)}t.data(lt.KEY_NAME,"boxStyle",e)}}setFontStyle(t){if(!(null===t.element||t.renderChildren.length||t.imageElement||t.svgElement||"HR"===t.tagName||t.inlineText&&!t.preserveWhiteSpace&&""===t.element.innerHTML.trim()&&!t.visibleStyle.background)){const e=t.css("opacity"),i=X.parseColor(t.css("color"),e);let s=t.css("fontFamily").trim(),n=t.css("fontSize"),o=t.css("fontWeight");if(""===s&&U.isUserAgent(16))switch(t.tagName){case"TT":case"CODE":case"KBD":case"SAMP":s="monospace"}if(0===K.convertInt(n))switch(n){case"xx-small":n="8px";break;case"x-small":n="10px";break;case"small":n="13px";break;case"medium":n="16px";break;case"large":n="18px";break;case"x-large":n="24px";break;case"xx-large":n="32px"}if(!K.isNumber(o))switch(o){case"lighter":o="200";break;case"bold":o="700";break;case"bolder":o="900";break;default:o="400"}const a={fontFamily:s,fontStyle:t.css("fontStyle"),fontSize:n,fontWeight:o,color:i?i.valueAsRGBA:""};t.data(lt.KEY_NAME,"fontStyle",a)}}setValueString(t){if(t.visible&&!t.svgElement){const e=t.element,i=t.renderParent;if(e&&i){let s="",n="",o=!1,a=!1;const r=t.css("textTransform");switch(e.tagName){case"INPUT":switch(n=e.value,e.type){case"radio":case"checkbox":t.companion&&!t.companion.visible&&(n=t.companion.textContent);break;case"submit":""!==n||t.visibleStyle.backgroundImage||(n="Submit");break;case"time":""===n&&(n="--:-- --");break;case"date":case"datetime-local":if(""===n){switch((new Intl.DateTimeFormat).resolvedOptions().locale){case"en-US":n="mm/dd/yyyy";break;default:n="dd/mm/yyyy"}"datetime-local"===e.type&&(n+=" --:-- --")}break;case"week":""===n&&(n="Week: --, ----");break;case"month":""===n&&(n="--------- ----");break;case"url":case"email":case"search":case"number":case"tel":""===n&&(n=e.placeholder);break;case"file":n=U.isUserAgent(8)?"Browse...":"Choose File"}break;case"TEXTAREA":n=e.value;break;case"BUTTON":n=at(r,e.innerText);break;case"IFRAME":n=e.src;break;default:t.plainText?(s=t.textContent.trim(),[n]=nt(i,t,e,at(r,t.textContent.replace(j.ESCAPE.AMP,"&amp;"))),a=!0,o=!0):t.inlineText?(s=t.textContent.trim(),n="CODE"===e.tagName?et(t,e,"innerHTML"):lt.hasLineBreak(t,!0)?at(r,et(t,e,"innerHTML")).replace(J,"\\n").replace(j.XML.TAGNAME_G,""):at(r,et(t,e,"textContent")),[n,a]=nt(i,t,e,n),o=!0):lt.isBackgroundVisible(t.data(lt.KEY_NAME,"boxStyle"))&&""===e.innerText.trim()&&(n=at(r,e.innerText))}if(""!==n){if(o){const e=t.previousSiblings().pop();let i=!1;if(n.length>1&&(void 0===e||e.multiline||e.lineBreak||e.plainText&&j.CHAR.TRAILINGSPACE.test(e.textContent)?n=n.replace(j.CHAR.LEADINGSPACE,""):e.element&&(i=j.CHAR.TRAILINGSPACE.test(e.element.innerHTML||e.element.innerText||e.textContent))),a){const s=n;n=n.trim(),!e||e.block||e.lineBreak||i||!j.CHAR.LEADINGSPACE.test(s)||(n="&#160;"+n),!t.lineBreakTrailing&&j.CHAR.TRAILINGSPACE.test(s)&&(n+="&#160;")}else if(""!==n.trim())n=(n=n.replace(j.CHAR.LEADINGSPACE,e&&(e.block||e.lineBreak||i&&e.htmlElement&&e.textContent.length>1||t.multiline&&lt.hasLineBreak(t))?"":"&#160;")).replace(j.CHAR.TRAILINGSPACE,"table-cell"===t.display||t.lineBreakTrailing||t.blockStatic?"":"&#160;");else if(!t.inlineText)return}""!==n&&t.data(lt.KEY_NAME,"valueString",{name:s,value:n})}}}}get assets(){return lt.ASSETS}get stored(){return lt.STORED}}lt.KEY_NAME="squared.resource",lt.ASSETS={ids:new Map,images:new Map,fonts:new Map},lt.STORED={strings:new Map,arrays:new Map,fonts:new Map,colors:new Map,images:new Map};const ct=squared.lib.css,ht=squared.lib.util,dt="[\\d.]+[a-z%]+|auto|max-content|min-content",ut="minmax\\(([^,]+), ([^)]+)\\)",gt="fit-content\\(([\\d.]+[a-z%]+)\\)",ft="\\[([\\w\\-\\s]+)\\]",pt={UNIT:RegExp(`^(${dt})$`),NAMED:`\\s*(repeat\\((auto-fit|auto-fill|\\d+), (.+)\\)|${ft}|${ut}|${gt}|${dt})\\s*`,REPEAT:`\\s*(${ft}|${ut}|${gt}|${dt})\\s*`,STARTEND:/^([\w\-]+)-(start|end)$/};function mt(t,e){const i=[],s=[];for(let n=0;n<e.length;n++)t.repeat[n]?s.push(e[n]):i.push(e[n]);const n=t.count-i.length,o=[];for(let e=0;e<t.count;e++){if(t.repeat[e]){for(let t=0,i=0;t<n;e++,t++,i++)i===s.length&&(i=0),o[e]=s[i];break}i.length&&(o[e]=i.shift())}return o}function bt(t){let e=0;for(const i of t)i&&e++;return e}const yt=(t,e)=>ct.isLength(e)?t.convertPX(e):e;class xt extends k{static createDataAttribute(){return{children:new Set,rowData:[],rowHeight:[],rowHeightCount:[],rowWeight:[],templateAreas:{},row:xt.createDataRowAttribute(),column:xt.createDataRowAttribute(),emptyRows:[],alignItems:"",alignContent:"",justifyItems:"",justifyContent:""}}static createDataRowAttribute(){return{count:0,gap:0,unit:[],unitMin:[],unitTotal:[],repeat:[],auto:[],autoFill:!1,autoFit:!1,name:{},normal:!0}}condition(t){return t.gridElement&&t.length>0}processNode(t){const e=Object.assign({},xt.createDataAttribute(),{alignItems:t.css("alignItems"),alignContent:t.css("alignContent"),justifyItems:t.css("justifyItems"),justifyContent:t.css("justifyContent")}),i=t.css("gridAutoFlow"),s=-1===i.indexOf("column"),n=-1!==i.indexOf("dense"),o=[],a=[],r=[];let l={};if(e.row.gap=t.parseUnit(t.css("rowGap"),!1,!1),e.column.gap=t.parseUnit(t.css("columnGap"),!0,!1),[t.cssInitial("gridTemplateRows",!0),t.cssInitial("gridTemplateColumns",!0),t.css("gridAutoRows"),t.css("gridAutoColumns")].forEach((i,s)=>{if(i&&"none"!==i&&"auto"!==i){const n=RegExp(pt.NAMED,"g");let o,a=1;for(;null!==(o=n.exec(i));)if(s<2){const i=e[0===s?"row":"column"];if(o[1].startsWith("repeat")){let e=1;switch(o[2]){case"auto-fit":i.autoFit=!0;break;case"auto-fill":i.autoFill=!0;break;default:e=ht.convertInt(o[2])}if(e>0){const s=[],n=RegExp(pt.REPEAT,"g");let r;for(;null!==(r=n.exec(o[3]));){let e;null!==(e=RegExp(ft).exec(r[1]))?(void 0===i.name[e[1]]&&(i.name[e[1]]=[]),s.push({name:e[1]})):null!==(e=RegExp(ut).exec(r[1]))?s.push({unit:yt(t,e[2]),unitMin:yt(t,e[1])}):null!==(e=RegExp(gt).exec(r[1]))?s.push({unit:yt(t,e[1]),unitMin:"0px"}):null!==(e=RegExp(dt).exec(r[1]))&&s.push({unit:yt(t,e[0])})}if(s.length)for(let t=0;t<e;t++)for(const t of s)t.name?i.name[t.name].push(a):t.unit&&(i.unit.push(t.unit),i.unitMin.push(t.unitMin||""),i.repeat.push(!0),a++)}}else"["===o[1].charAt(0)?(void 0===i.name[o[4]]&&(i.name[o[4]]=[]),i.name[o[4]].push(a)):o[1].startsWith("minmax")?(i.unit.push(yt(t,o[6])),i.unitMin.push(yt(t,o[5])),i.repeat.push(!1),a++):o[1].startsWith("fit-content")?(i.unit.push(yt(t,o[7])),i.unitMin.push("0px"),i.repeat.push(!1),a++):pt.UNIT.test(o[1])&&(i.unit.push("auto"===o[1]?"auto":yt(t,o[1])),i.unitMin.push(""),i.repeat.push(!1),a++)}else e[2===s?"row":"column"].auto.push(t.convertPX(o[1]))}}),t.sort(s?(t,e)=>ht.withinRange(t.linear.top,e.linear.top)?ht.withinRange(t.linear.left,e.linear.left)?0:t.linear.left<e.linear.left?-1:1:t.linear.top<e.linear.top?-1:1:(t,e)=>ht.withinRange(t.linear.left,e.linear.left)?ht.withinRange(t.linear.top,e.linear.top)?0:t.linear.top<e.linear.top?-1:1:t.linear.left<e.linear.left?-1:1),!t.has("gridTemplateAreas")&&t.every(t=>"auto"===t.css("gridRowStart")&&"auto"===t.css("gridColumnStart"))){let i,n,o,a,l;s?(i="top",n="bottom",o=2,a=1,l=3):(i="left",n="right",o=3,a=0,l=2);let c,h=0,d=0,u=0;t.each((t,g)=>{(void 0===c||t.linear[i]>=c.linear[n]||d>0&&d===u)&&(u=Math.max(d,u),h++,d=1);const f=t.css("gridRowEnd"),p=t.css("gridColumnEnd");let m=1,b=1;if(f.startsWith("span")?m=parseInt(f.split(" ")[1]):ht.isNumber(f)&&(m=parseInt(f)-h),p.startsWith("span")?b=parseInt(p.split(" ")[1]):ht.isNumber(p)&&(b=parseInt(p)-d),1===d&&u>0){let t=!1;do{const i=[].fill(1);for(const t of r){const e=t.placement;if(e[o]>h)for(let t=e[a];t<e[l];t++)i[t-1]=0}for(let e=0,s=0,n=0;e<i.length;e++)if(i[e]){if(0===s&&(n=e),++s===b){d=n+1,t=!0;break}}else s=0;t||(e.emptyRows[h-1]=i,h++)}while(!t)}r[g]={placement:s?[h,d,h+m,d+b]:[d,h,d+b,h+m],rowSpan:m,columnSpan:b},d+=b,c=t})}else t.css("gridTemplateAreas").split(/"[\s\n]+"/).forEach((t,i)=>{if("none"!==t){const s=e.templateAreas;ht.trimString(t.trim(),'"').split(" ").forEach((t,e)=>{"."!==t&&(s[t]?(s[t].rowSpan=i-s[t].rowStart+1,s[t].columnSpan=e-s[t].columnStart+1):s[t]={rowStart:i,rowSpan:1,columnStart:e,columnSpan:1})})}}),t.each((t,i)=>{const s=[t.css("gridRowStart"),t.css("gridColumnStart"),t.css("gridRowEnd"),t.css("gridColumnEnd")],n=[];let o=1,a=1;if(Object.keys(e.templateAreas).length)for(let t=0;t<s.length;t++){const i=s[t];let o=e.templateAreas[i];if(o)switch(t){case 0:n[0]=o.rowStart+1;break;case 1:n[1]=o.columnStart+1;break;case 2:n[2]=o.rowStart+o.rowSpan+1;break;case 3:n[3]=o.columnStart+o.columnSpan+1}else{const s=pt.STARTEND.exec(i);if(s&&(o=e.templateAreas[s[1]]))if("start"===s[2])switch(t){case 0:case 2:n[t]=o.rowStart+1;break;case 1:case 3:n[t]=o.columnStart+1}else switch(t){case 0:case 2:n[t]=o.rowStart+o.rowSpan+1;break;case 1:case 3:n[t]=o.columnStart+o.columnSpan+1}}}if(!(n[0]&&n[1]&&n[2]&&n[3])){function l(t,e){if(ht.isNumber(t))return n[e]=parseInt(t),!0;if(t.startsWith("span")){const i=parseInt(t.split(" ")[1]);return n[e-2]?n[e]=n[e-2]+i:e%2==0?o=i:a=i,!0}return!1}let t,i;for(let r=0;r<s.length;r++){const c=s[r];if("auto"!==c&&!n[r]&&!l(c,r)){const l=e[r%2==0?"row":"column"],h=c.split(" ");1===h.length?(h[1]=h[0],h[0]="1"):ht.isNumber(h[0])&&(r%2==0?t?o=parseInt(h[0])-parseInt(t[0]):t=h:i?a=parseInt(h[0])-parseInt(i[0]):i=h);const d=l.name[h[1]];if(d){const t=parseInt(h[0]);t<=d.length&&(n[r]=d[t-1]+(h[1]===s[r-2]?1:0))}}n[r]||l(c,r)}}r[i]={placement:n,rowSpan:o,columnSpan:a}});{const t=e[s?"column":"row"];t.count=Math.max(1,t.unit.length);for(const e of r)e&&(t.count=Math.max(t.count,s?e.columnSpan:e.rowSpan,e.placement[s?1:0]||0,(e.placement[s?3:2]||0)-1));(t.autoFill||t.autoFit)&&(0===t.unit.length&&(t.unit.push("auto"),t.unitMin.push(""),t.repeat.push(!0)),t.unit=mt(t,t.unit),t.unitMin=mt(t,t.unitMin));let i=1,n=0;for(const e of t.unit)ct.isPercent(e)?i-=parseFloat(e)/100:e.endsWith("fr")&&(n+=parseFloat(e));if(i>0&&n>0)for(let e=0;e<t.unit.length;e++)t.unit[e].endsWith("fr")&&(t.unit[e]=i*(parseFloat(t.unit[e])/n)+"fr");const o=e.row.unit.length+1,a=e.column.unit.length+1;for(const t of r){const e=t.placement;e[2]<0&&(o>1?e[2]+=o+1:e[2]=void 0),e[3]<0&&(a>1?e[3]+=a+1:e[3]=void 0)}}if(t.each((t,i)=>{const c=r[i],h=c.placement;let d,u,g,f,p,m,b;for(s?(d=c.rowSpan,u=c.columnSpan,g=e.column.count,f=0,p=1,m=2,b=3):(d=c.columnSpan,u=c.rowSpan,g=e.row.count,f=1,p=0,m=3,b=2);!h[0]||!h[1];){const t=h.slice(0);if(!t[f]){let e=o.length;for(let i=0,s=0,n=-1;i<e;i++)if(!l[i])if(void 0===a[i]||a[i]<g){if(0===s&&(n=i,e=Math.max(e,i+d)),++s===d){t[f]=n+1;break}}else s=0,n=-1,e=o.length}if(t[f]){if(!t[p]){t[m]||(t[m]=t[f]+d);const e=[],i=t[f]-1,s=t[m]-1;for(let t=i;t<s;t++)if(void 0===o[t])e.push([[0,-1]]);else{if(!(bt(o[t])+u<=g))break;{const i=[];let s=0;for(let e=0,n=-1;e<g;e++)void 0===o[t][e]&&(-1===n&&(n=e),s++),(o[t][e]||e===g-1)&&(s>=u&&i.push([n,n+s]),n=-1,s=0);if(!i.length)break;e.push(i)}}if(e.length)if(-1===e[0][0][1])t[p]=1;else if(e.length===s-i)if(e.length>1)t:for(const i of e[0])for(let s=i[0];s<i[1];s++)for(let i=1;i<e.length;i++)for(let n=0;n<e[i].length;n++){const o=e[i][n];if(s>=o[0]&&(-1===o[1]||s+u<=o[1])){t[p]=s+1;break t}}else t[p]=e[0][0][0]+1}}else h[f]=o.length+1,h[p]||(h[p]=1);t[f]&&t[p]?(h[f]=t[f],h[p]=t[p]):t[f]&&(l[t[f]-1]=!0)}h[m]||(h[m]=h[f]+d),h[b]||(h[b]=h[p]+u),function(t,e){if(e.every(t=>t>0)){for(let i=e[s?0:1]-1;i<e[s?2:3]-1;i++){void 0===o[i]&&(o[i]=[]);for(let n=e[s?1:0]-1;n<e[s?3:2]-1;n++)void 0===a[i]&&(a[i]=0),void 0===o[i][n]&&(o[i][n]=[],a[i]++),o[i][n].push(t)}return!0}return!1}(t,h)&&(t.data(M.CSS_GRID,"cellData",{rowStart:h[0]-1,rowSpan:h[2]-h[0],columnStart:h[1]-1,columnSpan:h[3]-h[1]}),n&&(l={}))}),o.length){if(s)e.rowData=o;else for(let t=0;t<o.length;t++)for(let i=0;i<o[t].length;i++)void 0===e.rowData[i]&&(e.rowData[i]=[]),e.rowData[i][t]=o[t][i];const i=e[s?"row":"column"].unitTotal;let n=0;for(const t of e.rowData){n=Math.max(t.length,n);for(let n=0;n<t.length;n++){const o=t[n];if(void 0===i[n]&&(i[n]=0),o){let t=0;for(let i=0;i<o.length;i++){const n=o[i];n.positioned=!0,e.children.has(n)||(t=Math.max(t,s?n.bounds.height:n.bounds.width)),e.children.add(n)}i[n]+=t}}}if(e.children.size===t.length){e.row.count=e.rowData.length,e.column.count=n;const i=new Set;for(let t=0;t<e.row.count;t++){e.rowHeight.push(0),e.rowHeightCount.push(0);for(let s=0;s<n;s++){const o=e.rowData[t][s];if(o)for(const a of o)if(!i.has(a)){const o=a.data(M.CSS_GRID,"cellData"),r=t+o.rowSpan-1;s+o.columnSpan-1<n-1&&a.modifyBox(4,e.column.gap),r<e.row.count-1&&a.modifyBox(8,e.row.gap),1===o.rowSpan&&(e.rowHeight[t]=Math.max(e.rowHeight[t],a.bounds.height),e.rowHeightCount[t]++),i.add(a)}}}for(let i=0;i<e.rowHeight.length;i++)e.rowWeight[i]=e.rowHeight[i]/t.actualHeight;t.retain(Array.from(e.children)),t.cssSort("zIndex"),t.cssTry("display","block")&&(t.each(t=>{const e=t.initial.bounds;if(e){const i=t.element.getBoundingClientRect();e.width=i.width,e.height=i.height}}),t.cssFinally("display")),t.data(M.CSS_GRID,"mainData",e)}}}}const St=squared.lib.css,_t=squared.lib.session;const vt=squared.lib.util;class Tt extends k{static createDataAttribute(t,e){const i=t.css("flexWrap"),s=t.css("flexDirection");return{directionRow:s.startsWith("row"),directionColumn:s.startsWith("column"),directionReverse:s.endsWith("reverse"),wrap:i.startsWith("wrap"),wrapReverse:"wrap-reverse"===i,alignContent:t.css("alignContent"),justifyContent:t.css("justifyContent"),rowCount:0,columnCount:0,children:e}}condition(t){return t.flexElement&&t.length>0}processNode(t){const e=this.application.controllerHandler,i=t.filter(t=>t.pageFlow&&t.pseudoElement&&'""'===t.css("content")&&0===t.contentBoxWidth?(t.hide(),!1):t.pageFlow),n=Tt.createDataAttribute(t,i);if(t.cssTry("alignItems","start")){if(t.cssTry("justifyItems","start")){for(const t of i){const e=t.initial.bounds;if(e&&t.cssTry("alignSelf","start")){if(t.cssTry("justifySelf","start")){if(t.cssTry("flexGrow","0")){if(t.cssTry("flexShrink","1")){const i=t.element.getBoundingClientRect();e.width=i.width,e.height=i.height,t.cssFinally("flexShrink")}t.cssFinally("flexGrow")}t.cssFinally("justifySelf")}t.cssFinally("alignSelf")}}t.cssFinally("justifyItems")}t.cssFinally("alignItems")}if(n.wrap){let o,a,r,l;n.directionRow?(o="top",a="left",r="right",l="intersectY"):(o="left",a="top",r="bottom",l="intersectX"),i.sort((t,e)=>t[l](e.bounds,"bounds")?vt.withinRange(t.linear[a],e.linear[a])?0:t.linear[a]<e.linear[a]?-1:1:t.linear[o]<e.linear[o]?-1:1);let c=[i[0]],h=i[0];const d=[c];for(let t=1;t<i.length;t++){const e=i[t];h[l](e.bounds,"bounds")?c.push(e):(h=e,d.push(c=[e]))}t.clear();let u=0;for(let i=0;i<d.length;i++){const n=d[i],o=e.createNodeGroup(n[0],n,t);o.siblingIndex=i,t.sort(s.siblingIndex);const a=o.unsafe("box");a&&(a[r]=t.box[r]),o.alignmentType|=128,u=Math.max(n.length,u)}n.directionRow?(n.rowCount=d.length,n.columnCount=u):(n.rowCount=u,n.columnCount=d.length)}else{if(i.some(t=>0!==t.flexbox.order)){const t=n.directionReverse?-1:1,e=n.directionReverse?1:-1;i.sort((i,s)=>i.flexbox.order===s.flexbox.order?0:i.flexbox.order>s.flexbox.order?t:e)}n.directionRow?(n.rowCount=1,n.columnCount=t.length):(n.rowCount=t.length,n.columnCount=1)}t.data(M.FLEXBOX,"mainData",n)}}const Et=squared.lib.util;function At(t,e){for(const i of t){const t=i.findIndex(t=>Et.withinRange(e.linear.top,t.linear.top)||e.linear.top>t.linear.top&&e.linear.top<t.linear.bottom);if(-1!==t)return t}return-1}class wt extends k{static createDataAttribute(){return{paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,columnCount:0}}static createDataCellAttribute(){return{rowSpan:0,columnSpan:0,index:-1,cellStart:!1,cellEnd:!1,rowEnd:!1,rowStart:!1,siblings:[]}}condition(t){if(t.length>1&&!t.layoutElement&&!t.has("listStyle")){if("table"===t.display)return t.every(t=>"table-row"===t.display&&t.every(t=>"table-cell"===t.display));{let e=0,i=0;for(const s of t){if(!s.pageFlow||s.visibleStyle.background||!s.blockStatic||s.autoMargin.leftRight||s.autoMargin.left)return!1;s.length>1&&e++,"list-item"!==s.display||s.has("listStyleType")||i++}if(i===t.length)return!0;if(e>0)return t.every(t=>t.length>0&&s.linearData(t.children).linearX)}}return!1}processNode(t){const e=[],i=[],s={};for(const e of t)for(const t of e){const e=Math.floor(t.linear.left);void 0===s[e]&&(s[e]=[]),s[e].push(t)}const n=Object.keys(s);if(n.length){let o=-1;for(let t=0;t<n.length;t++){const e=s[n[t]];if(0===t)o=e.length;else if(o!==e.length){o=-1;break}}if(-1!==o)for(let t=0;t<n.length;t++)i.push(s[n[t]]);else{const o=[];for(let t=0;t<n.length;t++){const e=s[n[t]];if(0===t&&0===e.length)return;o[t]=0===t?0:o[t-1];for(let s=0;s<e.length;s++){const n=e[s];if(0===t||n.linear.left>=o[t-1])if(void 0===i[t]&&(i[t]=[]),0===t||i[0].length===e.length)i[t][s]=n;else{const e=At(i,n);if(-1===e)return;i[t][e]=n}else{const t=i.length-1;if(i[t]){let e=1/0,s=-1/0;if(i[t].forEach(t=>{e=Math.min(e,t.linear.left),s=Math.max(s,t.linear.right)}),n.linear.left>Math.ceil(e)&&n.linear.right>Math.ceil(s)){const e=At(i,n);if(-1!==e)for(let s=i.length-1;s>=0;s--)if(i[s]){void 0===i[s][e]&&(i[t].length=0);break}}}}o[t]=Math.max(n.linear.right,o[t])}}for(let t=0,e=-1;t<o.length;t++)void 0===i[t]?-1===e?e=t-1:t===o.length-1&&(o[e]=o[t]):-1!==e&&(o[e]=o[t-1],e=-1);for(let t=0;t<i.length;t++)i[t]&&i[t].length?e.push(o[t]):i.splice(t--,1);const a=i.reduce((t,e)=>Math.max(t,e.length),0);for(let t=0;t<a;t++)for(let e=0;e<i.length;e++)void 0===i[e][t]&&(i[e][t]={spacer:1});e.push(t.box.right)}}if(i.length>1&&i[0].length===t.length){const s=Object.assign({},wt.createDataAttribute(),{columnCount:i.length}),n=[];for(let t=0,s=0;t<i.length;t++){let o=0;for(let a=0,r=0;a<i[t].length;a++){const l=i[t][a];if(void 0===n[a]&&(n[a]=[]),l.spacer)1===l.spacer&&o++;else{const c=Object.assign(wt.createDataCellAttribute(),l.data(M.GRID,"cellData"));let h=1,d=1+o;for(let e=t+1;e<i.length&&1===i[e][a].spacer;e++)d++,i[e][a].spacer=2;if(1===d)for(let e=a+1;e<i[t].length&&1===i[t][e].spacer;e++)h++,i[t][e].spacer=2;if(e.length){const i=Math.min(t+(d-1),e.length-1),s=l.documentParent.actualChildren;for(const t of s)t.visible&&!t.rendered&&t.linear.left>=l.linear.right&&t.linear.right<=e[i]&&c.siblings.push(t)}c.rowSpan=h,c.columnSpan=d,c.rowStart=0==r++,c.rowEnd=d+t===i.length,c.cellStart=0===s,c.cellEnd=c.rowEnd&&a===i[t].length-1,c.index=t,o=0,l.data(M.GRID,"cellData",c),n[a].push(l)}}}for(const e of t)e.hide();t.clear();for(const e of n)for(const i of e)i.parent=t;t.tableElement&&"collapse"===t.css("borderCollapse")&&(t.modifyBox(32,null),t.modifyBox(64,null),t.modifyBox(128,null),t.modifyBox(256,null)),t.data(M.GRID,"mainData",s)}}}const It=squared.lib.css,Ct=t=>t.visibleStyle.backgroundImage&&!t.visibleStyle.backgroundRepeat;class kt extends k{static createDataAttribute(){return{ordinal:"",imageSrc:"",imagePosition:""}}condition(t){if(super.condition(t)){const e=t.length;if(e){const i=new Set;let s=0,n=0,o=0,a=0,r=0,l=0;for(let c=0;c<e;c++){const h=t.children[c],d="none"!==h.css("listStyleType");"list-item"===h.display?(d||h.innerBefore||Ct(h))&&l++:Ct(h)&&!d&&h.marginLeft<0&&r++,h.blockStatic&&s++,h.inlineVertical&&n++,h.floating?(i.add(h.float),o++):(0===c||c===e-1||h.blockStatic||t.children[c-1].blockStatic&&t.children[c+1].blockStatic)&&a++}return(r>0||l>0)&&(s===e||n===e||o===e&&1===i.size||a===e)}}return!1}processNode(t){let e=1;t.each(t=>{const i=kt.createDataAttribute(),s=t.css("listStyleType");if("list-item"===t.display||s&&"none"!==s||Ct(t)){if(t.has("listStyleImage"))i.imageSrc=t.css("listStyleImage");else if(i.ordinal=It.convertListStyle(s,e),""===i.ordinal)switch(s){case"disc":i.ordinal="";break;case"square":i.ordinal="";break;case"none":let e="",n="";t.visibleStyle.backgroundRepeat||(e=t.css("backgroundImage"),n=t.css("backgroundPosition")),e&&"none"!==e&&(i.imageSrc=e,i.imagePosition=n,t.exclude({resource:r.IMAGE_SOURCE}));break;default:i.ordinal=""}else i.ordinal+=".";e++}t.data(M.LIST,"mainData",i)})}}const Rt=squared.lib.dom,Bt=squared.lib.util;const Lt=squared.lib.css,Pt=squared.lib.regex;const Mt=squared.lib.css;const Nt=squared.lib.client,Ft=squared.lib.css,Wt=squared.lib.dom,Ot=squared.lib.math,Dt=squared.lib.util,Ht=/none|\s0px|rgba\(0, 0, 0, 0\)|transparent/,zt=/rgba\(0, 0, 0, 0\)|transparent/;class qt extends k{static createDataAttribute(t){return{layoutType:0,rowCount:0,columnCount:0,layoutFixed:"fixed"===t.css("tableLayout"),borderCollapse:"collapse"===t.css("borderCollapse"),expand:!1}}processNode(t){const e=qt.createDataAttribute(t),i=[];function s(e){e.data(M.TABLE,"percent",`${Math.round(e.bounds.width/t.box.width*100)}%`),e.data(M.TABLE,"expand",!0)}function n(t){if(t.length){for(const e of t[0].cascade())"TH"!==e.tagName&&"TD"!==e.tagName||(e.inherit(t[0],"styleMap"),e.unsetCache("visibleStyle"));Dt.concatArray(i,t[0].children);for(const e of t)e.hide()}}const o=t=>t.css("width",Ft.formatPX(t.bounds.width),!0),a=[],r=[],l=[];t.each(t=>{switch(t.tagName){case"THEAD":a.push(t);break;case"TBODY":r.push(t);break;case"TFOOT":l.push(t)}}),n(a);for(const t of r)Dt.concatArray(i,t.children),t.hide();n(l);const[c,h]=e.borderCollapse?[0,0]:Dt.replaceMap(t.css("borderSpacing").split(" "),t=>parseFloat(t)),d=c>1?Math.round(c/2):c,u=h>1?Math.round(h/2):h,g=t.element.querySelector("COLGROUP"),f=[],p=[],m=[],b=[],y=i.length;let x=[].fill(0),S=0;for(let t=0;t<y;t++){const s=i[t];f[t]=c,m[t]=[],s.each((n,o)=>{const a=n.element;for(let e=0;e<a.rowSpan-1;e++){const i=t+1+e;void 0!==x[i]&&(x[i]+=a.colSpan)}if(!n.hasWidth){const t=Dt.convertInt(Wt.getNamedItem(a,"width"));t>0&&n.css("width",Ft.formatPX(t))}if(!n.hasHeight){const t=Dt.convertInt(Wt.getNamedItem(a,"height"));t>0&&n.css("height",Ft.formatPX(t))}if(!n.visibleStyle.backgroundImage&&!n.visibleStyle.backgroundColor)if(g){const e=Ft.getStyle(g.children[x[t]]);e.background?a.style.setProperty("background",e.background):e.backgroundColor&&a.style.setProperty("background-color",e.backgroundColor)}else{let t=Ft.getInheritedStyle(a,"background",zt,"TABLE");""!==t?a.style.setProperty("background",t):""!==(t=Ft.getInheritedStyle(a,"backgroundColor",zt,"TABLE"))&&a.style.setProperty("background-color",t)}switch(n.tagName){case"TH":{function r(t){const e=Ft.getInheritedStyle(a,t,Ht,"TABLE");if(""!==e){const i=/^(\d+[a-z]+) ([a-z]+) (.+)$/.exec(e);i&&(n.css(`${t}Style`,i[2]),n.css(`${t}Color`,i[3]),n.css(`${t}Width`,i[1],!0),n.has("border")||n.css("border","inherit"))}}n.cssInitial("textAlign")||n.css("textAlign",n.css("textAlign")),0===n.borderTopWidth&&r("borderTop"),0===n.borderRightWidth&&r("borderRight"),0===n.borderBottomWidth&&r("borderBottom"),0===n.borderLeftWidth&&r("borderLeft")}case"TD":n.cssInitial("verticalAlign")||n.css("verticalAlign","middle",!0)}const l=n.cssInitial("width"),h=x[t],m=void 0===b[h]||"auto"===b[h];if(0===t||m||!e.layoutFixed)if(""===l||"auto"===l)void 0===b[h]?(b[h]=l||"0px",p[h]=0):t===i.length-1&&m&&0===p[h]&&(p[h]=n.bounds.width);else{const t=Ft.isLength(b[h]),e=Ft.isPercent(l);(m||n.bounds.width<p[h]||n.bounds.width===p[h]&&(t&&e||e&&Ft.isPercent(b[h])&&Dt.convertFloat(l)>Dt.convertFloat(b[h])||t&&Ft.isLength(l)&&Dt.convertFloat(l)>Dt.convertFloat(b[h])))&&(b[h]=l),(m||1===a.colSpan)&&(p[h]=n.bounds.width)}(n.length||n.inlineText)&&(f[t]+=n.bounds.width+c),d>0&&(o<s.length-1&&n.modifyBox(4,d),0!==x[t]&&n.modifyBox(16,d)),u>0&&(t>0&&n.modifyBox(2,u),t+a.rowSpan<i.length&&n.modifyBox(8,u)),x[t]+=a.colSpan}),S=Math.max(S,x[t])}if(t.resetBox(480),c>0&&(t.modifyBox(256,c),t.modifyBox(64,c)),h>0&&(t.modifyBox(32,h),t.modifyBox(128,h)),t.has("width",2)&&b.some(t=>Ft.isPercent(t))&&Dt.replaceMap(b,(t,e)=>"auto"===t&&p[e]>0?Ft.formatPX(p[e]):t),b.every(t=>Ft.isPercent(t))&&b.reduce((t,e)=>t+parseFloat(e),0)>1){let t=100;Dt.replaceMap(b,e=>{const i=parseFloat(e);return t<=0?e="0px":t-i<0&&(e=Ft.formatPercent(t)),t-=i,e})}else if(b.every(t=>Ft.isLength(t))){const i=b.reduce((t,e)=>t+parseFloat(e),0);if(t.hasWidth)if(i<t.width)Dt.replaceMap(b,t=>"0px"!==t?`${parseFloat(t)/i*100}%`:t);else if(i>t.width&&(t.css("width","auto",!0),!e.layoutFixed))for(const e of t.cascade())e.css("width","auto",!0);e.layoutFixed&&!t.has("width")&&t.css("width",Ft.formatPX(t.bounds.width),!0)}const _=b.reduce((t,e)=>t+(Ft.isPercent(e)?parseFloat(e):0),0);e.layoutType=(()=>{if(e.layoutFixed&&b.reduce((t,e)=>t+(Ft.isLength(e)?parseFloat(e):0),0)>=t.actualWidth)return 4;if(b.some(t=>Ft.isPercent(t))||b.every(t=>Ft.isLength(t)&&"0px"!==t))return 3;if(b.every(t=>t===b[0])){if(t.cascadeSome(t=>t.hasHeight))return e.expand=!0,3;if("auto"===b[0]){if(t.hasWidth)return 3;{const e=t.cascade(t=>"TD"===t.tagName);return e.length&&e.every(t=>Dt.withinRange(t.bounds.width,e[0].bounds.width))?0:3}}if(t.hasWidth)return 2}return b.every(t=>"auto"===t||Ft.isLength(t)&&"0px"!==t)?(t.hasWidth||(e.expand=!0),1):0})();const v=t.find(t=>"CAPTION"===t.tagName);t.clear(),v&&(v.hasWidth||Nt.isUserAgent(16)||(v.textElement?v.has("maxWidth")||v.css("maxWidth",Ft.formatPX(v.bounds.width)):v.bounds.width>Ot.maxArray(f)&&o(v)),v.cssInitial("textAlign")||v.css("textAlign","center"),v.data(M.TABLE,"colSpan",S),v.parent=t),x=[].fill(0);const T=t.hasWidth;for(let n=0;n<i.length;n++){const a=i[n],r=a.duplicate();for(let i=0;i<r.length;i++){const a=r[i],l=a.element,c=l.rowSpan,h=l.colSpan;for(let t=0;t<c-1;t++){const e=n+1+t;void 0!==x[e]&&(x[e]+=h)}c>1&&a.data(M.TABLE,"rowSpan",c),h>1&&a.data(M.TABLE,"colSpan",h),a.has("verticalAlign")||a.css("verticalAlign","middle");const d=b[x[n]];if(void 0!==d)switch(e.layoutType){case 3:"auto"===d?_>=1?(o(a),a.data(M.TABLE,"exceed",!T),a.data(M.TABLE,"downsized",!0)):s(a):Ft.isPercent(d)?(a.data(M.TABLE,"percent",d),a.data(M.TABLE,"expand",!0)):Ft.isLength(d)&&parseInt(d)>0?a.bounds.width>=parseInt(d)?(o(a),a.data(M.TABLE,"expand",!1),a.data(M.TABLE,"downsized",!1)):e.layoutFixed?(s(a),a.data(M.TABLE,"downsized",!0)):(o(a),a.data(M.TABLE,"expand",!1)):(a.has("width")&&!a.has("width",32)||o(a),a.data(M.TABLE,"expand",!1));break;case 2:a.css("width","0px");break;case 1:"auto"===d?a.css("width","0px"):(e.layoutFixed?a.data(M.TABLE,"downsized",!0):o(a),a.data(M.TABLE,"expand",!1));break;case 4:Ft.isLength(d)||a.hide()}x[n]+=h;for(let t=0;t<c;t++)for(let e=0;e<h;e++)m[n+t].push(a);a.parent=t}if(x[n]<S){r[r.length-1].data(M.TABLE,"spaceSpan",S-x[n])}a.hide()}if(e.borderCollapse){const e=t.css("borderTopColor"),i=t.css("borderTopStyle"),s=t.css("borderTopWidth"),n=t.css("borderRightColor"),o=t.css("borderRightStyle"),a=t.css("borderRightWidth"),r=t.css("borderBottomColor"),l=t.css("borderBottomStyle"),c=t.css("borderBottomWidth"),h=t.css("borderLeftColor"),d=t.css("borderLeftStyle"),u=t.css("borderLeftWidth");let g=!1,f=!1,p=!1,b=!1;for(let t=0;t<y;t++)for(let x=0;x<S;x++){const _=m[t][x];if(_&&"visible"===_.css("visibility")){if(0===t&&(_.borderTopWidth<parseInt(s)?_.cssApply({borderTopColor:e,borderTopStyle:i,borderTopWidth:s}):g=!0),t>=0&&t<y-1){const e=m[t+1][x];e&&e!==_&&"visible"===e.css("visibility")&&(_.borderBottomWidth>=e.borderTopWidth?e.css("borderTopWidth","0px",!0):_.css("borderBottomWidth","0px",!0))}if(t===y-1&&(_.borderBottomWidth<parseInt(c)?_.cssApply({borderBottomColor:r,borderBottomStyle:l,borderBottomWidth:c}):p=!0),0===x&&(_.borderLeftWidth<parseInt(u)?_.cssApply({borderLeftColor:h,borderLeftStyle:d,borderLeftWidth:u}):b=!0),x>=0&&x<S-1){const e=m[t][x+1];e&&e!==_&&"visible"===e.css("visibility")&&(_.borderRightWidth>=e.borderLeftWidth?e.css("borderLeftWidth","0px",!0):_.css("borderRightWidth","0px",!0))}x===S-1&&(_.borderRightWidth<parseInt(a)?_.cssApply({borderRightColor:n,borderRightStyle:o,borderRightWidth:a}):f=!0)}}(g||f||p||b)&&t.cssApply({borderTopWidth:"0px",borderRightWidth:"0px",borderBottomWidth:"0px",borderLeftWidth:"0px"},!0)}e.rowCount=y,e.columnCount=S,t.data(M.TABLE,"mainData",e)}}const Vt=squared.lib.css,Xt=squared.lib.util;const Ut=squared.lib.session,$t=squared.lib.css,Gt=squared.lib.util;function jt(t,e){const i=t.has("minHeight",2)?t.toFloat("minHeight"):0;t.css("minHeight",$t.formatPX(Math.max(e,i)))}function Yt(t){return!!t&&((t.blockStatic||"table"===t.display)&&!t.lineBreak&&!t.positioned)}function Kt(t){if(t.visible){const e=t.innerWrapped;return e&&!e.naturalElement?e:t}return t.excluded?t:t.renderAs||t.outerWrapper||t.innerWrapped||t}function Zt(t,e){Kt(t).modifyBox(e,null),t.companion&&t.companion.modifyBox(e,null)}function Qt(t,e,i){if(Yt(e)){let s,n,o,a;if(i?(s="marginTop",n="borderTopWidth",o="paddingTop",a=2):(o="paddingBottom",n="borderBottomWidth",s="marginBottom",a=8),0===t[n]&&0===t[o]){for(;0===e[s]&&0===e[n]&&0===e[o];){const t=i?e.firstChild:e.lastChild;if(!Yt(t))break;e=t}const r=t[s]>=e[s];if(0===e.bounds.height&&r)e.hide();else if(1!==e.getBox(a)[0]){let n=!1;if(t.documentBody)r?n=!0:Zt(t,a);else{if(!r){const i=Kt(t);i.modifyBox(a,null),i.modifyBox(a,e[s])}n=!0}n&&(Zt(e,a),0===e.bounds.height&&Zt(e,i?8:2))}}}}const Jt={Accessibility:class extends k{constructor(){super(...arguments),this.options={showLabel:!0}}afterInit(){for(const t of this.application.processing.cache)if(t.hasProcedure(l.ACCESSIBILITY))switch(t.tagName){case"IMAGE":t.extracted=[t];break;case"RADIO":case"CHECKBOX":const e=t.element;[t.nextSibling,t.previousSibling].some(i=>{if(i&&i.visible&&i.pageFlow&&!i.visibleStyle.backgroundImage){const s=i.element,n="LABEL"===i.documentParent.tagName?i.documentParent:void 0;if(e.id&&e.id===s.htmlFor?t.companion=i:i.textElement&&n?(t.companion=i,n.renderAs=t):i.plainText&&(t.companion=i),t.companion)return this.options.showLabel||i.hide(),!0}return!1});break;case"BUTTON":if(t.length){const e=t.filter(t=>!t.textElement);e.length&&(t.extracted=e),t.clear()}}}},CssGrid:xt,External:class extends k{beforeInit(t,e=!1){if((e||this.included(t))&&!_t.getElementCache(t,"squaredExternalDisplay",this.application.processing.sessionId)){const e=[];let i=t;for(;i;)e.push(St.getStyle(i).getPropertyValue("display")),i.style.setProperty("display","block"),i=i.parentElement;_t.setElementCache(t,"squaredExternalDisplay",this.application.processing.sessionId,e)}}init(t){return this.included(t)&&this.application.rootElements.add(t),!1}afterInit(t,e=!1){if(e||this.included(t)){const e=_t.getElementCache(t,"squaredExternalDisplay",this.application.processing.sessionId);if(Array.isArray(e)){let i=t,s=0;for(;i;)i.style.setProperty("display",e[s]),i=i.parentElement,s++;_t.deleteElementCache(t,"squaredExternalDisplay",this.application.processing.sessionId)}}}},Flexbox:Tt,Grid:wt,List:kt,Relative:class extends k{condition(t){return t.positionRelative||0!==t.toFloat("verticalAlign",!0)}processNode(){return{include:!0}}postOptimize(t){const e=t.renderParent;if(e){const i=Bt.convertFloat(t.verticalAlign);let s=t,{top:n,right:a,bottom:r,left:l}=t;if(e.support.container.positionRelative&&e.layoutHorizontal&&0===t.renderChildren.length&&(0!==t.top||0!==t.bottom||0!==i)){s=t.clone(this.application.nextId,!0,!0),t.hide(!0),this.application.session.cache.append(s,!1);const i=new o(e,s,s.containerType,s.alignmentType),n=e.renderChildren.findIndex(e=>e===t);if(-1!==n&&(i.renderIndex=n+1),this.application.addLayout(i),e.layoutHorizontal&&t.documentParent.toInt("textIndent")<0&&e.renderEach(e=>{e.alignSibling("topBottom")===t.documentId?e.alignSibling("topBottom",s.documentId):e.alignSibling("bottomTop")===t.documentId&&e.alignSibling("bottomTop",s.documentId)}),t.baselineActive&&!t.baselineAltered)for(const i of e.horizontalRows||[e.renderChildren])if(i.includes(t)){const e=Bt.filterArray(i,e=>e.positionRelative&&e.length>0&&0!==Bt.convertFloat(t.verticalAlign));if(e.length){e.sort((t,e)=>Bt.withinRange(t.linear.top,e.linear.top)?0:t.linear.top<e.linear.top?-1:1);for(let i=0;i<e.length;i++){const s=e[i];0===i?t.modifyBox(2,Bt.convertFloat(s.verticalAlign)):s.modifyBox(2,s.linear.top-e[0].linear.top),s.css("verticalAlign","0px",!0)}}break}}else if(t.naturalElement&&t.positionRelative){const i=t.actualParent;if(i){let s=!1;for(const o of i.actualChildren){if(o===t){if(s){if(e.layoutVertical&&(0!==t.top||0!==t.bottom)){const e=Rt.assignRect(t.element.getBoundingClientRect(),!0);0!==n&&(n-=e.top-t.bounds.top),0!==r&&(r+=e.bottom-t.bounds.bottom)}if(e.layoutHorizontal&&(0!==t.left||0!==t.right)&&""===t.alignSibling("leftRight")){const e=Rt.assignRect(t.element.getBoundingClientRect(),!0);0!==l&&(l-=e.left-t.bounds.left),0!==a&&(a+=e.right-t.bounds.right)}}else e.layoutVertical&&0!==r&&1===o.getBox(2)[0]&&(r-=o.marginTop);break}o.positionRelative&&o.renderParent===e&&(s=!0)}}}0!==n?s.modifyBox(2,n):0!==r&&s.modifyBox(2,-1*r),0!==i&&s.modifyBox(2,-1*i),0!==l?s.autoMargin.left?s.modifyBox(4,-1*l):s.modifyBox(16,l):0!==a&&s.modifyBox(16,-1*a)}}},Sprite:class extends k{condition(t){let e=!1;if(t.hasWidth&&t.hasHeight&&0===t.length&&(this.included(t.element)||!t.dataset.use)){let i=t.css("backgroundImage");if(""===i||"none"===i){const e=Pt.CSS.URL.exec(t.css("background"));i=e?e[0]:""}if(""!==i){const s=this.application.resourceHandler.getImage(Lt.resolveURL(i));if(s){const i=t.actualDimension,n=Lt.getBackgroundPosition(`${t.css("backgroundPositionX")} ${t.css("backgroundPositionY")}`,i,t.fontSize);n.left<=0&&n.top<=0&&s.width>i.width&&s.height>i.height&&(s.position={x:n.left,y:n.top},t.data(M.SPRITE,"mainData",s),e=!0)}}}return e}},Substitute:class extends k{constructor(t,e,i,s){super(t,e,i,s),this.require(M.EXTERNAL,!0)}processNode(t,e){const i=Mt.getDataSet(t.element,this.name);if(i.tagChild&&t.each(t=>{t.styleElement&&(t.dataset.use=this.name,t.dataset.squaredSubstituteTag=i.tagChild)}),i.tag)return t.setControlType(i.tag),t.render(e),{output:{type:1,node:t,controlName:i.tag}}}},Table:qt,VerticalAlign:class extends k{condition(t){let e=!1,i=0,n=0;for(const s of t)s.inlineVertical&&(n++,0!==Xt.convertInt(s.verticalAlign)&&(e=!0)),(s.positionStatic||s.positionRelative&&s.length)&&i++;return e&&n>1&&i===t.length&&s.linearData(t.children).linearX}processNode(t){return t.each(t=>{(t.inlineVertical&&!t.baseline||t.imageElement)&&(t.baselineAltered=!0)}),{include:!0}}postConstraints(t){if(t.layoutHorizontal)for(const e of t.horizontalRows||[t.renderChildren]){const t=[];let i,s=1/0;for(const n of e)n.inlineVertical&&n.linear.top<=s&&(n.linear.top<s&&(t.length=0),t.push(n),s=n.linear.top),n.baselineActive&&(i=n);if(t.length){const s=t[0].linear.top;for(const n of e)if(n!==i){if(n.inlineVertical&&!n.baseline&&!t.includes(n)){let t=!1;switch(n.verticalAlign){case"super":case"sub":t=!0;break;default:(Vt.isLength(n.verticalAlign)||void 0===i)&&(t=!0)}t&&n.modifyBox(2,n.linear.top-s)}n.baselineAltered&&n.css("verticalAlign","0px",!0)}i&&(i.modifyBox(2,i.linear.top-s),i.baselineAltered=!0)}}else t.each(t=>t.baselineAltered=!1)}},WhiteSpace:class extends k{afterBaseLayout(){const t=new Set;for(const e of this.application.processing.cache)if(e.naturalElement&&!e.layoutElement&&e.actualChildren.length){const i=e.actualChildren;let s,n;for(let o=0;o<i.length;o++){const a=i[o];if(a.pageFlow&&(e.blockStatic&&(void 0===s&&(s=a),n=a),0!==o&&Yt(a))){const e=a.previousSiblings({floating:!1});if(e.length){const i=e.find(t=>!t.floating);if(i){const e=Kt(a);if(Yt(i)){const s=Kt(i);let n=Gt.convertFloat(i.cssInitial("marginBottom",!1,!0)),o=Gt.convertFloat(a.cssInitial("marginTop",!1,!0));if(i.excluded&&!a.excluded){const s=Math.min(n,Gt.convertFloat(i.cssInitial("marginTop",!1,!0)));if(s<0){const n=Math.abs(s)>=o?null:s;e.modifyBox(2,n),e.companion&&e.companion.modifyBox(2,n),t.add(i)}}else if(!i.excluded&&a.excluded){const e=Math.min(o,Gt.convertFloat(a.cssInitial("marginBottom",!1,!0)));e<0&&(s.modifyBox(8,Math.abs(e)>=n?null:e),t.add(a))}else{if(0===i.paddingBottom&&0===i.borderBottomWidth){const t=i.lastChild;if(Yt(t)&&1!==t.getBox(8)[0]){const e=Gt.convertFloat(t.cssInitial("marginBottom",!1,!0));e>n&&s.css("marginBottom",$t.formatPX(n=e),!0),Zt(Kt(t),8)}}if(0===a.borderTopWidth&&0===a.paddingTop){const t=a.firstChild;if(Yt(t)&&1!==t.getBox(2)[0]){const i=Gt.convertFloat(t.cssInitial("marginTop",!1,!0));i>o&&e.css("marginTop",$t.formatPX(o=i),!0),Zt(Kt(t),2)}}n>0&&(o>0?o<=n?Zt(e,2):Zt(s,8):0===i.bounds.height&&Zt(s,8))}}else if(i.blockDimension&&!i.block&&0===a.length){const t=a.linear.top-i.linear.bottom;Math.floor(t)>0&&0===a.ascend(!1,t=>t.has("height")).length&&e.modifyBox(2,t)}}}}}if(s&&Qt(e,s,!0),n&&(Qt(e,n,!1),n.marginTop<0)){const t=n.bounds.height+n.marginBottom+n.marginTop;t<0&&e.modifyBox(128,t,!1)}}for(const e of this.application.processing.excluded)if(!t.has(e)&&e.lineBreak&&!e.lineBreakTrailing){const i=e.previousSiblings({floating:!1}),s=e.nextSiblings({floating:!1});let n=!1;if(i.length&&s.length){let o,a=i.pop(),r=s.pop();if(a.inlineStatic&&r.inlineStatic){if(0===i.length){t.add(e);continue}{const t=i.pop();t.lineBreak&&(t.setBounds(),0!==t.bounds.bottom&&(a=t))}}if(n=!0,r.lineHeight>0&&r.element&&r.cssTry("lineHeight","0px")?(o=Ut.getClientRect(r.element,r.sessionId).top-r.marginTop,r.cssFinally("lineHeight")):o=r.linear.top,a.lineHeight>0&&a.element&&a.cssTry("lineHeight","0px")?(o-=Ut.getClientRect(a.element,a.sessionId).bottom+a.marginBottom,a.cssFinally("lineHeight")):o-=a.linear.bottom,0!==o){a=Kt(a),r=Kt(r);const t=a.visible&&a.renderParent,i=r.visible&&r.renderParent;if(i&&i.groupParent&&i.firstChild===r)i.modifyBox(2,o);else if(t&&t.groupParent&&t.lastChild===a)t.modifyBox(8,o);else if(i&&i.layoutVertical&&r.visible)r.modifyBox(2,o);else if(t&&t.layoutVertical&&a.visible)a.modifyBox(8,o);else{const s=e.actualParent;!i&&!t&&s&&s.visible?r.lineBreak||r.excluded?s.modifyBox(128,o):a.lineBreak||a.excluded?s.modifyBox(32,o):n=!1:n=!1}}}else{const t=e.actualParent;if(t&&t.visible){if(!t.documentRoot&&i.length){const e=i[i.length-1],s=t.box.bottom-e.linear[e.lineBreak||e.excluded?"top":"bottom"];0!==s&&(e.rendered||t.visibleStyle.background?t.modifyBox(128,s):t.hasHeight||jt(t,s))}else if(s.length){const e=s[s.length-1],i=e.linear[e.lineBreak||e.excluded?"bottom":"top"]-t.box.top;0!==i&&(e.rendered||t.visibleStyle.background?t.modifyBox(32,i):t.hasHeight||jt(t,i))}n=!0}}if(n){for(const e of i)t.add(e);for(const e of s)t.add(e)}}}afterConstraints(){const t=[];for(let i of this.application.processing.cache){const s=i.renderAs?i.renderAs.renderParent:i.renderParent;if(s&&i.pageFlow&&i.styleElement&&i.inlineVertical&&!i.positioned&&!i.documentParent.layoutElement&&!s.tableElement&&!t.includes(i.id)){function e(e,s){const n=i.actualRect(16===e?"left":"top")-s;n>0&&((i=Kt(i.outerWrapper||i)).modifyBox(e,n),t.push(i.id))}if(s.layoutVertical){if(i.blockDimension&&!i.lineBreakLeading){const t=s.renderChildren.findIndex(t=>t===i);t>0&&e(2,s.renderChildren[t-1].linear.bottom)}}else if(i.alignParent("left")){if(s.horizontalRows&&i.blockDimension&&!i.floating)t:{let t=0;for(let n=0;n<s.horizontalRows.length;n++){const o=s.horizontalRows[n];for(let s=0;s<o.length;s++)if(i===o[s]){n>0&&e(2,t);break t}let a=!1;for(const e of o)e.blockDimension&&!e.floating&&e.linear.bottom>t&&(t=e.linear.bottom,a=!0);if(!a)break}}}else{let t=i;for(;;){const i=t.previousSiblings();if(i.length&&!i.some(t=>t.lineBreak||t.excluded&&t.blockStatic)){const s=i.pop();if(s.inlineVertical)e(16,s.actualRect("right"));else if(s.floating){t=s;continue}}break}}}}}}},te={constant:N,enumeration:c};t.Application=class{constructor(t,e,i,n,o){this.framework=t,this.initialized=!1,this.closed=!1,this.builtInExtensions={},this.extensions=[],this.rootElements=new Set,this.session={cache:new s,documentRoot:[],targetQueue:new Map,excluded:new s,active:[],extensionMap:new Map},this.processing={cache:new s,node:void 0,excluded:new s,sessionId:""},this._layouts=[],b=e,this.controllerHandler=new i(this,this.processing.cache),this.resourceHandler=new n(this,this.processing.cache),this.extensionManager=new o(this,this.processing.cache)}registerController(t){t.application=this,t.cache=this.processing.cache,this.controllerHandler=t}registerResource(t){t.application=this,t.cache=this.processing.cache,this.resourceHandler=t}finalize(){const t=this.controllerHandler;for(const[t,e]of this.session.targetQueue.entries())if(t.dataset.target){const i=this.resolveTarget(t.dataset.target);i?(t.render(i),this.addLayoutTemplate(i,t,e)):void 0===t.renderParent&&this.session.cache.remove(t)}const e=this.rendered;for(const t of e)t.hasProcedure(l.LAYOUT)&&t.setLayout(),t.hasProcedure(l.ALIGNMENT)&&t.setAlignment();t.optimize(e);for(const t of this.extensions)for(const e of t.subscribers)t.postOptimize(e);for(const t of this.rendered)t.hasResource(r.BOX_SPACING)&&t.setBoxSpacing();for(const t of this.extensions){for(const e of t.subscribers)t.postBoxSpacing(e);t.beforeCascade()}for(const e of this.session.documentRoot){const i=e.node;if(i.documentRoot&&0===i.renderChildren.length&&!i.inlineText&&i.actualChildren.every(t=>t.documentRoot))continue;const s=i.renderParent;s&&s.renderTemplates&&this.saveDocument(e.layoutName,t.localSettings.layout.baseTemplate+t.cascadeDocument(s.renderTemplates,0),i.dataset.pathname,i.renderExtension&&i.renderExtension.some(t=>t.documentBase)?0:void 0)}this.resourceHandler.finalize(this._layouts),t.finalize(this._layouts);for(const t of this.extensions)t.afterFinalize();d.removeElementsByClassName("__squared.placeholder"),d.removeElementsByClassName("__squared.pseudo"),this.closed=!0}saveAllToDisk(){this.resourceHandler.fileHandler&&this.resourceHandler.fileHandler.saveAllToDisk(this.layouts)}reset(){for(const t of this.session.active)this.session.cache.each(e=>{if(e.naturalElement&&!e.pseudoElement){const i=e.element;g.deleteElementCache(i,"node",t),g.deleteElementCache(i,"styleMap",t)}});for(const t of this.rootElements)t.dataset.iteration="";this.session.documentRoot.length=0,this.session.active.length=0,this.session.targetQueue.clear(),this.session.cache.reset(),this.session.excluded.reset(),this.session.extensionMap.clear(),this.processing.cache.reset(),this.controllerHandler.reset(),this.resourceHandler.reset(),this._layouts.length=0;for(const t of this.extensions)t.subscribers.clear();this.closed=!1}parseDocument(...t){let e;this.rootElements.clear(),this.initialized=!1,this.processing.sessionId=this.controllerHandler.generateSessionId,this.session.active.push(this.processing.sessionId),this.setStyleMap(),0===t.length&&t.push(document.body);for(const e of t){const t="string"==typeof e?document.getElementById(e):e;h.hasComputedStyle(t)&&this.rootElements.add(t)}const i=this.resourceHandler.assets.images,s=this.rootElements.values().next().value,n=[],o=()=>{this.initialized=!1;for(const t of n)t.parentElement&&s.removeChild(t);n.length=0;for(const t of this.extensions)t.beforeParseDocument();for(const t of this.rootElements){const e=(t.dataset.iteration?f.convertInt(t.dataset.iteration):-1)+1;if(t.dataset.iteration=""+e,this.createCache(t)){const i=t.dataset.filename&&t.dataset.filename.replace(RegExp(`.${this.controllerHandler.localSettings.layout.fileExtension}$`),"")||t.id||`document_${this.length}`;t.dataset.layoutName=f.convertWord(e>1?`${i}_${e}`:i,!0),this.setBaseLayout(t.dataset.layoutName),this.setConstraints(),this.setResources()}}for(const t of this.extensions){for(const e of t.subscribers)t.postParseDocument(e);t.afterParseDocument()}"function"==typeof e&&e.call(this)},a=[];if(this.userSettings.preloadImages){for(const t of this.rootElements)t.querySelectorAll("input[type=image]").forEach(t=>{const e=t.src;""!==e&&i.set(e,{width:t.width,height:t.height,uri:e})}),t.querySelectorAll("svg image").forEach(t=>{const e=f.resolvePath(t.href.baseVal);""!==e&&i.set(e,{width:t.width.baseVal.value,height:t.height.baseVal.value,uri:e})});for(const t of i.values())if(t.uri&&0===t.width&&0===t.height){const e=document.createElement("img");e.src=t.uri,e.complete&&e.naturalWidth>0&&e.naturalHeight>0?(t.width=e.naturalWidth,t.height=e.naturalHeight):(s.appendChild(e),n.push(e))}for(const t of this.rootElements)t.querySelectorAll("img").forEach(t=>{"IMG"===t.tagName&&(t.complete?this.resourceHandler.addImage(t):a.push(t))})}return a.length?(this.initialized=!0,Promise.all(f.objectMap(a,t=>new Promise((e,i)=>{t.onload=(()=>{e(t)}),t.onerror=(()=>{i(t)})}))).then(t=>{for(const e of t)this.resourceHandler.addImage(e);o()}).catch(t=>{const e=t.target&&t.target.src;e&&!confirm(`FAIL: ${e}`)||o()})):o(),{then:t=>{this.initialized?e=t:t()}}}saveDocument(t,e,i,s){if(f.isString(e)){const n={pathname:i=i?f.trimString(i,"/"):this.controllerHandler.localSettings.layout.pathName,filename:t,content:e,index:s};void 0!==s&&s>=0&&s<this._layouts.length?this._layouts.splice(s,0,n):this._layouts.push(n)}}renderNode(t){return 0===t.itemCount?this.controllerHandler.renderNode(t):this.controllerHandler.renderNodeGroup(t)}addLayout(t){return f.hasBit(t.renderType,512)&&(f.hasBit(t.renderType,8)?t=this.processFloatHorizontal(t):f.hasBit(t.renderType,16)&&(t=this.processFloatVertical(t))),0!==t.containerType&&this.addLayoutTemplate(t.parent,t.node,this.renderNode(t),t.renderIndex)}addLayoutTemplate(t,e,i,s=-1){return!!i&&(e.renderExclude?(e.hide(),e.excluded=!0):e.renderParent?(void 0===t.renderTemplates&&(t.renderTemplates=[]),s>=0&&s<t.renderChildren.length?(t.renderChildren.splice(s,0,e),t.renderTemplates.splice(s,0,i)):(t.renderChildren.push(e),t.renderTemplates.push(i))):this.session.targetQueue.set(e,i),!0)}createNode(t,e=!0,i,s){const n=new b(this.nextId,this.processing.sessionId,t,this.controllerHandler.afterInsertNode);if(i&&(n.depth=i.depth+1),s)for(const t of s)t.parent=n;return e&&this.processing.cache.append(n,void 0!==s),n}resolveTarget(t){for(const e of this.processing.cache)if(e.elementId===t||e.controlId===t)return e;for(const e of this.session.cache)if(e.elementId===t||e.controlId===t)return e}toString(){return this._layouts.length?this._layouts[0].content:""}createCache(t){this.processing.node=void 0,this.processing.cache.afterAppend=void 0,this.processing.cache.clear(),this.processing.excluded.clear();for(const e of this.extensions)e.beforeInit(t);const e=this.cascadeParentNode(t);if(!e)return!1;e.parent=new b(0,this.processing.sessionId,t.parentElement||document.body,this.controllerHandler.afterInsertNode),e.siblingIndex=0,e.documentRoot=!0,e.documentParent=e.parent,this.processing.node=e;const i={},s=new Set;function n(t,e,s,n,o){void 0===i[e]&&(i[e]={}),i[e][s]=o,t.style[s]=n}let o=!1;for(const t of this.processing.cache)if(t.styleElement){const e=t.element;if(t.length){const i=t.cssInitial("textAlign");switch(i){case"center":case"right":case"end":n(e,t.id,"textAlign","left",i)}}if(t.positionRelative)for(const i of h.BOX_POSITION)t.has(i)&&(n(e,t.id,i,"auto",t.css(i)),o=!0);"rtl"===t.dir&&(e.dir="ltr",s.add(e))}const a=new Set;e.parent.setBounds();for(const t of this.processing.cache)t.pseudoElement?a.add(t.parent):t.setBounds(!o&&void 0===i[t.id]&&0===s.size);for(const t of a)[t.innerBefore,t.innerAfter].forEach((e,i)=>{if(e){const s=t.element,n=s.id;let o;e.pageFlow&&(s.id="id_"+Math.round(Math.random()*(new Date).getTime()),o=h.insertStyleSheetRule(`#${s.id}::${0===i?"before":"after"} { display: none !important; }`)),e.cssTry("display",e.display)&&(e.setBounds(!1),e.cssFinally("display")),o&&document.head.removeChild(o),s.id=n}});for(const t of this.processing.excluded)t.lineBreak||(t.setBounds(),t.saveAsInitial());const r=new Set;for(const t of this.processing.cache){if(t.styleElement){const e=t.element,n=i[t.id];if(n)for(const t in n)e.style[t]=n[t];s.has(e)&&(e.dir="rtl")}if(t.saveAsInitial(),!t.documentRoot){const i=t.parent,s=t.absoluteParent;let n;switch(t.position){case"relative":if(t===i.lastChild){let s=!1;if(t.outsideX(i.box)){if(!i.has("width")||"hidden"===i.css("overflowX"))continue;s=!0}if(t.outsideY(i.box)){if(!i.hasHeight&&!i.has("height")||"hidden"===i.css("overflowY"))continue;s=!0}if(s){n=i.actualParent;do{if(t.withinX(n.box)&&t.withinY(n.box)||"hidden"===n.css("overflow"))break;n=i.actualParent}while(n&&n!==e);n&&(t.css("position","absolute",!0),t.setBounds(!1))}}break;case"fixed":if(!t.positionAuto){n=e;break}case"absolute":if(s)if(n=s,t.positionAuto)t.previousSiblings().some(t=>t.multiline||t.excluded&&!t.blockStatic)?t.positionAuto=!1:t.cssApply({display:"inline-block",verticalAlign:"top"},!0),n=i;else if(this.userSettings.supportNegativeLeftTop){let i=!1;for(;n&&n!==e;){if(i){if(n.layoutElement){n=s;break}if(t.withinX(n.box)&&t.withinY(n.box))break}else{const e="hidden"===n.css("overflowX"),s="hidden"===n.css("overflowY");if(e&&s||"0px"===t.cssInitial("top")||"0px"===t.cssInitial("right")||"0px"===t.cssInitial("bottom")||"0px"===t.cssInitial("left"))break;{const o=!e&&t.outsideX(n.box);if(!s&&t.outsideY(n.box)&&(t.top<0||t.marginTop<0||!t.has("top")&&0!==t.bottom||!n.pageFlow&&t.top>0))i=!0;else if(o&&(!t.has("left")&&t.right>0||!n.pageFlow&&t.left>0))i=!0;else if(!e&&t.outsideX(n.linear)&&!t.pseudoElement&&(t.left<0||t.marginLeft<0||!t.has("left")&&t.right<0&&t.linear.left>=n.linear.right))i=!0;else{if(e||s||t.intersectX(n.box)||t.intersectY(n.box))break;i=!0}}}n=n.actualParent}}}if(void 0===n&&(n=t.pageFlow?i:e),n!==i){if(s&&s.positionRelative&&n!==s){const e=t.bounds;0!==s.left?(e.left+=s.left,e.right+=s.left):s.has("left")||0===s.right||(e.left-=s.right,e.right-=s.right),0!==s.top?(e.top+=s.top,e.bottom+=s.top):s.has("top")||0===s.bottom||(e.top-=s.bottom,e.bottom-=s.bottom),t.unsafe("box",!0),t.unsafe("linear",!0)}let e=f.convertFloat(t.css("opacity"))||1,o=i;for(;o&&o!==n;)e*=f.convertFloat(o.css("opacity"))||1,o=o.actualParent;t.css("opacity",""+e),t.parent=n,t.siblingIndex=1/0,r.add(n)}t.documentParent=n}}for(const t of this.processing.cache)if(r.has(t)){const e=[];let i=-1;if(t.each(s=>{if(s.siblingIndex===1/0)for(const i of t.children){let t=i.actualChildren.includes(s);if(!t){const e=i.cascade();t=s.ascend(!1,t=>e.includes(t)).length>0}if(t){const t=i.siblingIndex+(s.zIndex>=0||i!==s.actualParent?1:0);void 0===e[t]&&(e[t]=[]),e[t].push(s);break}}else s.siblingIndex>i&&(i=s.siblingIndex)}),e.length){const s=t.children;for(let t=0,n=0,o=1;t<e.length;t++,n++){const a=e[t];if(a){a.sort((t,e)=>t.parent===e.parent?t.zIndex===e.zIndex?t.id<e.id?-1:1:t.zIndex<e.zIndex?-1:1:0);for(const t of a)t.siblingIndex=i+o++;for(let t=0;t<s.length;t++)a.includes(s[t])&&(s[t]=void 0);s.splice(n,0,...a),n+=a.length}}t.retain(f.flatArray(s))}}this.processing.cache.sort((t,e)=>t.depth!==e.depth?t.depth<e.depth?-1:1:t.documentParent!==e.documentParent?t.documentParent.siblingIndex<e.documentParent.siblingIndex?-1:1:t.siblingIndex<e.siblingIndex?-1:1);for(const e of this.extensions)e.afterInit(t);return!0}cascadeParentNode(t,e=0){const i=this.insertNode(t);if(i){switch(i.depth=e,0===e&&this.processing.cache.append(i),i.tagName){case"SELECT":case"SVG":return i}const s=this.createPseduoElement(t,"before"),n=this.createPseduoElement(t,"after"),o=[];let a=!1;for(let r=0;r<t.childNodes.length;r++){const l=t.childNodes[r];if(l===s){const t=this.insertNode(s);t&&(i.innerBefore=t,t.setInlineText(!0),o.push(t),a=!0)}else if(l===n){const t=this.insertNode(n);t&&(i.innerAfter=t,t.setInlineText(!0),o.push(t),a=!0)}else if("#"===l.nodeName.charAt(0)){if("#text"===l.nodeName){const t=this.insertNode(l,i);t&&o.push(t)}}else if(this.controllerHandler.includeElement(l))if(y(l,this.extensions).some(t=>t.init(l)),this.rootElements.has(l)){const t=this.insertNode(l);t&&(t.documentRoot=!0,t.visible=!1,t.excluded=!0,o.push(t)),a=!0}else{const t=this.cascadeParentNode(l,e+1);t&&(o.push(t),t.excluded||(a=!0))}}for(let t=0;t<o.length;t++){const e=o[t];e.lineBreak&&(t>0&&(o[t-1].lineBreakTrailing=!0),t<o.length-1&&(o[t+1].lineBreakLeading=!0)),e.excluded?this.processing.excluded.append(e):!a&&e.plainText||(e.parent=i,this.processing.cache.append(e)),e.siblingIndex=t}i.setInlineText(!a),i.actualChildren=o}return i}setBaseLayout(t){const e=this.processing.node,i=f.filterArray(this.extensions,t=>!t.eventOnly),n=new Map;function r(t,e,i){const s=n.get(t)||new Map;n.set(t,s.set(e,i))}function l(t){for(const e of n.values())for(const i of e.values())if(i.id===t)return void e.delete(i.id)}r(-1,0,e.parent);let c=0;for(const t of this.processing.cache)t.visible&&(r(t.depth,t.id,t),c=Math.max(t.depth,c));for(let t=0;t<c;t++)n.set(-1*t-2,new Map);this.processing.cache.afterAppend=(t=>{l(t.id),r(-1*t.depth-2,t.id,t);for(const e of t.cascade())l(e.id),r(-1*e.depth-2,e.id,e)});for(const t of n.values())for(const e of t.values()){if(0===e.length)continue;const t=e.duplicate();let n,r=!1;t.length>1&&(r=e.some(t=>t.floating))&&(n=s.linearData(e.actualChildren,!0).cleared);let l=-1;for(;++l<t.length;){let s=t[l];if(!s.visible||s.rendered||s.htmlElement&&!s.documentRoot&&this.rootElements.has(s.element))continue;let c=s.parent;if(t.length>1&&l<t.length-1&&s.pageFlow&&(0===c.alignmentType||c.hasAlign(2)||s.hasAlign(4096))&&!c.hasAlign(4)&&s.hasSection(a.DOM_TRAVERSE)){const e=[],i=[];let a=!1;function h(t){return!i.length&&!a&&(e.push(t),!0)}function d(t){if(c.layoutVertical&&i.length){const e=i[i.length-1];if(e.layoutVertical)return void(t.parent=e)}i.push(t)}let g,p,m=l,b=0;s.hasAlign(4096)&&c.layoutVertical&&(e.push(s),m++,b++);t:{const s=new Set,o=new Set;for(;m<t.length;m++,b++){const l=t[m];if(l.pageFlow){if(r){const t=n.get(l);t&&("both"===t?o.clear():o.delete(t)),l.floating&&(s.add(l.float),o.add(l.float))}if(0===b){const t=l.nextSiblings().shift();if(t){!l.horizontalAligned||t.alignedVertically([l],[l])?i.push(l):e.push(l);continue}}const t=l.previousSiblings(),c=t[t.length-1];if(!c)break t;if(r){const r=l.alignedVertically(t,e.length?e:i,n,e.length>0);if(r>0){if(e.length&&7!==r){if(o.size&&!c.autoMargin.horizontal&&"both"!==n.get(l)&&!t.some(t=>t.lineBreak&&!n.has(t))){function u(){let t=0;return f.captureMap(e,t=>t.floating,e=>t=Math.max(t,e.linear.bottom)),t}if(!l.floating||l.linear.top<u()){if(n.has(l)){if(!l.floating&&o.size>0){l.alignmentType|=4096,e.push(l),a=!0;continue}break t}{const t=u();if(1===s.size&&(!l.floating&&l.linear.top<t||o.has(l.float))){if(e.push(l),!l.floating&&l.linear.bottom>=Math.floor(t))break t;continue}}}}break t}d(l)}else if(!h(l))break t}else if(l.alignedVertically(t))d(l);else if(!h(l))break t}else if(l.positionAuto){if(i.length)break;e.push(l)}}}e.length>1?(g=this.controllerHandler.processTraverseHorizontal(new o(c,s,0,0,e),t),p=e[e.length-1]):i.length>1&&(g=this.controllerHandler.processTraverseVertical(new o(c,s,0,0,i),t),(p=i[i.length-1]).horizontalAligned&&p!==t[t.length-1]&&(p.alignmentType|=4096)),c.hasAlign(2)&&p===t[t.length-1]&&(c.alignmentType^=2),g&&this.addLayout(g.layout)&&(c=s.parent)}if(s.hasAlign(4096)&&(s.alignmentType^=4096),l===t.length-1&&c.hasAlign(2)&&(c.alignmentType^=2),s.renderAs&&c.appendTry(s,s.renderAs,!1)&&(s.hide(),(s=s.renderAs).positioned&&(c=s.parent)),!s.rendered&&s.hasSection(a.EXTENSION)){const t=this.session.extensionMap.get(s.id);let n=e.renderExtension&&e.renderExtension.slice(0);if(t&&(n?f.concatArray(n,t):n=t.slice(0)),n){let t=!1;for(const e of n){const i=e.processChild(s,c);if(i&&(i.output&&this.addLayoutTemplate(i.parentAs||c,s,i.output),i.renderAs&&i.outputAs&&this.addLayoutTemplate(c,i.renderAs,i.outputAs),i.parent&&(c=i.parent),t=!0===i.next,i.complete||t))break}if(t)continue}if(s.styleElement){let e=!1;if(y(s.element,i).some(i=>{if(i.is(s)&&i.condition(s,c)&&(void 0===t||!t.includes(i))){const t=i.processNode(s,c);if(t&&(t.output&&this.addLayoutTemplate(t.parentAs||c,s,t.output),t.renderAs&&t.outputAs&&this.addLayoutTemplate(c,t.renderAs,t.outputAs),t.parent&&(c=t.parent),(t.output||!0===t.include)&&(void 0===s.renderExtension&&(s.renderExtension=[]),s.renderExtension.push(i),i.subscribers.add(s)),e=!0===t.next,t.complete||e))return!0}return!1}),e)continue}}if(!s.rendered&&s.hasSection(a.RENDER)){const e=this.createLayoutControl(c,s),i=s.length?this.controllerHandler.processUnknownParent(e):this.controllerHandler.processUnknownChild(e);if(!0===i.next)continue;if(i.renderAs){t[l]=i.renderAs,l--;continue}this.addLayout(i.layout)}}}this.processing.cache.sort((t,e)=>{if(t.depth===e.depth){if(t.length&&0===e.length)return-1;if(0===t.length&&e.length)return 1}return 0}),this.session.cache.concat(this.processing.cache.children),this.session.excluded.concat(this.processing.excluded.children);for(const i of this.processing.cache)i.documentRoot&&i.rendered&&this.session.documentRoot.push({node:i,layoutName:i===e?t:""});for(const t of this.extensions){for(const e of t.subscribers)t.postBaseLayout(e);t.afterBaseLayout()}}setConstraints(){this.controllerHandler.setConstraints();for(const t of this.extensions){for(const e of t.subscribers)t.postConstraints(e);t.afterConstraints()}}setResources(){for(const t of this.processing.cache)this.resourceHandler.setBoxStyle(t),this.resourceHandler.setFontStyle(t),this.resourceHandler.setValueString(t);for(const t of this.extensions)t.afterResources()}processFloatHorizontal(t){const e=this.controllerHandler,i=t.itemCount;if(0===t.cleared.size&&!t.some(t=>t.autoMargin.horizontal||t.multiline)){const s=[],n=[],o=[];for(const e of t)switch(e.float){case"left":n.push(e);break;case"right":o.push(e);break;default:s.push(e)}if(n.length===i||o.length===i||s.length===i||(0===n.length||0===o.length)&&!s.some(t=>t.blockStatic))return e.processLayoutHorizontal(t),t}const n=[],a=[],r=[],l=[],c=[],h=[],u=[];let p=[],m=[],b="",y=0;for(const e of t){const i=t.cleared.get(e);if(i)switch(i){case"left":f.hasBit(y,2)&&(y^=2),b="left";break;case"right":f.hasBit(y,4)&&(y^=4),b="right";break;case"both":switch(y){case 2:b="left";break;case 4:b="right";break;default:b="both"}y=0}if(e.autoMargin.horizontal)e.autoMargin.leftRight?u.length?c.push(e):l.push(e):e.autoMargin.left?c.push(e):l.push(e);else if(""===b)if("right"===e.float)c.push(e),f.hasBit(y,4)||(y|=4);else if("left"===e.float)l.push(e),f.hasBit(y,2)||(y|=2);else if(h.length||u.length)r.push(e);else if(l.length||c.length){let t=e.linear.top;if(e.textElement&&!e.plainText){const i=g.getRangeClientRect(e.element,e.sessionId);i.top>t&&(t=i.top)}l.some(e=>t>=e.linear.bottom)||c.some(e=>t>=e.linear.bottom)?r.push(e):a.push(e)}else a.push(e);else if("right"===e.float)0!==u.length||f.hasBit(y,4)||(y|=4),"right"!==b&&c.length?c.push(e):u.push(e);else if("left"===e.float)0!==h.length||f.hasBit(y,2)||(y|=2),"left"!==b&&l.length?l.push(e):h.push(e);else switch(b){case"left":h.push(e);break;case"right":u.push(e);break;default:r.push(e)}}l.length&&h.length?p=[l,h]:l.length?p=l:h.length&&(p=h),c.length&&u.length?m=[c,u]:c.length?m=c:u.length&&(m=u);const x=e.containerTypeVertical,S=c.length+u.length===t.length?1024:0;if(r.length){r.length>1&&(r[0].alignmentType|=4096),r.unshift(t.node);const e=this.createNode(d.createElement(t.node.actualParent&&t.node.actualParent.element),!0,t.parent,r);this.addLayout(new o(t.parent,e,x.containerType,x.alignmentType|(t.parent.blockStatic?64:0),r)),t.reset(e)}t.add(S);let _,v=e.containerTypeVerticalMargin;a.length?u.length?n.push(p=[a,l],m):h.length?n.push(m=[a,c],p):n.push(a,p,m):(p===h&&m===c||p===l&&m===u?n.push(0===h.length?[l,u]:[c,h]):n.push(p,m),0!==p.length&&0!==m.length||(v=x)),f.spliceArray(n,t=>0===t.length),t.itemCount=n.length,t.setType(v.containerType,v.alignmentType),t.hasAlign(1024)&&t.add(64);for(let r=0;r<n.length;r++){const d=n[r];let g;if(Array.isArray(d[0])){g=d;const i=[];for(const t of g)f.concatArray(i,t);if(i.sort(s.siblingIndex),t.node.layoutVertical)_=t.node;else{_=e.createNodeGroup(i[0],i,t.node);const s=new o(t.node,_,x.containerType,x.alignmentType|(g.some(t=>t===m||t===c)?1024:0));s.itemCount=g.length,this.addLayout(s)}}else g=[d],_=void 0;for(const s of g){const n=!_||s!==a&&s!==l&&s!==h&&s!==c&&s!==u?t.node:_,r=e.createNodeGroup(s[0],s,n),d=new o(n,r,0,s.length<i?128:0,s);if(s.some(t=>t.blockStatic||t.multiline&&n.blockStatic||t.has("width",32))&&d.add(64),1===s.length)if(r.innerWrapped=s[0],s[0].outerWrapper=r,s[0].has("width",32)){const t=this.controllerHandler.containerTypePercent;d.setType(t.containerType,t.alignmentType)}else d.setType(x.containerType,x.alignmentType);else d.linearY?d.setType(x.containerType,x.alignmentType):e.processLayoutHorizontal(d);if(this.addLayout(d),s===a){if(l.length){let t=-1/0,e=!1;for(const i of l){const s=i.linear.right+(i.marginLeft<0?i.marginLeft:0);s>t&&(t=s,e=i.marginRight>0)}const i=t-n.box.left;i>0&&r.modifyBox(256,i+(!e&&r.cascadeSome(t=>t.multiline)?this.controllerHandler.localSettings.deviations.textMarginBoundarySize:0))}if(c.length){let t=1/0,e=!1;for(const i of c){const s=i.linear.left+(i.marginRight<0?i.marginRight:0);s<t&&(t=s,e=i.marginLeft>0)}const i=n.box.right-t;i>0&&r.modifyBox(64,i+(!e&&r.cascadeSome(t=>t.multiline)?this.controllerHandler.localSettings.deviations.textMarginBoundarySize:0))}}}}return t}processFloatVertical(t){const e=this.controllerHandler,i=e.containerTypeVertical;if(0!==t.containerType){const s=e.createNodeGroup(t.node,[t.node],t.parent);this.addLayout(new o(s,t.node,i.containerType,i.alignmentType,s.children)),t.node=s}else t.containerType=i.containerType,t.add(i.alignmentType);const s=[],n=[],a=[],r=[];let l=!1,c=!1,h=!0;for(const e of t)e.blockStatic&&0===r.length?(a.push(e),c=!0):(t.cleared.has(e)&&(e.floating?l=!0:(e.modifyBox(2,null),s.push(a.slice(0)),n.push(r.slice(0)),a.length=0,r.length=0)),e.floating?(c&&(s.push(a.slice(0)),n.push(null),a.length=0,r.length=0,c=!1),r.push(e)):(l&&!t.cleared.has(e)&&(h=!1),a.push(e)));if(r.length&&n.push(r),a.length&&s.push(a),!h)for(let a=0;a<Math.max(n.length,s.length);a++){const r=s[a]||[];if(null===n[a]&&r.length){const i=e.containerTypeVertical;i.alignmentType|=192,this.addLayout(new o(t.node,e.createNodeGroup(r[0],r,t.node),i.containerType,i.alignmentType,r))}else{const s=n[a]||[];if(r.length||s.length){const n=e.createNodeGroup(s[0]||r[0],[],t.node),a=e.containerTypeVerticalMargin,l=new o(t.node,n,a.containerType,a.alignmentType),c=[];let h;s.length>1?(h=e.createNodeGroup(s[0],s,n),l.add(512),0===r.length&&s.every(t=>"right"===t.float)&&l.add(1024)):s.length&&((h=s[0]).parent=n),h&&(c.push(h),h=void 0),r.length>1?h=e.createNodeGroup(r[0],r,n):r.length&&((h=r[0]).parent=n),h&&c.push(h),n.init(),l.itemCount=c.length,this.addLayout(l);for(let t of c)t.groupParent||(t=e.createNodeGroup(t,[t],n)),this.addLayout(new o(n,t,i.containerType,192|i.alignmentType,t.children))}}}return t}insertNode(t,e){if("#text"!==t.nodeName){if(this.conditionElement(t)){this.controllerHandler.applyDefaultStyles(t);const e=this.createNode(t,!1);return this.userSettings.exclusionsDisabled||e.setExclusions(),e}{const e=this.createNode(t,!1);return e.visible=!1,e.excluded=!0,e}}if(p.isPlainText(t.textContent)||h.isParentStyle(t,"whiteSpace","pre","pre-wrap")){this.controllerHandler.applyDefaultStyles(t);const i=this.createNode(t,!1);return e&&(i.inherit(e,"textStyle"),i.pageFlow||i.css("backgroundColor",e.css("backgroundColor"))),i}}conditionElement(t){if(!this.controllerHandler.localSettings.unsupported.excluded.has(t.tagName)){if(this.controllerHandler.visibleElement(t)||t.dataset.use&&t.dataset.use.split(u.XML.SEPARATOR).some(t=>!!this.extensionManager.retrieve(t.trim())))return!0;{let e=t.parentElement,i=!0;for(;e;){if("none"===h.getStyle(e).display){i=!1;break}e=e.parentElement}if(i)for(let e=0;e<t.children.length;e++)if(this.controllerHandler.visibleElement(t.children[e]))return!0;return!1}}return!1}createPseduoElement(t,e){const i=g.getElementCache(t,`styleMap::${e}`,this.processing.sessionId);if(i&&i.content){if(""===f.trimString(i.content,'"').trim()&&0===f.convertFloat(i.width)&&("absolute"===i.position||"fixed"===i.position||i.clear&&"none"!==i.clear))return;let a=i.content;if("inherit"===a){let i=t.parentElement;for(;i&&"inherit"===(a=h.getStyle(i,e).getPropertyValue("content"));)i=i.parentElement}const r=h.getStyle(t);void 0===i.fontFamily&&(i.fontFamily=r.getPropertyValue("font-family")),i.fontSize=i.fontSize?h.convertPX(i.fontSize,h.getFontSize(document.body)):r.getPropertyValue("font-size"),void 0===i.fontWeight&&(i.fontWeight=r.getPropertyValue("font-weight")),void 0===i.color&&(i.color=r.getPropertyValue("color")),void 0===i.display&&(i.display="inline");let l=i.display.startsWith("inline")?"span":"div",c="";switch(a){case"normal":case"none":case"initial":case"inherit":case"no-open-quote":case"no-close-quote":case'""':break;case"open-quote":"before"===e&&(c="&quot;");break;case"close-quote":"after"===e&&(c="&quot;");break;default:if(a.startsWith("url(")){c=h.resolveURL(a);const t=f.fromLastIndexOf(c,".").toLowerCase();this.controllerHandler.localSettings.supported.imageFormat.includes(t)?l="img":c=""}else{let i;void 0===m.COUNTERS&&(m.COUNTERS=/\s*(?:attr\(([^)]+)\)|(counter)\(([^,)]+)(?:, ([a-z\-]+))?\)|(counters)\(([^,]+), "([^"]*)"(?:, ([a-z\-]+))?\)|"([^"]+)")\s*/g);let l=!1;for(;null!==(i=m.COUNTERS.exec(a));){if(i[1])c+=d.getNamedItem(t,i[1].trim());else if(i[2]||i[5]){const a="counter"===i[2];let l,d;function s(t){if("none"!==t){const e=/\s*([^\-\d][^\-\d]?[^ ]*) (-?\d+)\s*/g;let i;for(;null!==(i=e.exec(t));)if(i[1]===l)return parseInt(i[2])}}a?(l=i[3],d=i[4]||"decimal"):(l=i[6],d=i[8]||"decimal");const u=t=>{const i=g.getElementCache(t,`styleMap::${e}`,this.processing.sessionId);if(i&&i.counterIncrement)return s(i.counterIncrement)},f=(u(t)||0)+(s(r.getPropertyValue("counter-reset"))||0),p=[];let m,b=t,y=f,x=!1;function n(t,e=!1){0===p.length?y+=t:(x||e)&&(p[p.length-1]+=t)}function o(t){if(void 0===s(h.getStyle(t).getPropertyValue("counter-reset")))for(let e=0;e<t.children.length;e++){const i=t.children[e];if("__squared.pseudo"!==i.className){let t=u(i);t&&n(t,!0);const e=h.getStyle(i);if((t=s(e.getPropertyValue("counter-increment")))&&n(t),void 0!==(t=s(e.getPropertyValue("counter-reset"))))return;o(i)}}}for(;;){if(x=!1,b.previousElementSibling)o(b=b.previousElementSibling);else{if(!b.parentElement)break;b=b.parentElement,x=!0}if("__squared.pseudo"!==b.className){const t=u(b);t&&n(t,!0);const e=h.getStyle(b),i=s(e.getPropertyValue("counter-increment"))||0;i&&n(i);const o=s(e.getPropertyValue("counter-reset"));if(void 0!==o){if(void 0===m&&(y+=o),m=b,a)break;x&&p.push((t||0)+o)}}}if(m){if(!a&&p.length>1){p.reverse(),p.splice(1,1);for(const t of p)c+=h.convertListStyle(d,t,!0)+i[7]}}else y=f;c+=h.convertListStyle(d,y,!0)}else i[9]&&(c+=i[9]);l=!0}l||(c=a)}}if(c||'""'===a){const s=d.createElement(t,l,!1,"before"===e?0:-1);"img"===l?s.src=c:'""'!==a&&(s.innerText=c);for(const t in i)"display"!==t&&(s.style[t]=i[t]);return g.setElementCache(s,"pseudoType",this.processing.sessionId,e),g.setElementCache(s,"styleMap",this.processing.sessionId,i),s}}}setStyleMap(){let t=!1;for(let e=0;e<document.styleSheets.length;e++){const i=document.styleSheets[e];try{if(i.cssRules)for(let t=0;t<i.cssRules.length;t++){const e=i.cssRules[t];switch(e.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(e);break;case CSSRule.MEDIA_RULE:h.validMediaRule(e.conditionText||x("media",e.cssText))&&this.applyCSSRuleList(e.cssRules);break;case CSSRule.SUPPORTS_RULE:CSS.supports&&CSS.supports(e.conditionText||x("supports",e.cssText))&&this.applyCSSRuleList(e.cssRules)}}}catch(e){t||(alert("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+`${i.href}\n\n${e}`),t=!0)}}}applyCSSRuleList(t){for(let e=0;e<t.length;e++)this.applyStyleRule(t[e])}applyStyleRule(t){switch(t.type){case CSSRule.STYLE_RULE:{const e=[];for(const i of Array.from(t.style))e.push(f.convertCamelCase(i));for(const i of t.selectorText.split(u.XML.SEPARATOR)){const s=h.getSpecificity(i),[n,o]=i.split("::"),a=o?"::"+o:"";document.querySelectorAll(n||"*").forEach(i=>{const n=h.getStyle(i,a),o=h.parseUnit(n.getPropertyValue("font-size")),r={};for(const a of e){const e=h.checkStyleValue(i,a,t.style[a],n,s,o);e&&(r[a]=e)}this.userSettings.preloadImages&&[r.backgroundImage,r.listStyleImage,r.content].forEach(t=>{if(t&&t.startsWith("url("))for(const e of t.split(u.XML.SEPARATOR)){const t=h.resolveURL(e.trim());""!==t&&void 0===this.resourceHandler.getImage(t)&&this.resourceHandler.assets.images.set(t,{width:0,height:0,uri:t})}});const l=`styleMap${a}`,c=`styleSpecificity${a}`,d=g.getElementCache(i,l,this.processing.sessionId);if(d){const t=g.getElementCache(i,c,this.processing.sessionId)||{};for(const e in r)(void 0===d[e]||void 0===t[e]||s>=t[e])&&(d[e]=r[e],t[e]=s)}else{const t={};for(const e in r)t[e]=s;g.setElementCache(i,`style${a}`,"0",n),g.setElementCache(i,"sessionId","0",this.processing.sessionId),g.setElementCache(i,l,this.processing.sessionId,r),g.setElementCache(i,c,this.processing.sessionId,t)}})}break}case CSSRule.FONT_FACE_RULE:{void 0===m.FONT_FACE&&(m.FONT_FACE=/\s*@font-face\s*{([^}]+)}\s*/,m.FONT_FAMILY=/\s*font-family:[^\w]*([^'";]+)/,m.FONT_SRC=/\s*src:\s*([^;]+);/,m.FONT_STYLE=/\s*font-style:\s*(\w+)\s*;/,m.FONT_WEIGHT=/\s*font-weight:\s*(\d+)\s*;/,m.URL=/\s*(url|local)\(['"]([^'")]+)['"]\)\s*format\(['"](\w+)['"]\)\s*/);const e=m.FONT_FACE.exec(t.cssText);if(e){const t=m.FONT_FAMILY.exec(e[1]),i=m.FONT_SRC.exec(e[1]);if(t&&i){const s=m.FONT_STYLE.exec(e[1]),n=m.FONT_WEIGHT.exec(e[1]),o=t[1].trim(),a=s?s[1].toLowerCase():"normal",r=n?parseInt(n[1]):400;for(const t of i[1].split(u.XML.SEPARATOR)){const e=m.URL.exec(t);if(e){let t,i;"url"===e[1]?t=f.resolvePath(e[2].trim()):i=e[2].trim(),this.resourceHandler.addFont({fontFamily:o,fontWeight:r,fontStyle:a,srcUrl:t,srcLocal:i,srcFormat:e[3].toLowerCase().trim()})}}}}break}}}createLayoutControl(t,e){return new o(t,e,e.containerType,e.alignmentType,e.children)}set userSettings(t){this._userSettings=t}get userSettings(){return this._userSettings||{}}get layouts(){return this._layouts.sort((t,e)=>{if(t.index!==e.index){if(0===t.index||void 0!==t.index&&void 0===e.index||e.index===1/0)return-1;if(0===e.index||void 0!==e.index&&void 0===t.index||t.index===1/0)return 1;if(void 0!==t.index&&void 0!==e.index)return t.index<e.index?-1:1}return 0})}get rendered(){return this.session.cache.filter(t=>t.visible&&t.rendered)}get nextId(){return this.processing.cache.nextId}get length(){return this.session.documentRoot.length}},t.Controller=class{constructor(t,e){this.application=t,this.cache=e,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}reset(){this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}applyDefaultStyles(t){let e;if("#text"===t.nodeName)e={position:"static",display:"inline",verticalAlign:"baseline",float:"none",clear:"none"};else{if(e=T.getElementCache(t,"styleMap",this.application.processing.sessionId)||{},_.isUserAgent(8))switch(t.tagName){case"INPUT":case"SELECT":case"BUTTON":case"TEXTAREA":void 0===e.display&&(e.display="inline-block");break;case"FIELDSET":void 0===e.display&&(e.display="block")}switch(t.tagName){case"INPUT":switch(t.type){case"file":{const i=v.getStyle(t);if(void 0===S.parseColor(i.getPropertyValue("background-color"))&&(e.backgroundColor="#DDDDDD","none"===i.getPropertyValue("border-style")))for(const t of["borderTop","borderRight","borderBottom","borderLeft"])e[`${t}Style`]="outset",e[`${t}Color`]="#DDDDDD",e[`${t}Width`]="2px"}case"reset":case"submit":case"button":void 0===e.textAlign&&(e.textAlign="center")}break;case"BUTTON":void 0===e.textAlign&&(e.textAlign="center");break;case"TEXTAREA":case"SELECT":void 0===e.verticalAlign&&("SELECT"!==t.tagName||t.size>1)&&(e.verticalAlign="text-bottom");break;case"FORM":void 0===e.marginTop&&(e.marginTop="0px");break;case"LI":if(void 0===e.listStyleImage){const i=v.getStyle(t);e.listStyleImage=i.getPropertyValue("list-style-image")}break;case"IFRAME":void 0===e.display&&(e.display="block");case"IMG":const i=(i,s)=>{if(void 0===e[i]||"auto"===e[i]){const n=RegExp(`\\s+${i}="([^"]+)"`).exec(t.outerHTML);if(n)v.isLength(n[1])?e[i]=v.formatPX(n[1]):v.isPercent(n[1])&&(e[i]=n[1]);else if("IFRAME"===t.tagName)"width"===i?e.width="300px":e.height="150px";else if(e[s]&&v.isLength(e[s])){const n=`max${E.capitalize(i)}`;if(void 0===e[n]||!v.isPercent(n)){const n=this.application.resourceHandler.getImage(t.src);n&&n.width>0&&n.height>0&&(e[i]=v.formatPX(n[i]*parseFloat(e[s])/n[s]))}}}};i("width","height"),i("height","width")}}T.setElementCache(t,"styleMap",this.application.processing.sessionId,e)}addBeforeOutsideTemplate(t,e,i=-1){void 0===this._beforeOutside[t]&&(this._beforeOutside[t]=[]),-1!==i&&i<this._beforeOutside[t].length?this._beforeOutside[t].splice(i,0,e):this._beforeOutside[t].push(e)}addBeforeInsideTemplate(t,e,i=-1){void 0===this._beforeInside[t]&&(this._beforeInside[t]=[]),-1!==i&&i<this._beforeInside[t].length?this._beforeInside[t].splice(i,0,e):this._beforeInside[t].push(e)}addAfterInsideTemplate(t,e,i=-1){void 0===this._afterInside[t]&&(this._afterInside[t]=[]),-1!==i&&i<this._afterInside[t].length?this._afterInside[t].splice(i,0,e):this._afterInside[t].push(e)}addAfterOutsideTemplate(t,e,i=-1){void 0===this._afterOutside[t]&&(this._afterOutside[t]=[]),-1!==i&&i<this._afterOutside[t].length?this._afterOutside[t].splice(i,0,e):this._afterOutside[t].push(e)}getBeforeOutsideTemplate(t,e=0){return this._beforeOutside[t]?A.pushIndentArray(this._beforeOutside[t],e):""}getBeforeInsideTemplate(t,e=0){return this._beforeInside[t]?A.pushIndentArray(this._beforeInside[t],e):""}getAfterInsideTemplate(t,e=0){return this._afterInside[t]?A.pushIndentArray(this._afterInside[t],e):""}getAfterOutsideTemplate(t,e=0){return this._afterOutside[t]?A.pushIndentArray(this._afterOutside[t],e):""}hasAppendProcessing(t){return void 0!==this._beforeOutside[t]||void 0!==this._beforeInside[t]||void 0!==this._afterInside[t]||void 0!==this._afterOutside[t]}includeElement(t){return!this.localSettings.unsupported.tagName.has(t.tagName)||"INPUT"===t.tagName&&!this.localSettings.unsupported.tagName.has(`${t.tagName}:${t.type}`)||"true"===t.contentEditable}visibleElement(t){if("__squared.pseudo"===t.className)return!0;const e=T.getClientRect(t,this.application.processing.sessionId);if(w(e)){if(e.width>0&&e.height>0)return!0;const i=v.getStyle(t);return e.width>0&&"none"!==i.getPropertyValue("float")||"block"===i.getPropertyValue("display")&&(0!==parseInt(i.getPropertyValue("margin-top"))||0!==parseInt(i.getPropertyValue("margin-bottom")))||"none"!==i.getPropertyValue("clear")}return!1}cascadeDocument(t,e){const i=e>0?"\t".repeat(e):"";let s="";for(let n=0;n<t.length;n++){const o=t[n];if(o){const t=o.node;if(t.visible)switch(o.type){case 1:{const{controlName:n,attributes:a}=o,r=e+1,l=this.getBeforeInsideTemplate(t.id,r),c=this.getAfterInsideTemplate(t.id,r);let h=i+`<${n+(0===e?"{#0}":"")+(this.userSettings.showAttributes?a?A.pushIndent(a,r):t.extractAttributes(r):"")}`;h+=t.renderTemplates||""!==l||""!==c?">\n"+l+(t.renderTemplates?this.cascadeDocument(this.sortRenderPosition(t,t.renderTemplates),r):"")+c+i+`</${n}>\n`:" />\n",s+=this.getBeforeOutsideTemplate(t.id,e)+h+this.getAfterOutsideTemplate(t.id,e);break}case 2:{const{content:t}=o;t&&(s+=A.pushIndent(t,e));break}}}}return s}getEnclosingTag(t,e){switch(t){case 1:const{controlName:i,attributes:s,content:n}=e;return"<"+i+(s||"")+(n?">\n"+n+"</"+i+">\n":" />\n")}return""}get generateSessionId(){return""+(new Date).getTime()}},t.Extension=k,t.ExtensionManager=class{constructor(t){this.application=t}include(t){const e=this.retrieve(t.name);return e?(Array.isArray(t.tagNames)&&(e.tagNames=t.tagNames),Object.assign(e.options,t.options),!0):!(0!==t.framework&&!R.hasBit(t.framework,this.application.framework)||!t.dependencies.every(t=>!!this.retrieve(t.name))||(t.application=this.application,this.application.extensions.includes(t)||this.application.extensions.push(t),0))}exclude(t){for(let e=0;e<this.application.extensions.length;e++)if(this.application.extensions[e]===t)return this.application.extensions.splice(e,1),!0;return!1}retrieve(t){for(const e of this.application.extensions)if(e.name===t)return e;return null}optionValue(t,e){const i=this.retrieve(t);if(i&&"object"==typeof i.options)return i.options[e]}optionValueAsObject(t,e){const i=this.optionValue(t,e);return"object"==typeof i?i:null}optionValueAsString(t,e){const i=this.optionValue(t,e);return"string"==typeof i?i:""}optionValueAsNumber(t,e){const i=this.optionValue(t,e);return"number"==typeof i?i:0}optionValueAsBoolean(t,e){const i=this.optionValue(t,e);return"boolean"==typeof i&&i}},t.File=L,t.Layout=o,t.Node=V,t.NodeGroup=class extends V{init(){if(this.length){let t=1/0;for(const e of this.children)t=Math.min(t,e.siblingIndex),e.parent=this;this.siblingIndex===1/0&&(this.siblingIndex=t),this.parent&&this.parent.sort(s.siblingIndex),this.setBounds(),this.saveAsInitial(),this.actualParent&&(this.dir=this.actualParent.dir)}}setBounds(){if(this.length){const t=s.outerRegion(this);this._bounds=Object.assign({},t,{width:t.right-t.left,height:t.bottom-t.top})}}previousSiblings(t={}){const e=this.item(0);return e?e.previousSiblings(t):[]}nextSiblings(t={}){const e=this.item();return e?e.nextSiblings(t):[]}get block(){return void 0===this._cached.block&&(this._cached.block=this.some(t=>t.block)),this._cached.block}get blockStatic(){if(void 0===this._cached.blockStatic){const t=this.actualChildren.length&&this.actualChildren[0].blockStatic||this.actualWidth===this.documentParent.actualWidth||this.hasAlign(64)||this.layoutVertical&&this.some(t=>t.blockStatic)||this.documentParent.blockStatic&&this.hasAlign(256);if(!t&&0===this.containerType)return!1;this._cached.blockStatic=t}return this._cached.blockStatic}get blockDimension(){return void 0===this._cached.blockDimension&&(this._cached.blockDimension=this.some(t=>t.blockDimension)),this._cached.blockDimension}get inline(){return void 0===this._cached.inline&&(this._cached.inline=this.every(t=>t.inline)),this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.every(t=>t.inlineStatic)),this._cached.inlineStatic}get inlineVertical(){return void 0===this._cached.inlineVertical&&(this._cached.inlineVertical=this.every(t=>t.inlineVertical)),this._cached.inlineVertical}get inlineFlow(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inlineStatic||this.hasAlign(128)),this._cached.inlineStatic}get pageFlow(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=!this.cssAny("position","absolute","fixed")),this._cached.pageFlow}get baseline(){if(void 0===this._cached.baseline){const t=this.cssInitial("verticalAlign",!0);this._cached.baseline=""!==t?"baseline"===t:this.layoutHorizontal&&this.every(t=>t.baseline)}return this._cached.baseline}get float(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.hasAlign(1024)?"right":"left":"none"),this._cached.float}get floating(){return void 0===this._cached.floating&&(this._cached.floating=this.every(t=>t.naturalElement&&t.floating)),this._cached.floating}get display(){return this.css("display")||this.some(t=>t.blockStatic)?"block":this.some(t=>t.blockDimension||t.inlineVertical)?"inline-block":"inline"}get actualParent(){return void 0===this._cached.actualParent&&(this._cached.actualParent=s.actualParent(this._initial.children)),this._cached.actualParent}get groupParent(){return!0}get multiline(){return!1}},t.NodeList=s,t.Resource=lt,t.extensions=Jt,t.lib=te,Object.defineProperty(t,"__esModule",{value:!0})});
