!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t=t||self).squared=t.squared||{},t.squared.base={}))}(this,(function(t){"use strict";class e extends squared.lib.base.Container{constructor(t){super(t),this._currentId=0}append(t,e=!0){return super.append(t),e&&this.afterAppend&&this.afterAppend.call(this,t),this}reset(){return this._currentId=0,this.clear(),this}get nextId(){return++this._currentId}}const{regex:i,util:n}=squared.lib;class s{reset(){for(const t in s.ASSETS)s.ASSETS[t].clear();const t=this.fileHandler;t&&t.reset()}addImage(t){if(t&&t.complete){if(t.src.startsWith("data:image/")){const e=RegExp(`^${i.STRING.DATAURI}$`).exec(t.src);e&&e[1]&&e[2]&&this.addRawData(t.src,e[1],e[2],e[3],t.naturalWidth,t.naturalHeight)}const e=t.src;""!==e&&s.ASSETS.images.set(e,{width:t.naturalWidth,height:t.naturalHeight,uri:e})}}getImage(t){return s.ASSETS.images.get(t)}addFont(t){const e=s.ASSETS.fonts,i=e.get(t.fontFamily)||[];i.push(t),e.set(t.fontFamily,i)}getFont(t,e="normal",i){const n=s.ASSETS.fonts.get(t);if(n){const t=this.controllerSettings.supported.fontFormat;return n.find(n=>n.fontStyle===e&&(void 0===i||n.fontWeight===parseInt(i))&&("*"===t||t.includes(n.srcFormat)))}}addRawData(t,e,i,o,r=0,a=0){let l;e=e.toLowerCase(),"base64"===(i=i.toLowerCase())?(l=o,"image/svg+xml"===e&&(o=window.atob(o))):o=o.replace(/\\(["'])/g,(t,...e)=>e[0]);const c=this.controllerSettings.supported.imageFormat,h=t.startsWith(location.origin)?t.substring(location.origin.length+1,t.lastIndexOf("/")):"",d=()=>n.buildAlphaString(5).toLowerCase()+"_"+(new Date).getTime();let u;if("*"===c)if(t.startsWith(location.origin))u=n.fromLastIndexOf(t,"/");else{let t=e.split("/").pop();"svg+xml"===t&&(t="svg"),u=d()+"."+t}else for(const i of c)if(-1!==e.indexOf(i)){u=t.endsWith("."+i)?n.fromLastIndexOf(t,"/"):d()+"."+i;break}return u?(s.ASSETS.rawData.set(t,{pathname:h,filename:u,content:o,base64:l,mimeType:e,width:r,height:a}),u):""}getRawData(t){if(t.startsWith("url(")){const e=i.CSS.URL.exec(t);e&&(t=e[1])}return s.ASSETS.rawData.get(t)}setFileHandler(t){t.resource=this,this.fileHandler=t}}s.ASSETS={ids:new Map,images:new Map,fonts:new Map,rawData:new Map};var o=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};const{css:r,dom:a,regex:l,session:c,util:h}=squared.lib,d=s.ASSETS,u=/all|screen/,f=RegExp(`(url\\("(${l.STRING.DATAURI})"\\)),?\\s*`,"g");let g,p,m,b,x,y,v,S;function _(t,e){const i=RegExp(`^@${t}([^{]+)`).exec(e);return i?i[1].trim():e}class E{constructor(t,i,n,s,o){this.framework=t,this.initializing=!1,this.closed=!1,this.rootElements=new Set,this.session={active:[]},this.processing={cache:new e,excluded:new e,sessionId:""},this._cascadeAll=!1,S=i;const r=this.processing.cache;this.controllerHandler=new n(this,r),this.resourceHandler=new s(this,r),this.extensionManager=new o(this,r)}copyToDisk(t,e,i){const n=this.resourceHandler.fileHandler;n&&n.copyToDisk(t,i,e)}appendToArchive(t,e){const i=this.resourceHandler.fileHandler;i&&i.appendToArchive(t,e)}saveToArchive(t,e){const i=this.resourceHandler.fileHandler;i&&i.saveToArchive(t||this.userSettings.outputArchiveName,e)}reset(){this.session.active.length=0;const t=this.processing;t.cache.reset(),t.excluded.clear(),t.sessionId="",this.controllerHandler.reset();for(const t of this.extensions)t.subscribers.clear();this.closed=!1}parseDocument(...t){const e=this.controllerHandler,i=this.resourceHandler;let n;this.rootElements.clear(),this.initializing=!1;const s=e.generateSessionId;this.processing.sessionId=s,e.sessionId=s,this.session.active.push(s),e.init(),this.setStyleMap(),0===t.length&&t.push(document.body);for(const e of t){let t;if("string"==typeof e)t=document.getElementById(e);else{if(!r.hasComputedStyle(e))continue;t=e}t&&this.rootElements.add(t)}const a=this.rootElements.values().next().value,l=[],c=()=>{this.initializing=!1;for(const t of l)t.parentElement&&a.removeChild(t);l.length=0;for(const t of this.extensions)t.beforeParseDocument();for(const t of this.rootElements)this.createCache(t)&&this.afterCreateCache(t);for(const t of this.extensions)t.afterParseDocument();"function"==typeof n&&n.call(this)},u=this.userSettings.preloadImages,f=[];if(u){for(const t of this.rootElements)t.querySelectorAll("input[type=image]").forEach(t=>{const{width:e,height:i,src:n}=t;""!==n&&d.images.set(n,{width:e,height:i,uri:n})});for(const t of d.images.values()){const e=t.uri;if(e)if(e.toLowerCase().endsWith(".svg"))f.push(e);else if(0===t.width&&0===t.height){const i=document.createElement("img");i.src=e;const n=i.naturalWidth,s=i.naturalHeight;n>0&&s>0?(t.width=n,t.height=s):(a.appendChild(i),l.push(i))}}}for(const[t,e]of d.rawData.entries())if(e.mimeType&&e.mimeType.startsWith("image/")&&!e.mimeType.endsWith("svg+xml")){const i=document.createElement("img");i.src="data:"+e.mimeType+";"+(e.base64?"base64,"+e.base64:e.content);const n=i.naturalWidth,s=i.naturalHeight;n>0&&s>0?(e.width=n,e.height=s,d.images.set(t,{width:n,height:s,uri:e.filename})):(document.body.appendChild(i),l.push(i))}for(const t of this.rootElements)t.querySelectorAll("img").forEach(t=>{t.src.toLowerCase().endsWith(".svg")?u&&f.push(t.src):t.complete?i.addImage(t):u&&f.push(t)});f.length?(this.initializing=!0,Promise.all(h.objectMap(f,t=>new Promise((e,i)=>{"string"==typeof t?e(function(t){return o(this,void 0,void 0,(function*(){return(yield fetch(t,{method:"GET",headers:new Headers({Accept:"application/xhtml+xml, image/svg+xml","Content-Type":"image/svg+xml"})})).text()}))}(t)):(t.addEventListener("load",()=>e(t)),t.addEventListener("error",()=>i(t)))}))).then(t=>{const e=t.length;for(let n=0;n<e;n++){const e=t[n];if("string"==typeof e){const t=f[n];"string"==typeof t&&i.addRawData(t,"image/svg+xml","utf8",e)}else i.addImage(e)}c()}).catch(t=>{const e=t.target?t.target.src:t.message;this.userSettings.showErrorMessages&&h.isString(e)&&!confirm("FAIL: "+e)||c()})):c();return new class{then(t){f.length?n=t:t()}}}createCache(t){const e=this.createRootNode(t);if(e){const t=this.processing.cache;e.parent.setBounds();for(const e of t)e.setBounds(),e.saveAsInitial();return this.controllerHandler.sortInitialCache(t),!0}return!1}createNode(t,e=!0,i,n){const s=new S(this.nextId,this.processing.sessionId,t,this.controllerHandler.afterInsertNode);if(i&&(s.depth=i.depth+1),n)for(const t of n)t.parent=s;return e&&this.processing.cache.append(s,void 0!==n),s}toString(){return""}createRootNode(t){const e=this.processing;e.cache.clear(),e.excluded.clear(),this._cascadeAll=!1;const i=this.cascadeParentNode(t);if(i){const n=new S(0,e.sessionId,t.parentElement||document.body,this.controllerHandler.afterInsertNode);i.parent=n,i.actualParent=n,i.childIndex=0,i.documentRoot=!0}return e.node=i,e.cache.afterAppend=void 0,i}cascadeParentNode(t,e=0){const i=this.insertNode(t);if(i){const n=this.controllerHandler,s=this.processing,o=s.cache;if(i.depth=e,0===e&&o.append(i),n.preventNodeCascade(t))return i;const r=t.childNodes,l=r.length,c=Array(l),h=Array(t.childElementCount);let d=!0,u=0,f=0;for(let t=0;t<l;t++){const l=r[t];let g;"#"===l.nodeName.charAt(0)?a.isTextNode(l)&&(g=this.insertNode(l,i)):n.includeElement(l)?(g=this.cascadeParentNode(l,e+1))&&(h[f++]=g,o.append(g),d=!1):(g=this.insertNode(l))&&(s.excluded.append(g),d=!1),g&&(g.parent=i,g.actualParent=i,g.childIndex=u,c[u++]=g)}c.length=u,h.length=f,i.naturalChildren=c,i.naturalElements=h,i.inlineText=d,this.userSettings.createQuerySelectorMap&&f>0&&(i.queryMap=this.createQueryMap(h,f))}return i}createQueryMap(t,e){const i=[t];for(let n=0;n<e;n++){const e=t[n].queryMap;if(e){const t=e.length;for(let n=0;n<t;n++){const t=n+1,s=i[t];i[t]=s?s.concat(e[n]):e[n]}}}return i}setStyleMap(){let t=!1;const e=i=>{try{const t=i.cssRules;if(t){const i=t.length;for(let n=0;n<i;n++){const i=t[n];switch(i.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(i);break;case CSSRule.IMPORT_RULE:e(i.styleSheet);break;case CSSRule.MEDIA_RULE:r.validMediaRule(i.conditionText||_("media",i.cssText))&&this.applyCSSRuleList(i.cssRules);break;case CSSRule.SUPPORTS_RULE:CSS.supports&&CSS.supports(i.conditionText||_("supports",i.cssText))&&this.applyCSSRuleList(i.cssRules)}}}}catch(e){this.userSettings.showErrorMessages&&!t&&(alert("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+i.href+"\n\n"+e),t=!0)}},i=document.styleSheets,n=i.length;for(let t=0;t<n;t++){const n=i[t],s=n.media.mediaText;(""===s||u.test(s))&&e(n)}}applyCSSRuleList(t){const e=t.length;for(let i=0;i<e;i++)this.applyStyleRule(t[i])}applyStyleRule(t){const e=this.resourceHandler,i=this.processing.sessionId,n=t.parentStyleSheet&&t.parentStyleSheet.href||void 0,s=t.cssText;switch(t.type){case CSSRule.STYLE_RULE:{const o=t.style,a=[],l={},u=(t,i)=>{const s=t[i];if(s&&"initial"!==s){f.lastIndex=0;let o,r=s;for(;null!==(o=f.exec(s));)if(o[3]&&o[4])e.addRawData(o[2],o[3],o[4],o[5]);else if(this.userSettings.preloadImages){const t=h.resolvePath(o[5],n);""!==t&&(void 0===e.getImage(t)&&d.images.set(t,{width:0,height:0,uri:t}),r=r.replace(o[1],`url("${t}")`))}t[i]=r}};for(const t of Array.from(o))a.push(h.convertCamelCase(t));if(-1!==s.indexOf("!important")){let t;for(g?g.lastIndex=0:g=/\s*([a-z\-]+):.*?!important;/g;null!==(t=g.exec(s));){const e=h.convertCamelCase(t[1]);switch(e){case"margin":l.marginTop=!0,l.marginRight=!0,l.marginBottom=!0,l.marginLeft=!0;break;case"padding":l.paddingTop=!0,l.paddingRight=!0,l.paddingBottom=!0,l.paddingLeft=!0;break;case"background":l.backgroundColor=!0,l.backgroundImage=!0,l.backgroundSize=!0,l.backgroundRepeat=!0,l.backgroundPositionX=!0,l.backgroundPositionY=!0;break;case"backgroundPosition":l.backgroundPositionX=!0,l.backgroundPositionY=!0;break;case"border":l.borderTopStyle=!0,l.borderRightStyle=!0,l.borderBottomStyle=!0,l.borderLeftStyle=!0,l.borderTopWidth=!0,l.borderRightWidth=!0,l.borderBottomWidth=!0,l.borderLeftWidth=!0,l.borderTopColor=!0,l.borderRightColor=!0,l.borderBottomColor=!0,l.borderLeftColor=!0;break;case"borderStyle":l.borderTopStyle=!0,l.borderRightStyle=!0,l.borderBottomStyle=!0,l.borderLeftStyle=!0;break;case"borderWidth":l.borderTopWidth=!0,l.borderRightWidth=!0,l.borderBottomWidth=!0,l.borderLeftWidth=!0;break;case"borderColor":l.borderTopColor=!0,l.borderRightColor=!0,l.borderBottomColor=!0,l.borderLeftColor=!0;break;case"font":l.fontFamily=!0,l.fontStyle=!0,l.fontSize=!0,l.fontWeight=!0,l.lineHeight=!0}l[e]=!0}}for(const e of r.parseSelectorText(t.selectorText)){const t=r.getSpecificity(e),[n,s]=e.split("::"),h=s?"::"+s:"";document.querySelectorAll(n||"*").forEach(e=>{const n=r.getStyle(e,h),s={};for(const t of a){const i=r.checkStyleValue(e,t,o[t],n);i&&(s[t]=i)}u(s,"backgroundImage"),u(s,"listStyleImage"),u(s,"content");const d="styleMap"+h,f="styleSpecificity"+h,g=c.getElementCache(e,d,i);if(g){const n=c.getElementCache(e,f,i)||{};for(const e in s){const i=s[e],r=t+(l[e]?1e3:0);if(void 0===n[e]||r>=n[e]){if(n[e]=r,"initial"===i&&o.background&&e.startsWith("background"))continue;g[e]=i}}}else{const o={};for(const e in s)o[e]=t+(l[e]?1e3:0);c.setElementCache(e,"style"+h,"0",n),c.setElementCache(e,"sessionId","0",i),c.setElementCache(e,d,i,s),c.setElementCache(e,f,i,o)}})}break}case CSSRule.FONT_FACE_RULE:{void 0===p&&(p=/\s*@font-face\s*{([^}]+)}\s*/,m=/\s*font-family:[^\w]*([^'";]+)/,b=/\s*src:\s*([^;]+);/,x=/\s*font-style:\s*(\w+)\s*;/,y=/\s*font-weight:\s*(\d+)\s*;/,v=/\s*(url|local)\((?:['"]([^'")]+)['"]|([^)]+))\)\s*format\(['"]?(\w+)['"]?\)\s*/);const t=p.exec(s);if(t){const i=m.exec(t[1]),s=b.exec(t[1]);if(i&&s){const o=x.exec(t[1]),r=y.exec(t[1]),a=i[1].trim(),c=o?o[1].toLowerCase():"normal",d=r?parseInt(r[1]):400;for(const t of s[1].split(l.XML.SEPARATOR)){const i=v.exec(t);if(i){let t,s;const o=(i[2]||i[3]).trim();"url"===i[1]?t=h.resolvePath(o,n):s=o,e.addFont({fontFamily:a,fontWeight:d,fontStyle:c,srcUrl:t,srcLocal:s,srcFormat:i[4].toLowerCase().trim()})}}}}break}}}get nextId(){return this.processing.cache.nextId}get length(){return 0}}class T{preventNodeCascade(t){return!1}get generateSessionId(){return""+(new Date).getTime()}}class w{constructor(t,e,i){this.name=t,this.framework=e,this.options={},this.dependencies=[],this.subscribers=new Set,i&&Object.assign(this.options,i)}require(t,e=!1){this.dependencies.push({name:t,preload:e})}beforeParseDocument(){}afterParseDocument(){}set application(t){this._application=t,this.controller=t.controllerHandler}get application(){return this._application}}const k=squared.lib.util;const A=squared.lib.util;class R{constructor(){this.assets=[]}static getMimeType(t){switch(t.toLowerCase()){case"aac":return"audio/aac";case"abw":return"application/x-abiword";case"arc":return"application/x-freearc";case"avi":return"video/x-msvideo";case"azw":return"application/vnd.amazon.ebook";case"bin":return"application/octet-stream";case"bmp":return"image/bmp";case"bz":return"application/x-bzip";case"bz2":return"application/x-bzip2";case"csh":return"application/x-csh";case"css":return"text/css";case"csv":return"text/csv";case"doc":return"application/msword";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"eot":return"application/vnd.ms-fontobject";case"epub":return"application/epub+zip";case"gif":return"image/gif";case"htm":case"html":return"text/html";case"ico":return"image/vnd.microsoft.icon";case"ics":return"text/calendar";case"jar":return"application/java-archive";case"jpeg":case"jpg":return"image/jpeg";case"js":case"mjs":return"text/javascript";case"json":return"application/json";case"jsonld":return"application/ld+json";case"mid":case"midi":return"audio/midi";case"mp3":return"audio/mpeg";case"mpeg":return"video/mpeg";case"mpkg":return"application/vnd.apple.installer+xml";case"odp":return"application/vnd.oasis.opendocument.presentation";case"ods":return"application/vnd.oasis.opendocument.spreadsheet";case"odt":return"application/vnd.oasis.opendocument.text";case"oga":return"audio/ogg";case"ogv":return"video/ogg";case"ogx":return"application/ogg";case"otf":return"font/otf";case"png":return"image/png";case"pdf":return"application/pdf";case"ppt":return"application/vnd.ms-powerpoint";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"rar":return"application/x-rar-compressed";case"rtf":return"application/rtf";case"sh":return"application/x-sh";case"svg":return"image/svg+xml";case"swf":return"application/x-shockwave-flash";case"tar":return"application/x-tar";case"tif":case"tiff":return"image/tiff";case"ts":return"video/mp2t";case"ttf":return"font/ttf";case"txt":return"text/plain";case"vsd":return"application/vnd.visio";case"wav":return"audio/wav";case"weba":return"audio/webm";case"webm":return"video/webm";case"webp":return"image/webp";case"woff":return"font/woff";case"woff2":return"font/woff2";case"xhtml":return"application/xhtml+xml";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xml":return"text/xml";case"xul":return"application/vnd.mozilla.xul+xml";case"zip":return"application/zip";case"3gp":return"video/3gpp";case".3g2":return"video/3gpp2";case".7z":return"application/x-7z-compressed";default:return""}}static downloadFile(t,e,i){const n=new Blob([t],{type:i||"application/octet-stream"}),s=window.URL.createObjectURL(n),o=document.createElement("a");o.style.setProperty("display","none"),o.setAttribute("href",s),o.setAttribute("download",e),o.download||o.setAttribute("target","_blank");const r=document.body;r.appendChild(o),o.click(),r.removeChild(o),setTimeout(()=>window.URL.revokeObjectURL(s),1)}addAsset(t){if(t.content||t.uri||t.base64){const e=this.assets.findIndex(e=>e.pathname===t.pathname&&e.filename===t.filename);-1!==e?Object.assign(this.assets[e],t):this.assets.push(t)}}reset(){this.assets.length=0}copying(t,e,i){if(location.protocol.startsWith("http")){if((e=e.concat(this.assets)).length){const n=this.userSettings;fetch("/api/assets/copy?to="+encodeURIComponent(t.trim())+"&directory="+encodeURIComponent(A.trimString(n.outputDirectory,"/"))+"&timeout="+n.outputArchiveTimeout,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{t&&("function"==typeof i&&i(t),t.system&&this.userSettings.showErrorMessages&&alert(t.application+"\n\n"+t.system))}).catch(t=>{this.userSettings.showErrorMessages&&alert("ERROR: "+t)})}}else this.userSettings.showErrorMessages&&alert("SERVER (required): See README for instructions")}archiving(t,e,i){if(location.protocol.startsWith("http")){if((e=e.concat(this.assets)).length){const n=this.userSettings;fetch("/api/assets/archive?filename="+encodeURIComponent(t.trim())+"&directory="+encodeURIComponent(A.trimString(n.outputDirectory,"/"))+"&format="+n.outputArchiveFormat+(i?"&append_to="+encodeURIComponent(i.trim()):"")+"&timeout="+n.outputArchiveTimeout,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{if(t){const e=t.zipname;e?fetch("/api/browser/download?filename="+encodeURIComponent(e)).then(t=>t.blob()).then(t=>R.downloadFile(t,A.fromLastIndexOf(e,"/"))):t.system&&this.userSettings.showErrorMessages&&alert(t.application+"\n\n"+t.system)}}).catch(t=>{this.userSettings.showErrorMessages&&alert("ERROR: "+t)})}}else this.userSettings.showErrorMessages&&alert("SERVER (required): See README for instructions")}}const{css:C,dom:I,regex:B,session:P,util:N}=squared.lib,L={BACKGROUND:/\s*(url\(.+?\))\s*/,NTH_CHILD_OFTYPE:/^:nth(-last)?-(child|of-type)\((.+)\)$/,NTH_CHILD_OFTYPE_VALUE:/^(-)?(\d+)?n\s*([+\-]\d+)?$/,LANG:/^:lang\(\s*(.+)\s*\)$/};function M(t){let e=t.parentElement;for(;e;){if("FORM"===e.tagName)return e;e=e.parentElement}return null}const O=(t,e)=>t===e||C.isLength(t,!0)&&e.endsWith("px");class W extends squared.lib.base.Container{constructor(t,e="0",i){super(),this.id=t,this.sessionId=e,this.documentRoot=!1,this.depth=-1,this.childIndex=1/0,this._fontSize=0,this._element=null,this._initial={iteration:-1,children:[],styleMap:{}},this._data={},this._inlineText=!1,i?this._element=i:(this.style={},this._styleMap={})}static getPseudoElt(t){return t.pseudoElement?P.getElementCache(t.element,"pseudoElement",t.sessionId):""}init(){const t=this._element;if(t){const e=this.sessionId,i="0"!==e;if(i&&P.setElementCache(t,"node",e,this),this.style=this.pseudoElement?C.getStyle(t.parentElement,W.getPseudoElt(this)):C.getStyle(t),this._styleMap=P.getElementCache(t,"styleMap",e)||{},this.styleElement&&!this.pseudoElement&&i)for(let e of Array.from(t.style)){let i=t.style.getPropertyValue(e);e=N.convertCamelCase(e),""!==(i=C.checkStyleValue(t,e,i,this.style))&&(this._styleMap[e]=i)}}}saveAsInitial(t=!1){const e=this._initial;(-1===e.iteration||t)&&(e.children=this.duplicate(),e.styleMap=Object.assign({},this._styleMap));const i=this._bounds;i&&(e.bounds=I.assignRect(i),e.linear=I.assignRect(this.linear),e.box=I.assignRect(this.box)),e.iteration++}data(t,e,i,n=!0){const s=this._data;return N.hasValue(i)?("object"!=typeof s[t]&&(s[t]={}),(n||void 0===s[t][e])&&(s[t][e]=i)):null===i&&delete this._data[t],"object"==typeof s[t]&&null!==s[t]?s[t][e]:void 0}unsetCache(...t){if(t.length){const e=this._cached;for(const i of t){switch(i){case"position":return void(this._cached={});case"width":e.actualWidth=void 0,e.percentWidth=void 0;case"minWidth":e.width=void 0;break;case"height":e.actualHeight=void 0,e.percentHeight=void 0;case"minHeight":e.height=void 0;break;case"verticalAlign":e.baseline=void 0;break;case"display":e.block=void 0,e.blockDimension=void 0,e.blockStatic=void 0,e.inline=void 0,e.inlineVertical=void 0,e.inlineFlow=void 0,e.autoMargin=void 0,e.flexElement=void 0,e.gridElement=void 0,e.tableElement=void 0,e.layoutElement=void 0;break;case"backgroundColor":case"backgroundImage":e.visibleStyle=void 0;break;case"pageFlow":e.positionAuto=void 0,e.blockStatic=void 0,e.baseline=void 0,e.floating=void 0,e.autoMargin=void 0,e.rightAligned=void 0,e.bottomAligned=void 0;break;case"float":e.floating=void 0;break;default:i.startsWith("margin")&&(e.autoMargin=void 0),(i.startsWith("padding")||i.startsWith("border"))&&(e.contentBoxWidth=void 0,e.contentBoxHeight=void 0)}e[i]=void 0}}else this._cached={},this._textStyle=void 0}ascend(t,e,i="actualParent"){const n=[];let s=this[i];for(;s&&0!==s.id;){if(t){if(t(s))return[s]}else n.push(s);if(s===e)break;s=s[i]}return n}intersectX(t,e="linear"){const i=this[e];return N.aboveRange(t.left,i.left)&&Math.ceil(t.left)<i.right||t.right>Math.ceil(i.left)&&N.belowRange(t.right,i.right)||N.aboveRange(i.left,t.left)&&N.belowRange(i.right,t.right)||N.aboveRange(t.left,i.left)&&N.belowRange(t.right,i.right)}intersectY(t,e="linear"){const i=this[e];return N.aboveRange(t.top,i.top)&&Math.ceil(t.top)<i.bottom||t.bottom>Math.ceil(i.top)&&N.belowRange(t.bottom,i.bottom)||N.aboveRange(i.top,t.top)&&N.belowRange(i.bottom,t.bottom)||N.aboveRange(t.top,i.top)&&N.belowRange(t.bottom,i.bottom)}withinX(t,e="linear"){const i=this[e];return N.aboveRange(i.left,t.left)&&N.belowRange(i.right,t.right)}withinY(t,e="linear"){const i=this[e];return N.aboveRange(i.top,t.top)&&N.belowRange(i.bottom,t.bottom)}outsideX(t,e="linear"){const i=this[e];return i.left<Math.floor(t.left)||Math.floor(i.right)>t.right}outsideY(t,e="linear"){const i=this[e];return i.top<Math.floor(t.top)||Math.floor(i.bottom)>t.bottom}css(t,e,i=!0){return e&&this.styleElement&&(this.style[t]=e,O(e,this.style[t]))?(this._styleMap[t]=e,i&&this.unsetCache(t),e):this._styleMap[t]||this.styleElement&&this.style[t]||""}cssApply(t,e=!0){for(const i in t){const n=t[i];this.css(i,n,e)===n&&e&&this.unsetCache(i)}return this}cssInitial(t,e=!1,i=!1){-1!==this._initial.iteration||e||(i=!0);let n=(e?this._styleMap:this._initial.styleMap)[t];return i&&!n&&(n=this.style[t]),n||""}cssAny(t,...e){for(const i of e)if(this.css(t)===i)return!0;return!1}cssInitialAny(t,...e){for(const i of e)if(this.cssInitial(t)===i)return!0;return!1}cssAscend(t,e=!1){let i,n=e?this:this.actualParent;for(;n;){if(""!==(i=n.cssInitial(t)))return i;if(n.documentBody)break;n=n.actualParent}return""}cssSort(t,e=!0,i=!1){const n=i?this.duplicate():this.children;return n.sort((i,n)=>{const s=i.toFloat(t),o=n.toFloat(t);return s===o?0:e?s<o?-1:1:s>o?-1:1}),n}cssPX(t,e,i=!1,n=!1){const s=this._styleMap[t];if(s&&C.isLength(s)){e+=C.parseUnit(s,this.fontSize),!i&&e<0&&(e=0);const o=C.formatPX(e);return this.css(t,o),n&&this.unsetCache(t),o}return""}cssSpecificity(t){if(this.styleElement){const e=this._element,i=P.getElementCache(this.pseudoElement?e.parentElement:e,"styleSpecificity"+W.getPseudoElt(this),this.sessionId);if(i)return i[t]||0}return 0}cssTry(t,e){if(this.styleElement){const i=C.getStyle(this._element).getPropertyValue(t);if(i===e)return!0;{const n=this._element;if(n.style.setProperty(t,e),O(e,n.style.getPropertyValue(t)))return P.setElementCache(n,t,this.sessionId,i),!0}}return!1}cssFinally(t){if(this.styleElement){const e=this._element,i=P.getElementCache(e,t,this.sessionId);if(i)return e.style.setProperty(t,i),P.deleteElementCache(e,t,this.sessionId),!0}return!1}toInt(t,e=!1,i=0){const n=parseInt((e?this._initial.styleMap:this._styleMap)[t]);return isNaN(n)?i:n}toFloat(t,e=!1,i=0){const n=parseFloat((e?this._initial.styleMap:this._styleMap)[t]);return isNaN(n)?i:n}parseUnit(t,e="width",i=!0){if(t){if(C.isPercent(t)){const n=i&&this.absoluteParent||this;let s=parseFloat(t)/100;switch(e){case"width":s*=n.bounds.width;break;case"height":s*=n.bounds.height}return s}return C.parseUnit(t,this.fontSize)}return 0}convertPX(t,e="width",i=!0){return t.endsWith("px")?t:Math.round(this.parseUnit(t,e,i))+"px"}has(t,e=0,i){const n=(i&&"initial"===i.map?this._initial.styleMap:this._styleMap)[t];if(n)switch(n){case"auto":case"none":case"initial":case"normal":case"transparent":case"rgba(0, 0, 0, 0)":return!1;case"baseline":case"left":case"start":return this.flexElement||!!this.actualParent&&this.actualParent.flexElement;default:if(i&&i.not){if(n===i.not)return!1;if(Array.isArray(i.not))for(const t of i.not)if(n===t)return!1}if(e>0){if(N.hasBit(e,2)&&C.isLength(n))return!0;if(N.hasBit(e,4)&&C.isPercent(n))return!0}return 0===e}return!1}hasPX(t,e=!0,i=!1){const n=(i?this._initial.styleMap:this._styleMap)[t];return!!n&&C.isLength(n,e)}setBounds(t=!0){if(this.styleElement)this._bounds=I.assignRect(P.actualClientRect(this._element,this.sessionId,t),!0),this.documentBody&&0===this.marginTop&&(this._bounds.top=0);else if(this.plainText){const t=I.getRangeClientRect(this._element),e=I.assignRect(t,!0),i=t.numberOfLines;e.numberOfLines=i,this._bounds=e,this._textBounds=e,this._cached.multiline=i>1}t||(this._box=void 0,this._linear=void 0)}querySelector(t){return this.querySelectorAll(t,1)[0]||null}querySelectorAll(t,e=-1){let i=[];const n=this.queryMap;if(n){const o=C.parseSelectorText(t);for(let t=0;t<o.length;t++){const r=o[t],a=[];let l=-1;t:{let t,e;for(B.CSS.SELECTOR_G.lastIndex=0;null!==(e=B.CSS.SELECTOR_G.exec(r));){let i,n,s,o,r,c,h=e[1],d=!1;if(1===h.length){const e=h.charAt(0);switch(e){case"+":case"~":l--;case">":if(t||0===a.length){a.length=0;break t}t=e;continue;case"*":d=!0}}else if(h.endsWith("|*"))d="*|*"===h;else if("*"===h.charAt(0))h=h.substring(1);else if(h.startsWith("::")){a.length=0;break t}if(!d){let t;for(;null!==(t=B.CSS.SELECTOR_ATTR.exec(h));){void 0===o&&(o=[]);const e="i"===t[6];let i=t[3]||t[4]||t[5]||"";e&&(i=i.toLowerCase()),o.push({key:t[1],symbol:t[2],value:i,caseInsensitive:e}),h=N.spliceString(h,t.index,t[0].length)}if(-1!==h.indexOf("::")){a.length=0;break t}for(;null!==(t=B.CSS.SELECTOR_PSEUDO_CLASS.exec(h));)t[0].startsWith(":not(")?t[1]&&(void 0===c&&(c=[]),c.push(t[1])):(void 0===r&&(r=[]),r.push(t[0])),h=N.spliceString(h,t.index,t[0].length);for(;null!==(t=B.CSS.SELECTOR_LABEL.exec(h));){const e=t[0];switch(e.charAt(0)){case"#":n=e.substring(1);break;case".":void 0===s&&(s=[]),s.push(e.substring(1));break;default:i=e.toUpperCase()}h=N.spliceString(h,t.index,t[0].length)}}a.push({all:d,tagName:i,id:n,adjacent:t,classList:s,pseudoList:r,notList:c,attrList:o}),l++,t=void 0}}let c=n.length;if(a.length&&-1!==l&&l<c){const r=(e,i,n,s)=>{if(i.all)return!0;if(i.tagName&&i.tagName!==e.tagName.toUpperCase())return!1;if(i.id&&i.id!==e.elementId)return!1;if(i.pseudoList){const o=e.actualParent,r=e.tagName;for(const a of i.pseudoList)switch(a){case":first-child":case":nth-child(1)":if(e!==o.firstChild)return!1;break;case":last-child":case":nth-last-child(1)":if(e!==o.lastChild)return!1;break;case":only-child":if(o.naturalElements.length>1)return!1;break;case":only-of-type":{let t=0;for(const e of o.naturalElements)if(e.tagName===r&&++t>1)return!1;break}case":first-of-type":for(const t of o.naturalElements)if(t.tagName===r){if(t!==e)return!1;break}break;case":nth-child(n)":case":nth-last-child(n)":break;case":empty":if(e.element.childNodes.length)return!1;break;case":checked":if("INPUT"===r){if(!e.element.checked)return!1}else{if("OPTION"!==r)return!1;if(!e.element.selected)return!1}break;case":enabled":if(!e.inputElement||e.element.disabled)return!1;break;case":disabled":if(!e.inputElement||!e.element.disabled)return!1;break;case":read-only":{const t=e.element;if(t.isContentEditable||("INPUT"===r||"TEXTAREA"===r)&&!t.readOnly)return!1;break}case":read-write":{const t=e.element;if(!t.isContentEditable||("INPUT"===r||"TEXTAREA"===r)&&t.readOnly)return!1;break}case":required":if(!e.inputElement||"BUTTON"===r||!e.element.required)return!1;break;case":optional":if(!e.inputElement||"BUTTON"===r||e.element.required)return!1;break;case":placeholder-shown":if("INPUT"!==r&&"TEXTAREA"!==r||!e.element.placeholder)return!1;break;case":default":switch(r){case"INPUT":{const t=e.element;switch(t.type){case"radio":case"checkbox":if(!t.checked)return!1;break;default:return!1}break}case"OPTION":if(void 0===e.element.attributes.selected)return!1;break;case"BUTTON":{const i=e.element,n=M(i);if(n){let e=!1;const s=n.querySelectorAll("*"),o=s.length;for(let n=0;n<o;n++){const n=s[t];if("BUTTON"===n.tagName){e=i===n;break}if("INPUT"===n.tagName){const t=n.type;if("submit"===t||"image"===t){e=i===n;break}}}if(!e)return!1}break}default:return!1}break;case":in-range":case":out-of-range":if("INPUT"!==r)return!1;{const t=e.element,i=parseFloat(t.value);if(isNaN(i)){if(":in-range"===a)return!1}else{const e=N.convertFloat(t.min),n=N.convertFloat(t.max);if(i>=e&&i<=n){if(":out-of-range"===a)return!1}else if(":in-range"===a)return!1}}break;case":indeterminate":if("INPUT"===r){const t=e.element;switch(t.type){case"checkbox":if(!t.indeterminate)return!1;break;case"radio":if(t.checked)return!1;if(t.name){const e=(M(t)||document).querySelectorAll(`input[type=radio][name="${t.name}"`),i=e.length;for(let t=0;t<i;t++)if(e[t].checked)return!1}break;default:return!1}}else{if("PROGRESS"!==r)return!1;if(-1!==e.element.value)return!1}break;case":target":if(""===location.hash)return!1;{const t=e.element;if(location.hash!=="#"+t.id&&("A"!==r||location.hash!=="#"+t.name))return!1}break;case":scope":if(!n||">"===s&&e!==this)return!1;break;case":root":if(!n||s)return!1;break;case":link":case":visited":case":any-link":case":hover":case":focus":case":focus-within":case":valid":case":invalid":{const i=e.element,n=o.element.querySelectorAll(":scope > "+a);let s=!1;const r=n.length;for(let e=0;e<r;e++)if(n.item(t)===i){s=!0;break}if(!s)return!1;break}default:{let t=L.NTH_CHILD_OFTYPE.exec(a);if(t){const i=t[3].trim();let n=o.naturalElements;t[1]&&(n=n.slice(0).reverse());const s=("child"===t[2]?n.indexOf(e):N.filterArray(n,t=>t.tagName===r).indexOf(e))+1;if(s>0){if(N.isNumber(i)){if(parseInt(i)!==s)return!1}else switch(i){case"even":if(s%2!=0)return!1;break;case"odd":if(s%2==0)return!1;break;default:const t=L.NTH_CHILD_OFTYPE_VALUE.exec(i);if(t){const e=N.convertInt(t[3]);if(t[2]){if(t[1])return!1;const i=parseInt(t[2]);if(0!==i){if(s!==e)for(let t=i;;t+=i){const t=i+e;if(t===s)break;if(t>s)return!1}}else if(s!==e)return!1}else if(t[3]){if(!(e>0))return!1;if(t[1]){if(s>e)return!1}else if(s<e)return!1}}}continue}}else if(t=L.LANG.exec(a)){const i=e.attributes;if(i.lang&&t[1].toLowerCase()===i.lang.toLowerCase())continue}return!1}}}if(i.notList)for(const t of i.notList){const i={all:!1};switch(t.charAt(0)){case".":i.classList=[t];break;case"#":i.id=t.substring(1);break;case":":i.pseudoList=[t];break;case"[":{B.CSS.SELECTOR_ATTR.lastIndex=0;const e=B.CSS.SELECTOR_ATTR.exec(t);if(!e)continue;{const t="i"===e[6];let n=e[3]||e[4]||e[5]||"";t&&(n=n.toLowerCase()),i.attrList=[{key:e[1],symbol:e[2],value:n,caseInsensitive:t}]}break}default:if(!B.CHAR.WORDDASH.test(t))return!1;i.tagName=t}if(r(e,i,n))return!1}if(i.classList){const t=e.element.classList;for(const e of i.classList)if(!t.contains(e))return!1}if(i.attrList){const t=e.attributes;for(const e of i.attrList){let i=t[e.key];if(void 0===i)return!1;if(e.value)if(e.caseInsensitive&&(i=i.toLowerCase()),e.symbol)switch(e.symbol){case"~":if(!i.split(B.CHAR.SPACE).includes(e.value))return!1;break;case"^":if(!i.startsWith(e.value))return!1;break;case"$":if(!i.endsWith(e.value))return!1;break;case"*":if(-1===i.indexOf(e.value))return!1;break;case"|":if(i!==e.value&&!i.startsWith(e.value+"-"))return!1}else if(i!==e.value)return!1}}return!0},h=a.pop(),d=0===a.length;let u=[];for(let t=l;t<c;t++){const e=n[t];if(h.all)u=u.concat(e);else for(const t of e)r(t,h,d)&&u.push(t)}if(a.length){const t=this.depth;function s(e,i,n){const o=a[e],l=e===c-1,h=[];for(const s of n)if(i){const t=s.actualParent;if(">"===i)r(t,o,l,i)&&h.push(t);else{const e=t.naturalElements;switch(i){case"+":{const t=e.indexOf(s);if(t>0){const n=e[t-1];n&&r(n,o,l,i)&&h.push(n)}break}case"~":{const t=e.length;for(let n=0;n<t;n++){const t=e[n];if(t===s)break;r(t,o,l,i)&&h.push(t)}break}}}}else if(s.depth-t>=c-e){let t=s.actualParent;do{r(t,o,l)&&h.push(t),t=t.actualParent}while(t)}return!!h.length&&(++e===c||s(e,o.adjacent,h))}a.reverse(),c=a.length;for(const t of u)if(s(0,h.adjacent,[t])&&(i.push(t),i.length===e))return i}else{if(0===i.length&&(t===o.length-1||e>=0&&e<=u.length))return e>=0&&u.length>e&&(u.length=e),u;if(i=i.concat(u),e>=0&&i.length>=e)return i.length=e,i}}}}return i}getTextStyle(){return void 0===this._textStyle&&(this._textStyle={fontFamily:this.css("fontFamily"),fontSize:this.css("fontSize"),fontWeight:this.css("fontWeight"),fontStyle:this.css("fontStyle"),color:this.css("color"),whiteSpace:this.css("whiteSpace"),textDecoration:this.css("textDecoration"),textTransform:this.css("textTransform"),letterSpacing:this.css("letterSpacing"),wordSpacing:this.css("wordSpacing")}),this._textStyle}setDimension(t,e,i){const n=this._styleMap,s=this.parseUnit(n[t],t);let o=Math.max(s,this.parseUnit(n[e],t));if(0===o&&this.styleElement){const e=this._element;switch(e.tagName){case"IMG":case"INPUT":if("image"!==e.type)break;case"TD":case"TH":case"SVG":case"IFRAME":case"VIDEO":case"CANVAS":case"OBJECT":case"EMBED":const i=I.getNamedItem(e,t);""!==i&&(o=this.parseUnit(i,t))>0&&this.css(t,C.isPercent(i)?i:i+"px")}}let r=0;return s>0&&!this.imageElement&&(n[i]===n[t]?delete n[i]:(r=this.parseUnit(n[i],t))>0&&r<=s&&C.isLength(n[t])&&(r=0,n[t]=n[i],delete this._styleMap[i])),r>0?Math.min(o,r):o}setBoxModel(t){const e="box"===t?this._box:this._linear;if(e){if(e.width=this.bounds.width,this.plainText)e.height=e.bottom-e.top;else switch(e.height=this.bounds.height,t){case"box":e.width-=this.contentBoxWidth,e.height-=this.contentBoxHeight;break;case"linear":e.width+=Math.max(this.marginLeft,0)+this.marginRight,e.height+=Math.max(this.marginTop,0)+this.marginBottom}void 0===this._initial[t]&&(this._initial[t]=I.assignRect(e))}}convertPosition(t){let e=0;if(!this.positionStatic){const i=this.cssInitial(t,!0);C.isLength(i)?e=N.convertFloat(this.convertPX(i,"left"===t||"right"===t?"width":"height")):C.isPercent(i)&&this.styleElement&&(e=N.convertFloat(this.style[t]))}return e}convertBorderWidth(t){if(!this.plainText){if("none"!==this.css(C.BOX_BORDER[t][0])){const e=this.css(C.BOX_BORDER[t][1]);let i;switch(e){case"thin":case"medium":case"thick":i=N.convertFloat(this.style[C.BOX_BORDER[t][1]]);break;default:i=this.parseUnit(e,1===t||3===t?"width":"height")}if(i>0)return Math.max(Math.round(i),1)}}return 0}convertBox(t,e){switch(this.display){case"table":if(!e&&"collapse"===this.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if(e){switch(this.tagName){case"TD":case"TH":return 0;default:const e=this.actualParent;if(e){const[i,n]=e.css("borderSpacing").split(" ");switch(t){case"marginTop":case"marginBottom":return n?this.parseUnit(n,"height",!1):this.parseUnit(i,"width",!1);case"marginRight":if(e.lastChild!==this)return this.parseUnit(i,"width",!1);case"marginLeft":return 0}}}return 0}}const i=this.parseUnit(this.css(t));if(!e){let e=this.toFloat("paddingInlineStart"),n=this.toFloat("paddingInlineEnd");if(e>0||n>0)return"vertical-rl"===this.css("writingMode")?"rtl"===this.dir?("paddingBottom"!==t&&(e=0),"paddingTop"!==t&&(n=0)):("paddingTop"!==t&&(e=0),"paddingBottom"!==t&&(n=0)):"rtl"===this.dir?("paddingRight"!==t&&(e=0),"paddingLeft"!==t&&(n=0)):("paddingLeft"!==t&&(e=0),"paddingRight"!==t&&(n=0)),e+i+n}return i}set parent(t){t&&(t!==this._parent&&(this._parent&&this._parent.remove(this),this._parent=t),t.contains(this)||t.append(this),-1===this.depth&&(this.depth=t.depth+1))}get parent(){return this._parent}get tagName(){let t=this._cached.tagName;if(void 0===t){const e=this._element;t=e?"#"===e.nodeName.charAt(0)?e.nodeName:e.tagName:"",this._cached.tagName=t}return t}get element(){return this._element}get elementId(){return this._element?this._element.id:""}get htmlElement(){let t=this._cached.htmlElement;return void 0===t&&(t=!this.plainText&&this._element instanceof HTMLElement,this._cached.htmlElement=t),t}get svgElement(){let t=this._cached.svgElement;return void 0===t&&(t=!this.htmlElement&&!this.plainText&&this._element instanceof SVGElement,this._cached.svgElement=t),t}get styleElement(){return this.htmlElement||this.svgElement}get naturalChild(){return!0}get naturalElement(){let t=this._cached.naturalElement;return void 0===t&&(this._cached.naturalElement=t=this.naturalChild&&this.styleElement&&!this.pseudoElement),t}get pseudoElement(){return!1}get imageElement(){return"IMG"===this.tagName}get flexElement(){let t=this._cached.flexElement;return void 0===t&&(t=this.display.endsWith("flex"),this._cached.flexElement=t),t}get gridElement(){let t=this._cached.gridElement;return void 0===t&&(t=this.display.endsWith("grid"),this._cached.gridElement=t),t}get textElement(){let t=this._cached.textElement;return void 0===t&&(this._cached.textElement=t=this.plainText||this.inlineText),t}get tableElement(){let t=this._cached.tableElement;return void 0===t&&(this._cached.tableElement=t="TABLE"===this.tagName||"table"===this.display),t}get inputElement(){let t=this._cached.inputElement;if(void 0===t){switch(this.tagName){case"INPUT":case"BUTTON":case"SELECT":case"TEXTAREA":t=!0;break;default:t=!1}this._cached.inputElement=t}return t}get layoutElement(){let t=this._cached.layoutElement;return void 0===t&&(this._cached.layoutElement=t=this.flexElement||this.gridElement),t}get plainText(){return"#text"===this.tagName}get styleText(){return this.naturalElement&&this.inlineText}get lineBreak(){return"BR"===this.tagName}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||I.newBoxRectDimension()}get linear(){if(void 0===this._linear&&this._bounds){if(this._element){const t=this._bounds;this._linear={top:t.top-(this.marginTop>0?this.marginTop:0),right:t.right+this.marginRight,bottom:t.bottom+this.marginBottom,left:t.left-(this.marginLeft>0?this.marginLeft:0),width:0,height:0}}else this._linear=I.assignRect(this._bounds);this.setBoxModel("linear")}return this._linear||I.newBoxRectDimension()}get box(){if(void 0===this._box&&this._bounds){if(this._element){const t=this._bounds;this._box={top:t.top+(this.paddingTop+this.borderTopWidth),right:t.right-(this.paddingRight+this.borderRightWidth),bottom:t.bottom-(this.paddingBottom+this.borderBottomWidth),left:t.left+(this.paddingLeft+this.borderLeftWidth),width:0,height:0}}else this._box=I.assignRect(this._bounds);this.setBoxModel("box")}return this._box||I.newBoxRectDimension()}get dataset(){return this.styleElement?this._element.dataset:(void 0===this._dataset&&(this._dataset={}),this._dataset)}get flexbox(){let t=this._cached.flexbox;if(void 0===t){const e=this.actualParent,i=this.css("alignSelf"),n=this.css("justifySelf"),s=(t,i,n)=>{const o=(n||this).css(t);return N.isNumber(o)?parseFloat(o):"inherit"===o&&void 0===n&&e?s(t,i,e):i};t={alignSelf:"auto"===i&&e&&e.has("alignItems")?e.css("alignItems"):i,justifySelf:"auto"===n&&e&&e.has("justifyItems")?e.css("justifyItems"):n,basis:this.css("flexBasis"),grow:s("flexGrow",0),shrink:s("flexShrink",1),order:this.toInt("order")},this._cached.flexbox=t}return t}get width(){let t=this._cached.width;return void 0===t&&(t=this.setDimension("width","minWidth","maxWidth"),this._cached.width=t),t}get height(){let t=this._cached.height;return void 0===t&&(t=this.setDimension("height","minHeight","maxHeight"),this._cached.height=t),t}get hasWidth(){return this.width>0}get hasHeight(){const t=this.css("height");if(C.isPercent(t)){if(this.pageFlow){const e=this.actualParent;if(e&&e.hasHeight)return parseFloat(t)>0}return!1}return this.height>0}get lineHeight(){let t=this._cached.lineHeight;if(void 0===t){if(t=0,!this.imageElement&&!this.svgElement){let e=this.has("lineHeight"),i=0;if(e){const t=this.css("lineHeight");if(C.isPercent(t))i=N.convertFloat(this.style.lineHeight);else if(i=C.parseUnit(t,this.fontSize),t.endsWith("px")){const t=this.cssInitial("fontSize");t.endsWith("em")&&(i*=parseFloat(t))}}else if(this.naturalChild){let t=this.actualParent;for(;t;){if(t.lineHeight>0){i=t.lineHeight;break}t=t.actualParent}if(this.styleElement){const t=this.cssInitial("fontSize");if(t.endsWith("em")){const n=parseFloat(t);1!==n&&(this.css("lineHeight",C.formatPX(i*=n)),e=!0)}}}(e||i>this.actualHeight||this.multiline||this.block&&this.naturalChildren.some(t=>t.textElement))&&(t=i)}this._cached.lineHeight=t}return t}get display(){return this.css("display")}get positionStatic(){let t=this._cached.positionStatic;if(void 0===t){switch(this.css("position")){case"fixed":case"absolute":t=!1;break;case"relative":(t=!(this.hasPX("top")||this.hasPX("right")||this.hasPX("bottom")||this.hasPX("left")))&&(this._cached.positionRelative=!1);break;case"inherit":const e=this._element,i=e&&e.parentElement?C.getInheritedStyle(e.parentElement,"position"):"";t=""!==i&&!("absolute"===i||"fixed"===i);break;default:t=!0}this._cached.positionStatic=t}return t}get positionRelative(){let t=this._cached.positionRelative;return void 0===t&&(t="relative"===this.css("position"),this._cached.positionRelative=t),t}get positionAuto(){let t=this._cached.positionAuto;if(void 0===t){if(this.pageFlow)t=!1;else{const{top:e,right:i,bottom:n,left:s}=-1===this._initial.iteration?this._styleMap:this._initial.styleMap;t=!(e&&"auto"!==e||i&&"auto"!==i||n&&"auto"!==n||s&&"auto"!==s||!(this.toFloat("opacity",!0,1)>0))}this._cached.positionAuto=t}return t}get top(){let t=this._cached.top;return void 0===t&&(t=this.convertPosition("top"),this._cached.top=t),t}get right(){let t=this._cached.right;return void 0===t&&(t=this.convertPosition("right"),this._cached.right=t),t}get bottom(){let t=this._cached.bottom;return void 0===t&&(t=this.convertPosition("bottom"),this._cached.bottom=t),t}get left(){let t=this._cached.left;return void 0===t&&(t=this.convertPosition("left"),this._cached.left=t),t}get marginTop(){let t=this._cached.marginTop;return void 0===t&&(t=this.inlineStatic?0:this.convertBox("marginTop",!0),this._cached.marginTop=t),t}get marginRight(){let t=this._cached.marginRight;return void 0===t&&(t=this.convertBox("marginRight",!0),this._cached.marginRight=t),t}get marginBottom(){let t=this._cached.marginBottom;return void 0===t&&(t=this.inlineStatic?0:this.convertBox("marginBottom",!0),this._cached.marginBottom=t),t}get marginLeft(){let t=this._cached.marginLeft;return void 0===t&&(t=this.convertBox("marginLeft",!0),this._cached.marginLeft=t),t}get borderTopWidth(){let t=this._cached.borderTopWidth;return void 0===t&&(t=this.convertBorderWidth(0),this._cached.borderTopWidth=t),t}get borderRightWidth(){let t=this._cached.borderRightWidth;return void 0===t&&(t=this.convertBorderWidth(1),this._cached.borderRightWidth=t),t}get borderBottomWidth(){let t=this._cached.borderBottomWidth;return void 0===t&&(t=this.convertBorderWidth(2),this._cached.borderBottomWidth=t),t}get borderLeftWidth(){let t=this._cached.borderLeftWidth;return void 0===t&&(t=this.convertBorderWidth(3),this._cached.borderLeftWidth=t),t}get paddingTop(){let t=this._cached.paddingTop;return void 0===t&&(t=this.convertBox("paddingTop",!1),this._cached.paddingTop=t),t}get paddingRight(){let t=this._cached.paddingRight;return void 0===t&&(t=this.convertBox("paddingRight",!1),this._cached.paddingRight=t),t}get paddingBottom(){let t=this._cached.paddingBottom;return void 0===t&&(t=this.convertBox("paddingBottom",!1),this._cached.paddingBottom=t),t}get paddingLeft(){let t=this._cached.paddingLeft;return void 0===t&&(t=this.convertBox("paddingLeft",!1),this._cached.paddingLeft=t),t}get contentBox(){return"border-box"!==this.css("boxSizing")}get contentBoxWidth(){let t=this._cached.contentBoxWidth;return void 0===t&&(t=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth,this._cached.contentBoxWidth=t),t}get contentBoxHeight(){let t=this._cached.contentBoxHeight;return void 0===t&&(t=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth,this._cached.contentBoxHeight=t),t}get inline(){let t=this._cached.inline;if(void 0===t){const e=this.display;t="inline"===e||"initial"===e&&!I.ELEMENT_BLOCK.includes(this.tagName),this._cached.inline=t}return t}get inlineStatic(){let t=this._cached.inlineStatic;return void 0===t&&(this._cached.inlineStatic=t=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement),t}get inlineHorizontal(){let t=this._cached.inlineHorizontal;if(void 0===t){if(this.naturalElement){const e=this.display;t=e.startsWith("inline-")||e.startsWith("table")||this.flexElement||this.floating||"RUBY"===this.tagName}else t=this.plainText;this._cached.inlineVertical=t}return t}get inlineVertical(){let t=this._cached.inlineVertical;if(void 0===t){if(this.naturalElement){const e=this.display;t=(e.startsWith("inline")||"table-cell"===e)&&!this.floating&&!this.plainText}else t=!1;this._cached.inlineVertical=t}return t}set inlineText(t){switch(this.tagName){case"INPUT":case"IMG":case"SELECT":case"SVG":case"BR":case"HR":case"TEXTAREA":this._inlineText=!1;break;case"BUTTON":this._inlineText=""!==this.textContent.trim();break;default:this._inlineText=t}}get inlineText(){return this._inlineText}get block(){let t=this._cached.block;if(void 0===t){switch(this.display){case"block":case"flex":case"grid":case"list-item":t=!0;break;case"initial":t=I.ELEMENT_BLOCK.includes(this.tagName);break;case"inline":if("svg"===this.tagName&&this.actualParent.htmlElement){t=!this.hasPX("width")&&0===N.convertFloat(I.getNamedItem(this._element,"width"));break}default:t=!1}this._cached.block=t}return t}get blockStatic(){let t=this._cached.blockStatic;return void 0===t&&(t=this.pageFlow&&(this.block&&!this.floating||this.blockDimension&&"100%"===this.cssInitial("width")&&!this.hasPX("maxWidth")),this._cached.blockStatic=t),t}get blockDimension(){let t=this._cached.blockDimension;if(void 0===t){const e=this.display;t=this.block||e.startsWith("inline-")||"table"===e||this.imageElement||this.svgElement,this._cached.blockDimension=t}return t}get blockVertical(){let t=this._cached.blockVertical;return void 0===t&&(t=this.blockDimension&&this.hasPX("height"),this._cached.blockVertical=t),t}get pageFlow(){let t=this._cached.pageFlow;return void 0===t&&(this._cached.pageFlow=t=this.positionStatic||this.positionRelative),t}get inlineFlow(){let t=this._cached.inlineFlow;if(void 0===t){const e=this.display;t=this.inline||e.startsWith("inline")||"table-cell"===e||this.imageElement||this.floating,this._cached.inlineFlow=t}return t}get centerAligned(){let t=this._cached.centerAligned;return void 0===t&&(t=this.autoMargin.leftRight||this.textElement&&this.blockStatic&&"center"===this.cssInitial("textAlign")||this.inlineStatic&&"center"===this.cssAscend("textAlign",!0),this._cached.centerAligned=t),t}get rightAligned(){let t=this._cached.rightAligned;return void 0===t&&(t="right"===this.float||this.autoMargin.left||!this.pageFlow&&this.hasPX("right")||this.textElement&&this.blockStatic&&"right"===this.cssInitial("textAlign"),this._cached.rightAligned=t),t}get bottomAligned(){let t=this._cached.bottomAligned;return void 0===t&&(t=!this.pageFlow&&this.hasPX("bottom")&&this.bottom>=0,this._cached.bottomAligned=t),t}get horizontalAligned(){let t=this._cached.horizontalAligned;return void 0===t&&(t=!(this.blockStatic||this.autoMargin.horizontal||this.blockDimension&&"100%"===this.css("width")),this._cached.horizontalAligned=t),t}get autoMargin(){let t=this._cached.autoMargin;if(void 0===t){if(!this.pageFlow||this.blockStatic||"table"===this.display){const e=-1===this._initial.iteration?this._styleMap:this._initial.styleMap,i="auto"===e.marginLeft&&(this.pageFlow||this.hasPX("right")),n="auto"===e.marginRight&&(this.pageFlow||this.hasPX("left")),s="auto"===e.marginTop&&(this.pageFlow||this.hasPX("bottom")),o="auto"===e.marginBottom&&(this.pageFlow||this.hasPX("top"));t={horizontal:i||n,left:i&&!n,right:!i&&n,leftRight:i&&n,vertical:s||o,top:s&&!o,bottom:!s&&o,topBottom:s&&o}}else t={};this._cached.autoMargin=t}return t}get floating(){let t=this._cached.floating;return void 0===t&&(t=!!this.pageFlow&&this.cssAny("float","left","right"),this._cached.floating=t),t}get float(){let t=this._cached.float;return void 0===t&&(t=this.css("float")||"none",this._cached.float=t),t}get zIndex(){return this.toInt("zIndex")}get textContent(){let t=this._cached.textContent;return void 0===t&&(this._cached.textContent=t=this.svgElement?"":this._element.textContent),t}get src(){return this.htmlElement&&this._element.src||""}get overflow(){let t=this._cached.overflow;if(void 0===t){if(t=0,this.htmlElement&&!this.inputElement&&!this.imageElement&&"HR"!==this.tagName&&!this.documentBody){const e=this._element,i=this.css("overflowX"),n=this.css("overflowY");this.hasHeight&&(this.hasPX("height")||this.hasPX("maxHeight"))&&("scroll"===n||"auto"===n&&e.clientHeight!==e.scrollHeight)&&(t|=16),(this.hasPX("width")||this.hasPX("maxWidth"))&&("scroll"===i||"auto"===i&&e.clientWidth!==e.scrollWidth)&&(t|=8),"auto"!==i&&"hidden"!==i&&"overlay"!==i&&"auto"!==n&&"hidden"!==n&&"overlay"!==n||(t|=64)}this._cached.overflow=t}return t}get overflowX(){return N.hasBit(this.overflow,8)}get overflowY(){return N.hasBit(this.overflow,16)}get baseline(){let t=this._cached.baseline;return void 0===t&&(t=this.pageFlow&&!this.floating&&this.cssAny("verticalAlign","baseline","initial","0px","0%"),this._cached.baseline=t),t}get verticalAlign(){let t=this._cached.verticalAlign;return void 0===t&&(t=this.css("verticalAlign"),C.isLength(t,!0)&&(t=this.convertPX(t,"height")),this._cached.verticalAlign=t),t}set textBounds(t){this._textBounds=t||void 0}get textBounds(){return this.naturalChild&&void 0===this._textBounds&&(this._textBounds=P.actualTextRangeRect(this._element,this.sessionId)),this._textBounds}get multiline(){let t=this._cached.multiline;if(void 0===t){if(this.plainText)t=I.getRangeClientRect(this._element).numberOfLines>1;else if(this.styleText&&(this.inlineFlow||0===this.naturalElements.length)){const e=this.textBounds;t=!!e&&e.numberOfLines>1}else t=!1;this._cached.multiline=t}return t}get positiveAxis(){let t=this._cached.positiveAxis;return void 0===t&&(t=(!this.positionRelative||this.positionRelative&&this.top>=0&&this.left>=0&&(this.right<=0||this.hasPX("left"))&&(this.bottom<=0||this.hasPX("top")))&&this.marginTop>=0&&this.marginLeft>=0&&this.marginRight>=0,this._cached.positiveAxis=t),t}get backgroundColor(){let t=this._cached.backgroundColor;if(void 0===t){switch(t=this.css("backgroundColor")){case"initial":case"rgba(0, 0, 0, 0)":case"transparent":t="";break;default:if(""!==t&&this.pageFlow&&!this.plainText&&!this.inputElement&&(-1===this._initial.iteration||this.cssInitial("backgroundColor")===t)){let e=this.actualParent;for(;e&&0!==e.id;){const i=e.cssInitial("backgroundColor",!0);if(""!==i){i===t&&""===e.backgroundColor&&(t="");break}e=e.actualParent}}}this._cached.backgroundColor=t}return t}get backgroundImage(){let t=this._cached.backgroundImage;if(void 0===t){const e=this.css("backgroundImage");if(""!==e&&"none"!==e&&"initial"!==e)t=e;else{const e=L.BACKGROUND.exec(this.css("background"));t=e?e[1]:""}this._cached.backgroundImage=t}return t}get visibleStyle(){let t=this._cached.visibleStyle;if(void 0===t){if(this.plainText)t={background:!1,borderWidth:!1,backgroundImage:!1,backgroundColor:!1,backgroundRepeat:!1};else{const e=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,i=""!==this.backgroundColor,n=""!==this.backgroundImage;t={background:e||n||i,borderWidth:e,backgroundImage:n,backgroundColor:i,backgroundRepeat:"no-repeat"!==this.css("backgroundRepeat")}}this._cached.visibleStyle=t}return t}get percentWidth(){let t=this._cached.percentWidth;return void 0===t&&(t=C.isPercent(this.cssInitial("width",!0)),this._cached.percentWidth=t),t}get percentHeight(){let t=this._cached.percentHeight;return void 0===t&&(t=C.isPercent(this.cssInitial("height",!0)),this._cached.percentHeight=t),t}get absoluteParent(){let t=this._cached.absoluteParent;if(void 0===t){if(t=this.actualParent,!this.pageFlow)for(;t&&0!==t.id;){const e=t.cssInitial("position",!1,!0);if(t.documentBody||"static"!==e&&"initial"!==e)break;t=t.actualParent}this._cached.absoluteParent=t}return t}set actualParent(t){this._cached.actualParent=t}get actualParent(){let t=this._cached.actualParent;if(void 0===t){const e=this._element;t=e&&e.parentElement&&P.getElementAsNode(e.parentElement,this.sessionId)||null,this._cached.actualParent=t}return t}get actualWidth(){let t=this._cached.actualWidth;if(void 0===t){if(this.plainText)t=this.bounds.right-this.bounds.left;else{t=this.bounds.width;const e=this.actualParent;if(e&&!e.flexElement&&"table-cell"!==this.display){const e=this.parseUnit(this.cssInitial("width",!0));if(e>0){t=e;const i=this.parseUnit(this.css("maxWidth"));i>0&&(t=Math.min(t,i)),this.contentBox&&!this.tableElement&&(t+=this.contentBoxWidth)}}}this._cached.actualWidth=t}return t}get actualHeight(){let t=this._cached.actualHeight;if(void 0===t){if(t=this.bounds.height,!this.plainText){const e=this.actualParent;if(e&&!e.flexElement&&"table-cell"!==this.display){const e=this.parseUnit(this.cssInitial("height",!0),"height");if(e>0){t=e;const i=this.parseUnit(this.css("maxHeight"));i>0&&(t=Math.min(t,i)),this.contentBox&&!this.tableElement&&(t+=this.contentBoxHeight)}}}this._cached.actualHeight=t}return t}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}set naturalChildren(t){this._naturalChildren=t}get naturalChildren(){if(void 0===this._naturalChildren)if(this.naturalElement){const t=this.sessionId,e=[];let i=0;this._element.childNodes.forEach(n=>{const s=P.getElementAsNode(n,t);s&&(s.childIndex=i++,e.push(s))}),this._naturalChildren=e}else-1===this._initial.iteration&&this.saveAsInitial(),this._naturalChildren=this._initial.children;return this._naturalChildren}set naturalElements(t){this._naturalElements=t}get naturalElements(){return void 0===this._naturalElements&&(this._naturalElements=N.filterArray(this.naturalChildren,t=>t.naturalElement)),this._naturalElements}get firstChild(){return this.naturalElements[0]||null}get lastChild(){const t=this.naturalElements,e=t.length;return e?t[e-1]:null}get firstStaticChild(){for(const t of this.naturalChildren)if(t.pageFlow)return t;return null}get lastStaticChild(){const t=this.naturalChildren;for(let e=t.length-1;e>=0;e--){const i=t[e];if(i.pageFlow)return i}return null}get previousSibling(){const t=this.actualParent;return t&&t.naturalChildren[this.childIndex-1]||null}get nextSibling(){const t=this.actualParent;return t&&t.naturalChildren[this.childIndex+1]||null}get previousElementSibling(){const t=this.actualParent;if(t){const e=t.naturalElements,i=e.indexOf(this);if(i>0)return e[i-1]}return null}get nextElementSibling(){const t=this.actualParent;if(t){const e=t.naturalElements,i=e.indexOf(this);if(i<e.length-1)return e[i+1]}return null}get attributes(){let t=this._cached.attributes;if(void 0===t){if(t={},this.styleElement){const e=this._element.attributes,i=e.length;for(let n=0;n<i;n++){const i=e.item(n);t[i.name]=i.value}}this._cached.attributes=t}return t}get fontSize(){return 0===this._fontSize&&(this._fontSize=this.naturalElement?parseFloat(this.style.getPropertyValue("font-size")):C.parseUnit(this.css("fontSize"))),this._fontSize||parseFloat(C.getStyle(document.body).getPropertyValue("font-size"))}set dir(t){this._cached.dir=t}get dir(){let t=this._cached.dir;if(void 0===t){if(""===(t=this.naturalElement?this._element.dir:"")){let e=this.actualParent;for(;e&&""===(t=e.dir);)e=e.actualParent}this._cached.dir=t}return t}get center(){const t=this.bounds;return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}get extensions(){let t=this._cached.extensions;return void 0===t&&(t=this.dataset.use?N.spliceArray(this.dataset.use.split(B.XML.SEPARATOR),t=>""===t):[],this._cached.extensions=t),t}}const F={EXT_DATA:"mainData",TOP_BOTTOM:"topBottom",BOTTOM_TOP:"bottomTop",LEFT_RIGHT:"leftRight",RIGHT_LEFT:"rightLeft"},D=new Map([[2,"marginTop"],[4,"marginRight"],[8,"marginBottom"],[16,"marginLeft"],[32,"paddingTop"],[64,"paddingRight"],[128,"paddingBottom"],[256,"paddingLeft"]]),H={ACCESSIBILITY:"squared.accessibility",CSS_GRID:"squared.css-grid",FLEXBOX:"squared.flexbox",GRID:"squared.grid",LIST:"squared.list",RELATIVE:"squared.relative",SPRITE:"squared.sprite",TABLE:"squared.table",VERTICAL_ALIGN:"squared.verticalalign",WHITESPACE:"squared.whitespace"};var X,z,U,V=Object.freeze({__proto__:null,STRING_BASE:F,CSS_SPACING:D,EXT_NAME:H});!function(t){t[t.DOM_TRAVERSE=2]="DOM_TRAVERSE",t[t.EXTENSION=4]="EXTENSION",t[t.RENDER=8]="RENDER",t[t.ALL=14]="ALL"}(X||(X={})),function(t){t[t.BOX_STYLE=2]="BOX_STYLE",t[t.BOX_SPACING=4]="BOX_SPACING",t[t.FONT_STYLE=8]="FONT_STYLE",t[t.VALUE_STRING=16]="VALUE_STRING",t[t.IMAGE_SOURCE=32]="IMAGE_SOURCE",t[t.ASSET=56]="ASSET",t[t.ALL=126]="ALL"}(z||(z={})),function(t){t[t.CONSTRAINT=2]="CONSTRAINT",t[t.LAYOUT=4]="LAYOUT",t[t.ALIGNMENT=8]="ALIGNMENT",t[t.ACCESSIBILITY=16]="ACCESSIBILITY",t[t.LOCALIZATION=32]="LOCALIZATION",t[t.CUSTOMIZATION=64]="CUSTOMIZATION",t[t.ALL=126]="ALL"}(U||(U={}));var G=Object.freeze({__proto__:null,get APP_SECTION(){return X},get NODE_RESOURCE(){return z},get NODE_PROCEDURE(){return U}});const{css:q,dom:j,math:Y,session:$,util:K}=squared.lib,Q=Array.from(D.keys()),Z=["position","display","verticalAlign","float","clear","zIndex"],J=t=>t.naturalElements.length&&!t.layoutElement&&!t.tableElement;class tt extends W{constructor(){super(...arguments),this.alignmentType=0,this.baselineActive=!1,this.baselineAltered=!1,this.positioned=!1,this.rendered=!1,this.excluded=!1,this.controlId="",this.floatContainer=!1,this.containerIndex=1/0,this.lineBreakLeading=!1,this.lineBreakTrailing=!1,this._excludeSection=0,this._excludeProcedure=0,this._excludeResource=0,this._visible=!0,this._locked={}}static outerRegion(t){let e=1/0,i=-1/0,n=-1/0,s=1/0;return t.each(t=>{let o,r,a,l;t.companion?(o=t.actualRect("top"),r=t.actualRect("right"),a=t.actualRect("bottom"),l=t.actualRect("left")):({top:o,right:r,bottom:a,left:l}=t.linear),o<e&&(e=o),r>i&&(i=r),a>n&&(n=a),l<s&&(s=l)}),{top:e,right:i,bottom:n,left:s}}static baseline(t,e=!1){return(t=K.filterArray(t,t=>!(!t.baseline&&!q.isLength(t.verticalAlign)||e&&!t.textElement)&&(!t.floating&&!t.baselineAltered&&(t.naturalChild&&0===t.length||!t.layoutVertical&&t.every(t=>t.baseline&&!t.multiline))))).length>1&&t.sort((t,e)=>{if(t.length&&0===e.length)return 1;if(e.length&&0===t.length)return-1;let i=t.baselineHeight,n=e.baselineHeight;if(0!==t.marginTop){if(!(t.imageElement||i>=n||t.marginTop<0))return t.marginTop>(n-i)/2?-1:1;i+=t.marginTop}if(0!==e.marginTop){if(!(e.imageElement||n>=i||e.marginTop<0))return e.marginTop>(i-n)/2?1:-1;n+=e.marginTop}if(!Y.isEqual(i,n))return i>n?-1:1;if(t.textElement&&e.textElement){if(!t.plainText&&e.plainText)return-1;if(t.plainText&&!e.plainText)return 1}else if(t.inputElement&&e.inputElement&&t.containerType!==e.containerType)return t.containerType>e.containerType?-1:1;return t.bounds.bottom>e.bounds.bottom?-1:t.bounds.bottom<e.bounds.bottom?1:0}),t.shift()||null}static linearData(t,e=!1){const i=new Set,n=new Map;let s=!1,o=!1;if(t.length>1){const r=[],a=new Set,l={};for(const e of t)if(e.pageFlow){if(a.size){const t=[],i=e.css("clear");switch(i){case"left":t.push(l.left);break;case"right":t.push(l.right);break;case"both":t.push(l.left,l.right)}for(const i of t)if(i){const t=i.float;a.has(t)&&!e.floating&&K.aboveRange(e.linear.top,i.linear.bottom)&&(a.delete(t),l[t]=void 0)}"both"===i?(n.set(e,2===a.size?"both":a.values().next().value),a.clear(),l.left=void 0,l.right=void 0):a.has(i)&&(n.set(e,i),a.delete(i),l[i]=void 0)}if(e.floating){const t=e.float;a.add(t),i.add(t),l[t]=e}r.push(e)}else e.positionAuto&&r.push(e);const c=r.length;if(c&&!e){const t=[r[0]];let e=1,a=1;for(let i=1;i<c;i++)r[i].alignedVertically(t,n)?a++:e++,t.push(r[i]);if(o=a===c,(s=e===c)&&i.size){let t=1/0,e=-1/0,i=-1/0,n=1/0;for(const s of r){const{left:o,right:r}=s.linear;t=Math.min(t,o),e=Math.max(e,r),s.floating&&("left"===s.float?i=Math.max(i,r):n=Math.min(n,o))}for(let o=0,a=0,l=0,h=0,d=0;o<c;o++){const c=r[o],{left:u,right:f}=c.linear;if(Math.floor(u)<=t&&a++,Math.ceil(f)>=e&&l++,c.floating||(u===i&&h++,f===n&&d++),0===o)continue;if(2===a||2===l||2===h||2===d){s=!1;break}const g=r[o-1];if(K.withinRange(u,g.linear.left)||g.floating&&K.aboveRange(c.linear.top,g.linear.bottom)){s=!1;break}}}}}else t.length&&(s=!(o=t[0].blockStatic));return{linearX:s,linearY:o,cleared:n,floated:i}}static partitionRows(t){const e=t[0].actualParent,i=e&&e.floatContainer?tt.linearData(e.naturalElements,!0).cleared:void 0,n=[];let s=[],o=[];const r=t.length;for(let e=0;e<r;e++){const r=t[e];let a=r;if(!r.naturalChild){if(r.nodeGroup){s.length&&n.push(s),n.push([r]),s=[],o.length=0;continue}let t=r.innerWrapped;for(;t;){if(t.naturalChild){a=t;break}t=t.innerWrapped}}0===s.length?(s.push(r),o.push(a)):a.alignedVertically(o,i)?(s.length&&n.push(s),s=[r],o=[a]):(s.push(r),o.push(a))}return s.length&&n.push(s),n}is(t){return this.containerType===t}of(t,...e){return this.containerType===t&&e.some(t=>this.hasAlign(t))}attr(t,e,i,n=!0){let s=this["__"+t];return i?(void 0===s&&(this._namespaces.includes(t)||this._namespaces.push(t),this["__"+t]=s={}),!n&&s[e]?"":(s[e]=""+i,i)):s&&s[e]||""}unsafe(t,e){if(void 0===e)return this["_"+t];this["_"+t]=e}unset(t){delete this["_"+t]}namespace(t){return this["__"+t]||{}}delete(t,...e){const i=this["__"+t];if(i)for(const t of e)if(-1!==t.indexOf("*"))for(const[e]of K.searchObject(i,t))delete i[e];else delete i[t]}apply(t){for(const e in t){const i=t[e];if("object"==typeof i){for(const t in i)this.attr(e,t,i[t]);delete t[e]}}}lockAttr(t,e){let i=this._locked[t];void 0===i&&(this._locked[t]=i={}),i[e]=!0}lockedAttr(t,e){const i=this._locked[t];return i&&i[e]||!1}render(t){this.renderParent=t,this.rendered=!0}renderEach(t){const e=this.renderChildren,i=e.length;for(let n=0;n<i;n++){const i=e[n];i.visible&&t(i,n,e)}return this}renderFilter(t){return K.filterArray(this.renderChildren,t)}hide(t){const e=this.renderParent;if(e){const t=e.renderTemplates;if(t){const i=e.renderChildren.findIndex(t=>t===this);if(-1!==i){const e=t[i];e&&e.node===this&&(t[i]=null)}}}this.rendered=!0,this.visible=!1}inherit(t,...e){for(const i of e)switch(i){case"base":this._documentParent=t.documentParent,this._bounds=j.assignRect(t.bounds),this._linear=j.assignRect(t.linear),this._box=j.assignRect(t.box),this._boxReset=j.newBoxModel(),this._boxAdjustment=j.newBoxModel(),-1===this.depth&&(this.depth=t.depth);const e=t.actualParent;e&&(this.actualParent=e,this.dir=e.dir);break;case"initial":K.cloneObject(t.unsafe("initial"),this.initial);break;case"alignment":{const e=t.unsafe("initial").styleMap,i=this._styleMap,n=this._initial.styleMap;this.positionAuto=t.positionAuto;for(const s of Z)i[s]=t.css(s),n[s]=e[s];if(!this.positionStatic)for(const s of q.BOX_POSITION)t.hasPX(s)&&(i[s]=t.css(s)),n[s]=e[s];if(t.autoMargin.horizontal||t.autoMargin.vertical)for(const e of q.BOX_MARGIN)"auto"===t.cssInitial(e)&&(i[e]="auto",n[e]="auto");break}case"styleMap":K.assignEmptyProperty(this._styleMap,t.unsafe("styleMap"));break;case"textStyle":this.cssApply(t.getTextStyle()),this.fontSize=t.fontSize;break;case"boxStyle":const{backgroundColor:i,backgroundImage:n}=t;this.cssApply({backgroundColor:i,backgroundImage:n,backgroundRepeat:t.css("backgroundRepeat"),backgroundSize:t.css("backgroundSize"),backgroundPositionX:t.css("backgroundPositionX"),backgroundPositionY:t.css("backgroundPositionY"),backgroundClip:t.css("backgroundClip"),border:"initial",borderRadius:"initial",borderTopWidth:t.css("borderTopWidth"),borderBottomWidth:t.css("borderBottomWidth"),borderRightWidth:t.css("borderRightWidth"),borderLeftWidth:t.css("borderLeftWidth"),borderTopColor:t.css("borderTopColor"),borderBottomColor:t.css("borderBottomColor"),borderRightColor:t.css("borderRightColor"),borderLeftColor:t.css("borderLeftColor"),borderTopStyle:t.css("borderTopStyle"),borderBottomStyle:t.css("borderBottomStyle"),borderRightStyle:t.css("borderRightStyle"),borderLeftStyle:t.css("borderLeftStyle"),borderTopLeftRadius:t.css("borderTopLeftRadius"),borderTopRightRadius:t.css("borderTopRightRadius"),borderBottomRightRadius:t.css("borderBottomRightRadius"),borderBottomLeftRadius:t.css("borderBottomLeftRadius")},!0),this.setCacheValue("backgroundColor",i),this.setCacheValue("backgroundImage",n),t.cssApply({borderTopWidth:"0px",borderBottomWidth:"0px",borderRightWidth:"0px",borderLeftWidth:"0px",backgroundColor:"transparent",backgroundImage:"none",border:"0px none solid",borderRadius:"0px"},!0),t.setCacheValue("backgroundColor",""),t.setCacheValue("backgroundImage",""),t.resetBox(510,this)}}addAlign(t){this.hasAlign(t)||(this.alignmentType|=t)}removeAlign(t){this.hasAlign(t)&&(this.alignmentType^=t)}hasAlign(t){return K.hasBit(this.alignmentType,t)}hasResource(t){return!K.hasBit(this.excludeResource,t)}hasProcedure(t){return!K.hasBit(this.excludeProcedure,t)}hasSection(t){return!K.hasBit(this.excludeSection,t)}exclude(t=0,e=0,i=0){t>0&&!K.hasBit(this._excludeResource,t)&&(this._excludeResource|=t),e>0&&!K.hasBit(this._excludeProcedure,e)&&(this._excludeProcedure|=e),i>0&&!K.hasBit(this._excludeSection,i)&&(this._excludeSection|=i)}setExclusions(){if(this.styleElement){const t=this.actualParent,e=(e,i)=>{let n=this.dataset[e]||"",s=0;if(t&&t.dataset[e+"Child"]&&(n+=(""!==n?"|":"")+t.dataset[e+"Child"]),""!==n)for(let t of n.split("|"))i[t=t.trim().toUpperCase()]&&!K.hasBit(s,i[t])&&(s|=i[t]);return s};this.exclude(e("excludeResource",z),e("excludeProcedure",U),e("excludeSection",X))}}appendTry(t,e,i=!0){let n=!1;const s=this.children,o=s.length;for(let i=0;i<o;i++)if(s[i]===t){s[i]=e,e.parent=this,e.containerIndex=t.containerIndex,n=!0;break}return!n&&i&&(e.parent=this,n=!0),n}sort(t){return t?super.sort(t):this.children.sort((t,e)=>t.containerIndex<e.containerIndex?-1:1),this}alignedVertically(t,e,i){if(this.lineBreak)return 2;if(this.pageFlow||this.positionAuto){const n=t=>t.blockVertical||t.percentWidth,s=t=>K.aboveRange(this.linear.top,t.linear.bottom)&&(n(this)||n(t)||this.float!==t.float);if(K.isArray(t)){if(e&&e.has(this))return 5;{const n=t[t.length-1];if(this.floating&&n.floating){if(i&&this.float===n.float)return 0;if(K.aboveRange(this.linear.top,n.linear.bottom))return 4;if(i&&e&&e.size&&!t.some((t,i)=>i>0&&e.get(t)===this.float))return 0}else{if(!1===i&&this.floating&&n.blockStatic)return 0;if(void 0!==i&&!this.display.startsWith("inline-")){const{top:n,bottom:s}=this.linear;if(this.textElement&&e&&e.size&&t.some(t=>e.has(t))&&t.some(t=>n<t.linear.top&&s>t.linear.bottom))return 7;if("right"===t[0].float){if(t.length>1){let e=n;if(this.multiline)if(this.plainText)e=s;else if(this.styleText){const t=this.textBounds;t&&t.top>n&&(e=t.top)}let o=-1/0;for(const e of t)"right"===e.float&&e.bounds.bottom>o&&(o=e.bounds.bottom);return K.belowRange(e,o)?i?0:6:i?6:0}if(!i)return 6}}}if(this.blockDimension&&s(n))return 3}}if(this.blockDimension&&"100%"===this.css("width")&&!this.hasPX("maxWidth"))return 1;const o=this.actualParent||this.documentParent,r=this.blockStatic||"table"===this.display;for(const i of this.siblingsLeading){if(i.lineBreak)return 2;if(e&&"both"===e.get(i)&&(!K.isArray(t)||t[0]!==i))return 5;if(r&&(!i.floating||!i.rightAligned&&K.withinRange(i.linear.right,o.box.right)||e&&e.has(i))||i.blockStatic||i.autoMargin.leftRight)return 1;if(i.floating){if("left"===i.float&&this.autoMargin.right||"right"===i.float&&this.autoMargin.left)return 1;if(r&&this.some(t=>t.floating&&K.aboveRange(t.linear.top,i.linear.bottom)))return 6}if(this.blockDimension&&s(i))return 3}}return 0}previousSiblings(t={}){const e=t.floating,i=t.pageFlow,n=t.lineBreak,s=t.excluded,o=[];let r=this.element;if(r)r=r.previousSibling;else{const t=this.firstChild;t&&(r=t.element)&&(r=r.previousSibling)}for(;r;){const t=$.getElementAsNode(r,this.sessionId);if(t)if(!1!==n&&t.lineBreak||!1!==s&&t.excluded&&!t.lineBreak)o.push(t);else if(t.pageFlow&&!t.excluded){if(!1===i)break;if(o.push(t),!1!==e||!t.floating&&(t.visible||t.rendered)&&"none"!==t.display)break}r=r.previousSibling}return o}nextSiblings(t={}){const e=t.floating,i=t.pageFlow,n=t.lineBreak,s=t.excluded,o=[];let r=this._element;if(r)r=r.nextSibling;else{const t=this.lastChild;t&&(r=t.element)&&(r=r.nextSibling)}for(;r;){const t=$.getElementAsNode(r,this.sessionId);if(t)if(!1!==n&&t.lineBreak||!1!==s&&t.excluded&&!t.lineBreak)o.push(t);else if(t.pageFlow&&!t.excluded){if(!1===i)break;if(o.push(t),!1!==e||!t.floating&&(t.visible||t.rendered)&&"none"!==t.display)break}r=r.nextSibling}return o}modifyBox(t,e,i=!0){if(0!==e){const n=D.get(t);if(n&&(void 0===e?(void 0===this._boxReset&&(this._boxReset=j.newBoxModel()),this._boxReset[n]=1):(void 0===this._boxAdjustment&&(this._boxAdjustment=j.newBoxModel()),i?this._boxAdjustment[n]+=e:this[n]+this._boxAdjustment[n]+e<=0?(void 0===this._boxReset&&(this._boxReset=j.newBoxModel()),this._boxReset[n]=1,this._boxAdjustment[n]=0):this._boxAdjustment[n]+=e),this._boxRegister)){const n=this._boxRegister[t];if(n)for(const s of n)s.modifyBox(t,e,i)}}}getBox(t){const e=D.get(t);return e?[this._boxReset?this._boxReset[e]:0,this._boxAdjustment?this._boxAdjustment[e]:0]:[0,0]}resetBox(t,e){void 0===this._boxReset&&(this._boxReset=j.newBoxModel());const i=this._boxReset,n=(t,n)=>{for(let s=0;s<4;s++)if(0===i[t[s]]&&(i[t[s]]=1,e)){const t=Q[s+n],i=D.get(t),o=this[i];0!==o&&(e.naturalChild||0!==e[i]?e.modifyBox(t,o):e.css(i,q.formatPX(o),!0),this.registerBox(t,e))}};K.hasBit(t,30)&&n(q.BOX_MARGIN,0),K.hasBit(t,480)&&n(q.BOX_PADDING,4)}transferBox(t,e){void 0===this._boxAdjustment&&(this._boxAdjustment=j.newBoxModel());const i=this._boxAdjustment;if(i){const n=(t,n)=>{for(let s=0;s<4;s++){const o=i[t[s]];if(o>0){const r=Q[s+n];e.modifyBox(r,o,!1),this.registerBox(r,e),i[t[s]]=0}}};K.hasBit(t,30)&&n(q.BOX_MARGIN,0),K.hasBit(t,480)&&n(q.BOX_PADDING,4)}}registerBox(t,e){void 0===this._boxRegister&&(this._boxRegister={});const i=this._boxRegister;return void 0===i[t]&&(i[t]=new Set),e&&i[t].add(e),i[t]}actualRect(t,e="linear"){const i=this[e][t];if(this.inputElement){const n=this.companion;switch(t){case"top":case"left":if(n&&!n.visible&&n[e][t]<i)return n[e][t];break;case"right":case"bottom":if(n&&!n.visible&&n[e][t]>i)return n[e][t];break;default:return NaN}}return i}actualPadding(t,e){let i=this;for(;!i.naturalChild;){const n=i.innerWrapped;if(!n)return e;if((i=n).naturalChild&&1!==i.getBox("paddingTop"===t?32:128)[0])return e}let n=!1;if(J(i)){n=function i(n){let s=!1;for(const o of n){if(o.blockStatic)return!1;if(o.inlineStatic){if(o.has("lineHeight")&&o.lineHeight>o.bounds.height)return!1;if(o[t]>=e)s=!0;else if(J(o)){if(!i(o.naturalElements))return!1;s=!0}}}return s}(i.naturalElements)}return n?0:e}cloneBase(t){t.localSettings=this.localSettings,t.alignmentType=this.alignmentType,t.containerName=this.containerName,t.depth=this.depth,t.visible=this.visible,t.excluded=this.excluded,t.rendered=this.rendered,t.childIndex=this.childIndex,t.containerIndex=this.containerIndex,t.inlineText=this.inlineText,t.lineBreakLeading=this.lineBreakLeading,t.lineBreakTrailing=this.lineBreakTrailing,t.actualParent=this.actualParent,t.documentParent=this.documentParent,t.documentRoot=this.documentRoot,t.renderParent=this.renderParent,this.length&&t.retain(this.duplicate()),t.inherit(this,"initial","base","alignment","styleMap","textStyle"),Object.assign(t.unsafe("cached"),this._cached)}css(t,e,i=!1){return arguments.length>=2&&(e?this._styleMap[t]=e:delete this._styleMap[t],i&&this.unsetCache(t)),this._styleMap[t]||this.styleElement&&this.style[t]||""}cssApply(t,e=!1){if(Object.assign(this._styleMap,t),e)for(const e in t)this.unsetCache(e);return this}cssSet(t,e,i=!0){return super.css(t,e,i)}setCacheValue(t,e){this._cached[t]=e}get element(){let t=this._element;if(null===t){let e=this.innerWrapped;for(;e&&!(t=e.unsafe("element"));)e=e.innerWrapped}return t}get naturalChild(){return null!==this._element&&null!==this._element.parentElement}get pseudoElement(){return null!==this._element&&"__squared.pseudo"===this._element.className}set documentParent(t){this._documentParent=t}get documentParent(){return this._documentParent||this.absoluteParent||this.actualParent||this.parent||this}set containerName(t){this._cached.containerName=t.toUpperCase()}get containerName(){let t=this._cached.containerName;if(void 0===t){t="";const e=this.element;e&&(t=j.isTextNode(e)?"PLAINTEXT":"INPUT"===e.tagName?"INPUT_"+e.type.toUpperCase():e.tagName.toUpperCase()),this._cached.containerName=t}return t}get excludeSection(){return this._excludeSection}get excludeProcedure(){return this._excludeProcedure}get excludeResource(){return this._excludeResource}get layoutHorizontal(){return this.hasAlign(8)}get layoutVertical(){return this.hasAlign(16)}get nodeGroup(){return!1}set renderAs(t){!t||t.rendered||this.rendered||(this._renderAs=t)}get renderAs(){return this._renderAs}get blockStatic(){return super.blockStatic||this.hasAlign(64)&&!this.floating}get rightAligned(){return super.rightAligned||this.hasAlign(2048)}set positionAuto(t){this._cached.positionAuto=t}get positionAuto(){return super.positionAuto}set flexbox(t){this._cached.flexbox=t}get flexbox(){return super.flexbox}set contentBoxWidth(t){this._cached.contentBoxWidth=t}get contentBoxWidth(){return super.contentBoxWidth}set contentBoxHeight(t){this._cached.contentBoxHeight=t}get contentBoxHeight(){return super.contentBoxHeight}set textContent(t){this._cached.textContent=t}get textContent(){let t=this._cached.textContent;return void 0===t&&(this._cached.textContent=t=this.naturalChild&&this._element?this._element.textContent:""),t}set overflow(t){0!==t&&16!==t&&8!==t&&24!==t||(K.hasBit(this.overflow,64)&&(t|=64),this._cached.overflow=t)}get overflow(){return super.overflow}set baseline(t){this._cached.baseline=t}get baseline(){return super.baseline}set multiline(t){this._cached.multiline=t}get multiline(){return super.multiline}set visible(t){this._visible=t}get visible(){return this._visible}set controlName(t){this.rendered&&void 0!==this._controlName||(this._controlName=t)}get controlName(){return this._controlName||""}set siblingsLeading(t){this._siblingsLeading=t}get siblingsLeading(){return void 0===this._siblingsLeading&&(this._siblingsLeading=this.previousSiblings()),this._siblingsLeading}set siblingsTrailing(t){this._siblingsTrailing=t}get siblingsTrailing(){return void 0===this._siblingsTrailing&&(this._siblingsTrailing=this.nextSiblings()),this._siblingsTrailing}get previousSibling(){const t=this.actualParent;if(t){const e=t.naturalChildren,i=e.indexOf(this);if(-1!==i)for(let t=i-1;t>=0;t--){const i=e[t];if(i&&(!i.excluded||i.lineBreak))return i}}return null}get nextSibling(){const t=this.actualParent;if(t){const e=t.naturalChildren,i=e.indexOf(this);if(-1!==i){const t=e.length;for(let n=i+1;n<t;n++){const t=e[n];if(t&&(!t.excluded||t.lineBreak))return t}}}return null}get firstChild(){return this.naturalChildren[0]||null}get lastChild(){const t=this.naturalChildren;return t[t.length-1]||null}get onlyChild(){if(this.renderParent)return 1===this.renderParent.length;{const t=this.parent;if(t&&0!==t.id)return 1===t.length}return!1}get textEmpty(){let t=this._cached.textEmpty;return void 0===t&&(t=this.styleElement&&(""===this.textContent||!this.preserveWhiteSpace&&!this.pseudoElement&&""===this.textContent.trim())&&!this.imageElement&&!this.svgElement&&"HR"!==this.tagName,this._cached.textEmpty=t),t}get preserveWhiteSpace(){let t=this._cached.whiteSpace;return void 0===t&&(t=this.cssAny("whiteSpace","pre","pre-wrap"),this._cached.whiteSpace=t),t}set fontSize(t){this._fontSize=t}get fontSize(){return super.fontSize}}const et=squared.lib.util;class it extends squared.lib.base.Container{constructor(t,e,i=0,n=0,s){super(s),this.parent=t,this.node=e,this.containerType=i,this.alignmentType=n,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,s&&s.length&&this.init()}init(){const t=this.children,e=t.length;if(e){if(e>1){const e=tt.linearData(t);this._floated=e.floated,this._cleared=e.cleared,this._linearX=e.linearX,this._linearY=e.linearY}else this._linearY=t[0].blockStatic,this._linearX=!this._linearY;let i=0,n=0;for(let s=0;s<e;s++){const e=t[s];if(e.floating?i++:i=1/0,e.rightAligned?n++:n=1/0,i===1/0&&n===1/0)break}(i===e||this._floated&&2===this._floated.size)&&(this.add(512),this.some(t=>t.blockStatic)&&this.add(64)),n===e&&this.add(2048),this.itemCount=e}}setType(t){this.setContainerType(t.containerType,t.alignmentType)}setContainerType(t,e){this.containerType=t,e&&this.add(e)}hasAlign(t){return et.hasBit(this.alignmentType,t)}add(t){return et.hasBit(this.alignmentType,t)||(this.alignmentType|=t),this.alignmentType}delete(t){return et.hasBit(this.alignmentType,t)&&(this.alignmentType^=t),this.alignmentType}retain(t){return super.retain(t),this.init(),this}get linearX(){return void 0===this._linearX||this._linearX}get linearY(){return void 0!==this._linearY&&this._linearY}get floated(){return this._floated||new Set}get cleared(){return this._cleared||new Map}get singleRowAligned(){if(void 0===this._singleRow){const t=this.length;if(!t)return!1;if(this._singleRow=!0,t>1){let t=1/0;for(const e of this.children){if(e.multiline||e.blockStatic){this._singleRow=!1;break}if(et.aboveRange(e.linear.top,t)){this._singleRow=!1;break}t=e.linear.bottom}}}return this._singleRow}get unknownAligned(){return this.length>1&&!this.linearX&&!this.linearY}get visible(){return this.filter(t=>t.visible)}}const{css:nt,dom:st,regex:ot,session:rt,util:at,xml:lt}=squared.lib,ct={};let ht;class dt extends E{constructor(t,i,n,s,o){super(t,i,n,s,o),this.session={cache:new e,excluded:new e,extensionMap:new Map,active:[],documentRoot:[],targetQueue:new Map},this.builtInExtensions={},this.extensions=[],this._layouts=[],ht=i,this._localSettings=this.controllerHandler.localSettings,this._excluded=this._localSettings.unsupported.excluded}static prioritizeExtensions(t,e){if(t.dataset.use){const i=t.dataset.use.split(ot.XML.SEPARATOR),n=[],s=[];for(const t of e){const e=i.indexOf(t.name);-1!==e?n[e]=t:s.push(t)}if(n.length)return at.spliceArray(n,t=>void 0===t).concat(s)}return e}finalize(){const t=this.controllerHandler;for(const[t,e]of this.session.targetQueue.entries()){const i=t.dataset.target;if(i){const n=this.resolveTarget(i);n?(t.render(n),this.addLayoutTemplate(n,t,e)):void 0===t.renderParent&&this.session.cache.remove(t)}}const e=this.rendered;for(const t of e)t.hasProcedure(U.LAYOUT)&&t.setLayout(),t.hasProcedure(U.ALIGNMENT)&&t.setAlignment();t.optimize(e);for(const t of this.extensions)for(const e of t.subscribers)t.postOptimize(e);for(const t of this.rendered)t.hasResource(z.BOX_SPACING)&&t.setBoxSpacing();for(const t of this.extensions)t.beforeCascade();const i=this._localSettings.layout.baseTemplate;for(const e of this.session.documentRoot){const n=e.node;if(n.documentRoot&&0===n.renderChildren.length&&!n.inlineText&&n.naturalChildren.every(t=>t.documentRoot))continue;const s=n.renderParent;s&&s.renderTemplates&&this.saveDocument(e.layoutName,i+t.cascadeDocument(s.renderTemplates,0),n.dataset.pathname,n.renderExtension&&n.renderExtension.some(t=>t.documentBase)?0:void 0)}const n=this._layouts;this.resourceHandler.finalize(n),t.finalize(n);for(const t of this.extensions)t.afterFinalize();st.removeElementsByClassName("__squared.pseudo"),this.closed=!0}copyToDisk(t,e){super.copyToDisk(t,e,this.layouts)}appendToArchive(t){super.appendToArchive(t,this.layouts)}saveToArchive(t){super.saveToArchive(t,this.layouts)}reset(){super.reset();for(const t of this.rootElements)t.dataset.iteration="";const t=this.session;t.cache.reset(),t.excluded.reset(),t.extensionMap.clear(),t.documentRoot.length=0,t.targetQueue.clear(),this._layouts.length=0}conditionElement(t){if(!this._excluded.has(t.tagName)){if(this.controllerHandler.visibleElement(t)||this._cascadeAll||t.dataset.use&&t.dataset.use.split(ot.XML.SEPARATOR).some(t=>!!this.extensionManager.retrieve(t)))return!0;{switch(nt.getStyle(t).position){case"absolute":case"fixed":return!1}let e=t.parentElement;for(;e;){if("none"===nt.getStyle(e).display)return!1;e=e.parentElement}const i=this.controllerHandler,n=t.children,s=n.length;for(let t=0;t<s;t++)if(i.visibleElement(n[t]))return!0;return!1}}return!1}insertNode(t,e){if(!st.isTextNode(t)){if(this.conditionElement(t))return this.controllerHandler.applyDefaultStyles(t),this.createNode(t,!1);{const e=this.createNode(t,!1);return e.visible=!1,e.excluded=!0,e}}if(lt.isPlainText(t.textContent)||e&&e.preserveWhiteSpace&&("PRE"!==e.tagName||0===e.element.children.length)){this.controllerHandler.applyDefaultStyles(t);const i=this.createNode(t,!1);return e&&(i.cssApply(e.getTextStyle()),i.fontSize=e.fontSize),i}}saveDocument(t,e,i,n){if(at.isString(e)){const s={pathname:i?at.trimString(i,"/"):this._localSettings.layout.pathName,filename:t,content:e,index:n},o=this._layouts;void 0!==n&&n>=0&&n<o.length?o.splice(n,0,s):o.push(s)}}renderNode(t){return 0===t.itemCount?this.controllerHandler.renderNode(t):this.controllerHandler.renderNodeGroup(t)}addLayout(t){if(at.hasBit(t.renderType,512)&&(at.hasBit(t.renderType,8)?t=this.processFloatHorizontal(t):at.hasBit(t.renderType,16)&&(t=this.processFloatVertical(t))),0!==t.containerType){const e=this.renderNode(t);if(e)return this.addLayoutTemplate(e.parent||t.parent,t.node,e,t.renderIndex)}return!1}addLayoutTemplate(t,e,i,n=-1){if(i){if(e.renderExclude)e.hide(),e.excluded=!0;else if(e.renderParent){const s=t.renderChildren;void 0===t.renderTemplates&&(t.renderTemplates=[]),n>=0&&n<s.length?(s.splice(n,0,e),t.renderTemplates.splice(n,0,i)):(s.push(e),t.renderTemplates.push(i))}else this.session.targetQueue.set(e,i);return!0}return!1}createNode(t,e=!0,i,n){const s=this.processing,o=new ht(this.nextId,s.sessionId,t,this.controllerHandler.afterInsertNode);if(i&&(o.depth=i.depth+1),void 0===t&&i&&i.naturalElement&&(o.actualParent=i),n)for(const t of n)t.parent=o;return e&&s.cache.append(o,void 0!==n),o}createCache(t){const e=this.createRootNode(t);if(e){const t=e.parent;e.documentBody&&(t.visible=!1,t.exclude(z.ASSET,U.ALL,X.EXTENSION),this.processing.cache.append(t)),e.documentParent=t;const n=this.controllerHandler,s=this.processing.cache,o={},r=new Set;let a=!1;function i(t,e,i,n,s){void 0===o[e]&&(o[e]={}),o[e][i]=s,t.style.setProperty(i,n)}for(const t of s)if(t.styleElement){const e=t.element;if(t.length){const n=t.cssInitial("textAlign");switch(n){case"center":case"right":case"end":i(e,t.id,"text-align","left",n)}}if(t.positionRelative)for(const n of nt.BOX_POSITION)t.hasPX(n)&&(i(e,t.id,n,"auto",t.css(n)),a=!0);"rtl"===t.dir&&(e.dir="ltr",r.add(e))}!a&&r.size&&(a=!0);for(const t of this.processing.excluded)t.pageFlow||t.cssTry("display","none");e.parent.setBounds();const l=[];for(const t of s)t.pseudoElement?l.push(t):(t.setBounds(void 0===o[t.id]&&!a),e.styleText&&(t.textBounds=st.getRangeClientRect(e.element)));if(l.length){const t=new Map;for(const e of l){const i=e.actualParent.element;let n,s=i.id;e.pageFlow&&(""===s&&(s="__squared_"+Math.round(Math.random()*(new Date).getTime()),i.id=s),n=nt.insertStyleSheetRule(`#${s+tt.getPseudoElt(e)} { display: none !important; }`)),e.cssTry("display",e.display)&&t.set(e,{id:s,styleElement:n})}for(const e of l){t.get(e)&&e.setBounds(!1)}for(const e of l){const i=t.get(e);if(i){if(i.id.startsWith("__squared_")){e.actualParent.element.id=""}i.styleElement&&document.head.removeChild(i.styleElement),e.cssFinally("display")}}}for(const t of this.processing.excluded)t.lineBreak||(t.setBounds(),t.saveAsInitial()),t.pageFlow||t.cssFinally("display");for(const t of s){if(t.styleElement){const e=t.element,i=o[t.id];if(i)for(const t in i)e.style.setProperty(t,i[t]);r.has(e)&&(e.dir="rtl")}t.saveAsInitial()}return n.evaluateNonStatic(e,s),n.sortInitialCache(s),!0}return!1}afterCreateCache(t){const e=t.dataset,i=e.filename&&e.filename.replace(RegExp(`.${this._localSettings.layout.fileExtension}$`),"")||t.id||"document_"+this.length,n=(e.iteration?at.convertInt(e.iteration):-1)+1;e.iteration=""+n,e.layoutName=at.convertWord(n>1?i+"_"+n:i,!0),this.setBaseLayout(e.layoutName),this.setConstraints(),this.setResources()}resolveTarget(t){for(const e of this.processing.cache)if(e.elementId===t||e.controlId===t)return e;for(const e of this.session.cache)if(e.elementId===t||e.controlId===t)return e}toString(){const t=this._layouts;return t.length?t[0].content:""}cascadeParentNode(t,e=0){const i=this.insertNode(t);if(i){if(i.depth=e,0===e){this.processing.cache.append(i);const t=this.extensionManager;for(const e of i.extensions){const i=t.retrieve(e);if(i&&i.cascadeAll){this._cascadeAll=!0;break}}}const n=this.controllerHandler;if(n.preventNodeCascade(t))return i;const s=this.processing.sessionId,o=this.createPseduoElement(t,"::before",s),r=this.createPseduoElement(t,"::after",s),a=t.childNodes,l=a.length,c=Array(l),h=Array(t.childElementCount);let d=!0,u=0,f=0;for(let t=0;t<l;t++){const s=a[t];let l;s===o?(l=this.insertNode(o))&&(i.innerBefore=l,l.textEmpty||(l.inlineText=!0),d=!1):s===r?(l=this.insertNode(r))&&(i.innerAfter=l,l.textEmpty||(l.inlineText=!0),d=!1):"#"===s.nodeName.charAt(0)?st.isTextNode(s)&&(l=this.insertNode(s,i)):n.includeElement(s)&&(dt.prioritizeExtensions(s,this.extensions).some(t=>t.init(s)),this.rootElements.has(s)?((l=this.insertNode(s))&&(l.documentRoot=!0,l.visible=!1,l.excluded=!0),d=!1):!(l=this.cascadeParentNode(s,e+1))||l.excluded&&"WBR"!==l.tagName||(d=!1),l&&(h[f++]=l)),l&&(l.childIndex=u,c[u++]=l)}c.length=u,h.length=f,i.naturalChildren=c,i.naturalElements=h,this.cacheNodeChildren(i,c,d),this.userSettings.createQuerySelectorMap&&f>0&&(i.queryMap=this.createQueryMap(h,f))}return i}cacheNodeChildren(t,e,i){const n=e.length;if(n){const s=this.processing.cache;let o=[],r=[];if(n>1){let a=e[0],l=!1;for(let c=0,h=0;c<n;c++){const d=e[c];d.excluded?this.processing.excluded.append(d):d.plainText&&i||(d.containerIndex=h++,d.parent=t,s.append(d)),d.pageFlow&&(d.floating&&(l=!0),c>0&&(r.push(d),d.lineBreak&&(e[c-1].lineBreakTrailing=!0)),d.excluded||(d.siblingsLeading=o,a.siblingsTrailing=r,o=[],r=[],a=d),c<n-1&&(o.push(d),d.lineBreak&&(e[c+1].lineBreakLeading=!0))),d.actualParent=t}a.siblingsTrailing=r,t.floatContainer=l}else{const i=e[0];i.excluded?this.processing.excluded.append(i):i.plainText||(i.siblingsLeading=o,i.siblingsTrailing=r,i.parent=t,i.containerIndex=0,s.append(i)),i.actualParent=t}}else i=!t.textEmpty;t.inlineText=i}createPseduoElement(t,e,i){let n=rt.getElementCache(t,"styleMap"+e,i),s=0;if("Q"===t.tagName&&(void 0===n&&rt.setElementCache(t,"styleMap"+e,i,n={}),n.content||(n.content=nt.getStyle(t,e).getPropertyValue("content")||("::before"===e?"open-quote":"close-quote")),n.content.endsWith("-quote"))){let e=t.parentElement;for(;e&&"Q"===e.tagName;)s++,e=e.parentElement}if(n){let l=n.content;if(l){if(""===at.trimString(l,'"').trim()&&0===at.convertFloat(n.width)&&0===at.convertFloat(n.height)&&("absolute"===n.position||"fixed"===n.position||n.clear&&"none"!==n.clear)){let t=!0;for(const e in n)if(/(Width|Height)$/.test(e)){const i=n[e];if(nt.isLength(i,!0)&&0!==at.convertFloat(i)){t=!1;break}}if(t)return}if("inherit"===l){let e=t;for(;e&&"inherit"===(l=nt.getStyle(e).getPropertyValue("content"));)e=e.parentElement}const c=nt.getStyle(t);void 0===n.fontFamily&&(n.fontFamily=c.getPropertyValue("font-family")),void 0===n.fontSize&&(n.fontSize=c.getPropertyValue("font-size")),void 0===n.fontWeight&&(n.fontWeight=c.getPropertyValue("font-weight")),void 0===n.color&&(n.color=c.getPropertyValue("color")),void 0===n.display&&(n.display="inline");let h=n.display.startsWith("inline")?"span":"div",d="";switch(l){case"normal":case"none":case"initial":case"inherit":case"no-open-quote":case"no-close-quote":case'""':break;case"open-quote":"::before"===e&&(d=s%2==0?"":"");break;case"close-quote":"::after"===e&&(d=s%2==0?"":"");break;default:if(l.startsWith("url(")){d=nt.resolveURL(l);const t=at.fromLastIndexOf(d,".").toLowerCase(),e=this._localSettings.supported.imageFormat;"*"===e||e.includes(t)?h="img":d=""}else{ct.COUNTER?ct.COUNTER.lastIndex=0:(ct.COUNTER=/\s*(?:attr\(([^)]+)\)|(counter)\(([^,)]+)(?:, ([a-z\-]+))?\)|(counters)\(([^,]+), "([^"]*)"(?:, ([a-z\-]+))?\)|"([^"]+)")\s*/g,ct.COUNTER_VALUE=/\s*([^\-\d][^\-\d]?[^ ]*) (-?\d+)\s*/g);let n,s=!1;for(;null!==(n=ct.COUNTER.exec(l));){if(n[1])d+=st.getNamedItem(t,n[1].trim());else if(n[2]||n[5]){const s="counter"===n[2];let l,h;function o(t){if("none"!==t){let e;for(ct.COUNTER_VALUE.lastIndex=0;null!==(e=ct.COUNTER_VALUE.exec(t));)if(e[1]===l)return parseInt(e[2])}}s?(l=n[3],h=n[4]||"decimal"):(l=n[6],h=n[8]||"decimal");const u=t=>{const n=rt.getElementCache(t,"styleMap"+e,i);if(n&&n.counterIncrement)return o(n.counterIncrement)},f=(u(t)||0)+(o(c.getPropertyValue("counter-reset"))||0),g=[];let p,m=t,b=f,x=!1;function r(t,e){0===g.length?b+=t:(x||e)&&(g[g.length-1]+=t)}function a(t){if(void 0===o(nt.getStyle(t).getPropertyValue("counter-reset"))){const e=t.children,i=e.length;for(let t=0;t<i;t++){const i=e[t];if("__squared.pseudo"!==i.className){let t=u(i);t&&r(t,!0);const e=nt.getStyle(i);if((t=o(e.getPropertyValue("counter-increment")))&&r(t,!1),void 0!==(t=o(e.getPropertyValue("counter-reset"))))return;a(i)}}}}for(;;){if(x=!1,m.previousElementSibling)a(m=m.previousElementSibling);else{if(!m.parentElement)break;m=m.parentElement,x=!0}if("__squared.pseudo"!==m.className){const t=u(m);t&&r(t,!0);const e=nt.getStyle(m),i=o(e.getPropertyValue("counter-increment"))||0;i&&r(i,!1);const n=o(e.getPropertyValue("counter-reset"));if(void 0!==n){if(void 0===p&&(b+=n),p=m,s)break;x&&g.push((t||0)+n)}}}if(p){if(!s&&g.length>1){g.reverse(),g.splice(1,1);for(const t of g)d+=nt.convertListStyle(h,t,!0)+n[7]}}else b=f;d+=nt.convertListStyle(h,b,!0)}else n[9]&&(d+=n[9]);s=!0}s||(d=l)}}if(d||'""'===l){const s=function(t,e="span",i=-1){const n=document.createElement(e);return n.className="__squared.pseudo",n.style.setProperty("display","none"),i>=0&&i<t.childNodes.length?t.insertBefore(n,t.childNodes[i]):t.appendChild(n),n}(t,h,"::before"===e?0:-1);if("img"===h){s.src=d;const t=this.resourceHandler.getImage(d);t&&(void 0===n.width&&t.width>0&&(n.width=nt.formatPX(t.width)),void 0===n.height&&t.height>0&&(n.height=nt.formatPX(t.height)))}else'""'!==l&&(s.innerText=d);for(const t in n)"display"!==t&&(s.style[t]=n[t]);return rt.setElementCache(s,"pseudoElement",i,e),rt.setElementCache(s,"styleMap",i,n),s}}}}setBaseLayout(t){const{processing:e,session:i}=this,n=e.cache,s=e.node,o=this.session.extensionMap,r=new Map;let a=at.filterArray(this.extensions,t=>!t.eventOnly);function l(t,e,i){const n=r.get(t)||new Map;r.set(t,n.set(e,i))}function c(t){for(const e of r.values())for(const i of e.values())if(i.id===t)return void e.delete(i.id)}l(-1,0,s.parent);let h=0;for(const t of n)if(t.visible&&t.length){const e=t.depth;l(e,t.id,t),h=Math.max(e,h)}for(let t=0;t<h;t++)r.set(-1*t-2,new Map);n.afterAppend=t=>{const e=t.id;c(e),l(-1*t.depth-2,e,t);for(const e of t.cascade()){const t=e.id;c(t),l(-1*e.depth-2,t,e)}};for(const t of this.extensions)t.beforeBaseLayout();for(const t of r.values())for(const e of t.values()){if(0===e.length)continue;const t=e.floatContainer,i=e.renderExtension,n=e.duplicate(),s=n.length;let r;t&&(r=tt.linearData(e.naturalElements,!0).cleared);for(let e=0;e<s;e++){let l=n[e];if(l.rendered||!l.visible||l.naturalElement&&!l.documentRoot&&this.rootElements.has(l.element))continue;let c=l.parent;if(s>1&&e<s-1&&l.pageFlow&&!l.nodeGroup&&(0===c.alignmentType||c.hasAlign(2)||l.hasAlign(8192))&&!c.hasAlign(4)&&l.hasSection(X.DOM_TRAVERSE)){const i=[],o=[];let a=!1;function d(t){return!o.length&&!a&&(i.push(t),!0)}function u(t){return!i.length&&(o.push(t),!0)}let h,f,g=e,p=0;l.hasAlign(8192)&&c.layoutVertical&&(i.push(l),g++,p++);t:{let e,l;for(t&&(e=new Set,l=new Map);g<s;g++,p++){const s=n[g];if(s.pageFlow){if(t){if(e.size){const t=r.get(s);t&&("both"===t?e.clear():e.delete(t),l.set(s,t))}s.floating&&e.add(s.float)}if(0===p){const t=s.siblingsTrailing[0];if(t){!s.horizontalAligned||t.alignedVertically([s])?o.push(s):i.push(s);continue}}const n=s.siblingsLeading[0];if(!n)break t;if(t){const t=s.alignedVertically(i.length?i:o,r,i.length>0);if(t>0){if(i.length){if(7!==t&&6!==t&&e.size&&"both"!==l.get(s)&&!s.siblingsLeading.some(t=>t.lineBreak&&!r.has(t))&&(!s.floating||n.floating&&!at.aboveRange(s.linear.top,n.linear.bottom))){if(l.has(s)){if(!s.floating){s.addAlign(8192),i.push(s),a=!0;continue}break t}{let t=-1/0;if(s.floating||at.captureMap(i,t=>t.floating,e=>t=Math.max(t,e.linear.bottom)),!s.floating&&!at.aboveRange(s.linear.top,t)||s.floating&&e.has(s.float)){if(i.push(s),!s.floating&&at.aboveRange(s.linear.bottom,t))break t;continue}}}break t}if(!u(s))break t}else if(!d(s))break t}else if(s.alignedVertically()){if(!u(s))break t}else if(!d(s))break t}else if(s.positionAuto){const t=o.length;if(t){o[t-1].blockStatic&&o.push(s);break}i.push(s)}}}i.length>1?(h=this.controllerHandler.processTraverseHorizontal(new it(c,l,0,0,i),n),f=i[i.length-1]):o.length>1&&(h=this.controllerHandler.processTraverseVertical(new it(c,l,0,0,o),n),(f=o[o.length-1]).horizontalAligned&&f!==n[s-1]&&f.addAlign(8192)),h&&this.addLayout(h)&&(f===n[s-1]&&c.removeAlign(2),c=l.parent)}if(l.removeAlign(8192),e===s-1&&c.removeAlign(2),l.renderAs&&c.appendTry(l,l.renderAs,!1)&&(l.hide(),(l=l.renderAs).positioned&&(c=l.parent)),!l.rendered&&l.hasSection(X.EXTENSION)){const t=o.get(l.id);let e;if(e=t?i?i.concat(t):t:i){let t=!1;for(const i of e){const e=i.processChild(l,c);if(e){const{output:i,renderAs:n,outputAs:s}=e;if(i&&this.addLayoutTemplate(e.parentAs||c,l,i),n&&s&&this.addLayoutTemplate(c,n,s),c=e.parent||c,t=!0===e.next,e.complete||t)break}}if(t)continue}if(l.styleElement){const e=dt.prioritizeExtensions(l.element,a);let i=!1;function f(t){const e=a.indexOf(t);-1!==e&&(a=a.slice(0)).splice(e,1)}for(const n of e)if(n.is(l)&&(n.removeIs&&f(n),n.condition(l,c)&&(void 0===t||!t.includes(n)))){const t=n.processNode(l,c);if(t){const{output:e,renderAs:s,outputAs:o,include:r}=t;if(e&&this.addLayoutTemplate(t.parentAs||c,l,e),s&&o&&this.addLayoutTemplate(c,s,o),c=t.parent||c,(e&&!1!==r||r)&&(void 0===l.renderExtension&&(l.renderExtension=[]),l.renderExtension.push(n),n.subscribers.add(l)),t.remove&&f(n),i=!0===t.next,t.complete||i)break}}if(i)continue}}if(!l.rendered&&l.hasSection(X.RENDER)){let t=this.createLayoutControl(c,l);if(0===t.containerType){const e=l.length?this.controllerHandler.processUnknownParent(t):this.controllerHandler.processUnknownChild(t);if(e.next)continue;t=e.layout}this.addLayout(t)}}}for(const e of n)e.documentRoot&&e.renderParent&&i.documentRoot.push({node:e,layoutName:e===s?t:""});n.sort((t,e)=>t.depth===e.depth?t.nodeGroup&&(0===e.length||e.naturalChild)?-1:e.nodeGroup&&(0===t.length||t.naturalChild)?1:0:t.depth<e.depth?-1:1),i.cache.concat(n.children),i.excluded.concat(e.excluded.children);for(const t of this.extensions){for(const e of t.subscribers)n.contains(e)&&t.postBaseLayout(e);t.afterBaseLayout()}}setConstraints(){const t=this.processing.cache;this.controllerHandler.setConstraints();for(const e of this.extensions){for(const i of e.subscribers)t.contains(i)&&e.postConstraints(i);e.afterConstraints()}}setResources(){const t=this.resourceHandler;for(const e of this.processing.cache)t.setBoxStyle(e),t.setFontStyle(e),t.setValueString(e);for(const t of this.extensions)t.afterResources()}processFloatHorizontal(t){const e=this.controllerHandler,i=[],n=[],s=[],o=[],r=[];let a,l,c,h,d=0;t.each((e,i)=>{if(i>0){const i=t.cleared.get(e);if(i)switch(i){case"left":at.hasBit(d,2)||(d|=2);break;case"right":at.hasBit(d,4)||(d|=4);break;default:d=6}}if(0===d)if("right"===e.float)r.push(e);else if("left"===e.float)o.push(e);else if(o.length||r.length){let t=e.linear.top;if(e.styleText){const i=e.textBounds;i&&i.top>t&&(t=i.top)}o.some(e=>t>=e.linear.bottom)||r.some(e=>t>=e.linear.bottom)?s.push(e):n.push(e)}else n.push(e);else"right"===e.float?4===d||6===d?(void 0===l&&(l=[]),l.push(e)):r.push(e):"left"===e.float?2===d||6===d?(void 0===a&&(a=[]),a.push(e)):o.push(e):6===d?s.push(e):n.push(e)}),o.length&&a?c=[o,a]:o.length&&(c=o),r.length&&l?h=[r,l]:r.length&&(h=r);const{containerType:u,alignmentType:f}=e.containerTypeVertical;if(r.length+(l?l.length:0)===t.length&&t.add(2048),s.length){const{node:e,parent:i}=t;s.length>1&&s[0].addAlign(8192),s.unshift(e);const n=this.createNode(void 0,!0,i,s);n.containerName=e.containerName,n.inherit(e,"boxStyle"),n.innerWrapped=e,e.outerWrapper=n,this.addLayout(new it(i,n,u,f|(i.blockStatic?64:0),s)),t.parent=n}n.length&&i.push(n),c&&i.push(c),h&&i.push(h),t.setType(e.containerTypeVerticalMargin),t.itemCount=i.length,t.add(64);for(const s of i){let i,a;if(Array.isArray(s[0])){const n=t.node;let o=(i=s)[0];for(let t=1;t<i.length;t++)o=o.concat(i[t]);if(o.sort((t,e)=>t.childIndex<e.childIndex?-1:1),n.layoutVertical)a=n;else{a=e.createNodeGroup(o[0],o,n);const t=new it(n,a,u,f|(i.some(t=>t===h||t===r)?2048:0));t.itemCount=i.length,this.addLayout(t)}}else i=[s];for(const s of i){const i=a||t.node,l=e.createNodeGroup(s[0],s,i,!0),c=new it(i,l,0,128|(s===n?256:0),s);1===s.length?(c.node.innerWrapped=s[0],s[0].outerWrapper=c.node,s[0].percentWidth?c.setType(e.containerTypePercent):c.setContainerType(u,f)):c.linearY||c.unknownAligned?c.setContainerType(u,f|(c.unknownAligned?2:0)):e.processLayoutHorizontal(c),this.addLayout(c),s===n&&this.setFloatPadding(i,l,n,o,r)}}return t}processFloatVertical(t){const e=this.controllerHandler,{containerType:i,alignmentType:n}=e.containerTypeVertical;if(0!==t.containerType){const s=t.node,o=e.createNodeGroup(s,[s],t.parent);this.addLayout(new it(o,s,i,n,o.children)),t.node=o}else t.containerType=i,t.add(n);const s=[],o=[],r=[],a=[];let l=!1,c=!1,h=!0;for(const e of t)e.blockStatic&&0===a.length?(r.push(e),c=!0):(t.cleared.has(e)&&(e.floating?l=!0:(e.modifyBox(2),s.push(r.slice(0)),o.push(a.slice(0)),r.length=0,a.length=0)),e.floating?(c&&(s.push(r.slice(0)),o.push(null),r.length=0,a.length=0,c=!1),a.push(e)):(l&&!t.cleared.has(e)&&(h=!1),r.push(e)));if(a.length&&o.push(a),r.length&&s.push(r),!h)for(let r=0;r<Math.max(o.length,s.length);r++){const a=s[r]||[];if(null===o[r]&&a.length){const i=e.containerTypeVertical;i.alignmentType|=192,this.addLayout(new it(t.node,e.createNodeGroup(a[0],a,t.node),i.containerType,i.alignmentType,a))}else{const s=o[r]||[];if(a.length||s.length){const o=e.containerTypeVerticalMargin,r=e.createNodeGroup(s[0]||a[0],[],t.node),l=new it(t.node,r,o.containerType,o.alignmentType),c=[];let h;if(s.length){const t=e.createNodeGroup(s[0],s,r);l.add(512),0===a.length&&s.every(t=>"right"===t.float)&&l.add(2048),c.push(t)}a.length&&(h=e.createNodeGroup(a[0],a,r),c.push(h)),r.init(),l.itemCount=c.length,this.addLayout(l);for(let t of c)t.nodeGroup||(t=e.createNodeGroup(t,[t],r,!0)),this.addLayout(new it(r,t,i,192|n,t.children));if(a.length&&s.length){const[e,i]=at.partitionArray(s,t=>"right"!==t.float);this.setFloatPadding(t.node,h,a,e,i)}}}}return t}setFloatPadding(t,e,i,n,s){const o=t=>t.textElement&&(t.blockStatic||t.multiline);if(i.some(t=>o(t)||t.blockStatic&&t.cascadeSome(t=>o(t)))){if(n.length){let s=-1/0,o=0,r=0,a=!1;for(const t of n){const e=t.linear.right+(t.marginLeft<0?t.marginLeft:0);e>s&&(s=e,a=t.marginRight>0)}for(const t of i)t.blockStatic&&(t.bounds.left>s?r++:o=Math.max(o,t.marginLeft));if(r<i.length){const i=s-t.box.left-o;i>0&&e.modifyBox(256,i+(!a&&e.cascadeSome(t=>t.multiline)?this._localSettings.deviations.textMarginBoundarySize:0))}}if(s.length){let n=1/0,o=0,r=0,a=!1;for(const t of s){const e=t.linear.left+(t.marginRight<0?t.marginRight:0);e<n&&(n=e,a=t.marginLeft>0)}for(const t of i)t.blockStatic&&(t.bounds.right<n?r++:o=Math.max(o,t.marginRight));if(r<i.length){const i=t.box.right-n-o;i>0&&e.modifyBox(64,i+(!a&&e.cascadeSome(t=>t.multiline)?this._localSettings.deviations.textMarginBoundarySize:0))}}}}createLayoutControl(t,e){return new it(t,e,e.containerType,e.alignmentType,e.children)}get layouts(){return this._layouts.sort((t,e)=>{if(t.index!==e.index){if(0===t.index||void 0!==t.index&&t.index!==1/0&&void 0===e.index||e.index===1/0)return-1;if(0===e.index||void 0!==e.index&&e.index!==1/0&&void 0===t.index||t.index===1/0)return 1;if(void 0!==t.index&&void 0!==e.index)return t.index<e.index?-1:1}return 0})}get rendered(){return this.session.cache.filter(t=>t.visible&&void 0!==t.renderParent)}get nextId(){return this.processing.cache.nextId}get length(){return this.session.documentRoot.length}}const{client:ut,css:ft,dom:gt,session:pt,util:mt,xml:bt}=squared.lib,xt=t=>!(t.left<0&&Math.abs(t.left)>=t.width||t.top<0&&Math.abs(t.top)>=t.height);const{css:yt,util:vt}=squared.lib;class St extends w{constructor(t,e,i,n=[]){super(t,e,i),this.eventOnly=!1,this.documentBase=!1,this.cascadeAll=!1,this.removeIs=!1,this.tagNames=n}static findNestedElement(t,e){if(t&&yt.hasComputedStyle(t)){const i=t.children,n=i.length;for(let t=0;t<n;t++){const n=i[t];if(vt.includes(n.dataset.use,e))return n}}return null}condition(t,e){return!!t.styleElement&&(t.dataset.use?this.included(t.element):this.tagNames.length>0)}is(t){return!!t.styleElement&&(0===this.tagNames.length||this.tagNames.includes(t.element.tagName))}included(t){return vt.includes(t.dataset.use,this.name)}init(t){return!1}processNode(t,e){}processChild(t,e){}addDescendant(t){const e=this.application.session.extensionMap,i=t.id,n=e.get(i)||[];n.includes(this)||n.push(this),e.set(i,n)}postBaseLayout(t){}postConstraints(t){}postOptimize(t){}afterBaseLayout(){}afterConstraints(){}afterResources(){}beforeBaseLayout(){}beforeCascade(){}afterFinalize(){}set application(t){this._application=t,this.controller=t.controllerHandler,this.resource=t.resourceHandler}get application(){return this._application}}const{client:_t,color:Et,css:Tt,math:wt,regex:kt,session:At,util:Rt}=squared.lib,Ct="&#160;",It=`(rgba?\\(\\d+, \\d+, \\d+(?:, [\\d.]+)?\\)|#[A-Za-z\\d]{3,8}|[a-z]+)\\s*(${kt.STRING.LENGTH_PERCENTAGE}|${kt.STRING.CSS_ANGLE}|(?:${kt.STRING.CSS_CALC}(?=,)|${kt.STRING.CSS_CALC}))?,?\\s*`,Bt=RegExp(`(?:initial|url\\([^)]+\\)|(repeating)?-?(linear|radial|conic)-gradient\\(((?:to [a-z ]+|(?:from )?-?[\\d.]+(?:deg|rad|turn|grad)|(?:circle|ellipse)?\\s*(?:closest-side|closest-corner|farthest-side|farthest-corner)?)?(?:\\s*(?:(?:-?[\\d.]+(?:[a-z%]+)?\\s*)+)?(?:at [\\w %]+)?)?),?\\s*((?:${It})+)\\))`,"g");let Pt;function Nt(t,e,i){Pt?Pt.lastIndex=0:Pt=RegExp(It,"g");const n=e,s=!0===n.repeating;let o,r=1;s&&"radial"===e.type?(r=n.radiusExtent/n.radius,o=n.radius):o=n.horizontal?e.dimension.width:e.dimension.height;const a=[];let l,c=0;for(;null!==(l=Pt.exec(i));){const i=Et.parseColor(l[1],1,!0);if(i){let h=-1;"conic"===e.type?l[3]&&l[4]&&(h=Tt.convertAngle(l[3],l[4])/360):l[2]&&(Tt.isPercent(l[2])?h=parseFloat(l[2])/100:Tt.isLength(l[2])?h=t.parseUnit(l[2],n.horizontal?"width":"height",!1)/o:Tt.isCalc(l[2])&&(h=Tt.calculate(l[6],o,t.fontSize)/o),s&&-1!==h&&(h*=r)),0===a.length&&(-1===h?h=0:h>0&&a.push({color:i,offset:0})),-1!==h&&(c=h=Math.max(c,h)),a.push({color:i,offset:h})}}const h=a.length,d=a[h-1];-1===d.offset&&(d.offset=1);let u=0;for(let t=0;t<h;t++){const e=a[t];if(-1===e.offset)if(0===t)e.offset=0;else{for(let i=t+1,n=2;i<h-1;i++,n++)if(-1!==a[i].offset){e.offset=(u+a[i].offset)/n;break}-1===e.offset&&(e.offset=u+d.offset/(h-1))}u=e.offset}if(s){if(u<100)t:{const t=a.slice(0);let e=u;for(;u<100;){for(let i=0;i<h;i++)if(u=Math.min(e+t[i].offset,1),a.push(Object.assign(Object.assign({},t[i]),{offset:u})),1===u)break t;e=u}}}else u<1&&a.push(Object.assign(Object.assign({},a[h-1]),{offset:1}));return a}function Lt(t,e=0){if(t){let e=Tt.parseAngle(t.trim());return e<0&&(e+=360),e}return e}function Mt(t,e,i){switch(i=i.replace(/\u00A0/g,Ct),e.css("whiteSpace")){case"nowrap":i=i.replace(/\n/g," ");break;case"pre":case"pre-wrap":t.layoutVertical||(i=i.replace(/^\s*?\n/,"")),i=i.replace(/\n/g,"\\n").replace(/ /g,Ct);break;case"pre-line":i=i.replace(/\n/g,"\\n").replace(/[ ]+/g," ");break;default:const{previousSibling:n,nextSibling:s}=e;return(n&&(n.lineBreak||n.blockStatic)||e.onlyChild&&e.htmlElement)&&(i=i.replace(kt.CHAR.LEADINGSPACE,"")),(s&&(s.lineBreak||s.blockStatic)||e.onlyChild&&e.htmlElement)&&(i=i.replace(kt.CHAR.TRAILINGSPACE,"")),[i,!1]}return[i,!0]}function Ot(t,e,i){if(i){const n=i.split(kt.XML.SEPARATOR);return Ft.getBackgroundSize(t,n[e%n.length])}}function Wt(t){return t?-1!==t.indexOf("at ")?/(.+?)?\s*at (.+?)\s*$/.exec(t):[t,t]:null}class Ft extends s{static generateId(t,e,i=1){const n=e;let s=i;1===i&&(e+="_"+s);const o=this.ASSETS.ids.get(t)||[];for(;;){if(!o.includes(e)){o.push(e);break}e=n+"_"+ ++s}return this.ASSETS.ids.set(t,o),e}static insertStoredAsset(t,e,i){const n=Ft.STORED[t];if(n&&Rt.hasValue(i)){let s=this.getStoredName(t,i);if(""===s){Rt.isNumber(e)&&(e="__"+e);let t=0;do{s=e,t>0&&(s+="_"+t),n.has(s)||n.set(s,i),t++}while(n.has(s)&&n.get(s)!==i)}return s}return""}static getOptionArray(t,e=!1){const i=[];let n=!0;const s=t.children,o=s.length;for(let t=0;t<o;t++){const o=s[t];if(!e&&o.disabled)continue;const r=o.text.trim()||o.value.trim();""!==r&&(n&&!Rt.isNumber(r)&&(n=!1),i.push(r))}return n?[void 0,i]:[i]}static isBackgroundVisible(t){return!(void 0===t||!t.backgroundImage&&!t.borderTop&&!t.borderRight&&!t.borderBottom&&!t.borderLeft)}static parseBackgroundImage(t){const e=t.backgroundImage;if(""!==e){Bt.lastIndex=0;const i=[];let n,s=0;for(;null!==(n=Bt.exec(e));){if("initial"===n[0]||n[0].startsWith("url"))i.push(n[0]);else{const e="repeating"===n[1],o=n[2],r=n[3],a=Ot(t,s,t.css("backgroundSize")),l=a||t.actualDimension;let c;switch(o){case"conic":{const e=Wt(r),i={type:o,dimension:l,angle:Lt(r)};i.center=Tt.getBackgroundPosition(e&&e[2]||"center",l,t.fontSize,a),i.colorStops=Nt(t,i,n[4]),c=i;break}case"radial":{const{width:i,height:s}=l,h=Wt(r),d={type:o,repeating:e,horizontal:t.actualWidth<=t.actualHeight,dimension:l},u=Tt.getBackgroundPosition(h&&h[2]||"center",l,t.fontSize,a),{left:f,top:g}=u;d.center=u,d.closestCorner=1/0,d.farthestCorner=-1/0;let p="ellipse";if(h){const e=h[1]&&h[1].trim();if(e)if(e.startsWith("circle"))p="circle";else{const i=e.split(" ");let n=1/0;const s=i.length;for(let e=0;e<s;e++){const s=t.parseUnit(i[e],0===e?"width":"height",!1);s<n&&(n=s)}d.radius=n,d.radiusExtent=n,1!==s&&i[0]!==i[1]||(p="circle")}}d.shape=p;for(const t of[[0,0],[i,0],[i,s],[0,s]]){const e=Math.round(Math.sqrt(Math.pow(Math.abs(t[0]-f),2)+Math.pow(Math.abs(t[1]-g),2)));e<d.closestCorner&&(d.closestCorner=e),e>d.farthestCorner&&(d.farthestCorner=e)}d.closestSide=g,d.farthestSide=g;for(const t of[i-f,s-g,f])t<d.closestSide&&(d.closestSide=t),t>d.farthestSide&&(d.farthestSide=t);if(!d.radius&&!d.radiusExtent){d.radius=d.farthestCorner;const t=h&&h[1]?h[1].split(" ").pop():"";switch(t){case"closest-corner":case"closest-side":case"farthest-side":const i=d[Rt.convertCamelCase(t)];e?d.radiusExtent=i:d.radius=i;break;default:d.radiusExtent=d.farthestCorner}}d.colorStops=Nt(t,d,n[4]),c=d;break}case"linear":{const{width:i,height:s}=l;let a=180;switch(r){case"to top":a=360;break;case"to right top":a=45;break;case"to right":a=90;break;case"to right bottom":a=135;break;case"to bottom":break;case"to left bottom":a=225;break;case"to left":a=270;break;case"to left top":a=315;break;default:r&&(a=Lt(r,180)||360)}const h={type:o,repeating:e,horizontal:a>=45&&a<=135||a>=225&&a<=315,dimension:l,angle:a};h.colorStops=Nt(t,h,n[4]);let d=wt.truncateFraction(wt.offsetAngleX(a,i)),u=wt.truncateFraction(wt.offsetAngleY(a,s));if(d!==i&&u!==s&&!wt.isEqual(Math.abs(d),Math.abs(u))){let t;t=a<=90?wt.relativeAngle({x:0,y:s},{x:i,y:0}):a<=180?wt.relativeAngle({x:0,y:0},{x:i,y:s}):a<=270?wt.relativeAngle({x:0,y:0},{x:-i,y:s}):wt.relativeAngle({x:0,y:s},{x:-i,y:0});const e=Math.abs(t-a);d=wt.truncateFraction(wt.offsetAngleX(a,wt.triangulate(e,90-e,Math.sqrt(Math.pow(i,2)+Math.pow(s,2)))[1])),u=wt.truncateFraction(wt.offsetAngleY(a,wt.triangulate(90,90-a,d)[0]))}h.angleExtent={x:d,y:u},c=h;break}}i.push(c||"initial")}s++}if(i.length)return i}}static getBackgroundSize(t,e){let i=0,n=0;switch(e){case"":case"cover":case"contain":case"100% 100%":case"auto":case"auto auto":case"initial":return;default:const s=e.split(" "),o=s.length;1===o&&(s[1]=s[0]);for(let e=0;e<o;e++){let o=s[e];"auto"===o&&(o="100%"),0===e?i=t.parseUnit(o,"width",!1):n=t.parseUnit(o,"height",!1)}}return i>0&&n>0?{width:Math.round(i),height:Math.round(n)}:void 0}static isInheritedStyle(t,e){if(t.styleElement){const i=t.actualParent;if(i&&""===t.cssInitial(e))return t.style[e]===i.style[e]}return!1}static hasLineBreak(t,e=!1,i=!1){if(t.naturalElements.length)return t.naturalElements.some(t=>t.lineBreak);if(!e&&t.naturalChild){const e=t.element;let n=e.textContent;if(i&&(n=n.trim()),/\n/.test(n))return!(!t.plainText||!Tt.isParentStyle(e,"whiteSpace","pre","pre-wrap"))||t.css("whiteSpace").startsWith("pre")}return!1}static getStoredName(t,e){if(Ft.STORED[t])for(const[i,n]of Ft.STORED[t].entries())if(Rt.isEqual(e,n))return i;return""}finalize(t){}reset(){super.reset();for(const t in Ft.STORED)Ft.STORED[t].clear()}writeRawImage(t,e){this.fileHandler&&this.fileHandler.addAsset({pathname:this.controllerSettings.directory.image,filename:t,base64:e})}setBoxStyle(t){if(t.styleElement||t.visibleStyle.background){const n={backgroundSize:t.css("backgroundSize"),backgroundRepeat:t.css("backgroundRepeat"),backgroundPositionX:t.css("backgroundPositionX"),backgroundPositionY:t.css("backgroundPositionY")};function e(e,i){const s=t.css(i[0])||"none";let o=Tt.formatPX("outline"!==e?t[i[1]]:Rt.convertFloat(t.style[i[1]])),r=t.css(i[2])||"initial";switch(r){case"initial":r="rgb(0, 0, 0)";break;case"inherit":case"currentcolor":r=Tt.getInheritedStyle(t.element,i[2])}if("0px"!==o&&"none"!==s){"2px"!==o||"inset"!==s&&"outset"!==s||(o="1px");const t=Et.parseColor(r,1,!0);t&&(n[e]={width:o,style:s,color:t})}}function i(e){switch(t.css(e)){case"border-box":return!0;case"padding-box":n[e]={top:t.borderTopWidth,right:t.borderRightWidth,bottom:t.borderBottomWidth,left:t.borderLeftWidth};break;case"content-box":n[e]={top:t.borderTopWidth+t.paddingTop,right:t.borderRightWidth+t.paddingRight,bottom:t.borderBottomWidth+t.paddingBottom,left:t.borderLeftWidth+t.paddingLeft}}return!1}if(i("backgroundClip")&&t.has("backgroundOrigin")&&i("backgroundOrigin"),"0px"!==t.css("borderRadius")){const[e,i]=t.css("borderTopLeftRadius").split(" "),[s,o]=t.css("borderTopRightRadius").split(" "),[r,a]=t.css("borderBottomRightRadius").split(" "),[l,c]=t.css("borderBottomLeftRadius").split(" "),h=i||o||a||c?[e,i||e,s,o||s,r,a||r,l,c||l]:[e,s,r,l],d=t.actualWidth>=t.actualHeight;h.every(t=>t===h[0])&&(h.length="0px"===h[0]||""===h[0]?0:1);const u=h.length;if(u){const e=d?"width":"height";for(let i=0;i<u;i++)h[i]=t.convertPX(h[i],e,!1);n.borderRadius=h}}t.css("border").startsWith("0px none")||(e("borderTop",Tt.BOX_BORDER[0]),e("borderRight",Tt.BOX_BORDER[1]),e("borderBottom",Tt.BOX_BORDER[2]),e("borderLeft",Tt.BOX_BORDER[3])),e("outline",Tt.BOX_BORDER[4]),t.hasResource(z.IMAGE_SOURCE)&&(n.backgroundImage=Ft.parseBackgroundImage(t));let s=t.backgroundColor;if(""!==s||t.documentParent.visible||(s=t.css("backgroundColor")),""!==s){const t=Et.parseColor(s);n.backgroundColor=t?t.valueAsRGBA:""}t.data(Ft.KEY_NAME,"boxStyle",n)}}setFontStyle(t){if(((t.textElement||t.inlineText)&&(!t.textEmpty||t.visibleStyle.background)||t.inputElement)&&t.visible){const e=Et.parseColor(t.css("color"));let i=t.css("fontWeight");if(!Rt.isNumber(i))switch(i){case"lighter":i="200";break;case"bold":i="700";break;case"bolder":i="900";break;default:i="400"}t.data(Ft.KEY_NAME,"fontStyle",{fontFamily:t.css("fontFamily").trim(),fontStyle:t.css("fontStyle"),fontSize:Tt.formatPX(t.fontSize),fontWeight:i,color:e?e.valueAsRGBA:""})}}setValueString(t){if(t.visible&&!t.svgElement){const e=t.renderParent;if(e){const i=t.element;if(i){let n="",s="",o="",r=!1,a=!1;switch(i.tagName){case"INPUT":switch(s=i.value,i.type){case"radio":case"checkbox":const e=t.companion;e&&!e.visible&&(s=e.textContent.trim());break;case"submit":""!==s||t.visibleStyle.backgroundImage||(s="Submit");break;case"time":""===s&&(o="--:-- --");break;case"date":case"datetime-local":if(""===s){switch((new Intl.DateTimeFormat).resolvedOptions().locale){case"en-US":o="mm/dd/yyyy";break;default:o="dd/mm/yyyy"}"datetime-local"===i.type&&(o+=" --:-- --")}break;case"week":""===s&&(o="Week: --, ----");break;case"month":""===s&&(o="--------- ----");break;case"url":case"email":case"search":case"number":case"tel":""===s&&(o=i.placeholder);break;case"file":s=_t.isUserAgent(8)?"Browse...":"Choose File"}break;case"TEXTAREA":s=i.value;break;case"IFRAME":s=i.src;break;default:const l=t.textContent;t.plainText||t.pseudoElement?(n=l.trim(),[s]=Mt(e,t,l.replace(/&/g,"&amp;")),a=!0,r=!t.actualParent.preserveWhiteSpace):t.inlineText?(n=l.trim(),[s,a]=Mt(e,t,this.removeExcludedFromText(i,t.sessionId)),r=!0):0===t.naturalElements.length&&l&&""===l.trim()&&!t.hasPX("height")&&Ft.isBackgroundVisible(t.data(Ft.KEY_NAME,"boxStyle"))&&(s=l)}if(""!==s){if(r){const e=t.siblingsLeading[0];let i=!1;if(s.length>1)if(void 0===e||e.multiline||e.lineBreak||e.plainText&&kt.CHAR.TRAILINGSPACE.test(e.textContent))s=s.replace(kt.CHAR.LEADINGSPACE,"");else if(e.naturalElement){const t=e.textContent;t.length&&(i=32===t.charCodeAt(t.length-1))}if(a){const n=!t.lineBreakTrailing&&kt.CHAR.TRAILINGSPACE.test(s);if(s=!e||!kt.CHAR.LEADINGSPACE.test(s)||e.block||e.lineBreak||i?s.trim():Ct+s.trim(),n){const e=t.siblingsTrailing.find(t=>!t.excluded||t.lineBreak);e&&!e.blockStatic&&(s+=Ct)}}else if(""!==s.trim())s=(s=s.replace(kt.CHAR.LEADINGSPACE,e&&(e.block||e.lineBreak||i&&e.htmlElement&&e.textContent.length>1||t.multiline&&Ft.hasLineBreak(t))?"":Ct)).replace(kt.CHAR.TRAILINGSPACE,"table-cell"===t.display||t.lineBreakTrailing||t.blockStatic?"":Ct);else if(!t.inlineText)return}""!==s&&t.data(Ft.KEY_NAME,"valueString",{key:n,value:s})}""!==o&&t.data(Ft.KEY_NAME,"hintString",o)}else if(t.inlineText){const e=t.textContent;e&&t.data(Ft.KEY_NAME,"valueString",{key:e,value:e})}}}}removeExcludedFromText(t,e){const i=t.children.length||"CODE"===t.tagName?"innerHTML":"textContent";let n=t[i]||"";const s=t.childNodes,o=s.length;for(let t=0;t<o;t++){const r=s[t],a=At.getElementAsNode(r,e);if(void 0===a||!a.textElement||!a.pageFlow||a.positioned||a.pseudoElement||a.excluded||a.dataset.target){if(a){if(a.htmlElement&&"innerHTML"===i){n=a.lineBreak?n.replace(RegExp(`\\s*${a.element.outerHTML}\\s*`),"\\n"):n.replace(a.element.outerHTML,a.pageFlow&&""!==a.textContent.trim()?Ct:"");continue}if(Rt.isString(a[i])){n=n.replace(a[i],"");continue}}else if(r instanceof HTMLElement){const t=getComputedStyle(r).getPropertyValue("position");n=n.replace(r.outerHTML,"absolute"!==t&&"fixed"!==t&&""!==r.textContent.trim()?Ct:"")}0===t?n=Rt.trimStart(n," "):t===o-1&&(n=Rt.trimEnd(n," "))}}return"innerHTML"===i&&(n=n.replace(kt.ESCAPE.ENTITY,(t,e)=>String.fromCharCode(parseInt(e)))),n}}Ft.KEY_NAME="squared.resource",Ft.STORED={strings:new Map,arrays:new Map,fonts:new Map,colors:new Map,images:new Map};const{css:Dt,regex:Ht,util:Xt}=squared.lib,zt="[\\d.]+[a-z%]+|auto|max-content|min-content",Ut="minmax\\(([^,]+), ([^)]+)\\)",Vt="fit-content\\(([\\d.]+[a-z%]+)\\)",Gt="\\[([\\w\\-\\s]+)\\]",qt={};function jt(t,e){const i=t.repeat,n=[],s=[],o=e.length;for(let t=0;t<o;t++)i[t]?s.push(e[t]):n.push(e[t]);const r=t.length,a=r-n.length,l=Array(r);for(let t=0;t<r;t++){if(i[t]){for(let e=0,i=0;e<a;t++,e++,i++)i===s.length&&(i=0),l[t]=s[i];break}l[t]=n.shift()}return l}function Yt(t){let e=0;for(const i of t)i&&e++;return e}const $t=(t,e)=>Dt.isLength(e)?t.convertPX(e):e;class Kt extends St{static createDataAttribute(t,e,i,n){return{children:[],rowData:[],rowHeight:void 0,rowWeight:void 0,rowSpanMultiple:[],templateAreas:{},row:Kt.createDataRowAttribute(),column:Kt.createDataRowAttribute(),emptyRows:[],alignItems:t,alignContent:e,justifyItems:i,justifyContent:n}}static createDataRowAttribute(){return{length:0,gap:0,unit:[],unitMin:[],unitTotal:[],repeat:[],auto:[],autoFill:!1,autoFit:!1,name:{},normal:!0}}is(t){return t.gridElement}condition(t){return t.length>0}processNode(t){void 0===qt.UNIT&&(qt.UNIT=RegExp(`^(${zt})$`),qt.NAMED=RegExp(`\\s*(repeat\\((auto-fit|auto-fill|\\d+), (.+)\\)|${Gt}|${Ut}|${Vt}|${zt})\\s*`,"g"),qt.REPEAT=RegExp(`\\s*(${Gt}|${Ut}|${Vt}|${zt})\\s*`,"g"),qt.STARTEND=/^([\w\-]+)-(start|end)$/);const e=Kt.createDataAttribute(t.css("alignItems"),t.css("alignContent"),t.css("justifyItems"),t.css("justifyContent")),i=t.css("gridAutoFlow"),n=-1===i.indexOf("column"),s=-1!==i.indexOf("dense"),o=[],r=[],a=[];let l={};if(e.row.gap=t.parseUnit(t.css("rowGap"),"height",!1),e.column.gap=t.parseUnit(t.css("columnGap"),"width",!1),[t.cssInitial("gridTemplateRows",!0),t.cssInitial("gridTemplateColumns",!0),t.css("gridAutoRows"),t.css("gridAutoColumns")].forEach((i,n)=>{if(i&&"none"!==i&&"auto"!==i){qt.NAMED.lastIndex=0;const s=0===n?e.row:e.column,{name:o,repeat:r,unit:a,unitMin:l}=s;let c,h=1;for(;null!==(c=qt.NAMED.exec(i));)if(n<2)if(c[1].startsWith("repeat")){let e=1;switch(c[2]){case"auto-fit":s.autoFit=!0;break;case"auto-fill":s.autoFill=!0;break;default:e=Xt.convertInt(c[2])}if(e>0){void 0===qt.CELL_UNIT?(qt.CELL_UNIT=/[\d.]+[a-z%]+|auto|max-content|min-content/,qt.CELL_MINMAX=/minmax\(([^,]+), ([^)]+)\)/,qt.CELL_FIT_CONTENT=/fit-content\(([\d.]+[a-z%]+)\)/,qt.CELL_NAMED=/\[([\w\-\s]+)\]/):qt.REPEAT.lastIndex=0;const i=[];let n;for(;null!==(n=qt.REPEAT.exec(c[3]));){const e=n[1];let s;if(null!==(s=qt.CELL_NAMED.exec(e))){const t=s[1];void 0===o[t]&&(o[t]=[]),i.push({name:t})}else null!==(s=qt.CELL_MINMAX.exec(e))?i.push({unit:$t(t,s[2]),unitMin:$t(t,s[1])}):null!==(s=qt.CELL_FIT_CONTENT.exec(e))?i.push({unit:$t(t,s[1]),unitMin:"0px"}):null!==(s=qt.CELL_UNIT.exec(e))&&i.push({unit:$t(t,s[0])})}if(i.length)for(let t=0;t<e;t++)for(const t of i)t.name?o[t.name].push(h):t.unit&&(a.push(t.unit),l.push(t.unitMin||""),r.push(!0),h++)}}else"["===c[1].charAt(0)?(void 0===o[c[4]]&&(o[c[4]]=[]),o[c[4]].push(h)):c[1].startsWith("minmax")?(a.push($t(t,c[6])),l.push($t(t,c[5])),r.push(!1),h++):c[1].startsWith("fit-content")?(a.push($t(t,c[7])),l.push("0px"),r.push(!1),h++):qt.UNIT.test(c[1])&&(a.push("auto"===c[1]?"auto":$t(t,c[1])),l.push(""),r.push(!1),h++);else(2===n?e.row:e.column).auto.push(t.convertPX(c[1]))}}),t.sort(n?(t,e)=>{const{left:i,top:n}=t.linear,{left:s,top:o}=e.linear;return Xt.withinRange(n,o)?Xt.withinRange(i,s)?0:i<s?-1:1:n<o?-1:1}:(t,e)=>{const{left:i,top:n}=t.linear,{left:s,top:o}=e.linear;return Xt.withinRange(i,s)?Xt.withinRange(n,o)?0:n<o?-1:1:i<s?-1:1}),!t.has("gridTemplateAreas")&&t.every(t=>"auto"===t.css("gridRowStart")&&"auto"===t.css("gridColumnStart"))){let i,s,o,r,l;n?(i="top",s="bottom",o=2,r=1,l=3):(i="left",s="right",o=3,r=0,l=2);let c,h=0,d=0,u=0;t.each((t,f)=>{(void 0===c||t.linear[i]>=c.linear[s]||d>0&&d===u)&&(u=Math.max(d,u),h++,d=1);const g=t.css("gridRowEnd"),p=t.css("gridColumnEnd");let m=1,b=1;if(g.startsWith("span")?m=parseInt(g.split(" ")[1]):Xt.isNumber(g)&&(m=parseInt(g)-h),p.startsWith("span")?b=parseInt(p.split(" ")[1]):Xt.isNumber(p)&&(b=parseInt(p)-d),1===d&&u>0){let t=!1;do{const i=Array(u-1).fill(1);for(const t of a){const e=t.placement;if(e[o]>h)for(let t=e[r];t<e[l];t++)i[t-1]=0}for(let e=0,n=0,s=0;e<i.length;e++)if(i[e]){if(0===n&&(s=e),++n===b){d=s+1,t=!0;break}}else n=0;t||(e.emptyRows[h-1]=i,h++)}while(!t)}a[f]={placement:n?[h,d,h+m,d+b]:[d,h,d+b,h+m],rowSpan:m,columnSpan:b},d+=b,c=t})}else t.css("gridTemplateAreas").split(/"[\s\n]+"/).forEach((t,i)=>{if("none"!==t){const n=e.templateAreas;Xt.trimString(t.trim(),'"').split(Ht.CHAR.SPACE).forEach((t,e)=>{if("."!==t.charAt(0)){const s=n[t];s?(s.rowSpan=i-s.rowStart+1,s.columnSpan=e-s.columnStart+1):n[t]={rowStart:i,rowSpan:1,columnStart:e,columnSpan:1}}})}}),t.each((t,i)=>{const s=e.templateAreas,o=[t.css("gridRowStart"),t.css("gridColumnStart"),t.css("gridRowEnd"),t.css("gridColumnEnd")],r=[];let l=1,c=1;if(Object.keys(s).length)for(let t=0;t<4;t++){const e=o[t];let i=s[e];if(i)switch(t){case 0:r[0]=i.rowStart+1;break;case 1:r[1]=i.columnStart+1;break;case 2:r[2]=i.rowStart+i.rowSpan+1;break;case 3:r[3]=i.columnStart+i.columnSpan+1}else{const n=qt.STARTEND.exec(e);if(n&&(i=s[n[1]]))if("start"===n[2])switch(t){case 0:case 2:r[t]=i.rowStart+1;break;case 1:case 3:r[t]=i.columnStart+1}else switch(t){case 0:case 2:r[t]=i.rowStart+i.rowSpan+1;break;case 1:case 3:r[t]=i.columnStart+i.columnSpan+1}}}if(!(r[0]&&r[1]&&r[2]&&r[3])){function h(t,e){if(Xt.isNumber(t))return r[e]=parseInt(t),!0;if(t.startsWith("span")){const i=parseInt(t.split(" ")[1]);return r[e-2]?r[e]=r[e-2]+i:e%2==0?l=i:c=i,!0}return!1}let t,i;for(let n=0;n<4;n++){const s=o[n];if("auto"!==s&&!r[n]&&!h(s,n)){const a=e[n%2==0?"row":"column"],h=s.split(" ");1===h.length?(h[1]=h[0],h[0]="1"):Xt.isNumber(h[0])&&(n%2==0?t?l=parseInt(h[0])-parseInt(t[0]):t=h:i?c=parseInt(h[0])-parseInt(i[0]):i=h);const d=a.name[h[1]];if(d){const t=parseInt(h[0]);t<=d.length&&(r[n]=d[t-1]+(h[1]===o[n-2]?1:0))}}r[n]||h(s,n)}}a[i]={outerCoord:n?t.linear.top:t.linear.left,placement:r,rowSpan:l,columnSpan:c}});{const i=n?e.column:e.row,s=n?t.box.top:t.box.left;let o=i.unit,r=Math.max(1,o.length),l=0;for(const t of a)if(t){const e=t.placement;e.length&&(r=Math.max(r,n?t.columnSpan:t.rowSpan,e[n?1:0]||0,(e[n?3:2]||0)-1)),Xt.withinRange(t.outerCoord,s)&&(l+=n?t.columnSpan:t.rowSpan)}i.length=Math.max(r,l),(i.autoFill||i.autoFit)&&(0===o.length&&(o.push("auto"),i.unitMin.push(""),i.repeat.push(!0)),o=jt(i,o),i.unit=o,i.unitMin=jt(i,i.unitMin));let c=1,h=0;for(const t of o)Dt.isPercent(t)?c-=parseFloat(t)/100:t.endsWith("fr")&&(h+=parseFloat(t));if(c<1&&h>0){const t=o.length;for(let e=0;e<t;e++){const t=o[e];t.endsWith("fr")&&(o[e]=c*(parseFloat(t)/h)+"fr")}}const d=e.row.unit.length+1,u=e.column.unit.length+1;for(const t of a){const e=t.placement;e[2]<0&&(d>1?e[2]+=d+1:e[2]=void 0),e[3]<0&&(u>1?e[3]+=u+1:e[3]=void 0)}}t.each((t,i)=>{const c=a[i],h=c.placement;let d,u,f,g,p,m,b;for(n?(d=c.rowSpan,u=c.columnSpan,f=e.column.length,g=0,p=1,m=2,b=3):(d=c.columnSpan,u=c.rowSpan,f=e.row.length,g=1,p=0,m=3,b=2);!h[0]||!h[1];){const t=h.slice(0);if(!t[g]){let e=o.length;for(let i=0,n=0,s=-1;i<e;i++)if(!l[i])if(void 0===r[i]||r[i]<f){if(0===n&&(s=i,e=Math.max(e,i+d)),++n===d){t[g]=s+1;break}}else n=0,s=-1,e=o.length}if(t[g]){if(!t[p]){t[m]||(t[m]=t[g]+d);const e=[],i=t[g]-1,n=t[m]-1;for(let t=i;t<n;t++){const i=o[t];if(void 0===i)e.push([[0,-1]]);else{if(!(Yt(i)+u<=f))break;{const t=[];let n=0;for(let e=0,s=-1;e<f;e++)void 0===i[e]&&(-1===s&&(s=e),n++),(i[e]||e===f-1)&&(n>=u&&t.push([s,s+n]),s=-1,n=0);if(!t.length)break;e.push(t)}}}const s=e.length;if(s){const o=e[0];if(-1===o[0][1])t[p]=1;else if(s===n-i)if(s>1)t:for(const i of o)for(let n=i[0];n<i[1];n++)for(let i=1;i<s;i++){const s=e[i].length;for(let o=0;o<s;o++){const s=e[i][o];if(n>=s[0]&&(-1===s[1]||n+u<=s[1])){t[p]=n+1;break t}}}else t[p]=o[0][0]+1}}}else h[g]=o.length+1,h[p]||(h[p]=1);const e=t[g];e&&t[p]?(h[g]=e,h[p]=t[p]):e&&(l[e-1]=!0)}if(h[m]||(h[m]=h[g]+d),h[b]||(h[b]=h[p]+u),function(t,e){if(e.every(t=>t>0)){for(let i=e[n?0:1]-1;i<e[n?2:3]-1;i++){let s=o[i];void 0===s&&(o[i]=s=[]);for(let o=e[n?1:0]-1;o<e[n?3:2]-1;o++)void 0===r[i]&&(r[i]=0),void 0===s[o]&&(s[o]=[],r[i]++),s[o].push(t)}return!0}return!1}(t,h)){const i=h[0]-1,n=h[2]-h[0];if(n>1)for(let t=i;t<i+n;t++)e.rowSpanMultiple[t]=!0;t.data(H.CSS_GRID,"cellData",{rowStart:i,rowSpan:n,columnStart:h[1]-1,columnSpan:h[3]-h[1]}),s&&(l={})}});const c=o.length;if(c){if(n)e.rowData=o;else for(let t=0;t<c;t++){const i=o[t],n=i.length;for(let s=0;s<n;s++)void 0===e.rowData[s]&&(e.rowData[s]=[]),e.rowData[s][t]=i[s]}const i=(n?e.row:e.column).unitTotal,s=e.children;let r=0;for(const t of e.rowData){const e=t.length;r=Math.max(e,r);for(let o=0;o<e;o++){const e=t[o];if(void 0===i[o]&&(i[o]=0),e){let t=0;for(const i of e)s.includes(i)||(t=Math.max(t,n?i.bounds.height:i.bounds.width),s.push(i));i[o]+=t}}}if(s.length===t.length){const i=e.rowData,n=i.length,o=new Set,a=Array(n),l=Array(n),c=e.column.gap,h=e.row.gap;e.row.length=n,e.column.length=r,e.rowHeight=a,e.rowWeight=l;for(let t=0;t<n;t++){a[t]=0;const e=i[t];for(let i=0;i<r;i++){const s=e[i];if(s)for(const e of s)if(!o.has(e)){const s=e.data(H.CSS_GRID,"cellData"),l=t+s.rowSpan-1;i+s.columnSpan-1<r-1&&e.modifyBox(4,c),l<n-1&&e.modifyBox(8,h),1===s.rowSpan&&(a[t]=Math.max(a[t],e.bounds.height)),o.add(e)}}}const d=t.actualHeight;for(let t=0;t<n;t++)l[t]=a[t]/d;t.retain(s),t.cssSort("zIndex"),t.cssTry("display","block")&&(t.each(t=>{const e=t.initial.bounds;if(e){const i=t.element.getBoundingClientRect();e.width=i.width,e.height=i.height}}),t.cssFinally("display")),t.data(H.CSS_GRID,F.EXT_DATA,e)}}}}const Qt=squared.lib.util;class Zt extends St{static createDataAttribute(t,e){const i=t.css("flexWrap"),n=t.css("flexDirection");return{directionRow:n.startsWith("row"),directionColumn:n.startsWith("column"),directionReverse:n.endsWith("reverse"),wrap:i.startsWith("wrap"),wrapReverse:"wrap-reverse"===i,alignContent:t.css("alignContent"),justifyContent:t.css("justifyContent"),rowCount:0,columnCount:0,children:e}}is(t){return t.flexElement}condition(t){return t.length>0}processNode(t){const e=this.controller,[i,n]=t.partition(t=>t.pageFlow&&!t.renderExclude),s=Zt.createDataAttribute(t,i);if(t.cssTry("align-items","start")){if(t.cssTry("justify-items","start")){for(const t of i){const e=t.initial.bounds;if(e&&t.cssTry("align-self","start")){if(t.cssTry("justify-self","start")){const i=t.element.getBoundingClientRect();e.width=i.width,e.height=i.height,t.cssFinally("justify-self")}t.cssFinally("align-self")}}t.cssFinally("justify-items")}t.cssFinally("align-items")}if(s.wrap){let o,r,a,l;s.directionRow?(o="top",r="left",a="right",l="intersectY"):(o="left",r="top",a="bottom",l="intersectX"),i.sort((t,e)=>t[l](e.bounds,"bounds")?Qt.withinRange(t.linear[r],e.linear[r])?0:t.linear[r]<e.linear[r]?-1:1:t.linear[o]<e.linear[o]?-1:1);let c=[i[0]],h=i[0];const d=[c];let u=i.length;for(let t=1;t<u;t++){const e=i[t];h[l](e.bounds,"bounds")?c.push(e):(h=e,d.push(c=[e]))}t.clear();let f=0,g=0;if((u=d.length)>1){const i=t.box[a];for(let n=0;n<u;n++){const s=d[n],o=e.createNodeGroup(s[0],s,t,!0);o.containerIndex=n;const r=o.unsafe("box");r&&(r[a]=i),o.addAlign(128),f=Math.max(s.length,f)}g=u}else{const e=d[0];t.retain(e);for(let t=0;t<e.length;t++)e[t].containerIndex=t;g=f=e.length}for(let t=0;t<n.length;t++)n[t].containerIndex=g+t;t.concat(n),t.sort(),s.directionRow?(s.rowCount=u,s.columnCount=f):(s.rowCount=f,s.columnCount=u)}else{if(i.some(t=>0!==t.flexbox.order)){const[t,e]=s.directionReverse?[-1,1]:[1,-1];i.sort((i,n)=>{const s=i.flexbox.order,o=n.flexbox.order;return s===o?0:s>o?t:e})}s.directionRow?(s.rowCount=1,s.columnCount=t.length):(s.rowCount=t.length,s.columnCount=1)}t.data(H.FLEXBOX,F.EXT_DATA,s)}}const{css:Jt,util:te}=squared.lib;function ee(t,e){const i=e.linear.top;for(const e of t){const t=e.findIndex(t=>te.withinRange(i,t.linear.top)||i>t.linear.top&&i<t.linear.bottom);if(-1!==t)return t}return-1}class ie extends St{static createDataCellAttribute(){return{rowSpan:0,columnSpan:0,index:-1,cellStart:!1,cellEnd:!1,rowEnd:!1,rowStart:!1,block:!1}}condition(t){if(t.length>1&&!t.layoutElement&&!t.has("listStyle")){if("table"===t.display)return t.every(t=>"table-row"===t.display&&t.every(t=>"table-cell"===t.display))||t.every(t=>"table-cell"===t.display);{let e=0,i=0;for(const n of t){if(!n.pageFlow||n.visibleStyle.background||!n.blockStatic||n.autoMargin.leftRight||n.autoMargin.left)return!1;n.length>1&&e++,"list-item"!==n.display||n.has("listStyleType")||i++}if(i===t.length)return!0;if(e>0)return t.every(t=>t.length>0&&tt.linearData(t.children).linearX)}}return!1}processNode(t){const e=[],i=[],n={};for(const e of t)for(const t of e)if(t.visible){const e=Math.floor(t.linear.left);void 0===n[e]&&(n[e]=[]),n[e].push(t)}const s=Object.keys(n),o=s.length;if(o){let r=-1;for(let t=0;t<o;t++){const e=n[s[t]];if(0===t)r=o;else if(r!==e.length){r=-1;break}}if(-1!==r)for(let t=0;t<o;t++)i.push(n[s[t]]);else{const r=[];for(let t=0;t<o;t++){const e=n[s[t]],o=e.length;if(0===t&&0===o)return;r[t]=0===t?0:r[t-1];for(let n=0;n<o;n++){const s=e[n];if(0===t||te.aboveRange(s.linear.left,r[t-1]))if(void 0===i[t]&&(i[t]=[]),0===t||i[0].length===o)i[t][n]=s;else{const e=ee(i,s);if(-1===e)return;i[t][e]=s}else{const t=i.length-1;if(i[t]){let e=1/0,n=-1/0;if(i[t].forEach(t=>{const{left:i,right:s}=t.linear;i<e&&(e=i),s>n&&(n=s)}),Math.floor(s.linear.left)>Math.ceil(e)&&Math.floor(s.linear.right)>Math.ceil(n)){const e=ee(i,s);if(-1!==e)for(let n=i.length-1;n>=0;n--)if(i[n]){void 0===i[n][e]&&(i[t].length=0);break}}}}r[t]=Math.max(s.linear.right,r[t])}}const a=r.length;for(let t=0,e=-1;t<a;t++)void 0===i[t]?-1===e?e=t-1:t===a-1&&(r[e]=r[t]):-1!==e&&(r[e]=r[t-1],e=-1);for(let t=0;t<i.length;t++){const n=i[t];n&&n.length?e.push(r[t]):i.splice(t--,1)}const l=i.reduce((t,e)=>Math.max(t,e.length),0);for(let t=0;t<l;t++){const e=i.length;for(let n=0;n<e;n++)void 0===i[n][t]&&(i[n][t]={spacer:1})}e.push(t.box.right)}}const r=i.length;if(r>1&&i[0].length===t.length){const n=[],s=new Set;for(let t=0,o=0;t<r;t++){let a=0;const l=i[t];for(let c=0,h=0;c<l.length;c++){const d=l[c],u=l.length;if(void 0===n[c]&&(n[c]=[]),d.spacer)1===d.spacer&&a++;else{const f=Object.assign(ie.createDataCellAttribute(),d.data(H.GRID,"cellData"));let g=1,p=1+a;for(let e=t+1;e<r&&1===i[e][c].spacer;e++)p++,i[e][c].spacer=2;if(1===p)for(let t=c+1;t<u&&1===l[t].spacer;t++)g++,l[t].spacer=2;if(e.length){const i=Math.min(t+(p-1),e.length-1);for(const t of d.documentParent.naturalChildren)!s.has(t)&&t.visible&&!t.rendered&&te.aboveRange(t.linear.left,d.linear.right)&&te.belowRange(t.linear.right,e[i])&&(void 0===f.siblings&&(f.siblings=[]),f.siblings.push(t))}f.rowSpan=g,f.columnSpan=p,f.rowStart=0==h++,f.rowEnd=p+t===r,f.cellStart=0===o,f.cellEnd=f.rowEnd&&c===u-1,f.index=t,a=0,d.data(H.GRID,"cellData",f),n[c].push(d),s.add(d)}}}t.each(t=>t.hide()),t.clear();for(const e of n){let i=!0,n=!1;for(const t of e){const e=t.css("width");if(Jt.isPercent(e))n=!0;else if(!Jt.isLength(e)){i=!1;break}}if(i&&n&&e.length>1){const t=e[0].data(H.GRID,"cellData");if(t&&1===t.rowSpan){let i=t.siblings?t.siblings.slice(0):[];const n=e.length;for(let t=1;t<n;t++){const n=e[t],s=n.data(H.GRID,"cellData");if(!s||1!==s.rowSpan){i.length=0;break}i.push(n),s.siblings&&(i=i.concat(s.siblings))}i.length&&(t.block=!0,t.columnSpan=r,t.siblings=i,e.length=1)}}for(const n of e)n.parent=t,!i&&n.percentWidth&&n.css("width",Jt.formatPX(n.bounds.width))}t.tableElement&&"collapse"===t.css("borderCollapse")&&(t.modifyBox(32),t.modifyBox(64),t.modifyBox(128),t.modifyBox(256)),t.data(H.GRID,"columnCount",r)}}}const ne=squared.lib.css,se=t=>t.visibleStyle.backgroundImage&&!t.visibleStyle.backgroundRepeat;class oe extends St{static createDataAttribute(){return{ordinal:"",imageSrc:"",imagePosition:""}}condition(t){if(super.condition(t)){const e=t.length;if(e){const i=new Set,n=t.children;let s=0,o=0,r=0,a=0,l=0,c=0;for(let t=0;t<e;t++){const h=n[t],d="none"!==h.css("listStyleType");if("list-item"===h.display&&(d||h.innerBefore)?c++:h.marginLeft<0&&!d&&se(h)&&l++,h.blockStatic?s++:s=1/0,h.inlineVertical?o++:s=1/0,h.floating?(i.add(h.float),r++,a=1/0):0===t||t===e-1||h.blockStatic||n[t-1].blockStatic&&n[t+1].blockStatic?(a++,r=1/0):(r=1/0,a=1/0),s===1/0&&o===1/0&&a===1/0&&r===1/0)return!1}return(l>0||c>0)&&(s===e||o===e||r===e&&1===i.size||a===e)}}return!1}processNode(t){const e="OL"===t.tagName;let i=e&&t.element.start||1;t.each(t=>{const n=oe.createDataAttribute(),s=t.css("listStyleType"),o="list-item"===t.display;if(o||s&&"none"!==s||se(t)){if(t.has("listStyleImage"))n.imageSrc=t.css("listStyleImage");else{e&&o&&"LI"===t.tagName&&(i=t.element.value||i);let r=ne.convertListStyle(s,i);if(""===r)switch(s){case"disc":r="";break;case"square":r="";break;case"none":let e="",i="";t.visibleStyle.backgroundRepeat||(e=t.backgroundImage,i=t.css("backgroundPosition")),e&&"none"!==e&&(n.imageSrc=e,n.imagePosition=i,t.exclude(z.IMAGE_SOURCE));break;default:r=""}else r+=".";n.ordinal=r}o&&i++}t.data(H.LIST,F.EXT_DATA,n)})}}const{dom:re,util:ae}=squared.lib;const le=squared.lib.css;const{css:ce,dom:he,math:de,util:ue}=squared.lib,fe=/rgba\(0, 0, 0, 0\)|transparent/;class ge extends St{static createDataAttribute(t){return{layoutType:0,rowCount:0,columnCount:0,layoutFixed:"fixed"===t.css("tableLayout"),borderCollapse:"collapse"===t.css("borderCollapse"),expand:!1}}processNode(t){const e=ge.createDataAttribute(t);let i=[];const n=[],s=[],o=[];function r(e,i){i.percent=Math.round(e.bounds.width/t.box.width*100)+"%",i.expand=!0}function a(t){if(t.length){for(const e of t[0].cascade()){const i=e.tagName;"TH"!==i&&"TD"!==i||(e.inherit(t[0],"styleMap"),e.unsetCache("visibleStyle"))}i=i.concat(t[0].children);for(const e of t)e.hide()}}const l=t=>t.css("width",ce.formatPX(t.bounds.width),!0);t.each(t=>{switch(t.tagName){case"THEAD":n.push(t);break;case"TBODY":s.push(t);break;case"TFOOT":o.push(t)}}),a(n);for(const t of s)i=i.concat(t.children),t.hide();a(o);const[c,h]=e.borderCollapse?[0,0]:ue.replaceMap(t.css("borderSpacing").split(" "),(e,i)=>t.parseUnit(e,0===i?"width":"height")),d=c>1?Math.round(c/2):c,u=h>1?Math.round(h/2):h,f=t.element.querySelector("COLGROUP"),g=[],p=[],m=[],b=[],x=i.length;let y=Array(x).fill(0),v=0;for(let n=0;n<x;n++){const s=i[n];g[n]=c,m[n]=[],s.each((i,s)=>{const o=i.element;for(let t=0;t<o.rowSpan-1;t++){const e=n+t+1;y[e]>=0&&(y[e]+=o.colSpan)}const r=y[n];if(!i.hasPX("width")){const t=he.getNamedItem(o,"width");ce.isPercent(t)?i.css("width",t):ue.isNumber(t)&&i.css("width",ce.formatPX(parseFloat(t)))}if(!i.hasPX("height")){const t=he.getNamedItem(o,"height");ce.isPercent(t)?i.css("height",t):ue.isNumber(t)&&i.css("height",ce.formatPX(parseFloat(t)))}if(!i.visibleStyle.backgroundImage&&!i.visibleStyle.backgroundColor)if(f){const{backgroundImage:t,backgroundColor:e}=ce.getStyle(f.children[r]);t&&"none"!==t&&i.css("backgroundImage",t,!0),e&&!fe.test(e)&&i.css("backgroundColor",e,!0)}else{let t=ce.getInheritedStyle(o,"backgroundImage",/none/,"TABLE");""!==t&&i.css("backgroundImage",t,!0),""!==(t=ce.getInheritedStyle(o,"backgroundColor",fe,"TABLE"))&&i.css("backgroundColor",t,!0)}switch(i.tagName){case"TH":{function a(e){const n=e+"Style",s=e+"Color",o=e+"Width";i.ascend(void 0,t).some(t=>!!t.has(n)&&(i.css(n,t.css(n)),i.css(s,t.css(s)),i.css(o,t.css(o),!0),i.css("border","inherit"),!0))}i.cssInitial("textAlign")||i.css("textAlign",i.css("textAlign")),0===i.borderTopWidth&&a("borderTop"),0===i.borderRightWidth&&a("borderRight"),0===i.borderBottomWidth&&a("borderBottom"),0===i.borderLeftWidth&&a("borderLeft")}case"TD":i.cssInitial("verticalAlign")||i.css("verticalAlign","middle",!0)}const l=i.cssInitial("width"),m=void 0===b[r]||"auto"===b[r],v=i.bounds.width;if(0===n||m||!e.layoutFixed)if(""===l||"auto"===l)void 0===b[r]?(b[r]=l||"0px",p[r]=0):n===x-1&&m&&0===p[r]&&(p[r]=v);else{const t=ce.isPercent(l),e=ce.isLength(b[r]);(m||v<p[r]||v===p[r]&&(e&&t||t&&ce.isPercent(b[r])&&i.parseUnit(l)>=i.parseUnit(b[r])||e&&ce.isLength(l)&&i.parseUnit(l)>i.parseUnit(b[r])))&&(b[r]=l),(m||1===o.colSpan)&&(p[r]=v)}(i.length||i.inlineText)&&(g[n]+=v+c),d>0&&(i.modifyBox(16,0===y[n]?c:d),i.modifyBox(4,0===s?d:c)),u>0&&(i.modifyBox(2,0===n?h:u),i.modifyBox(8,n+o.rowSpan<x?u:h)),y[n]+=o.colSpan}),v=Math.max(v,y[n])}t.hasPX("width",!1)&&b.some(t=>ce.isPercent(t))&&ue.replaceMap(b,(t,e)=>"auto"===t&&p[e]>0?ce.formatPX(p[e]):t);let S=!1;if(b.every(t=>ce.isPercent(t))){if(b.reduce((t,e)=>t+parseFloat(e),0)>1){let t=100;ue.replaceMap(b,e=>{const i=parseFloat(e);return t<=0?e="0px":t-i<0&&(e=ce.formatPercent(t/100)),t-=i,e})}t.hasWidth||(e.expand=!0),S=!0}else if(b.every(t=>ce.isLength(t))){const i=b.reduce((t,e)=>t+parseFloat(e),0);if(t.hasWidth)if(i<t.width)ue.replaceMap(b,t=>"0px"!==t?parseFloat(t)/i*100+"%":t);else if(i>t.width&&(t.css("width","auto",!0),!e.layoutFixed))for(const e of t.cascade())e.css("width","auto",!0);e.layoutFixed&&!t.hasPX("width")&&t.css("width",ce.formatPX(t.bounds.width),!0)}let _=0;e.layoutType=(()=>{if(b.length>1){if(_=b.reduce((t,e)=>t+(ce.isPercent(e)?parseFloat(e):0),0),e.layoutFixed&&b.reduce((t,e)=>t+(ce.isLength(e)?parseFloat(e):0),0)>=t.actualWidth)return 4;if(b.length>1&&b.some(t=>ce.isPercent(t))||b.every(t=>ce.isLength(t)&&"0px"!==t))return 3;if(b.every(t=>t===b[0])){if(t.cascadeSome(t=>t.hasHeight))return e.expand=!0,3;if("auto"===b[0]){if(t.hasWidth)return 3;{const e=t.cascade(t=>"TD"===t.tagName);return e.length&&e.every(t=>ue.withinRange(t.bounds.width,e[0].bounds.width))?0:3}}if(t.hasWidth)return 2}if(b.every(t=>"auto"===t||ce.isLength(t)&&"0px"!==t))return t.hasWidth||(e.expand=!0),1}return 0})();const E=t.find(t=>"CAPTION"===t.tagName);t.clear(),E&&(E.hasWidth||(E.textElement?E.hasPX("maxWidth")||E.css("maxWidth",ce.formatPX(E.bounds.width)):E.bounds.width>de.maxArray(g)&&l(E)),E.cssInitial("textAlign")||E.css("textAlign","center"),E.data(H.TABLE,"cellData",{colSpan:v}),E.parent=t);const T=t.hasWidth;y=Array(x).fill(0);for(let n=0;n<x;n++){const s=i[n];let o;for(const i of s.duplicate()){const s=i.element,{rowSpan:a,colSpan:c}=s,h={rowSpan:a,colSpan:c};for(let t=0;t<a-1;t++){const e=n+1+t;void 0!==y[e]&&(y[e]+=c)}i.has("verticalAlign")||i.css("verticalAlign","middle");const d=b[y[n]];if(d)switch(e.layoutType){case 0:break;case 3:"auto"===d?_>=1?(l(i),h.exceed=!T,h.downsized=!0):r(i,h):ce.isPercent(d)?S?(h.percent=d,h.expand=!0):l(i):ce.isLength(d)&&parseInt(d)>0?i.bounds.width>=parseInt(d)?(l(i),h.expand=!1,h.downsized=!1):e.layoutFixed?(r(i,h),h.downsized=!0):(l(i),h.expand=!1):(i.hasPX("width")&&!i.percentWidth||l(i),h.expand=!1);break;case 2:i.css("width","0px");break;case 1:"auto"===d?i.css("width","0px"):(e.layoutFixed?h.downsized=!0:l(i),h.expand=!1);break;case 4:ce.isLength(d)||i.hide()}y[n]+=c;for(let t=0;t<a;t++)for(let e=0;e<c;e++)m[n+t].push(i);i.data(H.TABLE,"cellData",h),i.parent=t,o=i}if(o&&y[n]<v){const t=o.data(H.TABLE,"cellData");t&&(t.spaceSpan=v-y[n])}s.hide()}if(e.borderCollapse){const e=t.css("borderTopColor"),i=t.css("borderTopStyle"),n=t.css("borderTopWidth"),s=t.css("borderRightColor"),o=t.css("borderRightStyle"),r=t.css("borderRightWidth"),a=t.css("borderBottomColor"),l=t.css("borderBottomStyle"),c=t.css("borderBottomWidth"),h=t.css("borderLeftColor"),d=t.css("borderLeftStyle"),u=t.css("borderLeftWidth");let f=!1,g=!1,p=!1,b=!1;for(let t=0;t<x;t++)for(let y=0;y<v;y++){const S=m[t][y];if(S&&"visible"===S.css("visibility")){if(0===t&&(S.borderTopWidth<parseInt(n)?S.cssApply({borderTopColor:e,borderTopStyle:i,borderTopWidth:n}):f=!0),t>=0&&t<x-1){const e=m[t+1][y];e&&e!==S&&"visible"===e.css("visibility")&&(S.borderBottomWidth>=e.borderTopWidth?e.css("borderTopWidth","0px",!0):S.css("borderBottomWidth","0px",!0))}if(t===x-1&&(S.borderBottomWidth<parseInt(c)?S.cssApply({borderBottomColor:a,borderBottomStyle:l,borderBottomWidth:c}):p=!0),0===y&&(S.borderLeftWidth<parseInt(u)?S.cssApply({borderLeftColor:h,borderLeftStyle:d,borderLeftWidth:u}):b=!0),y>=0&&y<v-1){const e=m[t][y+1];e&&e!==S&&"visible"===e.css("visibility")&&(S.borderRightWidth>=e.borderLeftWidth?e.css("borderLeftWidth","0px",!0):S.css("borderRightWidth","0px",!0))}y===v-1&&(S.borderRightWidth<parseInt(r)?S.cssApply({borderRightColor:s,borderRightStyle:o,borderRightWidth:r}):g=!0)}}(f||g||p||b)&&t.cssApply({borderTopWidth:"0px",borderRightWidth:"0px",borderBottomWidth:"0px",borderLeftWidth:"0px"},!0)}e.rowCount=x,e.columnCount=v,t.data(H.TABLE,F.EXT_DATA,e)}}const{css:pe,util:me}=squared.lib;const{css:be,util:xe}=squared.lib,ye=null!==document.doctype&&"html"===document.doctype.name;function ve(t,e,i,n=0){let s;switch(e){case 2:s=t.actualRect("top")-i;break;case 16:s=t.actualRect("left")-i;break;case 8:s=i-t.actualRect("bottom");break;default:s=0}(s-=n)>0&&(t.renderAs||t.outerWrapper||t).modifyBox(e,s)}function Se(t,e,i){if(Ee(e,i)){let n,s,o,r;if(i?(n="marginTop",s="borderTopWidth",o="paddingTop",r=2):(n="marginBottom",s="borderBottomWidth",o="paddingBottom",r=8),0===t[s])if(0===t[o]){for(;ye&&0===e[n]&&0===e[s]&&0===e[o]&&we(e);){const t=i?e.firstStaticChild:e.lastStaticChild;if(!Ee(t,i))break;e=t}const a=t[n],l=e[n],c=e.bounds.height;let h=!1;if(!ye&&0===a&&l>0&&""===e.cssInitial(n))h=!0;else{const n=a>=l;0===c&&n&&e.textEmpty&&0===e.extensions.length?e.hide():1!==e.getBox(r)[0]&&(n?h=!0:t.documentBody?(_e(t,r),i&&(t.bounds.top=0,t.unset("box"),t.unset("linear"))):(1!==t.getBox(r)[0]&&(t.modifyBox(r),t.modifyBox(r,l)),h=!0))}h&&(_e(e,r),0!==c||e.every(t=>t.floating)||_e(e,i?8:2))}else if(0===e[n]&&0===e[s]&&we(e)){let r=!0;for(;;){const a=i?e.firstStaticChild:e.lastStaticChild;if(!a||0!==a[n]||0!==a[s]||a.visibleStyle.background||!we(a))break;{const n=a[o];if(n>0){n>=t[o]?t.modifyBox(i?32:128):r&&t.modifyBox(i?32:128,-n);break}Ee(a,i)||(r=!1),e=a}}}}}function _e(t,e){const i=t[D.get(e)];if(0===t.getBox(e)[0])t.modifyBox(e);else for(const n of t.ascend(void 0,void 0,"outerWrapper"))if(n.getBox(e)[1]>=i){n.modifyBox(e,-i);break}}function Ee(t,e,i=!1){if(t&&!t.lineBreak){let n=!1;if(t.blockStatic)n=!0;else if(!t.floating){const i=t.display;if("list-item"===i&&(n=!0),void 0!==e)if("table"===i&&(n=!0),e){const e=t.firstStaticChild;n=Ee(e)&&ke(e)}else{const e=t.lastStaticChild;n=Ee(e)&&Ae(e)}}return n&&(!i||void 0===e||t.bounds.height>0)}return!1}const Te=(t,e)=>t.css("minHeight",be.formatPX(Math.max(e,t.hasPX("minHeight",!1)?t.parseUnit(t.css("minHeight")):0))),we=t=>!t.layoutElement&&!t.tableElement&&"FIELDSET"!==t.tagName,ke=t=>!t.hasPX("height")&&0===t.paddingBottom&&0===t.borderBottomWidth&&we(t),Ae=t=>!t.hasPX("height")&&0===t.borderTopWidth&&0===t.paddingTop&&we(t);const Re={Accessibility:class extends St{constructor(){super(...arguments),this.options={showLabel:!1}}beforeBaseLayout(){for(const t of this.application.processing.cache)if(t.inputElement&&t.hasProcedure(U.ACCESSIBILITY))switch(t.containerName){case"INPUT_IMAGE":t.extracted=[t];break;case"INPUT_RADIO":case"INPUT_CHECKBOX":const e=t.element;[t.nextSibling,t.previousSibling].some(i=>!!(i&&i.visible&&i.pageFlow&&!i.visibleStyle.backgroundImage&&(e.id&&e.id===i.element.htmlFor?t.companion=i:i.textElement&&"LABEL"===i.documentParent.tagName?(t.companion=i,i.documentParent.renderAs=t):i.plainText&&(t.companion=i),t.companion))&&(this.options.showLabel||i.hide(),!0));break;case"BUTTON":if(t.length){const e=t.filter(t=>!t.textElement);e.length&&(t.extracted=e),t.clear()}}}},CssGrid:Kt,Flexbox:Zt,Grid:ie,List:oe,Relative:class extends St{is(t){return t.positionRelative||0!==t.toFloat("verticalAlign",!0)}condition(){return!0}processNode(){return{include:!0}}postOptimize(t){const e=t.renderParent;if(e){const i=ae.convertFloat(t.verticalAlign);let{top:n,right:s,bottom:o,left:r}=t,a=t;if(e.support.container.positionRelative&&e.layoutHorizontal&&0===t.renderChildren.length&&(0!==t.top||0!==t.bottom||0!==i)){const i=this.application;(a=t.clone(i.nextId,!0,!0)).baselineAltered=!0,t.hide(!0),i.session.cache.append(a,!1);const n=new it(e,a,a.containerType,a.alignmentType),s=e.renderChildren.findIndex(e=>e===t);if(-1!==s&&(n.renderIndex=s+1),i.addLayout(n),e.layoutHorizontal&&t.documentParent.parseUnit(t.css("textIndent"))<0&&e.renderEach(e=>{const i=t.documentId;e.alignSibling(F.TOP_BOTTOM)===i?e.alignSibling(F.TOP_BOTTOM,a.documentId):e.alignSibling(F.BOTTOM_TOP)===i&&e.alignSibling(F.BOTTOM_TOP,a.documentId)}),t.baselineActive&&!t.baselineAltered)for(const i of e.horizontalRows||[e.renderChildren])if(i.includes(t)){const e=ae.filterArray(i,e=>e.positionRelative&&e.length>0&&0!==ae.convertFloat(t.verticalAlign)),n=e.length;if(n){e.sort((t,e)=>{const i=t.linear.top,n=e.linear.top;return ae.withinRange(i,n)?0:i<n?-1:1});for(let i=0;i<n;i++){const n=e[i];0===i?t.modifyBox(2,ae.convertFloat(n.verticalAlign)):n.modifyBox(2,n.linear.top-e[0].linear.top),n.css("verticalAlign","0px",!0)}}break}}else if(t.naturalElement&&t.positionRelative){const i=t.actualParent;if(i){let a,l=!1;for(const c of i.naturalElements){if(c===t){if(l){if(e.layoutVertical&&(0!==t.top||0!==t.bottom)){const e=re.assignRect(t.element.getBoundingClientRect(),!0);0!==n&&(n-=e.top-t.bounds.top),0!==o&&(o+=e.bottom-t.bounds.bottom)}if(e.layoutHorizontal&&(0!==t.left||0!==t.right)&&""===t.alignSibling(F.LEFT_RIGHT)){const e=re.assignRect(t.element.getBoundingClientRect(),!0);0!==r&&(r-=e.left-t.bounds.left),0!==s&&(s+=e.right-t.bounds.right)}}else if(e.layoutVertical)if(0!==n)a&&a.blockStatic&&a.positionRelative&&c.blockStatic&&(n-=a.top);else if(0!==o){1===c.getBox(2)[0]&&(o-=c.marginTop)}break}c.positionRelative&&c.renderParent===e&&(l=!0),a=c}}}0!==n?a.modifyBox(2,n):0!==o&&a.modifyBox(2,-1*o),0!==i&&a.modifyBox(2,-1*i),0!==r?a.autoMargin.left?a.modifyBox(4,-1*r):a.modifyBox(16,r):0!==s&&a.modifyBox(16,-1*s)}}},Sprite:class extends St{is(){return!0}condition(t){const e=t.backgroundImage;if(""!==e&&t.hasWidth&&t.hasHeight&&0===t.length&&(this.included(t.element)||!t.dataset.use)){const i=this.resource.getRawData(e)||this.resource.getImage(le.resolveURL(e));if(i){const e=/^0[a-z%]+|left|start|top/,n=t.actualDimension,s=t.css("backgroundPositionX"),o=t.css("backgroundPositionY"),r=le.getBackgroundPosition(s+" "+o,n,t.fontSize),a=(r.left<0||e.test(s))&&i.width>n.width,l=(r.top<0||e.test(o))&&i.height>n.height;if((a||l)&&(a||0===r.left)&&(l||0===r.top))return t.data(H.SPRITE,F.EXT_DATA,{image:i,position:r}),!0}}return!1}},Table:ge,VerticalAlign:class extends St{is(){return!0}condition(t){let e=!1,i=0,n=0,s=0;for(const o of t){if(o.inlineVertical){const t=me.convertFloat(o.verticalAlign);0!==t&&(e=!0),isNaN(s)||(0===s?s=t:s!==t&&(s=NaN)),n++}else s=NaN;(o.positionStatic||o.positionRelative&&o.length)&&i++}return e&&isNaN(s)&&n>1&&i===t.length&&tt.linearData(t.children).linearX}processNode(t){return t.each(t=>{(t.inlineVertical&&!t.baseline||t.imageElement)&&(t.baselineAltered=!0)}),{include:!0}}postConstraints(t){if(t.layoutHorizontal)for(const e of t.horizontalRows||[t.renderChildren]){const t=[];let i,n=1/0;for(const s of e){const e=s.linear.top;s.inlineVertical&&e<=n&&(e<n&&(t.length=0),t.push(s),n=e),s.baselineActive&&(i=s)}if(t.length){const n=t[0].linear.top;for(const s of e)if(s!==i){if(s.inlineVertical&&!s.baseline)if(t.includes(s))s.imageElement&&i&&s.alignSibling("baseline")===i.documentId&&s.modifyBox(2,i.linear.top-s.linear.top);else{const t=s.verticalAlign;let e=!1;switch(t){case"super":case"sub":e=!0;break;default:(pe.isLength(t)||void 0===i)&&(e=!0)}e&&s.modifyBox(2,s.linear.top-n)}s.baselineAltered&&s.css("verticalAlign","0px",!0)}i&&(i.modifyBox(2,i.linear.top-n),i.baselineAltered=!0)}}else t.each(t=>t.baselineAltered=!1)}},WhiteSpace:class extends St{afterBaseLayout(){const t=new Set;for(const e of this.application.processing.cache)if(e.naturalElement&&e.naturalElements.length&&!e.layoutElement&&!e.tableElement&&0!==e.id){let i,n;const s=Ee(e)&&!e.actualParent.layoutElement,o=e.naturalChildren,r=o.length;for(let a=0;a<r;a++){const l=o[a];if(l.pageFlow&&(s&&(l.floating?n=void 0:l.bounds.height>0||1===r||Ee(l,0===a||a!==r-1&&void 0,!0)?(void 0===i&&(i=l),n=l):0===l.bounds.height&&e.layoutVertical&&""===l.alignSibling("top")&&""===l.alignSibling("bottom")&&(0===l.renderChildren.length||l.every(t=>!t.visible))&&(!l.pseudoElement||l.pseudoElement&&(1===r||a>0||o.every((t,e)=>0===e||t.floating||t.pseudoElement&&""===t.textContent.trim())))&&l.hide()),a>0&&Ee(l,!1))){const i=l.previousSiblings({floating:!1}),n=i.length;if(n){const o=i[n-1];let r=!1;if(Ee(o,!0)){let e=o.marginBottom,i=l.marginTop;if(o.excluded&&!l.excluded){const n=Math.min(e,o.marginTop);if(n<0){l.modifyBox(2,Math.abs(n)<i?n:void 0),t.add(o.id);continue}}else if(!o.excluded&&l.excluded){const n=Math.min(i,l.marginBottom);if(n<0){o.modifyBox(8,Math.abs(n)<e?n:void 0),t.add(l.id);continue}}let n=!1;if(s){let t=o;for(;ke(t);){const i=t.lastStaticChild;if(Ee(i,!0)&&1!==i.getBox(8)[0]){const s=i.marginBottom;if(_e(i,8),s>e)o.setCacheValue("marginBottom",e=s),n=!0;else if(0===s&&0===e){t=i;continue}}break}for(t=l;Ae(t);){const e=t.firstStaticChild;if(Ee(e,!1)&&1!==e.getBox(2)[0]){const n=e.marginTop;if(_e(e,2),n>i)l.setCacheValue("marginTop",i=n),r=!0;else if(0===n&&0===i){t=e;continue}}break}}if(e>0&&(i>0?i<=e?r&&xe.hasBit(l.overflow,64)||(r&&(l.setCacheValue("marginTop",0),r=!1),_e(l,2)):n&&xe.hasBit(o.overflow,64)||(n&&(o.setCacheValue("marginBottom",0),n=!1),_e(o,8)):0===o.bounds.height&&_e(o,8)),r)for(const t of l.registerBox(2))t.setCacheValue("marginTop",i);if(n)for(const t of o.registerBox(8))t.setCacheValue("marginBottom",e)}if(!r&&i.length>1&&i[0].floating&&(e.layoutVertical||l.renderParent&&l.renderParent.layoutVertical)){const t=i[0].linear.top-l.linear.top;t<0&&l.modifyBox(2,t,!1)}}}}if(!(xe.hasBit(e.overflow,64)||e.documentParent.layoutElement&&e.documentParent.css("flexDirection").startsWith("column")||"FIELDSET"===e.tagName)&&(i&&Se(e,i,!0),n&&(Se(e,n,!1),n.marginTop<0))){const t=n.bounds.height+n.marginBottom+n.marginTop;t<0&&e.modifyBox(128,t,!1)}}for(const e of this.application.processing.excluded)if(e.lineBreak&&!e.lineBreakTrailing&&!t.has(e.id)){const i=e.previousSiblings({floating:!1});let n=!1;if(i.length){const s=e.actualParent,o=e.nextSiblings({floating:!1});if(o.length){let r=i.pop(),a=o.pop();const l=r.inlineStatic&&a.inlineStatic;if(l&&0===i.length){t.add(e.id);continue}let c,h=0;const d=()=>a.linear.top-(c?Math.max(c.linear.top,r.linear.bottom):r.linear.bottom)-h;if(!r.multiline&&r.has("lineHeight")){const t=Math.floor((r.lineHeight-r.bounds.height)/2);t>0&&(h+=t)}if(!a.multiline&&a.has("lineHeight")){const t=Math.round((a.lineHeight-a.bounds.height)/2);t>0&&(h+=t)}l&&(c=i[0],1===i.length&&(c=c.lineBreak?e:void 0),c&&c.setBounds(!1));let u=r.renderParent,f=a.renderParent;if(u&&f){for(;u&&u!==s;)u=(r=u).renderParent;for(;f&&f!==s;)f=(a=f).renderParent;if(f===u){const t=d();0!==t&&(a.visible?(a.modifyBox(2,t),n=!0):r.visible&&(r.modifyBox(8,t),n=!0))}}else{const t=d();0!==t&&(a.lineBreak||a.excluded?(s.modifyBox(128,t),n=!0):(r.lineBreak||r.excluded)&&(s.modifyBox(32,t),n=!0))}}else if(s.visible){if(s.documentRoot||0!==s.ascend(t=>t.documentRoot,void 0,"outerWrapper").length){if(o.length){const t=o[o.length-1],e=(t.lineBreak||t.excluded?t.linear.bottom:t.linear.top)-s.box.top;0!==e&&(t.rendered||s.visibleStyle.background?s.modifyBox(32,e):s.hasHeight||Te(s,e))}}else{const t=i[i.length-1],e=0===t.bounds.height&&t.length?tt.outerRegion(t):t.linear,n=s.box.bottom-(t.lineBreak||t.excluded?e.top:e.bottom);0!==n&&(t.rendered||s.visibleStyle.background?s.modifyBox(128,n):s.hasHeight||Te(s,n))}n=!0}if(n){for(const e of i)t.add(e.id);for(const e of o)t.add(e.id)}}}}afterConstraints(){const t=this.application.processing.cache;for(const e of t)if(e.pageFlow){const t=e.renderParent;if(t&&e.styleElement&&e.inlineVertical&&!e.positioned&&!e.documentParent.layoutElement&&!t.tableElement){if(e.blockDimension&&!e.floating)if(t.layoutVertical){const i=t.renderChildren,n=i.findIndex(t=>t===e);if(-1!==n){if(!e.lineBreakLeading){const t=i[n-1];t&&t.pageFlow&&ve(e,2,t.actualRect("bottom"),t.getBox(8)[1])}if(!e.lineBreakTrailing){const t=i[n+1];t&&t.pageFlow&&t.styleElement&&!t.inlineVertical&&ve(e,8,t.actualRect("top"),t.getBox(2)[1])}}}else{let i;if(t.horizontalRows)t:{const n=t.horizontalRows;let s=-1/0;const o=n.length;for(let t=0;t<o;t++){const o=n[t],r=o.length;for(let n=0;n<r;n++)if(e===o[n]){t>0?ve(e,2,s):i=o;break t}for(const t of o)if(t.blockDimension&&!t.floating){const e=t.actualRect("bottom");e>s&&(s=e)}if(s===-1/0)break}}else t.layoutHorizontal&&(i=t.renderChildren);if(i){const t=e.actualParent;if(t){const n=e.actualRect("top");let s=-1/0;for(const e of t.naturalChildren){if(i.includes(e))break;if(e.lineBreak)s=-1/0;else if(e.blockDimension&&!e.floating){const t=e.actualRect("bottom");t>s&&(s=t)}}s!==-1/0&&n>s&&ve(e,2,s)}}}if(t.layoutHorizontal&&!e.alignParent("left")){const i=e.alignSibling("leftRight");if(""!==i){const n=t.renderChildren.find(t=>t.documentId===i);n&&n.inlineVertical&&ve(e,16,n.actualRect("right"))}else{let t=e;for(;;){const i=t.siblingsLeading;if(i.length&&!i.some(t=>t.lineBreak||t.excluded&&t.blockStatic)){const n=i[0];if(n.inlineVertical)ve(e,16,n.actualRect("right"));else if(n.floating){t=n;continue}}break}}}}}}}},Ce={constant:V,enumeration:G};t.Application=E,t.ApplicationUI=dt,t.Controller=T,t.ControllerUI=class extends T{constructor(){super(...arguments),this._requireFormat=!1,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}reset(){this._requireFormat=!1,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}preventNodeCascade(t){return this.localSettings.unsupported.cascade.has(t.tagName)}applyDefaultStyles(t){const e=this.sessionId;let i;if(gt.isTextNode(t))i={position:"static",display:"inline",verticalAlign:"baseline",float:"none",clear:"none"};else{i=pt.getElementCache(t,"styleMap",e)||{};const n=()=>{if(void 0===i.border&&function(t){for(let e=0;e<4;e++)if(i[ft.BOX_BORDER[e][t]])return!1;return!0}(0)){const t=this.localSettings.style.inputBorderColor;i.border="outset 1px "+t;for(let e=0;e<4;e++)i[ft.BOX_BORDER[e][0]]="outset",i[ft.BOX_BORDER[e][1]]="1px",i[ft.BOX_BORDER[e][2]]=t;return!0}return!1},s=t=>{!t||void 0!==i.backgroundColor&&"initial"!==i.backgroundColor||(i.backgroundColor=this.localSettings.style.inputBackgroundColor),void 0===i.textAlign&&(i.textAlign="center"),void 0!==i.padding||ft.BOX_PADDING.some(t=>!!i[t])||(i.paddingTop="2px",i.paddingRight="6px",i.paddingBottom="3px",i.paddingLeft="6px")};if(ut.isUserAgent(8))switch(t.tagName){case"INPUT":case"SELECT":case"BUTTON":case"TEXTAREA":void 0===i.display&&(i.display="inline-block");break;case"FIELDSET":void 0===i.display&&(i.display="block")}switch(t.tagName){case"INPUT":{const e=t.type;switch(e){case"radio":case"checkbox":break;case"week":case"month":case"time":case"date":case"datetime-local":i.paddingTop=ft.formatPX(mt.convertFloat(i.paddingTop)+1),i.paddingRight=ft.formatPX(mt.convertFloat(i.paddingRight)+1),i.paddingBottom=ft.formatPX(mt.convertFloat(i.paddingBottom)+1),i.paddingLeft=ft.formatPX(mt.convertFloat(i.paddingLeft)+1);break;case"image":void 0===i.verticalAlign&&(i.verticalAlign="text-bottom");break;default:const t=n();switch(e){case"file":case"reset":case"submit":case"button":s(t)}}break}case"BUTTON":s(n());break;case"TEXTAREA":case"SELECT":n();break;case"BODY":void 0!==i.backgroundColor&&"initial"!==i.backgroundColor||(i.backgroundColor="rgb(255, 255, 255)");break;case"FORM":void 0===i.marginTop&&(i.marginTop="0px");break;case"LI":if(void 0===i.listStyleImage){const e=ft.getStyle(t);i.listStyleImage=e.getPropertyValue("list-style-image")}break;case"IFRAME":void 0===i.display&&(i.display="block");case"IMG":const e=(e,n)=>{if(void 0===i[e]||"auto"===i[e]){const s=RegExp(`\\s+${e}="([^"]+)"`).exec(t.outerHTML);if(s)ft.isLength(s[1])?i[e]=s[1]+"px":ft.isPercent(s[1])&&(i[e]=s[1]);else if("IFRAME"===t.tagName)"width"===e?i.width="300px":i.height="150px";else if(i[n]&&ft.isLength(i[n])){const s="max"+mt.capitalize(e);if(void 0===i[s]||!ft.isPercent(s)){const s=this.application.resourceHandler.getImage(t.src);s&&s.width>0&&s.height>0&&(i[e]=ft.formatPX(s[e]*parseFloat(i[n])/s[n]))}}}};e("width","height"),e("height","width")}}pt.setElementCache(t,"styleMap",e,i)}addBeforeOutsideTemplate(t,e,i=!0,n=-1){void 0===this._beforeOutside[t]&&(this._beforeOutside[t]=[]),-1!==n&&n<this._beforeOutside[t].length?this._beforeOutside[t].splice(n,0,e):this._beforeOutside[t].push(e),i&&(this._requireFormat=!0)}addBeforeInsideTemplate(t,e,i=!0,n=-1){void 0===this._beforeInside[t]&&(this._beforeInside[t]=[]),-1!==n&&n<this._beforeInside[t].length?this._beforeInside[t].splice(n,0,e):this._beforeInside[t].push(e),i&&(this._requireFormat=!0)}addAfterInsideTemplate(t,e,i=!0,n=-1){void 0===this._afterInside[t]&&(this._afterInside[t]=[]),-1!==n&&n<this._afterInside[t].length?this._afterInside[t].splice(n,0,e):this._afterInside[t].push(e),i&&(this._requireFormat=!0)}addAfterOutsideTemplate(t,e,i=!0,n=-1){void 0===this._afterOutside[t]&&(this._afterOutside[t]=[]),-1!==n&&n<this._afterOutside[t].length?this._afterOutside[t].splice(n,0,e):this._afterOutside[t].push(e),i&&(this._requireFormat=!0)}getBeforeOutsideTemplate(t,e=0){return this._beforeOutside[t]?bt.pushIndentArray(this._beforeOutside[t],e):""}getBeforeInsideTemplate(t,e=0){return this._beforeInside[t]?bt.pushIndentArray(this._beforeInside[t],e):""}getAfterInsideTemplate(t,e=0){return this._afterInside[t]?bt.pushIndentArray(this._afterInside[t],e):""}getAfterOutsideTemplate(t,e=0){return this._afterOutside[t]?bt.pushIndentArray(this._afterOutside[t],e):""}hasAppendProcessing(t){return void 0===t?this._requireFormat:void 0!==this._beforeOutside[t]||void 0!==this._beforeInside[t]||void 0!==this._afterInside[t]||void 0!==this._afterOutside[t]}includeElement(t){return!(this.localSettings.unsupported.tagName.has(t.tagName)||"INPUT"===t.tagName&&this.localSettings.unsupported.tagName.has(t.tagName+":"+t.type))||"true"===t.contentEditable}visibleElement(t){const e=pt.actualClientRect(t,this.sessionId);if(xt(e)){const i=ft.getStyle(t);if(e.width>0&&e.height>0){if("visible"===i.getPropertyValue("visibility"))return!0;const t=i.getPropertyValue("position");return"absolute"!==t&&"fixed"!==t}return"IMG"===t.tagName&&"none"!==i.getPropertyValue("display")||e.width>0&&"none"!==i.getPropertyValue("float")||"none"!==i.getPropertyValue("clear")||"block"===i.getPropertyValue("display")&&(0!==parseInt(i.getPropertyValue("margin-top"))||0!==parseInt(i.getPropertyValue("margin-bottom")))||"__squared.pseudo"===t.className}return!1}evaluateNonStatic(t,e){const i=new Set;for(const n of e)if(!n.documentRoot){const e=n.parent,s=n.absoluteParent;let o;switch(n.css("position")){case"relative":if(n===e.lastChild){const i=e.box;let s=!1;if(n.outsideX(i)){if(!e.hasPX("width")||"hidden"===e.css("overflowX"))continue;s=!0}if(n.outsideY(i)){if(!e.hasHeight&&!e.hasPX("height")||"hidden"===e.css("overflowY"))continue;s=!0}if(s){o=e.actualParent;do{if(n.withinX(o.box)&&n.withinY(o.box)||"hidden"===o.css("overflow"))break;o=e.actualParent}while(o&&o!==t);o&&(n.css("position","absolute",!0),n.setBounds(!1))}}break;case"fixed":if(!n.positionAuto){o=t;break}case"absolute":if(s)if(o=s,n.positionAuto)n.siblingsLeading.some(t=>t.multiline||t.excluded&&!t.blockStatic)?n.positionAuto=!1:n.cssApply({display:"inline-block",verticalAlign:"top"},!0),o=e;else if(this.userSettings.supportNegativeLeftTop){const e=o.box;let i=!1;for(;o&&o!==t;){if(i){if(o.layoutElement){o=s;break}if(n.withinX(e)&&n.withinY(e))break}else{const t="hidden"===o.css("overflowX"),s="hidden"===o.css("overflowY");if(t&&s||"0px"===n.cssInitial("top")||"0px"===n.cssInitial("right")||"0px"===n.cssInitial("bottom")||"0px"===n.cssInitial("left"))break;{const r=!t&&n.outsideX(e),a=!s&&n.outsideY(e);if(!s&&n.linear.top<Math.floor(e.top)&&(n.top<0||n.marginTop<0))i=!0;else if(r&&!n.hasPX("left")&&n.right>0||a&&!n.hasPX("top")&&0!==n.bottom)i=!0;else if(r&&a&&(!o.pageFlow||o.actualParent&&o.actualParent.documentBody)&&(n.top>0||n.left>0))i=!0;else if(!t&&n.outsideX(o.linear)&&!n.pseudoElement&&(n.left<0||n.marginLeft<0||!n.hasPX("left")&&n.right<0&&n.linear.left>=o.linear.right))i=!0;else{if(t||s||n.intersectX(e)||n.intersectY(e))break;i=!0}}}o=o.actualParent}}}if(void 0===o&&(o=n.pageFlow?e:t),o!==e){if(s&&s.positionRelative&&o!==s){const{left:t,right:e,top:i,bottom:o}=s,r=n.bounds;0!==t?(r.left+=t,r.right+=t):s.hasPX("left")||0===e||(r.left-=e,r.right-=e),0!==i?(r.top+=i,r.bottom+=i):s.hasPX("top")||0===o||(r.top-=o,r.bottom-=o),n.unset("box"),n.unset("linear")}let t=n.toFloat("opacity",!1,1),r=e;for(;r&&r!==o;)t*=r.toFloat("opacity",!1,1),r=r.actualParent;n.css("opacity",""+t),n.parent=o,n.containerIndex=1/0,i.add(o)}n.documentParent=o}for(const t of i){const e=[];let i=-1;t.each(n=>{if(n.containerIndex===1/0)for(const i of t.children){let t=i.naturalElements.includes(n);if(!t){const e=i.cascade();t=n.ascend(t=>e.includes(t)).length>0}if(t){const t=i.containerIndex+(n.zIndex>=0||i!==n.actualParent?1:0);void 0===e[t]&&(e[t]=[]),e[t].push(n);break}}else n.containerIndex>i&&(i=n.containerIndex)});const n=e.length;if(n){const s=t.children;for(let t=0,o=0,r=1;t<n;t++,o++){const n=e[t];if(n){n.sort((t,e)=>t.parent===e.parent?t.zIndex===e.zIndex?t.id<e.id?-1:1:t.zIndex<e.zIndex?-1:1:0);for(const t of n)t.containerIndex=i+r++;for(let t=0;t<s.length;t++)n.includes(s[t])&&(s[t]=void 0);s.splice(o,0,...n),o+=n.length}}t.retain(mt.flatArray(s))}}}sortInitialCache(t){t.sort((t,e)=>{if(t.depth!==e.depth)return t.depth<e.depth?-1:1;{const i=t.documentParent,n=e.documentParent;if(i!==n)return i.depth!=i.depth?i.depth<i.depth?-1:1:i.actualParent===n.actualParent?i.childIndex<n.childIndex?-1:1:i.id<n.id?-1:1}return 0})}cascadeDocument(t,e){const i=e>0?"\t".repeat(e):"",n=this.userSettings.showAttributes;let s="";for(const o of t)if(o){const t=o.node;switch(o.type){case 1:{const{controlName:r,attributes:a}=o,{id:l,renderTemplates:c}=t,h=e+1,d=this.getBeforeInsideTemplate(l,h),u=this.getAfterInsideTemplate(l,h);let f=i+`<${r+(0===e?"{#0}":"")+(n?a?bt.pushIndent(a,h):t.extractAttributes(h):"")}`;f+=c||""!==d||""!==u?">\n"+d+(c?this.cascadeDocument(this.sortRenderPosition(t,c),h):"")+u+i+`</${r}>\n`:" />\n",s+=this.getBeforeOutsideTemplate(l,e)+f+this.getAfterOutsideTemplate(l,e);break}case 2:{const t=o.content;t&&(s+=bt.pushIndent(t,e));break}}}return s}getEnclosingXmlTag(t,e,i){return"<"+t+(e||"")+(i?">\n"+i+"</"+t+">\n":" />\n")}get generateSessionId(){return""+(new Date).getTime()}},t.Extension=w,t.ExtensionManager=class{constructor(t){this.application=t}include(t){const e=this.application,i=e.extensions,n=i.findIndex(e=>e.name===t.name);if(-1!==n)return i[n]=t,!0;{const n=t.framework;if(n>0)for(const i of t.dependencies)if(i.preload&&null===this.retrieve(i.name)){const t=e.builtInExtensions[i.name];t&&this.include(t)}if((0===n||k.hasBit(n,e.framework))&&t.dependencies.every(t=>!!this.retrieve(t.name)))return t.application=e,i.push(t),!0}return!1}exclude(t){const e=this.application.extensions;for(let i=0;i<e.length;i++)if(e[i]===t)return e.splice(i,1),!0;return!1}retrieve(t){for(const e of this.application.extensions)if(e.name===t)return e;return null}optionValue(t,e){const i=this.retrieve(t);if(i&&"object"==typeof i.options)return i.options[e]}optionValueAsObject(t,e){const i=this.optionValue(t,e);return"object"==typeof i?i:null}optionValueAsString(t,e){const i=this.optionValue(t,e);return"string"==typeof i?i:""}optionValueAsNumber(t,e){const i=this.optionValue(t,e);return"number"==typeof i?i:0}optionValueAsBoolean(t,e){const i=this.optionValue(t,e);return"boolean"==typeof i&&i}},t.ExtensionUI=St,t.File=R,t.FileUI=class extends R{get directory(){return this.resource.controllerSettings.directory}},t.LayoutUI=it,t.Node=W,t.NodeGroupUI=class extends tt{init(){if(this.length){for(const t of this.children)t.parent=this;this.setBounds(),this.saveAsInitial();const t=this.actualParent;t&&(this.dir=t.dir)}}setBounds(){if(this.length){const t=tt.outerRegion(this);t.width=t.right-t.left,t.height=t.bottom-t.top,this._bounds=t}}previousSiblings(t){const e=this._initial.children[0];return e?e.previousSiblings(t):[]}nextSiblings(t){const e=this._initial.children,i=e[e.length-1];return i?i.nextSiblings(t):[]}get block(){return void 0===this._cached.block&&(this._cached.block=this.some(t=>t.block)),this._cached.block}get blockStatic(){if(void 0===this._cached.blockStatic){const t=this.documentParent,e=this.naturalChildren.length&&this.naturalChildren[0].blockStatic||this.actualWidth===t.actualWidth&&!this.some(t=>t.plainText||t.naturalElement&&t.rightAligned)||this.layoutVertical&&this.some(t=>t.blockStatic||t.rightAligned)||t.blockStatic&&(t.layoutVertical||this.hasAlign(256));(e||0!==this.containerType)&&(this._cached.blockStatic=e)}return this._cached.blockStatic||this.hasAlign(64)}get blockDimension(){return void 0===this._cached.blockDimension&&(this._cached.blockDimension=this.some(t=>t.blockDimension)),this._cached.blockDimension}get inline(){return void 0===this._cached.inline&&(this._cached.inline=this.every(t=>t.inline)),this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.every(t=>t.inlineStatic)),this._cached.inlineStatic}get inlineVertical(){return void 0===this._cached.inlineVertical&&(this._cached.inlineVertical=this.every(t=>t.inlineVertical)),this._cached.inlineVertical}get inlineFlow(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inlineStatic||this.hasAlign(128)),this._cached.inlineStatic}get pageFlow(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=!this.cssAny("position","absolute","fixed")),this._cached.pageFlow}set baseline(t){this._cached.baseline=t}get baseline(){if(void 0===this._cached.baseline){const t=this.cssInitial("verticalAlign",!0);this._cached.baseline=""!==t?"baseline"===t:this.layoutHorizontal&&this.every(t=>t.baseline)}return this._cached.baseline}get float(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.hasAlign(2048)?"right":"left":"none"),this._cached.float}get floating(){return void 0===this._cached.floating&&(this._cached.floating=this.every(t=>t.floating)),this._cached.floating}get display(){return super.display||this.some(t=>t.blockStatic)?"block":this.blockDimension?"inline-block":"inline"}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}get tagName(){return""}get plainText(){return!1}get styleText(){return!1}get multiline(){return!1}get nodeGroup(){return!0}get naturalChild(){return!1}get naturalElement(){return!1}get pseudoElement(){return!1}get previousSibling(){return null}get nextSibling(){return null}get previousElementSibling(){return null}get nextElementSibling(){return null}},t.NodeList=e,t.NodeUI=tt,t.Resource=s,t.ResourceUI=Ft,t.extensions=Re,t.lib=Ce,Object.defineProperty(t,"__esModule",{value:!0})}));
