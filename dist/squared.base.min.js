!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e=e||self).squared=e.squared||{},e.squared.base={}))}(this,function(e){"use strict";const{constant:t,css:i,dom:n,regex:s,session:a,util:o}=squared.lib,r={BACKGROUND:/\s*(url\(.+?\))\s*/,NTH_CHILD_OFTYPE:/^:nth(-last)?-(child|of-type)\((.+)\)$/,NTH_CHILD_OFTYPE_VALUE:/^(-)?(\d+)?n\s*([+\-]\d+)?$/,LANG:/^:lang\(\s*(.+)\s*\)$/},l=(e,t)=>e===t||i.isLength(e,!0)&&t.endsWith("px");class c extends squared.lib.base.Container{constructor(e,t="0",i){super(),this.id=e,this.sessionId=t,this.documentRoot=!1,this.depth=-1,this.childIndex=1/0,this._element=null,this._initial={iteration:-1,children:[],styleMap:{}},this._data={},this._fontSize=0,this._inlineText=!1,i?this._element=i:(this.style={},this._styleMap={})}static getPseudoElt(e){return e.pseudoElement?a.getElementCache(e.element,"pseudoElement",e.sessionId):""}static copyTextStyle(e,t){e.cssApply({fontFamily:t.css("fontFamily"),fontSize:i.formatPX(t.fontSize),fontWeight:t.css("fontWeight"),fontStyle:t.css("fontStyle"),color:t.css("color"),whiteSpace:t.css("whiteSpace"),textDecoration:t.css("textDecoration"),textTransform:t.css("textTransform"),wordSpacing:t.css("wordSpacing"),opacity:t.css("opacity")})}init(){const e=this._element;if(e){const t=this.sessionId;if("0"!==t&&a.setElementCache(e,"node",t,this),this.style=this.pseudoElement?i.getStyle(e.parentElement,c.getPseudoElt(this)):i.getStyle(e),this._styleMap=a.getElementCache(e,"styleMap",t)||{},this.styleElement&&!this.pseudoElement&&"0"!==t)for(let t of Array.from(e.style)){let n=e.style.getPropertyValue(t);t=o.convertCamelCase(t),""!==(n=i.checkStyleValue(e,t,n,this.style))&&(this._styleMap[t]=n)}}}saveAsInitial(e=!1){(-1===this._initial.iteration||e)&&(this._initial.children=this.duplicate(),this._initial.styleMap=Object.assign({},this._styleMap)),this._bounds&&(this._initial.bounds=n.assignRect(this._bounds),this._initial.linear=n.assignRect(this.linear),this._initial.box=n.assignRect(this.box)),this._initial.iteration++}unsafe(e,t=!1){if(!t)return this[`_${e}`];delete this[`_${e}`]}data(e,t,i,n=!0){return o.hasValue(i)?("object"!=typeof this._data[e]&&(this._data[e]={}),(n||void 0===this._data[e][t])&&(this._data[e][t]=i)):null===i&&delete this._data[e],"object"==typeof this._data[e]&&null!==this._data[e]?this._data[e][t]:void 0}unsetCache(...e){if(e.length)for(const t of e){switch(t){case"position":return void(this._cached={});case"width":this._cached.actualWidth=void 0,this._cached.percentWidth=void 0;case"minWidth":this._cached.width=void 0;break;case"height":this._cached.actualHeight=void 0,this._cached.percentHeight=void 0;case"minHeight":this._cached.height=void 0;break;case"verticalAlign":this._cached.baseline=void 0;break;case"display":this._cached.inline=void 0,this._cached.inlineVertical=void 0,this._cached.inlineFlow=void 0,this._cached.block=void 0,this._cached.blockDimension=void 0,this._cached.blockStatic=void 0,this._cached.autoMargin=void 0;break;case"backgroundColor":case"backgroundImage":this._cached.visibleStyle=void 0;break;case"pageFlow":this._cached.positionAuto=void 0,this._cached.blockStatic=void 0,this._cached.baseline=void 0,this._cached.floating=void 0,this._cached.autoMargin=void 0,this._cached.rightAligned=void 0,this._cached.bottomAligned=void 0;break;case"float":this._cached.floating=void 0;break;default:t.startsWith("margin")&&(this._cached.autoMargin=void 0),(t.startsWith("padding")||t.startsWith("border"))&&(this._cached.contentBoxWidth=void 0,this._cached.contentBoxHeight=void 0)}this._cached[t]=void 0}else this._cached={}}ascend(e,t,i="actualParent"){const n=[];let s=this[i];for(;s&&0!==s.id;){if(e){if(e(s))return[s]}else n.push(s);if(s===t)break;s=s[i]}return n}intersectX(e,t="linear"){const i=this[t];return o.aboveRange(e.left,i.left)&&Math.ceil(e.left)<i.right||e.right>Math.ceil(i.left)&&o.belowRange(e.right,i.right)||o.aboveRange(i.left,e.left)&&o.belowRange(i.right,e.right)||o.aboveRange(e.left,i.left)&&o.belowRange(e.right,i.right)}intersectY(e,t="linear"){const i=this[t];return o.aboveRange(e.top,i.top)&&Math.ceil(e.top)<i.bottom||e.bottom>Math.ceil(i.top)&&o.belowRange(e.bottom,i.bottom)||o.aboveRange(i.top,e.top)&&o.belowRange(i.bottom,e.bottom)||o.aboveRange(e.top,i.top)&&o.belowRange(e.bottom,i.bottom)}withinX(e,t="linear"){const i=this[t];return o.aboveRange(i.left,e.left)&&o.belowRange(i.right,e.right)}withinY(e,t="linear"){const i=this[t];return o.aboveRange(i.top,e.top)&&o.belowRange(i.bottom,e.bottom)}outsideX(e,t="linear"){const i=this[t];return i.left<Math.floor(e.left)||Math.floor(i.right)>e.right}outsideY(e,t="linear"){const i=this[t];return i.top<Math.floor(e.top)||Math.floor(i.bottom)>e.bottom}css(e,t,i=!0){return this.styleElement&&t&&(this.style[e]=t,l(t,this.style[e]))?(this._styleMap[e]=t,i&&this.unsetCache(e),t):this._styleMap[e]||this.styleElement&&this.style[e]||""}cssApply(e,t=!0){for(const i in e){const n=e[i];this.css(i,n,t)===n&&t&&this.unsetCache(i)}return this}cssInitial(e,t=!1,i=!1){-1!==this._initial.iteration||t||(i=!0);let n=(t?this._styleMap:this._initial.styleMap)[e];return i&&!n&&(n=this.style[e]),n||""}cssAny(e,...t){for(const i of t)if(this.css(e)===i)return!0;return!1}cssInitialAny(e,...t){for(const i of t)if(this.cssInitial(e)===i)return!0;return!1}cssAscend(e,t=!1,i){let n,s=t?this:this.actualParent;for(;s;){if(""!==(n=s.cssInitial(e)))return i?s.convertPX(n,i):n;if(s.documentBody)break;s=s.actualParent}return""}cssSort(e,t=!0,i=!1){const n=i?this.duplicate():this.children;return n.sort((i,n)=>{const s=i.toFloat(e),a=n.toFloat(e);return s===a?0:t?s<a?-1:1:s>a?-1:1}),n}cssPX(e,t,n=!1,s=!1){const a=this._styleMap[e];if(a&&i.isLength(a)){t+=i.parseUnit(a,this.fontSize),!n&&t<0&&(t=0);const o=i.formatPX(t);return this.css(e,o),s&&this.unsetCache(e),o}return""}cssSpecificity(e){if(this.styleElement){const t=this._element,i=a.getElementCache(this.pseudoElement?t.parentElement:t,`styleSpecificity${c.getPseudoElt(this)}`,this.sessionId);if(i)return i[e]||0}return 0}cssTry(e,t){if(this.styleElement){const i=this.style.getPropertyValue(e);if(i===t)return!0;{const n=this._element;if(n.style.setProperty(e,t),l(t,n.style.getPropertyValue(e)))return a.setElementCache(n,e,this.sessionId,i),!0}}return!1}cssFinally(e){if(this.styleElement){const t=this._element,i=a.getElementCache(t,e,this.sessionId);if(i)return t.style.setProperty(e,i),a.deleteElementCache(t,e,this.sessionId),!0}return!1}toInt(e,t=!1,i=0){const n=parseInt((t?this._initial.styleMap:this._styleMap)[e]);return isNaN(n)?i:n}toFloat(e,t=!1,i=0){const n=parseFloat((t?this._initial.styleMap:this._styleMap)[e]);return isNaN(n)?i:n}parseUnit(e,n=t.CSS.WIDTH,s=!0){if(e){if(i.isPercent(e)){let i=parseFloat(e)/100,a=this;if(s){const e=this.absoluteParent;e&&(a=e)}switch(n){case t.CSS.WIDTH:i*=a.hasPX(n,!1)?a.actualWidth:a.bounds.width;break;case t.CSS.HEIGHT:i*=a.hasPX(n,!1)?a.actualHeight:a.bounds.height;break;default:i*=Math.max(a.actualWidth,a.actualHeight)}return i}return i.parseUnit(e,this.fontSize)}return 0}convertPX(e,i=t.CSS.WIDTH,n=!0){return e.endsWith("px")?e:`${Math.round(this.parseUnit(e,i,n))}px`}has(e,t=0,n){const s=(n&&"initial"===n.map?this._initial.styleMap:this._styleMap)[e];if(s)switch(s){case"auto":case"none":case"initial":case"unset":case"normal":case"transparent":case"rgba(0, 0, 0, 0)":return!1;case"baseline":case"left":case"start":return this.flexElement||!!this.actualParent&&this.actualParent.flexElement;default:if(n&&n.not){if(s===n.not)return!1;if(Array.isArray(n.not))for(const e of n.not)if(s===e)return!1}if(t>0){if(o.hasBit(t,2)&&i.isLength(s))return!0;if(o.hasBit(t,4)&&i.isPercent(s))return!0}return 0===t}return!1}hasPX(e,t=!0,n=!1){const s=(n?this._initial.styleMap:this._styleMap)[e];return!!s&&i.isLength(s,t)}setBounds(e=!0){if(this.styleElement)this._bounds=n.assignRect(a.getClientRect(this._element,this.sessionId,e),!0),this.documentBody&&0===this.marginTop&&(this._bounds.top=0);else if(this.plainText){const t=a.getRangeClientRect(this._element,this.sessionId,e);this._bounds=n.assignRect(t,!0),this._cached.multiline=t.numberOfLines>0}e||(this._box=void 0,this._linear=void 0)}querySelector(e){return this.querySelectorAll(e,1)[0]||null}querySelectorAll(e,t=-1){let n=[];const a=this.queryMap;if(a){const c=i.parseSelectorText(e);for(let e=0;e<c.length;e++){const i=c[e],h=[];let d=-1;e:{let e,t;for(s.CSS.SELECTOR_G.lastIndex=0;null!==(t=s.CSS.SELECTOR_G.exec(i));){let i,n,a,r,l,c,u=t[1],f=!1;if(1===u.length){const t=u.charAt(0);switch(t){case"+":case"~":d--;case">":if(e||0===h.length){h.length=0;break e}e=t;continue;case"*":f=!0}}else if(u.endsWith("|*"))f="*|*"===u;else if("*"===u.charAt(0))u=u.substring(1);else if(u.startsWith("::")){h.length=0;break e}if(!f){let e;for(;null!==(e=s.CSS.SELECTOR_ATTR.exec(u));){void 0===r&&(r=[]);const t="i"===e[6];let i=e[3]||e[4]||e[5]||"";t&&(i=i.toLowerCase()),r.push({key:e[1],symbol:e[2],value:i,caseInsensitive:t}),u=o.spliceString(u,e.index,e[0].length)}if(-1!==u.indexOf("::")){h.length=0;break e}for(;null!==(e=s.CSS.SELECTOR_PSEUDO_CLASS.exec(u));)e[0].startsWith(":not(")?e[1]&&(void 0===c&&(c=[]),c.push(e[1])):(void 0===l&&(l=[]),l.push(e[0])),u=o.spliceString(u,e.index,e[0].length);for(;null!==(e=s.CSS.SELECTOR_LABEL.exec(u));){const t=e[0];switch(t.charAt(0)){case"#":n=t.substring(1);break;case".":void 0===a&&(a=[]),a.push(t.substring(1));break;default:i=t.toUpperCase()}u=o.spliceString(u,e.index,e[0].length)}}(h.length>0||void 0===l)&&d++,h.push({all:f,tagName:i,id:n,adjacent:e,classList:a,pseudoList:l,notList:c,attrList:r}),e=void 0}}let u=a.length;if(h.length&&-1!==d&&d<u){const i=(t,n,a,l)=>{if(n.all)return!0;if(n.tagName&&n.tagName!==t.tagName.toUpperCase())return!1;if(n.id&&n.id!==t.elementId)return!1;if(n.pseudoList){const i=t.actualParent,s=t.tagName;for(const c of n.pseudoList)switch(c){case":first-child":case":nth-child(1)":if(t!==i.firstChild)return!1;break;case":last-child":case":nth-last-child(1)":if(t!==i.lastChild)return!1;break;case":only-child":if(i.naturalElements.length>1)return!1;break;case":only-of-type":{let e=0;for(const t of i.naturalElements)if(t.tagName===s&&++e>1)return!1;break}case":first-of-type":for(const e of i.naturalElements)if(e.tagName===s){if(e!==t)return!1;break}break;case":nth-child(n)":case":nth-last-child(n)":break;case":empty":if(t.element.childNodes.length)return!1;break;case":checked":if(t.inputElement){if(!t.element.checked)return!1}else{if("OPTION"!==s)return!1;if(!t.element.selected)return!1}break;case":enabled":if(t.element.disabled)return!1;break;case":disabled":if(!t.element.disabled)return!1;break;case":read-only":if("INPUT"!==s&&"TEXTAREA"!==s||!t.element.readOnly)return!1;break;case":read-write":if("INPUT"!==s&&"TEXTAREA"!==s||t.element.readOnly)return!1;break;case":required":if(!(t.inputElement&&t.element.required||"BUTTON"===s))return!1;break;case":optional":if(!t.inputElement||"BUTTON"===s||t.element.required)return!1;break;case":in-range":case":out-of-range":if("INPUT"!==s)return!1;{const e=t.element,i=parseFloat(e.value);if(isNaN(i)){if(":in-range"===c)return!1}else{const t=o.convertFloat(e.min),n=o.convertFloat(e.max);if(i>=t&&i<=n){if(":out-of-range"===c)return!1}else if(":in-range"===c)return!1}}break;case":indeterminate":if("INPUT"===s){const e=t.element;switch(e.type){case"checkbox":if(!e.indeterminate)return!1;break;case"radio":if(e.checked)return!1;if(e.name){let t=e.parentElement;for(;t&&"FORM"!==t.tagName;)t=t.parentElement;const i=(t||document).querySelectorAll(`input[type=radio][name="${e.name}"`),n=i.length;for(let e=0;e<n;e++)if(i.item(e).checked)return!1}break;default:return!1}}else{if("PROGRESS"!==s)return!1;if(-1!==t.element.value)return!1}break;case":target":if(""===location.hash)return!1;{const e=t.element;if(location.hash!==`#${e.id}`&&("A"!==s||location.hash!==`#${e.name}`))return!1}break;case":scope":if(!a||">"===l&&t!==this)return!1;break;case":root":if(!a||l)return!1;break;case":link":case":visited":case":hover":case":focus":case":valid":case":invalid":{const n=t.element,s=i.element.querySelectorAll(`:scope > ${c}`);let a=!1;const o=s.length;for(let t=0;t<o;t++)if(s.item(e)===n){a=!0;break}if(!a)return!1;break}default:{let e=r.NTH_CHILD_OFTYPE.exec(c);if(e){const n=e[3].trim();let a=i.naturalElements;e[1]&&(a=a.slice(0).reverse());const l=("child"===e[2]?a.indexOf(t):o.filterArray(a,e=>e.tagName===s).indexOf(t))+1;if(l>0){if(o.isNumber(n)){if(parseInt(n)!==l)return!1}else switch(n){case"even":if(l%2!=0)return!1;break;case"odd":if(l%2==0)return!1;break;default:const e=r.NTH_CHILD_OFTYPE_VALUE.exec(n);if(e){const t=o.convertInt(e[3]);if(e[2]){if(e[1])return!1;const i=parseInt(e[2]);if(0!==i){if(l!==t)for(let e=i;;e+=i){const e=i+t;if(e===l)break;if(e>l)return!1}}else if(l!==t)return!1}else if(e[3]){if(!(t>0))return!1;if(e[1]){if(l>t)return!1}else if(l<t)return!1}}}continue}}else if(e=r.LANG.exec(c)){const i=t.attributes;if(i.lang&&e[1].toLowerCase()===i.lang.toLowerCase())continue}return!1}}}if(n.notList)for(const e of n.notList){const n={all:!1};switch(e.charAt(0)){case".":n.classList=[e];break;case"#":n.id=e.substring(1);break;case":":n.pseudoList=[e];break;case"[":{s.CSS.SELECTOR_ATTR.lastIndex=0;const t=s.CSS.SELECTOR_ATTR.exec(e);if(!t)continue;{const e="i"===t[6];let i=t[3]||t[4]||t[5]||"";e&&(i=i.toLowerCase()),n.attrList=[{key:t[1],symbol:t[2],value:i,caseInsensitive:e}]}break}default:if(!s.CHAR.WORDDASH.test(e))return!1;n.tagName=e}if(i(t,n,a))return!1}if(n.classList){const e=t.element.classList;for(const t of n.classList)if(!e.contains(t))return!1}if(n.attrList){const e=t.attributes;for(const t of n.attrList){let i=e[t.key];if(void 0===i)return!1;if(t.value)if(t.caseInsensitive&&(i=i.toLowerCase()),t.symbol)switch(t.symbol){case"~":if(!i.split(s.CHAR.SPACE).includes(t.value))return!1;break;case"^":if(!i.startsWith(t.value))return!1;break;case"$":if(!i.endsWith(t.value))return!1;break;case"*":if(-1===i.indexOf(t.value))return!1;break;case"|":if(i!==t.value&&!i.startsWith(`${t.value}-`))return!1}else if(i!==t.value)return!1}}return!0},f=h.pop(),g=0===h.length;let p=[];for(let e=d;e<u;e++){const t=a[e];if(f.all)p=p.concat(t);else for(const e of t)i(e,f,g)&&p.push(e)}if(h.length){const e=this.depth;function l(t,n,s){const a=h[t],o=t===u-1,r=[];for(const l of s)if(n){const e=l.actualParent;if(">"===n)i(e,a,o,n)&&r.push(e);else{const t=e.naturalElements;switch(n){case"+":{const e=t.indexOf(l);if(e>0){const s=t[e-1];s&&i(s,a,o,n)&&r.push(s)}break}case"~":{const e=t.length;for(let s=0;s<e;s++){const e=t[s];if(e===l)break;i(e,a,o,n)&&r.push(e)}break}}}}else if(l.depth-e>=u-t){let e=l.actualParent;do{i(e,a,o)&&r.push(e),e=e.actualParent}while(e)}return!!r.length&&(++t===u||l(t,a.adjacent,r))}h.reverse(),u=h.length;for(const e of p)if(l(0,f.adjacent,[e])&&(n.push(e),n.length===t))return n}else{if(0===n.length&&(e===c.length-1||t>=0&&t<=p.length))return t>=0&&p.length>t&&(p.length=t),p;if(n=n.concat(p),t>=0&&n.length>=t)return n.length=t,n}}}}return n}setDimension(e,t,s){const a=this.parseUnit(this._styleMap[e],e);let o=Math.max(a,this.parseUnit(this._styleMap[t],e));if(0===o&&this.styleElement){const t=this._element;switch(t.tagName){case"IMG":case"INPUT":if("image"!==t.type)break;case"TD":case"TH":case"SVG":case"IFRAME":case"VIDEO":case"CANVAS":case"OBJECT":case"EMBED":const s=n.getNamedItem(t,e);""!==s&&(o=this.parseUnit(s,e))>0&&this.css(e,i.isPercent(s)?s:`${s}px`)}}let r=0;return a>0&&!this.imageElement&&(this._styleMap[s]===this._styleMap[e]?delete this._styleMap[s]:(r=this.parseUnit(this._styleMap[s],e))>0&&r<=a&&i.isLength(this._styleMap[e])&&(r=0,this._styleMap[e]=this._styleMap[s],delete this._styleMap[s])),r>0?Math.min(o,r):o}setBoxModel(e){const t=this.unsafe(e);if(t){if(t.width=this.bounds.width,this.plainText)t.height=t.bottom-t.top;else switch(t.height=this.bounds.height,e){case"box":t.width-=this.contentBoxWidth,t.height-=this.contentBoxHeight;break;case"linear":t.width+=(this.marginLeft>0?this.marginLeft:0)+this.marginRight,t.height+=(this.marginTop>0?this.marginTop:0)+this.marginBottom}void 0===this._initial[e]&&(this._initial[e]=n.assignRect(t))}}convertPosition(e){let n=0;if(!this.positionStatic){const s=this.cssInitial(e,!0);i.isLength(s)?n=o.convertFloat(this.convertPX(s,e===t.CSS.LEFT||e===t.CSS.RIGHT?t.CSS.WIDTH:t.CSS.HEIGHT)):i.isPercent(s)&&this.styleElement&&(n=o.convertFloat(this.style[e]))}return n}convertBorderWidth(e){if(this.styleElement){if(this.css(i.BOX_BORDER[e][0])!==t.CSS.NONE){const n=this.css(i.BOX_BORDER[e][1]);let s;switch(n){case"thin":case"medium":case"thick":s=o.convertFloat(this.style[i.BOX_BORDER[e][1]]);break;default:s=this.parseUnit(n,1===e||3===e?t.CSS.WIDTH:t.CSS.HEIGHT)}if(s>0)return Math.max(Math.round(s),1)}}return 0}convertBox(e,i){switch(this.display){case"table":if(!i&&"collapse"===this.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if(i)return 0}const n=this.parseUnit(this.css(e),t.CSS.NONE);if(!i){let t=this.toFloat("paddingInlineStart"),i=this.toFloat("paddingInlineEnd");if(t>0||i>0)return"vertical-rl"===this.css("writingMode")?"ltr"===this.dir?("paddingTop"!==e&&(t=0),"paddingBottom"!==e&&(i=0)):("paddingBottom"!==e&&(t=0),"paddingTop"!==e&&(i=0)):"ltr"===this.dir?("paddingLeft"!==e&&(t=0),"paddingRight"!==e&&(i=0)):("paddingRight"!==e&&(t=0),"paddingLeft"!==e&&(i=0)),t+n+i}return n}set parent(e){e&&(e!==this._parent&&(this._parent&&this._parent.remove(this),this._parent=e),e.contains(this)||e.append(this),-1===this.depth&&(this.depth=e.depth+1))}get parent(){return this._parent}get tagName(){if(void 0===this._cached.tagName){const e=this._element;this._cached.tagName=e?"#"===e.nodeName.charAt(0)?e.nodeName:e.tagName:""}return this._cached.tagName}get element(){return this._element}get elementId(){return this._element?this._element.id:""}get htmlElement(){return void 0===this._cached.htmlElement&&(this._cached.htmlElement=this._element instanceof HTMLElement),this._cached.htmlElement}get svgElement(){return void 0===this._cached.svgElement&&(this._cached.svgElement=this._element instanceof SVGElement),this._cached.svgElement}get styleElement(){return this.htmlElement||this.svgElement}get naturalChild(){return!0}get naturalElement(){return void 0===this._cached.naturalElement&&(this._cached.naturalElement=this.naturalChild&&this.styleElement&&!this.pseudoElement),this._cached.naturalElement}get pseudoElement(){return!1}get imageElement(){return"IMG"===this.tagName}get flexElement(){const e=this.display;return"flex"===e||"inline-flex"===e}get gridElement(){const e=this.display;return"grid"===e||"inline-grid"===e}get textElement(){return this.plainText||this.inlineText}get tableElement(){return"TABLE"===this.tagName||"table"===this.display}get inputElement(){if(void 0===this._cached.inputElement)switch(this.tagName){case"INPUT":case"BUTTON":case"SELECT":case"TEXTAREA":this._cached.inputElement=!0;break;default:this._cached.inputElement=!1}return this._cached.inputElement}get layoutElement(){return this.flexElement||this.gridElement}get plainText(){return"#text"===this.tagName}get lineBreak(){return"BR"===this.tagName}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||n.newBoxRectDimension()}get linear(){if(void 0===this._linear&&this._bounds){if(this._element){const e=this._bounds;this._linear={top:e.top-(this.marginTop>0?this.marginTop:0),right:e.right+this.marginRight,bottom:e.bottom+this.marginBottom,left:e.left-(this.marginLeft>0?this.marginLeft:0),width:0,height:0}}else this._linear=n.assignRect(this._bounds);this.setBoxModel("linear")}return this._linear||n.newBoxRectDimension()}get box(){if(void 0===this._box&&this._bounds){if(this._element){const e=this._bounds;this._box={top:e.top+(this.paddingTop+this.borderTopWidth),right:e.right-(this.paddingRight+this.borderRightWidth),bottom:e.bottom-(this.paddingBottom+this.borderBottomWidth),left:e.left+(this.paddingLeft+this.borderLeftWidth),width:0,height:0}}else this._box=n.assignRect(this._bounds);this.setBoxModel("box")}return this._box||n.newBoxRectDimension()}get dataset(){return this.styleElement?this._element.dataset:(void 0===this._dataset&&(this._dataset={}),this._dataset)}get flexbox(){if(void 0===this._cached.flexbox){const e=this.actualParent,i=this.css("alignSelf"),n=this.css("justifySelf"),s=(t,i,n)=>{const a=(n||this).css(t);return o.isNumber(a)?parseFloat(a):"inherit"===a&&void 0===n&&e?s(t,i,e):i};this._cached.flexbox={alignSelf:i===t.CSS.AUTO&&e&&e.has("alignItems")?e.css("alignItems"):i,justifySelf:n===t.CSS.AUTO&&e&&e.has("justifyItems")?e.css("justifyItems"):n,basis:this.css("flexBasis"),grow:s("flexGrow",0),shrink:s("flexShrink",1),order:this.toInt("order")}}return this._cached.flexbox}get width(){return void 0===this._cached.width&&(this._cached.width=this.setDimension(t.CSS.WIDTH,"minWidth","maxWidth")),this._cached.width}get height(){return void 0===this._cached.height&&(this._cached.height=this.setDimension(t.CSS.HEIGHT,"minHeight","maxHeight")),this._cached.height}get hasWidth(){return this.width>0}get hasHeight(){const e=this.css(t.CSS.HEIGHT);if(i.isPercent(e)){if(this.pageFlow){const t=this.actualParent;if(t&&t.hasHeight)return parseFloat(e)>0}return!1}return this.height>0}get lineHeight(){if(void 0===this._cached.lineHeight)if(this.imageElement||this.svgElement)this._cached.lineHeight=0;else{let e=this.has("lineHeight"),n=0;if(e)n=i.parseUnit(this.css("lineHeight"),this.fontSize);else if(this.naturalChild&&(n=o.convertFloat(this.cssAscend("lineHeight",!1,t.CSS.HEIGHT)),this.styleElement)){const t=this.cssInitial("fontSize");if(t.endsWith("em")){const s=parseFloat(t);s<1&&(this.css("lineHeight",i.formatPX(n*=s)),e=!0)}}this._cached.lineHeight=e||n>this.actualHeight||this.multiline||this.block&&this.naturalChildren.some(e=>e.textElement)?n:0}return this._cached.lineHeight}get display(){return this.css("display")}get positionStatic(){if(void 0===this._cached.positionStatic)switch(this.css("position")){case"fixed":case"absolute":this._cached.positionStatic=!1;break;case"sticky":case"relative":this._cached.positionStatic=!(this.hasPX(t.CSS.TOP)||this.hasPX(t.CSS.RIGHT)||this.hasPX(t.CSS.BOTTOM)||this.hasPX(t.CSS.LEFT)),this._cached.positionStatic&&(this._cached.positionRelative=!1);break;case"inherit":const e=this._element&&this._element.parentElement?i.getInheritedStyle(this._element.parentElement,"position"):"";this._cached.positionStatic=""!==e&&!("absolute"===e||"fixed"===e);break;default:this._cached.positionStatic=!0}return this._cached.positionStatic}get positionRelative(){if(void 0===this._cached.positionRelative){const e=this.css("position");this._cached.positionRelative="relative"===e||"sticky"===e}return this._cached.positionRelative}get positionAuto(){if(void 0===this._cached.positionAuto){const e=-1===this._initial.iteration?this._styleMap:this._initial.styleMap;this._cached.positionAuto=!(this.pageFlow||e.top&&e.top!==t.CSS.AUTO||e.right&&e.right!==t.CSS.AUTO||e.bottom&&e.bottom!==t.CSS.AUTO||e.left&&e.left!==t.CSS.AUTO)}return this._cached.positionAuto}get top(){return void 0===this._cached.top&&(this._cached.top=this.convertPosition(t.CSS.TOP)),this._cached.top}get right(){return void 0===this._cached.right&&(this._cached.right=this.convertPosition(t.CSS.RIGHT)),this._cached.right}get bottom(){return void 0===this._cached.bottom&&(this._cached.bottom=this.convertPosition(t.CSS.BOTTOM)),this._cached.bottom}get left(){return void 0===this._cached.left&&(this._cached.left=this.convertPosition(t.CSS.LEFT)),this._cached.left}get marginTop(){return void 0===this._cached.marginTop&&(this._cached.marginTop=this.inlineStatic?0:this.convertBox("marginTop",!0)),this._cached.marginTop}get marginRight(){return void 0===this._cached.marginRight&&(this._cached.marginRight=this.convertBox("marginRight",!0)),this._cached.marginRight}get marginBottom(){if(void 0===this._cached.marginBottom)if(this.inlineStatic)this._cached.marginBottom=0;else{const e=this.convertBox("marginBottom",!0);this._cached.marginBottom=0===this.bounds.height&&!this.overflowY&&e>0?0:e}return this._cached.marginBottom}get marginLeft(){return void 0===this._cached.marginLeft&&(this._cached.marginLeft=this.convertBox("marginLeft",!0)),this._cached.marginLeft}get borderTopWidth(){return void 0===this._cached.borderTopWidth&&(this._cached.borderTopWidth=this.convertBorderWidth(0)),this._cached.borderTopWidth}get borderRightWidth(){return void 0===this._cached.borderRightWidth&&(this._cached.borderRightWidth=this.convertBorderWidth(1)),this._cached.borderRightWidth}get borderBottomWidth(){return void 0===this._cached.borderBottomWidth&&(this._cached.borderBottomWidth=this.convertBorderWidth(2)),this._cached.borderBottomWidth}get borderLeftWidth(){return void 0===this._cached.borderLeftWidth&&(this._cached.borderLeftWidth=this.convertBorderWidth(3)),this._cached.borderLeftWidth}get paddingTop(){if(void 0===this._cached.paddingTop){const e=this.convertBox("paddingTop",!1);if(this.length&&e>0&&!this.layoutElement){let t=0;for(const e of this.children){if(!e.inline||e.has("lineHeight")){t=0;break}t=Math.max(t,e.paddingTop)}this._cached.paddingTop=Math.max(0,e-t)}else this._cached.paddingTop=this.inlineStatic&&!this.visibleStyle.background?0:e}return this._cached.paddingTop}get paddingRight(){return void 0===this._cached.paddingRight&&(this._cached.paddingRight=this.convertBox("paddingRight",!1)),this._cached.paddingRight}get paddingBottom(){if(void 0===this._cached.paddingBottom){const e=this.convertBox("paddingBottom",!1);if(this.length&&e>0&&!this.layoutElement){let t=0;for(const e of this.children){if(!e.inline||e.has("lineHeight")){t=0;break}t=Math.max(t,e.paddingBottom)}this._cached.paddingBottom=Math.max(0,e-t)}else this._cached.paddingBottom=this.inlineStatic&&!this.visibleStyle.background?0:e}return this._cached.paddingBottom}get paddingLeft(){return void 0===this._cached.paddingLeft&&(this._cached.paddingLeft=this.convertBox("paddingLeft",!1)),this._cached.paddingLeft}get contentBox(){return"border-box"!==this.css("boxSizing")}get contentBoxWidth(){return void 0===this._cached.contentBoxWidth&&(this._cached.contentBoxWidth=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth),this._cached.contentBoxWidth}get contentBoxHeight(){return void 0===this._cached.contentBoxHeight&&(this._cached.contentBoxHeight=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth),this._cached.contentBoxHeight}get inline(){if(void 0===this._cached.inline){const e=this.display;this._cached.inline="inline"===e||("initial"===e||"unset"===e)&&!n.ELEMENT_BLOCK.includes(this.tagName)}return this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement),this._cached.inlineStatic}get inlineVertical(){if(void 0===this._cached.inlineVertical){const e=this.display;this._cached.inlineVertical=(e.startsWith("inline")||"table-cell"===e)&&!this.floating&&!this.plainText}return this._cached.inlineVertical}set inlineText(e){switch(this.tagName){case"INPUT":case"IMG":case"SELECT":case"SVG":case"BR":case"HR":case"TEXTAREA":this._inlineText=!1;break;case"BUTTON":this._inlineText=""!==this.textContent.trim();break;default:this._inlineText=e}}get inlineText(){return this._inlineText}get block(){if(void 0===this._cached.block){switch(this.display){case"block":case"flex":case"grid":case"list-item":this._cached.block=!0;break;case"initial":this._cached.block=n.ELEMENT_BLOCK.includes(this.tagName);break;case"inline":if("svg"===this.tagName&&this.actualParent.htmlElement){this._cached.block=!this.hasPX(t.CSS.WIDTH)&&0===o.convertFloat(n.getNamedItem(this._element,"width"));break}default:this._cached.block=!1}}return this._cached.block}get blockStatic(){return void 0===this._cached.blockStatic&&(this._cached.blockStatic=this.pageFlow&&(this.block&&!this.floating||this.blockDimension&&this.cssInitial(t.CSS.WIDTH)===t.CSS.PERCENT_100&&!this.hasPX("maxWidth"))),this._cached.blockStatic}get blockDimension(){if(void 0===this._cached.blockDimension){const e=this.display;this._cached.blockDimension=this.block||e.startsWith("inline-")||"table"===e||this.imageElement||this.svgElement}return this._cached.blockDimension}get blockVertical(){return void 0===this._cached.blockVertical&&(this._cached.blockVertical=this.blockDimension&&this.hasPX(t.CSS.HEIGHT)),this._cached.blockVertical}get pageFlow(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=this.positionStatic||this.positionRelative),this._cached.pageFlow}get inlineFlow(){if(void 0===this._cached.inlineFlow){const e=this.display;this._cached.inlineFlow=this.inline||e.startsWith("inline")||"table-cell"===e||this.imageElement||this.floating}return this._cached.inlineFlow}get centerAligned(){return void 0===this._cached.centerAligned&&(this._cached.centerAligned=this.autoMargin.leftRight||this.textElement&&this.blockStatic&&this.cssInitial("textAlign")===t.CSS.CENTER||this.inlineStatic&&this.cssAscend("textAlign",!0)===t.CSS.CENTER),this._cached.centerAligned}get rightAligned(){return void 0===this._cached.rightAligned&&(this._cached.rightAligned=this.float===t.CSS.RIGHT||this.autoMargin.left||!this.pageFlow&&this.hasPX(t.CSS.RIGHT)||this.textElement&&this.blockStatic&&this.cssInitial("textAlign")===t.CSS.RIGHT),this._cached.rightAligned}get bottomAligned(){return void 0===this._cached.bottomAligned&&(this._cached.bottomAligned=!this.pageFlow&&this.hasPX(t.CSS.BOTTOM)&&this.bottom>=0),this._cached.bottomAligned}get horizontalAligned(){return void 0===this._cached.horizontalAligned&&(this._cached.horizontalAligned=!(this.blockStatic||this.autoMargin.horizontal||this.blockDimension&&this.css(t.CSS.WIDTH)===t.CSS.PERCENT_100)),this._cached.horizontalAligned}get autoMargin(){if(void 0===this._cached.autoMargin)if(!this.pageFlow||this.blockStatic||"table"===this.display){const e=-1===this._initial.iteration?this._styleMap:this._initial.styleMap,i=e.marginLeft===t.CSS.AUTO&&(this.pageFlow||this.hasPX(t.CSS.RIGHT)),n=e.marginRight===t.CSS.AUTO&&(this.pageFlow||this.hasPX(t.CSS.LEFT)),s=e.marginTop===t.CSS.AUTO&&(this.pageFlow||this.hasPX(t.CSS.BOTTOM)),a=e.marginBottom===t.CSS.AUTO&&(this.pageFlow||this.hasPX(t.CSS.TOP));this._cached.autoMargin={horizontal:i||n,left:i&&!n,right:!i&&n,leftRight:i&&n,vertical:s||a,top:s&&!a,bottom:!s&&a,topBottom:s&&a}}else this._cached.autoMargin={};return this._cached.autoMargin}get floating(){return void 0===this._cached.floating&&(this._cached.floating=!!this.pageFlow&&this.cssAny("float",t.CSS.LEFT,t.CSS.RIGHT)),this._cached.floating}get float(){return void 0===this._cached.float&&(this._cached.float=this.css("float")||t.CSS.NONE),this._cached.float}get zIndex(){return this.toInt("zIndex")}get textContent(){return this.htmlElement||this.plainText?this._element.textContent:""}get src(){return this.htmlElement&&this._element.src||""}get overflow(){if(void 0===this._cached.overflow){let e=0;if(this.styleElement&&!this.documentBody){const i=this._element,n=this.css("overflowX"),s=this.css("overflowY");(this.hasPX(t.CSS.WIDTH)||this.hasPX("maxWidth"))&&("scroll"===n||n===t.CSS.AUTO&&i&&i.clientWidth!==i.scrollWidth)&&(e|=8),this.hasHeight&&(this.hasPX(t.CSS.HEIGHT)||this.hasPX("maxHeight"))&&("scroll"===s||s===t.CSS.AUTO&&i&&i.clientHeight!==i.scrollHeight)&&(e|=16),n!==t.CSS.AUTO&&"hidden"!==n&&"overlay"!==n&&s!==t.CSS.AUTO&&"hidden"!==s&&"overlay"!==s||(e|=64)}this._cached.overflow=e}return this._cached.overflow}get overflowX(){return o.hasBit(this.overflow,8)}get overflowY(){return o.hasBit(this.overflow,16)}get baseline(){return void 0===this._cached.baseline&&(this._cached.baseline=this.pageFlow&&!this.floating&&this.cssAny("verticalAlign","baseline","initial",t.CSS.PX_0,t.CSS.PERCENT_0,"unset")),this._cached.baseline}get verticalAlign(){if(void 0===this._cached.verticalAlign){let e=this.css("verticalAlign");i.isLength(e,!0)&&(e=this.convertPX(e,t.CSS.HEIGHT)),this._cached.verticalAlign=e}return this._cached.verticalAlign}get multiline(){return void 0===this._cached.multiline&&(this._cached.multiline=!!(this.plainText||this._element&&this.inlineText&&(this.inlineFlow||0===this.length))&&a.getRangeClientRect(this._element,this.sessionId).numberOfLines>0),this._cached.multiline}get positiveAxis(){return void 0===this._cached.positiveAxis&&(this._cached.positiveAxis=(!this.positionRelative||this.positionRelative&&this.top>=0&&this.left>=0&&(this.right<=0||this.hasPX(t.CSS.LEFT))&&(this.bottom<=0||this.hasPX(t.CSS.TOP)))&&this.marginTop>=0&&this.marginLeft>=0&&this.marginRight>=0),this._cached.positiveAxis}get backgroundColor(){if(void 0===this._cached.backgroundColor){let e=this.css("backgroundColor");switch(e){case"initial":case"unset":case"rgba(0, 0, 0, 0)":this._cached.backgroundColor="";break;default:if(""!==e&&this.pageFlow&&!this.plainText&&(-1===this._initial.iteration||this.cssInitial("backgroundColor")===e)){let t=this.actualParent;for(;t&&0!==t.id;){const i=t.cssInitial("backgroundColor",!0);if(""!==i){i===e&&(e="");break}t=t.actualParent}}this._cached.backgroundColor=e}}return this._cached.backgroundColor}get backgroundImage(){if(void 0===this._cached.backgroundImage){const e=this.css("backgroundImage");if(""!==e&&e!==t.CSS.NONE)this._cached.backgroundImage=e;else{const e=r.BACKGROUND.exec(this.css("background"));this._cached.backgroundImage=e?e[1]:""}}return this._cached.backgroundImage}get visibleStyle(){if(void 0===this._cached.visibleStyle){const e=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,t=""!==this.backgroundColor,i=""!==this.backgroundImage;this._cached.visibleStyle={background:e||i||t,borderWidth:e,backgroundImage:i,backgroundColor:t,backgroundRepeat:"no-repeat"!==this.css("backgroundRepeat")}}return this._cached.visibleStyle}get percentWidth(){return void 0===this._cached.percentWidth&&(this._cached.percentWidth=i.isPercent(this.cssInitial(t.CSS.WIDTH,!0))),this._cached.percentWidth}get percentHeight(){return void 0===this._cached.percentHeight&&(this._cached.percentHeight=i.isPercent(this.cssInitial(t.CSS.HEIGHT,!0))),this._cached.percentHeight}get absoluteParent(){if(void 0===this._cached.absoluteParent){let e=this.actualParent;if(!this.pageFlow)for(;e&&0!==e.id;){const t=e.cssInitial("position",!1,!0);if(e.documentBody||"static"!==t&&"initial"!==t&&"unset"!==t)break;e=e.actualParent}this._cached.absoluteParent=e||null}return this._cached.absoluteParent}set actualParent(e){this._cached.actualParent=e}get actualParent(){if(void 0===this._cached.actualParent){const e=this.element;this._cached.actualParent=e&&e.parentElement&&a.getElementAsNode(e.parentElement,this.sessionId)||null}return this._cached.actualParent}get actualWidth(){if(void 0===this._cached.actualWidth){if(this.plainText)this._cached.actualWidth=this.bounds.right-this.bounds.left;else{const e=this.actualParent;if(e&&!e.flexElement&&"table-cell"!==this.display){let e=this.parseUnit(this.cssInitial(t.CSS.WIDTH,!0));if(e>0){const t=this.parseUnit(this.css("maxWidth"));return t>0&&(e=Math.min(e,t)),this.contentBox&&!this.tableElement&&(e+=this.contentBoxWidth),this._cached.actualWidth=e,e}}}this._cached.actualWidth=this.bounds.width}return this._cached.actualWidth}get actualHeight(){if(void 0===this._cached.actualHeight){const e=this.actualParent;if(!this.plainText&&e&&!e.flexElement&&"table-cell"!==this.display){let e=this.parseUnit(this.cssInitial(t.CSS.HEIGHT,!0),t.CSS.HEIGHT);if(e>0){const t=this.parseUnit(this.css("maxHeight"));return t>0&&(e=Math.min(e,t)),this.contentBox&&!this.tableElement&&(e+=this.contentBoxHeight),this._cached.actualHeight=e,e}}this._cached.actualHeight=this.bounds.height}return this._cached.actualHeight}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}set naturalChildren(e){this._naturalChildren=e}get naturalChildren(){if(void 0===this._naturalChildren)if(this.naturalElement){const e=[];let t=0;this._element.childNodes.forEach(i=>{const n=a.getElementAsNode(i,this.sessionId);n&&(n.childIndex=t++,e.push(n))}),this._naturalChildren=e}else-1===this._initial.iteration&&this.saveAsInitial(),this._naturalChildren=this._initial.children;return this._naturalChildren}set naturalElements(e){this._naturalElements=e}get naturalElements(){return void 0===this._naturalElements&&(this._naturalElements=o.filterArray(this.naturalChildren,e=>e.naturalElement)),this._naturalElements}get firstChild(){return this.naturalElements[0]||null}get lastChild(){const e=this.naturalElements,t=e.length;return t?e[t-1]:null}get previousSibling(){const e=this.actualParent;return e&&e.naturalChildren[this.childIndex-1]||null}get nextSibling(){const e=this.actualParent;return e&&e.naturalChildren[this.childIndex+1]||null}get previousElementSibling(){const e=this.actualParent;if(e){const t=e.naturalElements,i=t.indexOf(this);if(i>0)return t[i-1]}return null}get nextElementSibling(){const e=this.actualParent;if(e){const t=e.naturalElements,i=t.indexOf(this);if(i<t.length-1)return t[i+1]}return null}get attributes(){if(void 0===this._cached.attributes){const e={};if(this.styleElement){const t=this._element.attributes,i=t.length;for(let n=0;n<i;n++){const i=t.item(n);e[i.name]=i.value}}this._cached.attributes=e}return this._cached.attributes}get fontSize(){return 0===this._fontSize&&(this._fontSize=this.styleElement&&!this.pseudoElement?parseFloat(this.style.getPropertyValue("font-size")):i.parseUnit(this.css("fontSize"))),this._fontSize||parseFloat(i.getStyle(document.body).getPropertyValue("font-size"))}set dir(e){this._cached.dir=e}get dir(){if(void 0===this._cached.dir){let e=this.naturalElement?this._element.dir:"";switch(e){case"ltr":case"rtl":break;default:let t=this.actualParent;for(;t;){if(e=t.dir){this._cached.dir=e;break}t=t.actualParent}}this._cached.dir=e||document.body.dir}return this._cached.dir}get center(){return{x:(this.bounds.left+this.bounds.right)/2,y:(this.bounds.top+this.bounds.bottom)/2}}get extensions(){return void 0===this._cached.extensions&&(this._cached.extensions=this.dataset.use?o.spliceArray(this.dataset.use.split(s.XML.SEPARATOR),e=>""===e):[]),this._cached.extensions}}class h extends squared.lib.base.Container{constructor(e){super(e),this._currentId=0}append(e,t=!0){return super.append(e),t&&this.afterAppend&&this.afterAppend.call(this,e),this}reset(){return this._currentId=0,this.clear(),this}get nextId(){return++this._currentId}}const{regex:d,util:u}=squared.lib;class f{reset(){for(const e in f.ASSETS)f.ASSETS[e].clear();this.fileHandler&&this.fileHandler.reset()}addImage(e){if(e&&e.complete){if(e.src.startsWith("data:image/")){const t=RegExp(`^${d.STRING.DATAURI}$`).exec(e.src);t&&t[1]&&t[2]&&this.addRawData(e.src,t[1],t[2],t[3],e.naturalWidth,e.naturalHeight)}const t=e.src;""!==t&&f.ASSETS.images.set(t,{width:e.naturalWidth,height:e.naturalHeight,uri:t})}}getImage(e){return f.ASSETS.images.get(e)}addFont(e){const t=f.ASSETS.fonts.get(e.fontFamily)||[];t.push(e),f.ASSETS.fonts.set(e.fontFamily,t)}getFont(e,t="normal",i){const n=f.ASSETS.fonts.get(e);if(n){const e=this.application.controllerHandler.localSettings.supported.fontFormat;return n.find(n=>n.fontStyle===t&&(void 0===i||n.fontWeight===parseInt(i))&&("*"===e||e.includes(n.srcFormat)))}}addRawData(e,t,i,n,s=0,a=0){t=t.toLowerCase(),i=i.toLowerCase();const o=this.application.controllerHandler.localSettings.supported.imageFormat;let r;"base64"===i?(r=n,"image/svg+xml"===t&&(n=window.atob(n))):n=n.replace(/\\(["'])/g,(e,...t)=>t[0]);const l=()=>u.buildAlphaString(5).toLowerCase()+"_"+(new Date).getTime(),c=e.startsWith(location.origin)?e.substring(location.origin.length+1,e.lastIndexOf("/")):"";let h;if("*"===o)if(e.startsWith(location.origin))h=u.fromLastIndexOf(e,"/");else{let e=t.split("/").pop();"svg+xml"===e&&(e="svg"),h=l()+"."+e}else for(const i of o)if(-1!==t.indexOf(i)){h=e.endsWith(`.${i}`)?u.fromLastIndexOf(e,"/"):l()+"."+i;break}return h?(f.ASSETS.rawData.set(e,{pathname:c,filename:h,content:n,base64:r,mimeType:t,width:s,height:a}),h):""}getRawData(e){if(e.startsWith("url(")){const t=d.CSS.URL.exec(e);t&&(e=t[1])}return f.ASSETS.rawData.get(e)}setFileHandler(e){e.resource=this,this.fileHandler=e}}f.ASSETS={ids:new Map,images:new Map,fonts:new Map,rawData:new Map};const{css:g,dom:p,regex:m,session:b,util:S}=squared.lib,x=f.ASSETS,T={};let y;function _(e,t){const i=RegExp(`^@${e}([^{]+)`).exec(t);return i&&(t=i[1].trim()),t}class C{constructor(e,t,i,n,s){this.framework=e,this.initializing=!1,this.closed=!1,this.rootElements=new Set,this.session={active:[]},this.processing={cache:new h,excluded:new h,sessionId:""},this._cascadeAll=!1,y=t;const a=this.processing.cache;this.controllerHandler=new i(this,a),this.resourceHandler=new n(this,a),this.extensionManager=new s(this,a)}saveAllToDisk(){const e=this.resourceHandler.fileHandler;e&&e.saveAllToDisk()}reset(){this.session.active.length=0;const e=this.processing;e.cache.reset(),e.excluded.clear(),e.sessionId="",this.controllerHandler.reset();for(const e of this.extensions)e.subscribers.clear();this.closed=!1}parseDocument(...e){const t=this.controllerHandler,i=this.resourceHandler;let n;this.rootElements.clear(),this.initializing=!1,this.processing.sessionId=t.generateSessionId,this.session.active.push(this.processing.sessionId),t.init(),this.setStyleMap(),0===e.length&&e.push(document.body);for(const t of e){let e;if("string"==typeof t)e=document.getElementById(t);else{if(!g.hasComputedStyle(t))continue;e=t}e&&this.rootElements.add(e)}const s=this.rootElements.values().next().value,a=[],o=()=>{this.initializing=!1;for(const e of a)e.parentElement&&s.removeChild(e);a.length=0;for(const e of this.extensions)e.beforeParseDocument();for(const e of this.rootElements)this.createCache(e)&&this.afterCreateCache(e);for(const e of this.extensions)e.afterParseDocument();"function"==typeof n&&n.call(this)},r=this.userSettings.preloadImages,l=[];if(r){for(const e of this.rootElements)e.querySelectorAll("input[type=image]").forEach(e=>{const t=e.src;""!==t&&x.images.set(t,{width:e.width,height:e.height,uri:t})}),e.querySelectorAll("svg image").forEach(e=>{const t=S.resolvePath(e.href.baseVal);""!==t&&x.images.set(t,{width:e.width.baseVal.value,height:e.height.baseVal.value,uri:t})});for(const e of x.images.values())if(e.uri)if(e.uri.toLowerCase().endsWith(".svg"))l.push(e.uri);else if(0===e.width&&0===e.height){const t=document.createElement("img");t.src=e.uri,t.complete&&t.naturalWidth>0&&t.naturalHeight>0?(e.width=t.naturalWidth,e.height=t.naturalHeight):(s.appendChild(t),a.push(t))}}for(const[e,t]of x.rawData.entries())if(t.mimeType&&t.mimeType.startsWith("image/")&&!t.mimeType.endsWith("svg+xml")){const i=document.createElement("img");i.src=`data:${t.mimeType};`+(t.base64?`base64,${t.base64}`:t.content),i.complete&&i.naturalWidth>0&&i.naturalHeight>0?(t.width=i.naturalWidth,t.height=i.naturalHeight,x.images.set(e,{width:t.width,height:t.height,uri:t.filename})):(document.body.appendChild(i),a.push(i))}for(const e of this.rootElements)e.querySelectorAll("img").forEach(e=>{"IMG"===e.tagName&&(e.src.toLowerCase().endsWith(".svg")?r&&l.push(e.src):e.complete?i.addImage(e):r&&l.push(e))});l.length?(this.initializing=!0,Promise.all(S.objectMap(l,e=>new Promise((t,i)=>{"string"==typeof e?t(function(e){return __awaiter(this,void 0,void 0,function*(){return(yield fetch(e,{method:"GET",headers:new Headers({Accept:"application/xhtml+xml, image/svg+xml","Content-Type":"image/svg+xml"})})).text()})}(e)):(e.addEventListener("load",()=>t(e)),e.addEventListener("error",()=>i(e)))}))).then(e=>{const t=e.length;for(let n=0;n<t;n++){const t=e[n];"string"==typeof t?"string"==typeof l[n]&&i.addRawData(l[n],"image/svg+xml","utf8",t):i.addImage(t)}o()}).catch(e=>{const t=e.target?e.target.src:e.message;this.userSettings.showErrorMessages&&S.isString(t)&&!confirm(`FAIL: ${t}`)||o()})):o();return new class{then(e){l.length?n=e:e()}}}createCache(e){const t=this.createRootNode(e);if(t){const e=this.processing.cache;t.parent.setBounds();for(const t of e)t.setBounds(),t.saveAsInitial();return this.controllerHandler.sortInitialCache(e),!0}return!1}createNode(e,t=!0,i,n){const s=new y(this.nextId,this.processing.sessionId,e,this.controllerHandler.afterInsertNode);if(i&&(s.depth=i.depth+1),n)for(const e of n)e.parent=s;return t&&this.processing.cache.append(s,void 0!==n),s}insertNode(e,t){this.controllerHandler.applyDefaultStyles(e);const i=this.createNode(e,!1);return i.plainText&&c.copyTextStyle(i,t),i}toString(){return""}createRootNode(e){const t=this.processing;t.cache.clear(),t.excluded.clear(),this._cascadeAll=!1;const i=this.cascadeParentNode(e);if(i){const n=new y(0,t.sessionId,e.parentElement||document.body,this.controllerHandler.afterInsertNode);i.parent=n,i.actualParent=n,i.childIndex=0,i.documentRoot=!0}return t.node=i,t.cache.afterAppend=void 0,i}cascadeParentNode(e,t=0){const i=this.insertNode(e);if(i){const n=this.controllerHandler,s=this.processing,a=s.cache;if(i.depth=t,0===t&&a.append(i),n.preventNodeCascade(e))return i;const o=e.childNodes,r=o.length,l=Array(r),c=Array(e.childElementCount),h=this.userSettings.createQuerySelectorMap&&e.childElementCount?[[]]:void 0;let d=!0,u=0,f=0;for(let e=0;e<r;e++){const r=o[e];let g;"#"===r.nodeName.charAt(0)?p.isPlainText(r)&&(g=this.insertNode(r,i)):n.includeElement(r)?(g=this.cascadeParentNode(r,t+1))&&(c[f++]=g,h&&(h[0].push(g),this.appendQueryMap(h,t,g)),a.append(g),d=!1):(g=this.insertNode(r))&&(s.excluded.append(g),d=!1),g&&(g.parent=i,g.actualParent=i,g.childIndex=u,l[u++]=g)}l.length=u,c.length=f,i.naturalChildren=l,i.naturalElements=c,i.inlineText=d,h&&h[0].length&&(i.queryMap=h)}return i}appendQueryMap(e,t,i){const n=i.queryMap;if(n){const s=i.depth-t,a=n.length;for(let t=0;t<a;t++){const i=t+s;void 0===e[i]&&(e[i]=[]),e[i]=e[i].concat(n[t])}}}setStyleMap(){let e=!1;const t=i=>{try{const n=i.cssRules;if(n){const e=n.length;for(let i=0;i<e;i++){const e=n[i];switch(e.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(e);break;case CSSRule.IMPORT_RULE:t(e.styleSheet);break;case CSSRule.MEDIA_RULE:g.validMediaRule(e.conditionText||_("media",e.cssText))&&this.applyCSSRuleList(e.cssRules);break;case CSSRule.SUPPORTS_RULE:CSS.supports&&CSS.supports(e.conditionText||_("supports",e.cssText))&&this.applyCSSRuleList(e.cssRules)}}}}catch(t){this.userSettings.showErrorMessages&&!e&&(alert("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+`${i.href}\n\n${t}`),e=!0)}},i=document.styleSheets,n=i.length;for(let e=0;e<n;e++)t(i[e])}applyCSSRuleList(e){const t=e.length;for(let i=0;i<t;i++)this.applyStyleRule(e[i])}applyStyleRule(e){const t=this.resourceHandler,i=this.processing.sessionId;switch(e.type){case CSSRule.STYLE_RULE:{const n=[];for(const t of Array.from(e.style))n.push(S.convertCamelCase(t));for(const s of g.parseSelectorText(e.selectorText)){const a=g.getSpecificity(s),[o,r]=s.split("::"),l=r?"::"+r:"";document.querySelectorAll(o||"*").forEach(s=>{const o=g.getStyle(s,l),r={};for(const t of n){const i=g.checkStyleValue(s,t,e.style[t],o);i&&(r[t]=i)}[r.backgroundImage,r.listStyleImage,r.content].forEach(e=>{if(e){let i;for(void 0===T.DATAURI?T.DATAURI=RegExp(`url\\("(${m.STRING.DATAURI})"\\),?\\s*`,"g"):T.DATAURI.lastIndex=0;null!==(i=T.DATAURI.exec(e));)if(i[2]&&i[3])t.addRawData(i[1],i[2],i[3],i[4]);else if(this.userSettings.preloadImages){const e=S.resolvePath(i[4]);""!==e&&void 0===t.getImage(e)&&x.images.set(e,{width:0,height:0,uri:e})}}});const c=`styleMap${l}`,h=`styleSpecificity${l}`,d=b.getElementCache(s,c,i);if(d){const e=b.getElementCache(s,h,i)||{};for(const t in r)(void 0===e[t]||a>=e[t])&&(d[t]=r[t],e[t]=a)}else{const e={};for(const t in r)e[t]=a;b.setElementCache(s,`style${l}`,"0",o),b.setElementCache(s,"sessionId","0",i),b.setElementCache(s,c,i,r),b.setElementCache(s,h,i,e)}})}break}case CSSRule.FONT_FACE_RULE:{void 0===T.FONT_FACE&&(T.FONT_FACE=/\s*@font-face\s*{([^}]+)}\s*/,T.FONT_FAMILY=/\s*font-family:[^\w]*([^'";]+)/,T.FONT_SRC=/\s*src:\s*([^;]+);/,T.FONT_STYLE=/\s*font-style:\s*(\w+)\s*;/,T.FONT_WEIGHT=/\s*font-weight:\s*(\d+)\s*;/,T.URL=/\s*(url|local)\(['"]([^'")]+)['"]\)\s*format\(['"](\w+)['"]\)\s*/);const i=T.FONT_FACE.exec(e.cssText);if(i){const e=T.FONT_FAMILY.exec(i[1]),n=T.FONT_SRC.exec(i[1]);if(e&&n){const s=T.FONT_STYLE.exec(i[1]),a=T.FONT_WEIGHT.exec(i[1]),o=e[1].trim(),r=s?s[1].toLowerCase():"normal",l=a?parseInt(a[1]):400;for(const e of n[1].split(m.XML.SEPARATOR)){const i=T.URL.exec(e);if(i){let e,n;"url"===i[1]?e=S.resolvePath(i[2].trim()):n=i[2].trim(),t.addFont({fontFamily:o,fontWeight:l,fontStyle:r,srcUrl:e,srcLocal:n,srcFormat:i[3].toLowerCase().trim()})}}}}break}}}get nextId(){return this.processing.cache.nextId}get length(){return 0}}class E{preventNodeCascade(e){return!1}get generateSessionId(){return""+(new Date).getTime()}}class v{constructor(e,t,i){this.name=e,this.framework=t,this.options={},this.dependencies=[],this.subscribers=new Set,i&&Object.assign(this.options,i)}require(e,t=!1){this.dependencies.push({name:e,preload:t})}beforeParseDocument(){}afterParseDocument(){}}const A=squared.lib.util;const{constant:I,util:w}=squared.lib;class R{constructor(){this.assets=[]}static getMimeType(e){switch(e.toLowerCase()){case"aac":return"audio/aac";case"abw":return"application/x-abiword";case"arc":return"application/x-freearc";case"avi":return"video/x-msvideo";case"azw":return"application/vnd.amazon.ebook";case"bin":return"application/octet-stream";case"bmp":return"image/bmp";case"bz":return"application/x-bzip";case"bz2":return"application/x-bzip2";case"csh":return"application/x-csh";case"css":return"text/css";case"csv":return"text/csv";case"doc":return"application/msword";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"eot":return"application/vnd.ms-fontobject";case"epub":return"application/epub+zip";case"gif":return"image/gif";case"htm":case"html":return"text/html";case"ico":return"image/vnd.microsoft.icon";case"ics":return"text/calendar";case"jar":return"application/java-archive";case"jpeg":case"jpg":return"image/jpeg";case"js":case"mjs":return"text/javascript";case"json":return"application/json";case"jsonld":return"application/ld+json";case"mid":case"midi":return"audio/midi";case"mp3":return"audio/mpeg";case"mpeg":return"video/mpeg";case"mpkg":return"application/vnd.apple.installer+xml";case"odp":return"application/vnd.oasis.opendocument.presentation";case"ods":return"application/vnd.oasis.opendocument.spreadsheet";case"odt":return"application/vnd.oasis.opendocument.text";case"oga":return"audio/ogg";case"ogv":return"video/ogg";case"ogx":return"application/ogg";case"otf":return"font/otf";case"png":return"image/png";case"pdf":return"application/pdf";case"ppt":return"application/vnd.ms-powerpoint";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"rar":return"application/x-rar-compressed";case"rtf":return"application/rtf";case"sh":return"application/x-sh";case"svg":return"image/svg+xml";case"swf":return"application/x-shockwave-flash";case"tar":return"application/x-tar";case"tif":case"tiff":return"image/tiff";case"ts":return"video/mp2t";case"ttf":return"font/ttf";case"txt":return"text/plain";case"vsd":return"application/vnd.visio";case"wav":return"audio/wav";case"weba":return"audio/webm";case"webm":return"video/webm";case"webp":return"image/webp";case"woff":return"font/woff";case"woff2":return"font/woff2";case"xhtml":return"application/xhtml+xml";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xml":return"text/xml";case"xul":return"application/vnd.mozilla.xul+xml";case"zip":return"application/zip";case"3gp":return"video/3gpp";case".3g2":return"video/3gpp2";case".7z":return"application/x-7z-compressed";default:return""}}static downloadToDisk(e,t,i){const n=new Blob([e],{type:i||"application/octet-stream"}),s=window.URL.createObjectURL(n),a=document.createElement("a");a.style.setProperty("display",I.CSS.NONE),a.setAttribute("href",s),a.setAttribute("download",t),a.download||a.setAttribute("target","_blank"),document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>window.URL.revokeObjectURL(s),1)}saveAllToDisk(){this.saveToDisk(this.assets,this.userSettings.outputArchiveName)}addAsset(e){if(e.content||e.uri||e.base64){const t=this.assets.findIndex(t=>t.pathname===e.pathname&&t.filename===e.filename);-1!==t?Object.assign(this.assets[t],e):this.assets.push(e)}}reset(){this.assets.length=0}saveToDisk(e,t){if(location.protocol.startsWith("http")){if(e.length){const i=this.userSettings;e=e.concat(this.assets),fetch("/api/savetodisk"+`?directory=${encodeURIComponent(w.trimString(i.outputDirectory,"/"))}`+(t?`&filename=${encodeURIComponent(t.trim())}`:"")+`&format=${i.outputArchiveFormat.toLowerCase()}`+`&timeout=${(""+i.outputArchiveTimeout).trim()}`,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e&&(e.zipname?fetch(`/api/downloadtobrowser?filename=${encodeURIComponent(e.zipname)}`).then(e=>e.blob()).then(t=>R.downloadToDisk(t,w.fromLastIndexOf(e.zipname,"/"))):e.system&&this.userSettings.showErrorMessages&&alert(`${e.application}\n\n${e.system}`))}).catch(e=>{this.userSettings.showErrorMessages&&alert(`ERROR: ${e}`)})}}else this.userSettings.showErrorMessages&&alert("SERVER (required): See README for instructions")}}const k={EXT_DATA:"mainData",TOP_BOTTOM:"topBottom",BOTTOM_TOP:"bottomTop",LEFT_RIGHT:"leftRight",RIGHT_LEFT:"rightLeft"},B=new Map([[2,"marginTop"],[4,"marginRight"],[8,"marginBottom"],[16,"marginLeft"],[32,"paddingTop"],[64,"paddingRight"],[128,"paddingBottom"],[256,"paddingLeft"]]),P={ACCESSIBILITY:"squared.accessibility",CSS_GRID:"squared.css-grid",EXTERNAL:"squared.external",FLEXBOX:"squared.flexbox",GRID:"squared.grid",LIST:"squared.list",RELATIVE:"squared.relative",SPRITE:"squared.sprite",SUBSTITUTE:"squared.substitute",TABLE:"squared.table",VERTICAL_ALIGN:"squared.verticalalign",WHITESPACE:"squared.whitespace"};var N,L,O,M=Object.freeze({STRING_BASE:k,CSS_SPACING:B,EXT_NAME:P});!function(e){e[e.DOM_TRAVERSE=2]="DOM_TRAVERSE",e[e.EXTENSION=4]="EXTENSION",e[e.RENDER=8]="RENDER",e[e.ALL=14]="ALL"}(N||(N={})),function(e){e[e.BOX_STYLE=2]="BOX_STYLE",e[e.BOX_SPACING=4]="BOX_SPACING",e[e.FONT_STYLE=8]="FONT_STYLE",e[e.VALUE_STRING=16]="VALUE_STRING",e[e.IMAGE_SOURCE=32]="IMAGE_SOURCE",e[e.ASSET=56]="ASSET",e[e.ALL=126]="ALL"}(L||(L={})),function(e){e[e.CONSTRAINT=2]="CONSTRAINT",e[e.LAYOUT=4]="LAYOUT",e[e.ALIGNMENT=8]="ALIGNMENT",e[e.ACCESSIBILITY=16]="ACCESSIBILITY",e[e.LOCALIZATION=32]="LOCALIZATION",e[e.CUSTOMIZATION=64]="CUSTOMIZATION",e[e.ALL=126]="ALL"}(O||(O={}));var H=Object.freeze({get APP_SECTION(){return N},get NODE_RESOURCE(){return L},get NODE_PROCEDURE(){return O}});const{constant:W,css:D,dom:F,math:X,session:U,util:G}=squared.lib,z=Array.from(B.keys()),V=["position","display","verticalAlign","float","clear","zIndex"];class $ extends c{constructor(){super(...arguments),this.alignmentType=0,this.baselineActive=!1,this.baselineAltered=!1,this.positioned=!1,this.rendered=!1,this.excluded=!1,this.controlId="",this.floatContainer=!1,this.containerIndex=1/0,this.lineBreakLeading=!1,this.lineBreakTrailing=!1,this._excludeSection=0,this._excludeProcedure=0,this._excludeResource=0,this._visible=!0}static outerRegion(e){let t=1/0,i=-1/0,n=-1/0,s=1/0;return e.each(e=>{let a,o,r,l;e.companion?(a=e.actualRect(W.CSS.TOP),o=e.actualRect(W.CSS.RIGHT),r=e.actualRect(W.CSS.BOTTOM),l=e.actualRect(W.CSS.LEFT)):(a=e.linear.top,o=e.linear.right,r=e.linear.bottom,l=e.linear.left),a<t&&(t=a),o>i&&(i=o),r>n&&(n=r),l<s&&(s=l)}),{top:t,right:i,bottom:n,left:s}}static baseline(e,t=!1){return(e=G.filterArray(e,e=>!(!e.baseline&&!D.isLength(e.verticalAlign)||t&&!e.textElement)&&(!e.floating&&!e.baselineAltered&&(e.naturalChild&&0===e.length||!e.layoutVertical&&e.every(e=>e.baseline&&!e.multiline))))).length>1&&e.sort((e,t)=>{if(e.length&&0===t.length)return 1;if(t.length&&0===e.length)return-1;let i=e.baselineHeight,n=t.baselineHeight;if(0!==e.marginTop){if(!(e.imageElement||i>=n||e.marginTop<0))return e.marginTop>(n-i)/2?-1:1;i+=e.marginTop}if(0!==t.marginTop){if(!(t.imageElement||n>=i||t.marginTop<0))return t.marginTop>(i-n)/2?1:-1;n+=t.marginTop}return X.isEqual(i,n)?e.inputElement&&t.inputElement&&e.containerType!==t.containerType?e.containerType>t.containerType?-1:1:e.bounds.bottom>t.bounds.bottom?-1:e.bounds.bottom<t.bounds.bottom?1:0:i>n?-1:1}),e.shift()||null}static linearData(e,t=!1){const i=new Set,n=new Map;let s=!1,a=!1;if(e.length>1){const o=[],r=new Set,l={};for(const t of e)if(t.pageFlow){if(r.size){const e=[],i=t.css("clear");switch(i){case W.CSS.LEFT:e.push(l.left);break;case W.CSS.RIGHT:e.push(l.right);break;case"both":e.push(l.left,l.right)}for(const i of e)i&&r.has(i.float)&&!t.floating&&G.aboveRange(t.linear.top,i.linear.bottom)&&(r.delete(i.float),l[i.float]=void 0);"both"===i?(n.set(t,2===r.size?"both":r.values().next().value),r.clear(),l.left=void 0,l.right=void 0):r.has(i)&&(n.set(t,i),r.delete(i),l[i]=void 0)}t.floating&&(r.add(t.float),i.add(t.float),l[t.float]=t),o.push(t)}else t.positionAuto&&o.push(t);const c=o.length;if(c&&!t){const e=[o[0]];let t=1,r=1;for(let i=1;i<c;i++)o[i].alignedVertically(e,n)?r++:t++,e.push(o[i]);if(a=r===c,(s=t===c)&&i.size){let e=1/0,t=-1/0,i=-1/0,n=1/0;for(const s of o)e=Math.min(e,s.linear.left),t=Math.max(t,s.linear.right),s.floating&&(s.float===W.CSS.LEFT?i=Math.max(i,s.linear.right):n=Math.min(n,s.linear.left));for(let a=0,r=0,l=0,h=0,d=0;a<c;a++){const c=o[a];if(Math.floor(c.linear.left)<=e&&r++,Math.ceil(c.linear.right)>=t&&l++,c.floating||(c.linear.left===i&&h++,c.linear.right===n&&d++),0===a)continue;if(2===r||2===l||2===h||2===d){s=!1;break}const u=o[a-1];if(u.floating&&G.aboveRange(c.linear.top,u.linear.bottom)||G.withinRange(c.linear.left,u.linear.left)){s=!1;break}}}}}else e.length&&(s=!(a=e[0].blockStatic));return{linearX:s,linearY:a,cleared:n,floated:i}}static partitionRows(e){const t=e[0].actualParent,i=t&&t.floatContainer?$.linearData(t.naturalElements,!0).cleared:void 0,n=[];let s=[],a=[];const o=e.length;for(let t=0;t<o;t++){const o=e[t];let r=o;if(!o.naturalChild){if(o.nodeGroup){s.length&&n.push(s),n.push([o]),s=[],a.length=0;continue}let e=o.innerWrapped;for(;e;){if(e.naturalChild){r=e;break}e=e.innerWrapped}}0===s.length?(s.push(o),a.push(r)):r.alignedVertically(a,i)?(s.length&&n.push(s),s=[o],a=[r]):(s.push(o),a.push(r))}return s.length&&n.push(s),n}is(e){return this.containerType===e}of(e,...t){return this.containerType===e&&t.some(e=>this.hasAlign(e))}attr(e,t,i,n=!0){let s=this[`__${e}`];return i?(void 0===s&&(this._namespaces.includes(e)||this._namespaces.push(e),this[`__${e}`]=s={}),!n&&s[t]?"":(s[t]=""+i,s[t])):s&&s[t]||""}namespace(e){return this[`__${e}`]||{}}delete(e,...t){const i=this[`__${e}`];if(i)for(const e of t)if(-1!==e.indexOf("*"))for(const[t]of G.searchObject(i,e))delete i[t];else delete i[e]}apply(e){for(const t in e){const i=e[t];if("object"==typeof i){for(const e in i)this.attr(t,e,i[e]);delete e[t]}}}render(e){this.renderParent=e,this.rendered=!0}renderEach(e){const t=this.renderChildren,i=t.length;for(let n=0;n<i;n++){const i=t[n];i.visible&&e(i,n,t)}return this}renderFilter(e){return G.filterArray(this.renderChildren,e)}hide(e){this.rendered=!0,this.visible=!1;const t=this.renderParent;if(t&&t.renderTemplates){const e=t.renderChildren.findIndex(e=>e===this);if(-1!==e){const i=t.renderTemplates[e];i&&i.node===this&&(t.renderTemplates[e]=null)}}}inherit(e,...t){const i=e.unsafe("initial");for(const n of t)switch(n){case"base":this._documentParent=e.documentParent,this._bounds=F.assignRect(e.bounds),this._linear=F.assignRect(e.linear),this._box=F.assignRect(e.box),this._boxReset=F.newBoxModel(),this._boxAdjustment=F.newBoxModel(),-1===this.depth&&(this.depth=e.depth);const t=e.actualParent;t&&(this.actualParent=t,this.dir=t.dir);break;case"initial":G.cloneObject(i,this.initial);break;case"alignment":this.positionAuto=e.positionAuto;for(const t of V)this._styleMap[t]=e.css(t),this._initial.styleMap[t]=i.styleMap[t];if(!this.positionStatic)for(const t of D.BOX_POSITION)e.hasPX(t)&&(this._styleMap[t]=e.css(t)),this._initial.styleMap[t]=i.styleMap[t];if(e.autoMargin.horizontal||e.autoMargin.vertical)for(const t of D.BOX_MARGIN)e.cssInitial(t)===W.CSS.AUTO&&(this._styleMap[t]=W.CSS.AUTO,this._initial.styleMap[t]=W.CSS.AUTO);break;case"styleMap":G.assignEmptyProperty(this._styleMap,e.unsafe("styleMap"));break;case"textStyle":$.copyTextStyle(this,e)}}addAlign(e){this.hasAlign(e)||(this.alignmentType|=e)}removeAlign(e){this.hasAlign(e)&&(this.alignmentType^=e)}hasAlign(e){return G.hasBit(this.alignmentType,e)}hasResource(e){return!G.hasBit(this.excludeResource,e)}hasProcedure(e){return!G.hasBit(this.excludeProcedure,e)}hasSection(e){return!G.hasBit(this.excludeSection,e)}exclude(e=0,t=0,i=0){e>0&&!G.hasBit(this._excludeResource,e)&&(this._excludeResource|=e),t>0&&!G.hasBit(this._excludeProcedure,t)&&(this._excludeProcedure|=t),i>0&&!G.hasBit(this._excludeSection,i)&&(this._excludeSection|=i)}setExclusions(){if(this.styleElement){const e=this.actualParent,t=(t,i)=>{let n=this.dataset[t]||"",s=0;if(e&&e.dataset[`${t}Child`]&&(n+=(""!==n?"|":"")+e.dataset[`${t}Child`]),""!==n)for(let e of n.split("|"))i[e=e.trim().toUpperCase()]&&!G.hasBit(s,i[e])&&(s|=i[e]);return s};this.exclude(t("excludeResource",L),t("excludeProcedure",O),t("excludeSection",N))}}appendTry(e,t,i=!0){let n=!1;const s=this.children,a=s.length;for(let i=0;i<a;i++)if(s[i]===e){s[i]=t,t.parent=this,t.containerIndex=e.containerIndex,n=!0;break}return!n&&i&&(t.parent=this,n=!0),n}sort(e){return e?super.sort(e):this.children.sort((e,t)=>e.containerIndex<t.containerIndex?-1:1),this}alignedVertically(e,t,i){if(this.lineBreak)return 2;if(this.pageFlow||this.positionAuto){const n=e=>e.blockVertical||e.percentWidth,s=e=>G.aboveRange(this.linear.top,e.linear.bottom)&&(n(this)||n(e)||this.float!==e.float);if(G.isArray(e)){if(t&&t.has(this))return 5;{const n=e[e.length-1];if(this.floating&&n.floating){if(i&&this.float===n.float)return 0;if(G.aboveRange(this.linear.top,n.linear.bottom))return 4;if(i&&t&&!e.some((e,i)=>i>0&&t.get(e)===this.float))return 0}else{if(!1===i&&this.floating&&n.blockStatic)return 0;if(void 0!==i&&!this.display.startsWith("inline-")){const{top:n,bottom:s}=this.linear;if(this.textElement&&t&&t.size&&e.some((e,i)=>i>0&&t.has(e))&&e.some(e=>n<e.linear.top&&s>e.linear.bottom))return 7;if(e[0].float===W.CSS.RIGHT){if(e.length>1){let t=1/0,a=-1/0,o=n;for(const i of e)i.float===W.CSS.RIGHT&&(i.linear.top<t&&(t=i.linear.top),i.linear.bottom>a&&(a=i.linear.bottom));if(this.multiline&&(o=s,this.textElement&&!this.plainText)){const e=U.getRangeClientRect(this._element,this.sessionId);e.bottom>s&&(o=e.bottom)}return G.belowRange(o,a)?i?0:6:i?6:0}if(!i)return 6}}}if(this.blockDimension&&s(n))return 3}}if(this.blockDimension&&this.css(W.CSS.WIDTH)===W.CSS.PERCENT_100&&!this.hasPX("maxWidth"))return 1;const a=this.actualParent||this.documentParent,o=this.blockStatic||"table"===this.display;for(const i of this.siblingsLeading){if(i.lineBreak)return 2;if(t&&"both"===t.get(i)&&(!G.isArray(e)||e[0]!==i))return 5;if(o&&(!i.floating||!i.rightAligned&&G.withinRange(i.linear.right,a.box.right)||t&&t.has(i))||i.blockStatic||i.autoMargin.leftRight||i.float===W.CSS.LEFT&&this.autoMargin.right||i.float===W.CSS.RIGHT&&this.autoMargin.left)return 1;if(this.blockDimension&&s(i))return 3}}return 0}previousSiblings(e={}){const t=e.floating,i=e.pageFlow,n=e.lineBreak,s=e.excluded,a=[];let o=this.element;if(o)o=o.previousSibling;else{const e=this.firstChild;e&&(o=e.element)&&(o=o.previousSibling)}for(;o;){const e=U.getElementAsNode(o,this.sessionId);if(e)if(!1!==n&&e.lineBreak||!1!==s&&e.excluded)a.push(e);else if(e.pageFlow&&!e.excluded){if(!1===i)break;if(a.push(e),!1!==t||!e.floating&&(e.visible||e.rendered)&&"none"!==e.display)break}o=o.previousSibling}return a}nextSiblings(e={}){const t=e.floating,i=e.pageFlow,n=e.lineBreak,s=e.excluded,a=[];let o=this._element;if(o)o=o.nextSibling;else{const e=this.lastChild;e&&(o=e.element)&&(o=o.nextSibling)}for(;o;){const e=U.getElementAsNode(o,this.sessionId);if(e)if(!1!==n&&e.lineBreak||!1!==s&&e.excluded)a.push(e);else if(e.pageFlow&&!e.excluded){if(!1===i)break;if(a.push(e),!1!==t||!e.floating&&(e.visible||e.rendered)&&"none"!==e.display)break}o=o.nextSibling}return a}modifyBox(e,t,i=!0){if(0!==t){const n=B.get(e);n&&(void 0===t?(void 0===this._boxReset&&(this._boxReset=F.newBoxModel()),this._boxReset[n]=1):(void 0===this._boxAdjustment&&(this._boxAdjustment=F.newBoxModel()),i?this._boxAdjustment[n]+=t:this[n]+this._boxAdjustment[n]+t<=0?(void 0===this._boxReset&&(this._boxReset=F.newBoxModel()),this._boxReset[n]=1,this._boxAdjustment[n]=0):this._boxAdjustment[n]+=t))}}getBox(e){const t=B.get(e);return t?[this._boxReset?this._boxReset[t]:0,this._boxAdjustment?this._boxAdjustment[t]:0]:[0,0]}resetBox(e,t,i=!1){void 0===this._boxReset&&(this._boxReset=F.newBoxModel());const n=this._boxReset,s=(e,s)=>{for(let a=0;a<4;a++)if(0===n[e[a]]){n[e[a]]=1;const o=B.get(z[a+s]),r=this[o];t&&0!==r&&(t.naturalChild||0!==t[o]?t.modifyBox(z[a+(i?0:4)],r):t.css(o,D.formatPX(r),!0))}};G.hasBit(e,30)&&s(D.BOX_MARGIN,0),G.hasBit(e,480)&&s(D.BOX_PADDING,4)}transferBox(e,t){const i=this._boxAdjustment;if(i){const n=(e,n)=>{for(let s=0;s<4;s++){const a=i[e[s]];a>0&&(t.modifyBox(z[s+n],a,!1),i[e[s]]=0)}};G.hasBit(e,30)&&n(D.BOX_MARGIN,0),G.hasBit(e,480)&&n(D.BOX_PADDING,4)}}actualRect(e,t="linear"){let i;switch(e){case W.CSS.TOP:case W.CSS.LEFT:i=this.companion&&!this.companion.visible&&this.companion[t][e]<this[t][e]?this.companion:this;break;case W.CSS.RIGHT:case W.CSS.BOTTOM:i=this.companion&&!this.companion.visible&&this.companion[t][e]>this[t][e]?this.companion:this;break;default:return NaN}return i[t][e]}cloneBase(e){e.localSettings=this.localSettings,e.alignmentType=this.alignmentType,e.containerName=this.containerName,e.depth=this.depth,e.visible=this.visible,e.excluded=this.excluded,e.rendered=this.rendered,e.childIndex=this.childIndex,e.containerIndex=this.containerIndex,e.inlineText=this.inlineText,e.lineBreakLeading=this.lineBreakLeading,e.lineBreakTrailing=this.lineBreakTrailing,e.actualParent=this.actualParent,e.documentParent=this.documentParent,e.documentRoot=this.documentRoot,e.renderParent=this.renderParent,this.length&&e.retain(this.duplicate()),e.inherit(this,"initial","base","alignment","styleMap","textStyle"),Object.assign(e.unsafe("cached"),this._cached)}css(e,t,i=!1){return arguments.length>=2&&(t?this._styleMap[e]=t:delete this._styleMap[e],i&&this.unsetCache(e)),this._styleMap[e]||this.styleElement&&this.style[e]||""}cssApply(e,t=!1){if(Object.assign(this._styleMap,e),t)for(const t in e)this.unsetCache(t);return this}cssSet(e,t,i=!0){return super.css(e,t,i)}get element(){let e=this._element;if(null===e){let t=this.innerWrapped;for(;t&&!(e=t.unsafe("element"));)t=t.innerWrapped}return e}get naturalChild(){return null!==this._element}get pseudoElement(){return null!==this._element&&"__squared.pseudo"===this._element.className}set documentParent(e){this._documentParent=e}get documentParent(){return this._documentParent||this.absoluteParent||this.actualParent||this.parent||this}set containerName(e){this._cached.containerName=e.toUpperCase()}get containerName(){if(void 0===this._cached.containerName){const e=this.element;let t="";e&&(t=(t=F.isPlainText(e)?"PLAINTEXT":"INPUT"===e.tagName?`INPUT_${e.type}`:e.tagName).toUpperCase()),this._cached.containerName=t}return this._cached.containerName}get excludeSection(){return this._excludeSection}get excludeProcedure(){return this._excludeProcedure}get excludeResource(){return this._excludeResource}get layoutHorizontal(){return this.hasAlign(8)}get layoutVertical(){return this.hasAlign(16)}get nodeGroup(){return!1}set renderAs(e){this.rendered||!e||e.rendered||(this._renderAs=e)}get renderAs(){return this._renderAs}get blockStatic(){return super.blockStatic||this.hasAlign(64)&&!this.floating}get rightAligned(){return super.rightAligned||this.hasAlign(2048)}set positionAuto(e){this._cached.positionAuto=e}get positionAuto(){return super.positionAuto}set flexbox(e){this._cached.flexbox=e}get flexbox(){return super.flexbox}set contentBoxWidth(e){this._cached.contentBoxWidth=e}get contentBoxWidth(){return super.contentBoxWidth}set contentBoxHeight(e){this._cached.contentBoxHeight=e}get contentBoxHeight(){return super.contentBoxHeight}set textContent(e){this._textContent=e}get textContent(){return this._textContent||super.textContent}set overflow(e){0!==e&&16!==e&&8!==e&&24!==e||(G.hasBit(this.overflow,64)&&(e|=64),this._cached.overflow=e)}get overflow(){return super.overflow}set baseline(e){this._cached.baseline=e}get baseline(){return super.baseline}set multiline(e){this._cached.multiline=e}get multiline(){return super.multiline}set visible(e){this._visible=e}get visible(){return this._visible}set controlName(e){this.rendered&&void 0!==this._controlName||(this._controlName=e)}get controlName(){return this._controlName||""}set siblingsLeading(e){this._siblingsLeading=e}get siblingsLeading(){return void 0===this._siblingsLeading&&(this._siblingsLeading=this.previousSiblings()),this._siblingsLeading}set siblingsTrailing(e){this._siblingsTrailing=e}get siblingsTrailing(){return void 0===this._siblingsTrailing&&(this._siblingsTrailing=this.nextSiblings()),this._siblingsTrailing}get previousSibling(){const e=this.actualParent;if(e){const t=e.naturalChildren,i=t.indexOf(this);if(-1!==i)for(let e=i-1;e>=0;e--){const i=t[e];if(i&&(!i.excluded||i.lineBreak))return i}}return null}get nextSibling(){const e=this.actualParent;if(e){const t=e.naturalChildren,i=t.indexOf(this);if(-1!==i){const e=t.length;for(let n=i+1;n<e;n++){const e=t[n];if(e&&(!e.excluded||e.lineBreak))return e}}}return null}get firstChild(){return this.naturalChildren[0]||null}get lastChild(){const e=this.naturalChildren;return e.length?e[e.length-1]:null}get onlyChild(){return this.renderParent?1===this.renderParent.length:!(!this.parent||0===this.parent.id)&&1===this.parent.length}get textEmpty(){return void 0===this._cached.textEmpty&&(this._cached.textEmpty=this.styleElement&&(""===this.textContent||!this.preserveWhiteSpace&&""===this.textContent.trim())&&!this.imageElement&&!this.svgElement),this._cached.textEmpty}get preserveWhiteSpace(){return void 0===this._cached.whiteSpace&&(this._cached.whiteSpace=this.cssAny("whiteSpace","pre","pre-wrap")),this._cached.whiteSpace}get leftTopAxis(){if(void 0===this._cached.leftTopAxis){const e=this.cssInitial("position");this._cached.leftTopAxis="absolute"===e&&this.absoluteParent===this.documentParent||"fixed"===e}return this._cached.leftTopAxis}}const q=squared.lib.util;class j extends squared.lib.base.Container{constructor(e,t,i=0,n=0,s){super(s),this.parent=e,this.node=t,this.containerType=i,this.alignmentType=n,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,s&&this.init()}init(){const e=this.children,t=e.length;if(t){if(t>1){const t=$.linearData(e);this._floated=t.floated,this._cleared=t.cleared,this._linearX=t.linearX,this._linearY=t.linearY}else this._linearY=e[0].blockStatic,this._linearX=!this._linearY;let i=0,n=0;for(let s=0;s<t;s++){const t=e[s];if(t.floating?i++:i=1/0,t.rightAligned?n++:n=1/0,i===1/0&&n===1/0)break}(i===t||this._floated&&2===this._floated.size)&&(this.add(512),this.some(e=>e.blockStatic)&&this.add(64)),n===t&&this.add(2048),this.itemCount=t}}reset(e,t){this.containerType=0,this.alignmentType=0,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,this._linearX=void 0,this._linearY=void 0,this._floated=void 0,this._cleared=void 0,e&&(this.parent=e),t&&(this.node=t),this.clear()}setType(e,t){this.containerType=e,t&&this.add(t)}hasAlign(e){return q.hasBit(this.alignmentType,e)}add(e){return q.hasBit(this.alignmentType,e)||(this.alignmentType|=e),this.alignmentType}delete(e){return q.hasBit(this.alignmentType,e)&&(this.alignmentType^=e),this.alignmentType}retain(e){return super.retain(e),this.init(),this}get linearX(){return void 0===this._linearX||this._linearX}get linearY(){return void 0!==this._linearY&&this._linearY}get floated(){return this._floated||new Set}get cleared(){return this._cleared||new Map}get singleRowAligned(){if(void 0===this._singleRow){if(!this.length)return!1;if(this._singleRow=!0,this.length>1){let e=1/0;for(const t of this.children){if(t.multiline||t.blockStatic){this._singleRow=!1;break}if(q.aboveRange(t.linear.top,e)){this._singleRow=!1;break}e=t.linear.bottom}}}return this._singleRow}get unknownAligned(){return this.length>1&&!this.linearX&&!this.linearY}get visible(){return this.filter(e=>e.visible)}}const{constant:Y,css:K,dom:Q,regex:Z,session:J,util:ee,xml:te}=squared.lib,ie={};let ne;class se extends C{constructor(e,t,i,n,s){super(e,t,i,n,s),this.session={cache:new h,excluded:new h,extensionMap:new Map,active:[],documentRoot:[],targetQueue:new Map},this.builtInExtensions={},this.extensions=[],this._layouts=[],ne=t}static prioritizeExtensions(e,t){if(e.dataset.use&&t.length){const i=e.dataset.use.split(Z.XML.SEPARATOR),n=[],s=[];for(const e of t){const t=i.indexOf(e.name);-1!==t?n[t]=e:s.push(e)}if(n.length)return ee.spliceArray(n,e=>void 0===e).concat(s)}return t}finalize(){const e=this.controllerHandler;for(const[e,t]of this.session.targetQueue.entries()){const i=e.dataset.target;if(i){const n=this.resolveTarget(i);n?(e.render(n),this.addLayoutTemplate(n,e,t)):void 0===e.renderParent&&this.session.cache.remove(e)}}const t=this.rendered;for(const e of t)e.hasProcedure(O.LAYOUT)&&e.setLayout(),e.hasProcedure(O.ALIGNMENT)&&e.setAlignment();e.optimize(t);for(const e of this.extensions)for(const t of e.subscribers)e.postOptimize(t);for(const e of this.rendered)e.hasResource(L.BOX_SPACING)&&e.setBoxSpacing();for(const e of this.extensions){for(const t of e.subscribers)e.postBoxSpacing(t);e.beforeCascade()}const i=e.localSettings.layout.baseTemplate;for(const t of this.session.documentRoot){const n=t.node;if(n.documentRoot&&0===n.renderChildren.length&&!n.inlineText&&n.naturalChildren.every(e=>e.documentRoot))continue;const s=n.renderParent;s&&s.renderTemplates&&this.saveDocument(t.layoutName,i+e.cascadeDocument(s.renderTemplates,0),n.dataset.pathname,n.renderExtension&&n.renderExtension.some(e=>e.documentBase)?0:void 0)}this.resourceHandler.finalize(this._layouts),e.finalize(this._layouts);for(const e of this.extensions)e.afterFinalize();Q.removeElementsByClassName("__squared.pseudo"),this.closed=!0}saveAllToDisk(){const e=this.resourceHandler.fileHandler;e&&e.saveAllToDisk(this.layouts)}reset(){super.reset();for(const e of this.rootElements)e.dataset.iteration="";const e=this.session;e.cache.reset(),e.excluded.reset(),e.extensionMap.clear(),e.documentRoot.length=0,e.targetQueue.clear(),this._layouts.length=0}conditionElement(e){const t=this.controllerHandler;if(!t.localSettings.unsupported.excluded.has(e.tagName)){if(t.visibleElement(e)||this._cascadeAll||e.dataset.use&&e.dataset.use.split(Z.XML.SEPARATOR).some(e=>!!this.extensionManager.retrieve(e)))return!0;{let i=e.parentElement,n=!0;for(;i;){if(K.getStyle(i).display===Y.CSS.NONE){n=!1;break}i=i.parentElement}if(n){const i=e.children,n=i.length;for(let e=0;e<n;e++)if(t.visibleElement(i[e]))return!0}return!1}}return!1}insertNode(e,t){if(!Q.isPlainText(e)){if(this.conditionElement(e))return this.controllerHandler.applyDefaultStyles(e),this.createNode(e,!1);{const t=this.createNode(e,!1);return t.visible=!1,t.excluded=!0,t}}if(te.isPlainText(e.textContent)||K.isParentStyle(e,"whiteSpace","pre","pre-wrap")){this.controllerHandler.applyDefaultStyles(e);const i=this.createNode(e,!1);return t&&$.copyTextStyle(i,t),i}}saveDocument(e,t,i,n){if(ee.isString(t)){const s={pathname:i?ee.trimString(i,"/"):this.controllerHandler.localSettings.layout.pathName,filename:e,content:t,index:n};void 0!==n&&n>=0&&n<this._layouts.length?this._layouts.splice(n,0,s):this._layouts.push(s)}}renderNode(e){return 0===e.itemCount?this.controllerHandler.renderNode(e):this.controllerHandler.renderNodeGroup(e)}addLayout(e){if(ee.hasBit(e.renderType,512)&&(ee.hasBit(e.renderType,8)?e=this.processFloatHorizontal(e):ee.hasBit(e.renderType,16)&&(e=this.processFloatVertical(e))),0!==e.containerType){const t=this.renderNode(e);if(t)return this.addLayoutTemplate(t.parent||e.parent,e.node,t,e.renderIndex)}return!1}addLayoutTemplate(e,t,i,n=-1){return!!i&&(t.renderExclude?(t.hide(),t.excluded=!0):t.renderParent?(void 0===e.renderTemplates&&(e.renderTemplates=[]),n>=0&&n<e.renderChildren.length?(e.renderChildren.splice(n,0,t),e.renderTemplates.splice(n,0,i)):(e.renderChildren.push(t),e.renderTemplates.push(i))):this.session.targetQueue.set(t,i),!0)}createNode(e,t=!0,i,n){const s=new ne(this.nextId,this.processing.sessionId,e,this.controllerHandler.afterInsertNode);if(i&&(s.depth=i.depth+1),n)for(const e of n)e.parent=s;return t&&this.processing.cache.append(s,void 0!==n),s}createCache(e){const t=this.createRootNode(e);if(t){t.documentParent=t.parent;const e=this.controllerHandler,n=this.processing.cache,s={},a=new Set;let o=!1;function i(e,t,i,n,a){void 0===s[t]&&(s[t]={}),s[t][i]=a,e.style.setProperty(i,n)}for(const e of n)if(e.styleElement){const t=e.element;if(e.length){const n=e.cssInitial("textAlign");switch(n){case Y.CSS.CENTER:case Y.CSS.RIGHT:case Y.CSS.END:i(t,e.id,"text-align",Y.CSS.LEFT,n)}}if(e.positionRelative)for(const n of K.BOX_POSITION)e.hasPX(n)&&(i(t,e.id,n,Y.CSS.AUTO,e.css(n)),o=!0);"rtl"===e.dir&&(t.dir="ltr",a.add(t))}!o&&a.size&&(o=!0),t.parent.setBounds();for(const e of n)if(e.pseudoElement){const t=e.actualParent.element;if(t){const i=t.id;let n;e.pageFlow&&(t.id=`id_${Math.round(Math.random()*(new Date).getTime())}`,n=K.insertStyleSheetRule(`#${t.id+$.getPseudoElt(e)} { display: none !important; }`)),e.cssTry("display",e.display)&&(e.setBounds(!1),e.cssFinally("display")),n&&document.head.removeChild(n),t.id=i}}else e.setBounds(void 0===s[e.id]&&!o);for(const e of this.processing.excluded)e.lineBreak||(e.setBounds(),e.saveAsInitial());for(const e of n){if(e.styleElement){const t=e.element,i=s[e.id];if(i)for(const e in i)t.style.setProperty(e,i[e]);a.has(t)&&(t.dir="rtl")}e.saveAsInitial()}return e.evaluateNonStatic(t,n),e.sortInitialCache(n),!0}return!1}afterCreateCache(e){const t=e.dataset,i=t.filename&&t.filename.replace(RegExp(`.${this.controllerHandler.localSettings.layout.fileExtension}$`),"")||e.id||`document_${this.length}`,n=(t.iteration?ee.convertInt(t.iteration):-1)+1;t.iteration=""+n,t.layoutName=ee.convertWord(n>1?`${i}_${n}`:i,!0),this.setBaseLayout(t.layoutName),this.setConstraints(),this.setResources()}resolveTarget(e){for(const t of this.processing.cache)if(t.elementId===e||t.controlId===e)return t;for(const t of this.session.cache)if(t.elementId===e||t.controlId===e)return t}toString(){return this._layouts.length?this._layouts[0].content:""}cascadeParentNode(e,t=0){const i=this.insertNode(e);if(i){if(i.depth=t,0===t){this.processing.cache.append(i);for(const e of i.extensions){const t=this.extensionManager.retrieve(e);if(t&&t.cascadeAll){this._cascadeAll=!0;break}}}const n=this.controllerHandler;if(n.preventNodeCascade(e))return i;const s=this.createPseduoElement(e,"::before"),a=this.createPseduoElement(e,"::after"),o=e.childNodes,r=o.length,l=Array(r),c=Array(e.childElementCount),h=this.userSettings.createQuerySelectorMap&&e.childElementCount?[[]]:void 0;let d=!0,u=0,f=0;for(let e=0;e<r;e++){const r=o[e];let g;r===s?(g=this.insertNode(s))&&(i.innerBefore=g,g.inlineText=!0,d=!1):r===a?(g=this.insertNode(a))&&(i.innerAfter=g,g.inlineText=!0,d=!1):"#"===r.nodeName.charAt(0)?Q.isPlainText(r)&&(g=this.insertNode(r,i)):n.includeElement(r)&&(se.prioritizeExtensions(r,this.extensions).some(e=>e.init(r)),this.rootElements.has(r)?((g=this.insertNode(r))&&(g.documentRoot=!0,g.visible=!1,g.excluded=!0),d=!1):(g=this.cascadeParentNode(r,t+1))&&!g.excluded&&(d=!1),g&&(c[f++]=g,h&&(h[0].push(g),this.appendQueryMap(h,t,g)))),g&&(g.childIndex=u,l[u++]=g)}l.length=u,c.length=f,i.naturalChildren=l,i.naturalElements=c,this.cacheNodeChildren(i,l,d),h&&h[0].length&&(i.queryMap=h)}return i}cacheNodeChildren(e,t,i){const n=t.length;if(n){const s=this.processing.cache;let a=[],o=[];if(n>1){let r=t[0],l=!1;for(let c=0,h=0;c<n;c++){const d=t[c];d.excluded?this.processing.excluded.append(d):d.plainText&&i||(d.containerIndex=h++,d.parent=e,s.append(d)),d.pageFlow&&(d.floating&&(l=!0),c>0&&(o.push(d),d.lineBreak&&(t[c-1].lineBreakTrailing=!0)),d.excluded||(d.siblingsLeading=a,r.siblingsTrailing=o,a=[],o=[],r=d),c<n-1&&(a.push(d),d.lineBreak&&(t[c+1].lineBreakLeading=!0))),d.actualParent=e}r.siblingsTrailing=o,e.floatContainer=l}else{const i=t[0];i.excluded?this.processing.excluded.append(i):i.plainText||(i.siblingsLeading=a,i.siblingsTrailing=o,i.parent=e,i.containerIndex=0,s.append(i)),i.actualParent=e}}else i=!e.textEmpty;e.inlineText=i}createPseduoElement(e,t){const i=J.getElementCache(e,`styleMap${t}`,this.processing.sessionId);if(i&&i.content){if(""===ee.trimString(i.content,'"').trim()&&0===ee.convertFloat(i.width)&&0===ee.convertFloat(i.height)&&("absolute"===i.position||"fixed"===i.position||i.clear&&i.clear!==Y.CSS.NONE)){let e=!0;for(const t in i)if(/(Width|Height)$/.test(t)&&K.isLength(i[t],!0)&&0!==ee.convertFloat(i[t])){e=!1;break}if(e)return}let o=i.content;if("inherit"===o){let t=e;for(;t&&"inherit"===(o=K.getStyle(t).getPropertyValue("content"));)t=t.parentElement}const r=K.getStyle(e);void 0===i.fontFamily&&(i.fontFamily=r.getPropertyValue("font-family")),void 0===i.fontSize&&(i.fontSize=r.getPropertyValue("font-size")),void 0===i.fontWeight&&(i.fontWeight=r.getPropertyValue("font-weight")),void 0===i.color&&(i.color=r.getPropertyValue("color")),void 0===i.display&&(i.display="inline");let l=i.display.startsWith("inline")?"span":"div",c="";switch(o){case"normal":case"none":case"initial":case"inherit":case"no-open-quote":case"no-close-quote":case'""':break;case"open-quote":"::before"===t&&(c="&quot;");break;case"close-quote":"::after"===t&&(c="&quot;");break;default:if(o.startsWith("url(")){c=K.resolveURL(o);const e=ee.fromLastIndexOf(c,".").toLowerCase(),t=this.controllerHandler.localSettings.supported.imageFormat;"*"===t||t.includes(e)?l="img":c=""}else{void 0===ie.COUNTER?(ie.COUNTER=/\s*(?:attr\(([^)]+)\)|(counter)\(([^,)]+)(?:, ([a-z\-]+))?\)|(counters)\(([^,]+), "([^"]*)"(?:, ([a-z\-]+))?\)|"([^"]+)")\s*/g,ie.COUNTER_VALUE=/\s*([^\-\d][^\-\d]?[^ ]*) (-?\d+)\s*/g):ie.COUNTER.lastIndex=0;let i,l=!1;for(;null!==(i=ie.COUNTER.exec(o));){if(i[1])c+=Q.getNamedItem(e,i[1].trim());else if(i[2]||i[5]){const o="counter"===i[2];let l,h;function n(e){if(e!==Y.CSS.NONE){let t;for(ie.COUNTER_VALUE.lastIndex=0;null!==(t=ie.COUNTER_VALUE.exec(e));)if(t[1]===l)return parseInt(t[2])}}o?(l=i[3],h=i[4]||"decimal"):(l=i[6],h=i[8]||"decimal");const d=e=>{const i=J.getElementCache(e,`styleMap${t}`,this.processing.sessionId);if(i&&i.counterIncrement)return n(i.counterIncrement)},u=(d(e)||0)+(n(r.getPropertyValue("counter-reset"))||0),f=[];let g,p=e,m=u,b=!1;function s(e,t){0===f.length?m+=e:(b||t)&&(f[f.length-1]+=e)}function a(e){if(void 0===n(K.getStyle(e).getPropertyValue("counter-reset"))){const t=e.children,i=t.length;for(let e=0;e<i;e++){const i=t[e];if("__squared.pseudo"!==i.className){let e=d(i);e&&s(e,!0);const t=K.getStyle(i);if((e=n(t.getPropertyValue("counter-increment")))&&s(e,!1),void 0!==(e=n(t.getPropertyValue("counter-reset"))))return;a(i)}}}}for(;;){if(b=!1,p.previousElementSibling)a(p=p.previousElementSibling);else{if(!p.parentElement)break;p=p.parentElement,b=!0}if("__squared.pseudo"!==p.className){const e=d(p);e&&s(e,!0);const t=K.getStyle(p),i=n(t.getPropertyValue("counter-increment"))||0;i&&s(i,!1);const a=n(t.getPropertyValue("counter-reset"));if(void 0!==a){if(void 0===g&&(m+=a),g=p,o)break;b&&f.push((e||0)+a)}}}if(g){if(!o&&f.length>1){f.reverse(),f.splice(1,1);for(const e of f)c+=K.convertListStyle(h,e,!0)+i[7]}}else m=u;c+=K.convertListStyle(h,m,!0)}else i[9]&&(c+=i[9]);l=!0}l||(c=o)}}if(c||'""'===o){const n=function(e,t="span",i=-1){const n=document.createElement(t);return n.className="__squared.pseudo",n.style.setProperty("display",Y.CSS.NONE),i>=0&&i<e.childNodes.length?e.insertBefore(n,e.childNodes[i]):e.appendChild(n),n}(e,l,"::before"===t?0:-1);"img"===l?n.src=c:'""'!==o&&(n.innerText=c);for(const e in i)"display"!==e&&(n.style[e]=i[e]);return J.setElementCache(n,"pseudoElement",this.processing.sessionId,t),J.setElementCache(n,"styleMap",this.processing.sessionId,i),n}}}setBaseLayout(e){const t=this.processing,i=this.session,n=t.cache,s=t.node,a=ee.filterArray(this.extensions,e=>!e.eventOnly),o=new Map;function r(e,t,i){const n=o.get(e)||new Map;o.set(e,n.set(t,i))}function l(e){for(const t of o.values())for(const i of t.values())if(i.id===e)return void t.delete(i.id)}r(-1,0,s.parent);let c=0;for(const e of n)e.visible&&e.length&&(r(e.depth,e.id,e),c=Math.max(e.depth,c));for(let e=0;e<c;e++)o.set(-1*e-2,new Map);n.afterAppend=e=>{l(e.id),r(-1*e.depth-2,e.id,e);for(const t of e.cascade())l(t.id),r(-1*t.depth-2,t.id,t)};for(const e of this.extensions)e.beforeBaseLayout();for(const e of o.values())for(const t of e.values()){if(0===t.length)continue;const e=t.duplicate(),i=t.floatContainer,n=e.length;let s;i&&(s=$.linearData(t.naturalElements,!0).cleared);for(let o=0;o<n;o++){let r=e[o];if(r.rendered||!r.visible||r.naturalElement&&!r.documentRoot&&this.rootElements.has(r.element))continue;let l=r.parent;if(n>1&&o<n-1&&r.pageFlow&&!r.nodeGroup&&(0===l.alignmentType||l.hasAlign(2)||r.hasAlign(8192))&&!l.hasAlign(4)&&r.hasSection(N.DOM_TRAVERSE)){const t=[],a=[];let c=!1;function h(e){return!a.length&&!c&&(t.push(e),!0)}function d(e){return!t.length&&(a.push(e),!0)}let u,f,g=o,p=0;r.hasAlign(8192)&&l.layoutVertical&&(t.push(r),g++,p++);e:{let o,r;for(i&&(o=new Set,r=new Map);g<n;g++,p++){const n=e[g];if(n.pageFlow){if(i){if(o.size){const e=s.get(n);e&&("both"===e?o.clear():o.delete(e),r.set(n,e))}n.floating&&o.add(n.float)}if(0===p){const e=n.siblingsTrailing[0];if(e){!n.horizontalAligned||e.alignedVertically([n])?a.push(n):t.push(n);continue}}const e=n.siblingsLeading[0];if(!e)break e;if(i){const i=n.alignedVertically(t.length?t:a,r,t.length>0);if(i>0){if(t.length){if(7!==i&&6!==i&&o.size&&"both"!==r.get(n)&&!n.siblingsLeading.some(e=>e.lineBreak&&!s.has(e))&&(!n.floating||e.floating&&!ee.aboveRange(n.linear.top,e.linear.bottom))){if(r.has(n)){if(!n.floating){n.addAlign(8192),t.push(n),c=!0;continue}break e}{let e=-1/0;if(n.floating||ee.captureMap(t,e=>e.floating,t=>e=Math.max(e,t.linear.bottom)),!n.floating&&!ee.aboveRange(n.linear.top,e)||n.floating&&o.has(n.float)){if(t.push(n),!n.floating&&ee.aboveRange(n.linear.bottom,e))break e;continue}}}break e}if(!d(n))break e}else if(!h(n))break e}else if(n.alignedVertically()){if(!d(n))break e}else if(!h(n))break e}else if(n.positionAuto){if(a.length){a[a.length-1].blockStatic&&a.push(n);break}t.push(n)}}}t.length>1?(u=this.controllerHandler.processTraverseHorizontal(new j(l,r,0,0,t),e),f=t[t.length-1]):a.length>1&&(u=this.controllerHandler.processTraverseVertical(new j(l,r,0,0,a),e),(f=a[a.length-1]).horizontalAligned&&f!==e[n-1]&&f.addAlign(8192)),u&&this.addLayout(u)&&(f===e[n-1]&&l.removeAlign(2),l=r.parent)}if(r.removeAlign(8192),o===n-1&&l.removeAlign(2),r.renderAs&&l.appendTry(r,r.renderAs,!1)&&(r.hide(),(r=r.renderAs).positioned&&(l=r.parent)),!r.rendered&&r.hasSection(N.EXTENSION)){const e=this.session.extensionMap.get(r.id);let i=t.renderExtension&&t.renderExtension.slice(0);if(e&&(i=i?i.concat(e):e.slice(0)),i){let e=!1;for(const t of i){const i=t.processChild(r,l);if(i&&(i.output&&this.addLayoutTemplate(i.parentAs||l,r,i.output),i.renderAs&&i.outputAs&&this.addLayoutTemplate(l,i.renderAs,i.outputAs),i.parent&&(l=i.parent),e=!0===i.next,i.complete||e))break}if(e)continue}if(r.styleElement){let t=!1;if(se.prioritizeExtensions(r.element,a).some(i=>{if(i.is(r)&&i.condition(r,l)&&(void 0===e||!e.includes(i))){const e=i.processNode(r,l);if(e&&(e.output&&this.addLayoutTemplate(e.parentAs||l,r,e.output),e.renderAs&&e.outputAs&&this.addLayoutTemplate(l,e.renderAs,e.outputAs),e.parent&&(l=e.parent),(e.output&&!1!==e.include||!0===e.include)&&(void 0===r.renderExtension&&(r.renderExtension=[]),r.renderExtension.push(i),i.subscribers.add(r)),t=!0===e.next,e.complete||t))return!0}return!1}),t)continue}}if(!r.rendered&&r.hasSection(N.RENDER)){let e=this.createLayoutControl(l,r);if(0===e.containerType){const t=r.length?this.controllerHandler.processUnknownParent(e):this.controllerHandler.processUnknownChild(e);if(!0===t.next)continue;e=t.layout}this.addLayout(e)}}}for(const t of n)t.documentRoot&&t.rendered&&i.documentRoot.push({node:t,layoutName:t===s?e:""});n.sort((e,t)=>e.depth===t.depth?e.nodeGroup&&(0===t.length||t.naturalChild)?-1:t.nodeGroup&&(0===e.length||e.naturalChild)?1:0:e.depth<t.depth?-1:1),i.cache.concat(n.children),i.excluded.concat(t.excluded.children);for(const e of this.extensions){for(const t of e.subscribers)n.contains(t)&&e.postBaseLayout(t);e.afterBaseLayout()}}setConstraints(){const e=this.processing.cache;this.controllerHandler.setConstraints();for(const t of this.extensions){for(const i of t.subscribers)e.contains(i)&&t.postConstraints(i);t.afterConstraints()}}setResources(){const e=this.resourceHandler;for(const t of this.processing.cache)e.setBoxStyle(t),e.setFontStyle(t),e.setValueString(t);for(const e of this.extensions)e.afterResources()}processFloatHorizontal(e){const t=this.controllerHandler,i=[],n=[],s=[],a=[],o=[];let r,l,c,h,d=0;e.each((t,i)=>{if(i>0){const i=e.cleared.get(t);if(i)switch(i){case Y.CSS.LEFT:ee.hasBit(d,2)||(d|=2);break;case Y.CSS.RIGHT:ee.hasBit(d,4)||(d|=4);break;default:d=6}}if(0===d)if(t.float===Y.CSS.RIGHT)o.push(t);else if(t.float===Y.CSS.LEFT)a.push(t);else if(a.length||o.length){let e=t.linear.top;if(t.textElement&&!t.plainText){const i=J.getRangeClientRect(t.element,t.sessionId);i.top>e&&(e=i.top)}a.some(t=>e>=t.linear.bottom)||o.some(t=>e>=t.linear.bottom)?s.push(t):n.push(t)}else n.push(t);else t.float===Y.CSS.RIGHT?4===d||6===d?(void 0===l&&(l=[]),l.push(t)):o.push(t):t.float===Y.CSS.LEFT?2===d||6===d?(void 0===r&&(r=[]),r.push(t)):a.push(t):6===d?s.push(t):n.push(t)}),a.length&&r?c=[a,r]:a.length&&(c=a),o.length&&l?h=[o,l]:o.length&&(h=o);const{containerType:u,alignmentType:f}=t.containerTypeVertical,g=t.containerTypeVerticalMargin;if(o.length+(l?l.length:0)===e.length&&e.add(2048),s.length){s.length>1&&s[0].addAlign(8192),s.unshift(e.node);const t=this.createNode(void 0,!0,e.parent,s);t.actualParent=e.parent,this.addLayout(new j(e.parent,t,u,f|(e.parent.blockStatic?64:0),s)),e.parent=t}n.length&&i.push(n),c&&i.push(c),h&&i.push(h),e.setType(g.containerType,g.alignmentType),e.itemCount=i.length,e.add(64);for(const s of i){let i,r;if(Array.isArray(s[0])){let n=(i=s)[0];for(let e=1;e<i.length;e++)n=n.concat(i[e]);if(n.sort((e,t)=>e.childIndex<t.childIndex?-1:1),e.node.layoutVertical)r=e.node;else{r=t.createNodeGroup(n[0],n,e.node);const s=new j(e.node,r,u,f|(i.some(e=>e===h||e===o)?2048:0));s.itemCount=i.length,this.addLayout(s)}}else i=[s];for(const s of i){const i=r||e.node,l=t.createNodeGroup(s[0],s,i,!0),c=new j(i,l,0,128|(s===n?256:0),s);if(1===s.length)if(c.node.innerWrapped=s[0],s[0].outerWrapper=c.node,s[0].percentWidth){const e=t.containerTypePercent;c.setType(e.containerType,e.alignmentType)}else c.setType(u,f);else c.linearY||c.unknownAligned?c.setType(u,f|(c.unknownAligned?2:0)):t.processLayoutHorizontal(c);this.addLayout(c),s===n&&this.setFloatPadding(i,l,n,a,o)}}return e}processFloatVertical(e){const t=this.controllerHandler,{containerType:i,alignmentType:n}=t.containerTypeVertical;if(0!==e.containerType){const s=t.createNodeGroup(e.node,[e.node],e.parent);this.addLayout(new j(s,e.node,i,n,s.children)),e.node=s}else e.containerType=i,e.add(n);const s=[],a=[],o=[],r=[];let l=!1,c=!1,h=!0;for(const t of e)t.blockStatic&&0===r.length?(o.push(t),c=!0):(e.cleared.has(t)&&(t.floating?l=!0:(t.modifyBox(2),s.push(o.slice(0)),a.push(r.slice(0)),o.length=0,r.length=0)),t.floating?(c&&(s.push(o.slice(0)),a.push(null),o.length=0,r.length=0,c=!1),r.push(t)):(l&&!e.cleared.has(t)&&(h=!1),o.push(t)));if(r.length&&a.push(r),o.length&&s.push(o),!h)for(let o=0;o<Math.max(a.length,s.length);o++){const r=s[o]||[];if(null===a[o]&&r.length){const i=t.containerTypeVertical;i.alignmentType|=192,this.addLayout(new j(e.node,t.createNodeGroup(r[0],r,e.node),i.containerType,i.alignmentType,r))}else{const s=a[o]||[];if(r.length||s.length){const a=t.containerTypeVerticalMargin,o=t.createNodeGroup(s[0]||r[0],[],e.node),l=new j(e.node,o,a.containerType,a.alignmentType),c=[];let h;if(s.length){const e=t.createNodeGroup(s[0],s,o);l.add(512),0===r.length&&s.every(e=>e.float===Y.CSS.RIGHT)&&l.add(2048),c.push(e)}r.length&&(h=t.createNodeGroup(r[0],r,o),c.push(h)),o.init(),l.itemCount=c.length,this.addLayout(l);for(let e of c)e.nodeGroup||(e=t.createNodeGroup(e,[e],o,!0)),this.addLayout(new j(o,e,i,192|n,e.children));if(r.length&&s.length){const[t,i]=ee.partitionArray(s,e=>"right"!==e.float);this.setFloatPadding(e.node,h,r,t,i)}}}}return e}setFloatPadding(e,t,i,n,s){const a=e=>e.textElement&&(e.blockStatic||e.multiline);if(i.some(e=>a(e)||e.blockStatic&&e.cascadeSome(e=>a(e)))){if(n.length){let s=-1/0,a=0,o=!1;for(const e of n){const t=e.linear.right+(e.marginLeft<0?e.marginLeft:0);t>s&&(s=t,o=e.marginRight>0)}for(const e of i)e.blockStatic&&e.bounds.left>s&&a++;if(a<i.length){const i=s-e.box.left;i>0&&t.modifyBox(256,i+(!o&&t.cascadeSome(e=>e.multiline)?this.controllerHandler.localSettings.deviations.textMarginBoundarySize:0))}}if(s.length){let n=1/0,a=0,o=!1;for(const e of s){const t=e.linear.left+(e.marginRight<0?e.marginRight:0);t<n&&(n=t,o=e.marginLeft>0)}for(const e of i)e.blockStatic&&e.bounds.right<n&&a++;if(a<i.length){const i=e.box.right-n;i>0&&t.modifyBox(64,i+(!o&&t.cascadeSome(e=>e.multiline)?this.controllerHandler.localSettings.deviations.textMarginBoundarySize:0))}}}}createLayoutControl(e,t){return new j(e,t,t.containerType,t.alignmentType,t.children)}get layouts(){return this._layouts.sort((e,t)=>{if(e.index!==t.index){if(0===e.index||void 0!==e.index&&e.index!==1/0&&void 0===t.index||t.index===1/0)return-1;if(0===t.index||void 0!==t.index&&t.index!==1/0&&void 0===e.index||e.index===1/0)return 1;if(void 0!==e.index&&void 0!==t.index)return e.index<t.index?-1:1}return 0})}get rendered(){return this.session.cache.filter(e=>e.visible&&e.rendered)}get nextId(){return this.processing.cache.nextId}get length(){return this.session.documentRoot.length}}const{client:ae,constant:oe,css:re,dom:le,session:ce,util:he,xml:de}=squared.lib,ue=e=>!(e.left<0&&e.top<0&&Math.abs(e.left)>=e.width&&Math.abs(e.top)>=e.height);const{css:fe,util:ge}=squared.lib;class pe extends v{constructor(e,t,i,n=[]){super(e,t,i),this.eventOnly=!1,this.documentBase=!1,this.cascadeAll=!1,this.tagNames=n}static findNestedElement(e,t){if(e&&fe.hasComputedStyle(e)){const i=e.children,n=i.length;for(let e=0;e<n;e++){const n=i[e];if(ge.includes(n.dataset.use,t))return n}}return null}condition(e,t){return!!e.styleElement&&(e.dataset.use?this.included(e.element):this.tagNames.length>0)}is(e){return!!e.styleElement&&(0===this.tagNames.length||this.tagNames.includes(e.element.tagName))}included(e){return ge.includes(e.dataset.use,this.name)}init(e){return!1}processNode(e,t){}processChild(e,t){}addDescendant(e){const t=this.application.session.extensionMap,i=t.get(e.id)||[];i.includes(this)||i.push(this),t.set(e.id,i)}postBaseLayout(e){}postConstraints(e){}postOptimize(e){}postBoxSpacing(e){}afterBaseLayout(){}afterConstraints(){}afterResources(){}beforeBaseLayout(){}beforeCascade(){}afterFinalize(){}}const me=squared.lib.constant;const{client:be,color:Se,constant:xe,css:Te,math:ye,regex:_e,util:Ce}=squared.lib,Ee="&#160;",ve=`(rgba?\\(\\d+, \\d+, \\d+(?:, [\\d.]+)?\\)|#[A-Za-z\\d]{3,8}|[a-z]+)\\s*(${_e.STRING.LENGTH_PERCENTAGE}|${_e.STRING.CSS_ANGLE}|(?:${_e.STRING.CSS_CALC}(?=,)|${_e.STRING.CSS_CALC}))?,?\\s*`,Ae=RegExp(`(?:initial|url\\([^)]+\\)|(repeating)?-?(linear|radial|conic)-gradient\\(((?:to [a-z ]+|(?:from )?-?[\\d.]+(?:deg|rad|turn|grad)|(?:circle|ellipse)?\\s*(?:closest-side|closest-corner|farthest-side|farthest-corner)?)?(?:\\s*at [\\w %]+)?),?\\s*((?:${ve})+)\\))`,"g");let Ie;function we(e,t,i,n){void 0===Ie?Ie=RegExp(ve,"g"):Ie.lastIndex=0;const s=t,a=s.horizontal?xe.CSS.WIDTH:xe.CSS.HEIGHT,o=!0===s.repeating,r=o&&"radial"===t.type?s.radiusExtent/s.radius:1,l=[];let c,h=0;for(;null!==(c=Ie.exec(i));){const i=Se.parseColor(c[1],n,!0);if(i){let n=-1;if("conic"===t.type)c[3]&&c[4]&&(n=Te.convertAngle(c[3],c[4])/360);else if(c[2]){if(Te.isPercent(c[2]))n=parseFloat(c[2])/100;else if(o){const i="radial"===t.type?s.radius:t.dimension[a];Te.isLength(c[2])?n=e.parseUnit(c[2],a,!1)/i:Te.isCalc(c[2])&&(n=Te.calculate(c[6],i,e.fontSize)/i)}o&&-1!==n&&(n*=r)}0===l.length&&(-1===n?n=0:n>0&&l.push({color:i,offset:0})),-1!==n&&(h=n=Math.max(h,n)),l.push({color:i,offset:n})}}const d=l.length,u=l[d-1];-1===u.offset&&(u.offset=1);let f=0;for(let e=0;e<d;e++){const t=l[e];if(-1===t.offset)if(0===e)t.offset=0;else{for(let i=e+1,n=2;i<d-1;i++,n++)if(-1!==l[i].offset){t.offset=(f+l[i].offset)/n;break}-1===t.offset&&(t.offset=f+u.offset/(d-1))}f=t.offset}if(o){if(f<100)e:{const e=l.slice(0);let t=f;for(;f<100;){for(let i=0;i<d;i++)if(l.push(Object.assign({},e[i],{offset:f=Math.min(t+e[i].offset,1)})),1===f)break e;t=f}}}else f<1&&l.push(Object.assign({},l[d-1],{offset:1}));return l}function Re(e){if(e){let t=Te.parseAngle(e.trim());return t<0&&(t+=360),t}return 0}function ke(e,t,i,n){switch(n=n.replace(/\u00A0/g,Ee),t.css("whiteSpace")){case"nowrap":n=n.replace(/\n/g," ");break;case"pre":case"pre-wrap":e.layoutVertical||(n=n.replace(/^\s*?\n/,"")),n=n.replace(/\n/g,"\\n").replace(/\s/g,Ee);break;case"pre-line":n=n.replace(/\n/g,"\\n").replace(/\s+/g," ");break;default:const i=t.previousSibling,s=t.nextSibling;return(i&&(i.lineBreak||i.blockStatic)||t.onlyChild&&t.htmlElement)&&(n=n.replace(_e.CHAR.LEADINGSPACE,"")),(s&&(s.lineBreak||s.blockStatic)||t.onlyChild&&t.htmlElement)&&(n=n.replace(_e.CHAR.TRAILINGSPACE,"")),[n,!1]}return[n,!0]}function Be(e,t,i){if(i){const n=i.split(_e.XML.SEPARATOR);return Ne.getBackgroundSize(e,n[t%n.length])}}const Pe=e=>e?/(.+?)?\s*at (.+?)$/.exec(e):null;class Ne extends f{static generateId(e,t,i=1){const n=t;let s=i;1===i&&(t+=`_${""+s}`);const a=this.ASSETS.ids.get(e)||[];for(;;){if(!a.includes(t)){a.push(t);break}t=`${n}_${""+ ++s}`}return this.ASSETS.ids.set(e,a),t}static insertStoredAsset(e,t,i){const n=Ne.STORED[e];if(n&&Ce.hasValue(i)){let s=this.getStoredName(e,i);if(""===s){Ce.isNumber(t)&&(t=`__${t}`);let e=0;do{s=t,e>0&&(s+=`_${e}`),n.has(s)||n.set(s,i),e++}while(n.has(s)&&n.get(s)!==i)}return s}return""}static getOptionArray(e,t=!1){const i=[];let n=!0;const s=e.children,a=s.length;for(let e=0;e<a;e++){const a=s[e];if(!t&&a.disabled)continue;const o=a.text.trim()||a.value.trim();""!==o&&(n&&!Ce.isNumber(o)&&(n=!1),i.push(o))}return n?[void 0,i]:[i]}static isBackgroundVisible(e){return!(void 0===e||!e.backgroundImage&&!e.borderTop&&!e.borderRight&&!e.borderBottom&&!e.borderLeft)}static getBackgroundSize(e,t){let i=0,n=0;switch(t){case"":case"cover":case"contain":case"100% 100%":case"auto":case"auto auto":case"initial":return;default:const s=t.split(" "),a=s.length;1===a&&(s[1]=s[0]);for(let t=0;t<a;t++)s[t]===xe.CSS.AUTO&&(s[t]=xe.CSS.PERCENT_100),0===t?i=e.parseUnit(s[t],xe.CSS.WIDTH,!1):n=e.parseUnit(s[t],xe.CSS.HEIGHT,!1)}return i>0&&n>0?{width:Math.round(i),height:Math.round(n)}:void 0}static isInheritedStyle(e,t){if(e.styleElement){const i=e.actualParent;if(i&&""===e.cssInitial(t))return e.style[t]===i.style[t]}return!1}static hasLineBreak(e,t=!1,i=!1){if(e.naturalElements.length)return e.naturalElements.some(e=>e.lineBreak);if(!t&&e.naturalChild){const t=e.element;let n=t.textContent;if(i&&(n=n.trim()),/\n/.test(n))return!(!e.plainText||!Te.isParentStyle(t,"whiteSpace","pre","pre-wrap"))||e.css("whiteSpace").startsWith("pre")}return!1}static getStoredName(e,t){if(Ne.STORED[e])for(const[i,n]of Ne.STORED[e].entries())if(Ce.isEqual(t,n))return i;return""}finalize(e){}reset(){super.reset();for(const e in Ne.STORED)Ne.STORED[e].clear()}writeRawImage(e,t){this.fileHandler&&this.fileHandler.addAsset({pathname:this.application.controllerHandler.localSettings.directory.image,filename:e,base64:t})}setBoxStyle(e){if(e.visible&&e.styleElement){const i={backgroundSize:e.css("backgroundSize"),backgroundRepeat:e.css("backgroundRepeat"),backgroundPositionX:e.css("backgroundPositionX"),backgroundPositionY:e.css("backgroundPositionY")},n=e.element,s=e.css("opacity");function t(t,a){const o=e.css(a[0])||xe.CSS.NONE;let r=Te.formatPX("outline"!==t?e[a[1]]:Ce.convertFloat(e.style[a[1]])),l=e.css(a[2])||"initial";switch(l){case"initial":l="rgb(0, 0, 0)";break;case"inherit":case"currentcolor":l=Te.getInheritedStyle(n,a[2])}if(o!==xe.CSS.NONE&&r!==xe.CSS.PX_0){"2px"!==r||"inset"!==o&&"outset"!==o||(r="1px");const e=Se.parseColor(l,s,!0);e&&(i[t]={width:r,style:o,color:e})}}switch(e.css("backgroundClip")){case"padding-box":i.backgroundClip={top:e.borderTopWidth,right:e.borderRightWidth,bottom:e.borderBottomWidth,left:e.borderLeftWidth};break;case"content-box":i.backgroundClip={top:e.borderTopWidth+e.paddingTop,right:e.borderRightWidth+e.paddingRight,bottom:e.borderBottomWidth+e.paddingBottom,left:e.borderLeftWidth+e.paddingLeft}}if(e.css("borderRadius")!==xe.CSS.PX_0){const[t,n]=e.css("borderTopLeftRadius").split(" "),[s,a]=e.css("borderTopRightRadius").split(" "),[o,r]=e.css("borderBottomRightRadius").split(" "),[l,c]=e.css("borderBottomLeftRadius").split(" "),h=n||a||r||c?[t,n||t,s,a||s,o,r||o,l,c||l]:[t,s,o,l],d=e.actualWidth>=e.actualHeight;h.every(e=>e===h[0])&&(h.length=h[0]===xe.CSS.PX_0||""===h[0]?0:1);const u=h.length;if(u){const t=d?xe.CSS.WIDTH:xe.CSS.HEIGHT;for(let i=0;i<u;i++)h[i]=e.convertPX(h[i],t,!1);i.borderRadius=h}}if(e.css("border").startsWith("0px none")||(t("borderTop",Te.BOX_BORDER[0]),t("borderRight",Te.BOX_BORDER[1]),t("borderBottom",Te.BOX_BORDER[2]),t("borderLeft",Te.BOX_BORDER[3]),t("outline",Te.BOX_BORDER[4])),e.hasResource(L.IMAGE_SOURCE)){Ae.lastIndex=0;const t=[];let n,a=0;for(;null!==(n=Ae.exec(e.backgroundImage));){if("initial"===n[0]||n[0].startsWith("url"))t.push(n[0]);else{const o="repeating"===n[1],r=n[2],l=n[3],c=Be(e,a,i.backgroundSize)||e.actualDimension;let h;switch(r){case"conic":{const t=Pe(l),i={type:r,dimension:c,angle:Re(l)};i.center=Te.getBackgroundPosition(t&&t[2]||xe.CSS.CENTER,c,e.fontSize),i.colorStops=we(e,i,n[4],s),h=i;break}case"radial":{const t=Pe(l),i={type:r,repeating:o,horizontal:e.actualWidth<=e.actualHeight,dimension:c,shape:t&&t[1]&&t[1].startsWith("circle")?"circle":"ellipse"};i.center=Te.getBackgroundPosition(t&&t[2]||xe.CSS.CENTER,c,e.fontSize),i.closestCorner=1/0,i.farthestCorner=-1/0;for(const e of[[0,0],[c.width,0],[c.width,c.height],[0,c.height]]){const t=Math.round(Math.sqrt(Math.pow(Math.abs(e[0]-i.center.left),2)+Math.pow(Math.abs(e[1]-i.center.top),2)));t<i.closestCorner&&(i.closestCorner=t),t>i.farthestCorner&&(i.farthestCorner=t)}i.closestSide=i.center.top,i.farthestSide=i.center.top;for(const e of[c.width-i.center.left,c.height-i.center.top,i.center.left])e<i.closestSide&&(i.closestSide=e),e>i.farthestSide&&(i.farthestSide=e);i.radius=i.farthestCorner;const a=t&&t[1]?t[1].split(" ").pop():"";switch(a){case"closest-corner":case"closest-side":case"farthest-side":const e=i[Ce.convertCamelCase(a)];o?i.radiusExtent=e:i.radius=e;break;default:i.radiusExtent=i.farthestCorner}i.colorStops=we(e,i,n[4],s),h=i;break}case"linear":{let t=180;switch(l){case"to top":t=0;break;case"to right top":t=45;break;case"to right":t=90;break;case"to right bottom":t=135;break;case"to bottom":break;case"to left bottom":t=225;break;case"to left":t=270;break;case"to left top":t=315;break;default:l&&(t=Re(l))}const i={type:r,repeating:o,horizontal:t>=45&&t<=135||t>=225&&t<=315,dimension:c,angle:t};i.colorStops=we(e,i,n[4],s);const a=c.width,d=c.height;let u=ye.truncateFraction(ye.offsetAngleX(t,a)),f=ye.truncateFraction(ye.offsetAngleY(t,d));if(u!==a&&f!==d&&!ye.isEqual(Math.abs(u),Math.abs(f))){let e;e=t<=90?ye.relativeAngle({x:0,y:d},{x:a,y:0}):t<=180?ye.relativeAngle({x:0,y:0},{x:a,y:d}):t<=270?ye.relativeAngle({x:0,y:0},{x:-a,y:d}):ye.relativeAngle({x:0,y:d},{x:-a,y:0});let i=Math.abs(e-t),n=90-i;const s=ye.triangulate(i,n,Math.sqrt(Math.pow(a,2)+Math.pow(d,2)));u=ye.truncateFraction(ye.offsetAngleX(t,s[1]));const o=ye.triangulate(i=90,n=90-t,u);f=ye.truncateFraction(ye.offsetAngleY(t,o[0]))}i.angleExtent={x:u,y:f},h=i;break}}t.push(h||"initial")}a++}t.length&&(i.backgroundImage=t)}const a=e.documentParent.visible?e.backgroundColor:e.css("backgroundColor");if(""!==a){const e=Se.parseColor(a,s);i.backgroundColor=e?e.valueAsRGBA:""}if(i.borderTop&&i.borderRight&&i.borderBottom&&i.borderLeft){let e=!0;for(const t in i.borderTop){const n=i.borderTop[t];if(n!==i.borderRight[t]||n!==i.borderBottom[t]||n!==i.borderLeft[t]){e=!1;break}}e&&(i.border=i.borderTop)}e.data(Ne.KEY_NAME,"boxStyle",i)}}setFontStyle(e){if(!(null===e.element&&!e.inlineText||e.renderChildren.length||e.imageElement||e.svgElement||"HR"===e.tagName||e.textElement&&e.textEmpty&&!e.visibleStyle.background)){const t=Se.parseColor(e.css("color"),e.css("opacity"));let i=e.css("fontWeight");if(!Ce.isNumber(i))switch(i){case"lighter":i="200";break;case"bold":i="700";break;case"bolder":i="900";break;default:i="400"}e.data(Ne.KEY_NAME,"fontStyle",{fontFamily:e.css("fontFamily").trim(),fontStyle:e.css("fontStyle"),fontSize:Te.formatPX(e.fontSize),fontWeight:i,color:t?t.valueAsRGBA:""})}}setValueString(e){if(e.visible&&!e.svgElement){const t=e.renderParent;if(t){const i=e.element;if(i){let n="",s="",a="",o=!1,r=!1;switch(i.tagName){case"INPUT":switch(s=i.value,i.type){case"radio":case"checkbox":e.companion&&!e.companion.visible&&(s=e.companion.textContent);break;case"submit":""!==s||e.visibleStyle.backgroundImage||(s="Submit");break;case"time":""===s&&(a="--:-- --");break;case"date":case"datetime-local":if(""===s){switch((new Intl.DateTimeFormat).resolvedOptions().locale){case"en-US":a="mm/dd/yyyy";break;default:a="dd/mm/yyyy"}"datetime-local"===i.type&&(a+=" --:-- --")}break;case"week":""===s&&(a="Week: --, ----");break;case"month":""===s&&(a="--------- ----");break;case"url":case"email":case"search":case"number":case"tel":""===s&&(a=i.placeholder);break;case"file":s=be.isUserAgent(8)?"Browse...":"Choose File"}break;case"TEXTAREA":s=i.value;break;case"IFRAME":s=i.src;break;default:const l=e.textContent;e.plainText?(n=l.trim(),[s]=ke(t,e,0,l.replace(/&/g,"&amp;")),r=!0,o=!0):e.inlineText?(n=l.trim(),[s,r]=ke(t,e,0,function(e,t,i){let n=t[i];const s=e.naturalChildren,a=s.length;for(let e=0;e<a;e++){const t=s[e];(!t.textElement||!t.pageFlow||t.positioned||t.pseudoElement||t.excluded||t.dataset.target)&&(t.htmlElement&&"innerHTML"===i?n=t.lineBreak?n.replace(RegExp(`\\s*${t.element.outerHTML}\\s*`),"\\n"):n.replace(t.element.outerHTML,t.pageFlow&&t.textContent?Ee:""):Ce.isString(t[i])?n=n.replace(t[i],""):0===e?n=Ce.trimStart(n," "):e===a-1&&(n=Ce.trimEnd(n," ")))}return"innerHTML"===i&&(n=n.replace(_e.ESCAPE.ENTITY,(e,t)=>String.fromCharCode(parseInt(t)))),n}(e,i,i.children.length||"CODE"===i.tagName?"innerHTML":"textContent")),o=!0):""===l.trim()&&Ne.isBackgroundVisible(e.data(Ne.KEY_NAME,"boxStyle"))&&(s=l)}if(""!==s){if(o){const t=e.siblingsLeading[0];let i=!1;if(s.length>1)if(void 0===t||t.multiline||t.lineBreak||t.plainText&&_e.CHAR.TRAILINGSPACE.test(t.textContent))s=s.replace(_e.CHAR.LEADINGSPACE,"");else if(t.naturalElement){const e=t.textContent;e.length&&(i=32===e.charCodeAt(e.length-1))}if(r){const n=s;if(s=s.trim(),!t||!_e.CHAR.LEADINGSPACE.test(n)||t.block||t.lineBreak||i||(s=Ee+s),!e.lineBreakTrailing&&_e.CHAR.TRAILINGSPACE.test(n)){const t=e.siblingsTrailing.find(e=>!e.excluded||e.lineBreak);t&&!t.blockStatic&&(s+=Ee)}}else if(""!==s.trim())s=(s=s.replace(_e.CHAR.LEADINGSPACE,t&&(t.block||t.lineBreak||i&&t.htmlElement&&t.textContent.length>1||e.multiline&&Ne.hasLineBreak(e))?"":Ee)).replace(_e.CHAR.TRAILINGSPACE,"table-cell"===e.display||e.lineBreakTrailing||e.blockStatic?"":Ee);else if(!e.inlineText)return}""!==s&&e.data(Ne.KEY_NAME,"valueString",{key:n,value:s})}""!==a&&e.data(Ne.KEY_NAME,"hintString",a)}else if(e.inlineText&&e.textContent){const t=e.textContent;e.data(Ne.KEY_NAME,"valueString",{key:t,value:t})}}}}}Ne.KEY_NAME="squared.resource",Ne.STORED={strings:new Map,arrays:new Map,fonts:new Map,colors:new Map,images:new Map};const{constant:Le,css:Oe,regex:Me,util:He}=squared.lib,We="[\\d.]+[a-z%]+|auto|max-content|min-content",De="minmax\\(([^,]+), ([^)]+)\\)",Fe="fit-content\\(([\\d.]+[a-z%]+)\\)",Xe="\\[([\\w\\-\\s]+)\\]",Ue={};function Ge(e,t){const i=[],n=[],s=t.length;for(let a=0;a<s;a++)e.repeat[a]?n.push(t[a]):i.push(t[a]);const a=[],o=e.length,r=o-i.length;for(let t=0;t<o;t++){if(e.repeat[t]){for(let e=0,i=0;e<r;t++,e++,i++)i===n.length&&(i=0),a[t]=n[i];break}i.length&&(a[t]=i.shift())}return a}function ze(e){let t=0;for(const i of e)i&&t++;return t}const Ve=(e,t)=>Oe.isLength(t)?e.convertPX(t):t;class $e extends pe{static createDataAttribute(e="",t="",i="",n=""){return{children:new Set,rowData:[],rowHeight:[],rowWeight:[],rowSpanMultiple:[],templateAreas:{},row:$e.createDataRowAttribute(),column:$e.createDataRowAttribute(),emptyRows:[],alignItems:e,alignContent:t,justifyItems:i,justifyContent:n}}static createDataRowAttribute(){return{length:0,gap:0,unit:[],unitMin:[],unitTotal:[],repeat:[],auto:[],autoFill:!1,autoFit:!1,name:{},normal:!0}}condition(e){return e.gridElement&&e.length>0}processNode(e){void 0===Ue.UNIT&&(Ue.UNIT=RegExp(`^(${We})$`),Ue.NAMED=RegExp(`\\s*(repeat\\((auto-fit|auto-fill|\\d+), (.+)\\)|${Xe}|${De}|${Fe}|${We})\\s*`,"g"),Ue.REPEAT=RegExp(`\\s*(${Xe}|${De}|${Fe}|${We})\\s*`,"g"),Ue.STARTEND=/^([\w\-]+)-(start|end)$/);const t=$e.createDataAttribute(e.css("alignItems"),e.css("alignContent"),e.css("justifyItems"),e.css("justifyContent")),i=e.css("gridAutoFlow"),n=-1===i.indexOf("column"),s=-1!==i.indexOf("dense"),a=[],o=[],r=[];let l={};if(t.row.gap=e.parseUnit(e.css("rowGap"),Le.CSS.HEIGHT,!1),t.column.gap=e.parseUnit(e.css("columnGap"),Le.CSS.WIDTH,!1),[e.cssInitial("gridTemplateRows",!0),e.cssInitial("gridTemplateColumns",!0),e.css("gridAutoRows"),e.css("gridAutoColumns")].forEach((i,n)=>{if(i&&i!==Le.CSS.NONE&&i!==Le.CSS.AUTO){let s;Ue.NAMED.lastIndex=0;let a=1;for(;null!==(s=Ue.NAMED.exec(i));)if(n<2){const i=t[0===n?"row":"column"];if(s[1].startsWith("repeat")){let t=1;switch(s[2]){case"auto-fit":i.autoFit=!0;break;case"auto-fill":i.autoFill=!0;break;default:t=He.convertInt(s[2])}if(t>0){void 0===Ue.CELL_UNIT?(Ue.CELL_UNIT=/[\d.]+[a-z%]+|auto|max-content|min-content/,Ue.CELL_MINMAX=/minmax\(([^,]+), ([^)]+)\)/,Ue.CELL_FIT_CONTENT=/fit-content\(([\d.]+[a-z%]+)\)/,Ue.CELL_NAMED=/\[([\w\-\s]+)\]/):Ue.REPEAT.lastIndex=0;const n=[];let o;for(;null!==(o=Ue.REPEAT.exec(s[3]));){let t;null!==(t=Ue.CELL_NAMED.exec(o[1]))?(void 0===i.name[t[1]]&&(i.name[t[1]]=[]),n.push({name:t[1]})):null!==(t=Ue.CELL_MINMAX.exec(o[1]))?n.push({unit:Ve(e,t[2]),unitMin:Ve(e,t[1])}):null!==(t=Ue.CELL_FIT_CONTENT.exec(o[1]))?n.push({unit:Ve(e,t[1]),unitMin:Le.CSS.PX_0}):null!==(t=Ue.CELL_UNIT.exec(o[1]))&&n.push({unit:Ve(e,t[0])})}if(n.length)for(let e=0;e<t;e++)for(const e of n)e.name?i.name[e.name].push(a):e.unit&&(i.unit.push(e.unit),i.unitMin.push(e.unitMin||""),i.repeat.push(!0),a++)}}else"["===s[1].charAt(0)?(void 0===i.name[s[4]]&&(i.name[s[4]]=[]),i.name[s[4]].push(a)):s[1].startsWith("minmax")?(i.unit.push(Ve(e,s[6])),i.unitMin.push(Ve(e,s[5])),i.repeat.push(!1),a++):s[1].startsWith("fit-content")?(i.unit.push(Ve(e,s[7])),i.unitMin.push(Le.CSS.PX_0),i.repeat.push(!1),a++):Ue.UNIT.test(s[1])&&(i.unit.push(s[1]===Le.CSS.AUTO?Le.CSS.AUTO:Ve(e,s[1])),i.unitMin.push(""),i.repeat.push(!1),a++)}else t[2===n?"row":"column"].auto.push(e.convertPX(s[1]))}}),e.sort(n?(e,t)=>He.withinRange(e.linear.top,t.linear.top)?He.withinRange(e.linear.left,t.linear.left)?0:e.linear.left<t.linear.left?-1:1:e.linear.top<t.linear.top?-1:1:(e,t)=>He.withinRange(e.linear.left,t.linear.left)?He.withinRange(e.linear.top,t.linear.top)?0:e.linear.top<t.linear.top?-1:1:e.linear.left<t.linear.left?-1:1),!e.has("gridTemplateAreas")&&e.every(e=>e.css("gridRowStart")===Le.CSS.AUTO&&e.css("gridColumnStart")===Le.CSS.AUTO)){let i,s,a,o,l;n?(i=Le.CSS.TOP,s=Le.CSS.BOTTOM,a=2,o=1,l=3):(i=Le.CSS.LEFT,s=Le.CSS.RIGHT,a=3,o=0,l=2);let c,h=0,d=0,u=0;e.each((e,f)=>{(void 0===c||e.linear[i]>=c.linear[s]||d>0&&d===u)&&(u=Math.max(d,u),h++,d=1);const g=e.css("gridRowEnd"),p=e.css("gridColumnEnd");let m=1,b=1;if(g.startsWith("span")?m=parseInt(g.split(" ")[1]):He.isNumber(g)&&(m=parseInt(g)-h),p.startsWith("span")?b=parseInt(p.split(" ")[1]):He.isNumber(p)&&(b=parseInt(p)-d),1===d&&u>0){let e=!1;do{const i=Array(u-1).fill(1);for(const e of r){const t=e.placement;if(t[a]>h)for(let e=t[o];e<t[l];e++)i[e-1]=0}for(let t=0,n=0,s=0;t<i.length;t++)if(i[t]){if(0===n&&(s=t),++n===b){d=s+1,e=!0;break}}else n=0;e||(t.emptyRows[h-1]=i,h++)}while(!e)}r[f]={placement:n?[h,d,h+m,d+b]:[d,h,d+b,h+m],rowSpan:m,columnSpan:b},d+=b,c=e})}else e.css("gridTemplateAreas").split(/"[\s\n]+"/).forEach((e,i)=>{if(e!==Le.CSS.NONE){const n=t.templateAreas;He.trimString(e.trim(),'"').split(Me.CHAR.SPACE).forEach((e,t)=>{"."!==e.charAt(0)&&(n[e]?(n[e].rowSpan=i-n[e].rowStart+1,n[e].columnSpan=t-n[e].columnStart+1):n[e]={rowStart:i,rowSpan:1,columnStart:t,columnSpan:1})})}}),e.each((e,i)=>{const n=[e.css("gridRowStart"),e.css("gridColumnStart"),e.css("gridRowEnd"),e.css("gridColumnEnd")],s=[];let a=1,o=1;if(Object.keys(t.templateAreas).length)for(let e=0;e<4;e++){const i=n[e];let a=t.templateAreas[i];if(a)switch(e){case 0:s[0]=a.rowStart+1;break;case 1:s[1]=a.columnStart+1;break;case 2:s[2]=a.rowStart+a.rowSpan+1;break;case 3:s[3]=a.columnStart+a.columnSpan+1}else{const n=Ue.STARTEND.exec(i);if(n&&(a=t.templateAreas[n[1]]))if(n[2]===Le.CSS.START)switch(e){case 0:case 2:s[e]=a.rowStart+1;break;case 1:case 3:s[e]=a.columnStart+1}else switch(e){case 0:case 2:s[e]=a.rowStart+a.rowSpan+1;break;case 1:case 3:s[e]=a.columnStart+a.columnSpan+1}}}if(!(s[0]&&s[1]&&s[2]&&s[3])){function l(e,t){if(He.isNumber(e))return s[t]=parseInt(e),!0;if(e.startsWith("span")){const i=parseInt(e.split(" ")[1]);return s[t-2]?s[t]=s[t-2]+i:t%2==0?a=i:o=i,!0}return!1}let e,i;for(let r=0;r<4;r++){const c=n[r];if(c!==Le.CSS.AUTO&&!s[r]&&!l(c,r)){const l=t[r%2==0?"row":"column"],h=c.split(" ");1===h.length?(h[1]=h[0],h[0]="1"):He.isNumber(h[0])&&(r%2==0?e?a=parseInt(h[0])-parseInt(e[0]):e=h:i?o=parseInt(h[0])-parseInt(i[0]):i=h);const d=l.name[h[1]];if(d){const e=parseInt(h[0]);e<=d.length&&(s[r]=d[e-1]+(h[1]===n[r-2]?1:0))}}s[r]||l(c,r)}}r[i]={placement:s,rowSpan:a,columnSpan:o}});{const e=t[n?"column":"row"];e.length=Math.max(1,e.unit.length);for(const t of r)t&&(e.length=Math.max(e.length,n?t.columnSpan:t.rowSpan,t.placement[n?1:0]||0,(t.placement[n?3:2]||0)-1));(e.autoFill||e.autoFit)&&(0===e.unit.length&&(e.unit.push(Le.CSS.AUTO),e.unitMin.push(""),e.repeat.push(!0)),e.unit=Ge(e,e.unit),e.unitMin=Ge(e,e.unitMin));let i=1,s=0;for(const t of e.unit)Oe.isPercent(t)?i-=parseFloat(t)/100:t.endsWith("fr")&&(s+=parseFloat(t));if(i>0&&s>0){const t=e.unit.length;for(let n=0;n<t;n++)e.unit[n].endsWith("fr")&&(e.unit[n]=i*(parseFloat(e.unit[n])/s)+"fr")}const a=t.row.unit.length+1,o=t.column.unit.length+1;for(const e of r){const t=e.placement;t[2]<0&&(a>1?t[2]+=a+1:t[2]=void 0),t[3]<0&&(o>1?t[3]+=o+1:t[3]=void 0)}}if(e.each((e,i)=>{const c=r[i],h=c.placement;let d,u,f,g,p,m,b;for(n?(d=c.rowSpan,u=c.columnSpan,f=t.column.length,g=0,p=1,m=2,b=3):(d=c.columnSpan,u=c.rowSpan,f=t.row.length,g=1,p=0,m=3,b=2);!h[0]||!h[1];){const e=h.slice(0);if(!e[g]){let t=a.length;for(let i=0,n=0,s=-1;i<t;i++)if(!l[i])if(void 0===o[i]||o[i]<f){if(0===n&&(s=i,t=Math.max(t,i+d)),++n===d){e[g]=s+1;break}}else n=0,s=-1,t=a.length}if(e[g]){if(!e[p]){e[m]||(e[m]=e[g]+d);const t=[],i=e[g]-1,n=e[m]-1;for(let e=i;e<n;e++)if(void 0===a[e])t.push([[0,-1]]);else{if(!(ze(a[e])+u<=f))break;{const i=[];let n=0;for(let t=0,s=-1;t<f;t++)void 0===a[e][t]&&(-1===s&&(s=t),n++),(a[e][t]||t===f-1)&&(n>=u&&i.push([s,s+n]),s=-1,n=0);if(!i.length)break;t.push(i)}}const s=t.length;if(s){const a=t[0];if(-1===a[0][1])e[p]=1;else if(s===n-i)if(s>1)e:for(const i of a)for(let n=i[0];n<i[1];n++)for(let i=1;i<s;i++){const s=t[i].length;for(let a=0;a<s;a++){const s=t[i][a];if(n>=s[0]&&(-1===s[1]||n+u<=s[1])){e[p]=n+1;break e}}}else e[p]=a[0][0]+1}}}else h[g]=a.length+1,h[p]||(h[p]=1);e[g]&&e[p]?(h[g]=e[g],h[p]=e[p]):e[g]&&(l[e[g]-1]=!0)}if(h[m]||(h[m]=h[g]+d),h[b]||(h[b]=h[p]+u),function(e,t){if(t.every(e=>e>0)){for(let i=t[n?0:1]-1;i<t[n?2:3]-1;i++){void 0===a[i]&&(a[i]=[]);for(let s=t[n?1:0]-1;s<t[n?3:2]-1;s++)void 0===o[i]&&(o[i]=0),void 0===a[i][s]&&(a[i][s]=[],o[i]++),a[i][s].push(e)}return!0}return!1}(e,h)){const i=h[0]-1,n=h[2]-h[0];if(n>1)for(let e=i;e<i+n;e++)t.rowSpanMultiple[e]=!0;e.data(P.CSS_GRID,"cellData",{rowStart:i,rowSpan:n,columnStart:h[1]-1,columnSpan:h[3]-h[1]}),s&&(l={})}}),a.length){if(n)t.rowData=a;else{const e=a.length;for(let i=0;i<e;i++){const e=a[i].length;for(let n=0;n<e;n++)void 0===t.rowData[n]&&(t.rowData[n]=[]),t.rowData[n][i]=a[i][n]}}const i=t[n?"row":"column"].unitTotal,s=t.children;let o=0;for(const e of t.rowData){const t=e.length;o=Math.max(t,o);for(let a=0;a<t;a++){const t=e[a];if(void 0===i[a]&&(i[a]=0),t){let e=0;for(const i of t)s.has(i)||(e=Math.max(e,n?i.bounds.height:i.bounds.width)),s.add(i);i[a]+=e}}}if(s.size===e.length){const i=t.rowData.length;t.row.length=i,t.column.length=o;const n=new Set,a=t.rowHeight;for(let e=0;e<i;e++){a.push(0);const s=t.rowData[e];for(let r=0;r<o;r++){const l=s[r];if(l)for(const s of l)if(!n.has(s)){const l=s.data(P.CSS_GRID,"cellData"),c=e+l.rowSpan-1;r+l.columnSpan-1<o-1&&s.modifyBox(4,t.column.gap),c<i-1&&s.modifyBox(8,t.row.gap),1===l.rowSpan&&(a[e]=Math.max(a[e],s.bounds.height)),n.add(s)}}}const r=t.rowWeight,l=a.length;for(let t=0;t<l;t++)r[t]=a[t]/e.actualHeight;e.retain(Array.from(s)),e.cssSort("zIndex"),e.cssTry("display","block")&&(e.each(e=>{const t=e.initial.bounds;if(t){const i=e.element.getBoundingClientRect();t.width=i.width,t.height=i.height}}),e.cssFinally("display")),e.data(P.CSS_GRID,k.EXT_DATA,t)}}}}const{constant:qe,util:je}=squared.lib;class Ye extends pe{static createDataAttribute(e,t){const i=e.css("flexWrap"),n=e.css("flexDirection");return{directionRow:n.startsWith("row"),directionColumn:n.startsWith("column"),directionReverse:n.endsWith("reverse"),wrap:i.startsWith("wrap"),wrapReverse:"wrap-reverse"===i,alignContent:e.css("alignContent"),justifyContent:e.css("justifyContent"),rowCount:0,columnCount:0,children:t}}condition(e){return e.flexElement&&e.length>0}processNode(e){const t=this.application.controllerHandler,[i,n]=e.partition(e=>e.pageFlow&&!e.renderExclude),s=Ye.createDataAttribute(e,i);if(e.cssTry("align-items",qe.CSS.START)){if(e.cssTry("justify-items",qe.CSS.START)){for(const e of i){const t=e.initial.bounds;if(t&&e.cssTry("align-self",qe.CSS.START)){if(e.cssTry("justify-self",qe.CSS.START)){if(e.cssTry("flex-grow","0")){if(e.cssTry("flex-shrink","1")){const i=e.element.getBoundingClientRect();t.width=i.width,t.height=i.height,e.cssFinally("flex-shrink")}e.cssFinally("flex-grow")}e.cssFinally("justify-self")}e.cssFinally("align-self")}}e.cssFinally("justify-items")}e.cssFinally("align-items")}if(s.wrap){let a,o,r,l;s.directionRow?(a=qe.CSS.TOP,o=qe.CSS.LEFT,r=qe.CSS.RIGHT,l="intersectY"):(a=qe.CSS.LEFT,o=qe.CSS.TOP,r=qe.CSS.BOTTOM,l="intersectX"),i.sort((e,t)=>e[l](t.bounds,"bounds")?je.withinRange(e.linear[o],t.linear[o])?0:e.linear[o]<t.linear[o]?-1:1:e.linear[a]<t.linear[a]?-1:1);let c=[i[0]],h=i[0];const d=[c];let u=i.length;for(let e=1;e<u;e++){const t=i[e];h[l](t.bounds,"bounds")?c.push(t):(h=t,d.push(c=[t]))}e.clear();let f=0,g=0;if((u=d.length)>1){const i=e.box[r];for(let n=0;n<u;n++){const s=d[n],a=t.createNodeGroup(s[0],s,e,!0);a.containerIndex=n;const o=a.unsafe("box");o&&(o[r]=i),a.addAlign(128),f=Math.max(s.length,f)}g=u}else{const t=d[0];e.retain(t);for(let e=0;e<t.length;e++)t[e].containerIndex=e;g=f=t.length}for(let e=0;e<n.length;e++)n[e].containerIndex=g+e;e.concat(n),e.sort(),s.directionRow?(s.rowCount=u,s.columnCount=f):(s.rowCount=f,s.columnCount=u)}else{if(i.some(e=>0!==e.flexbox.order)){const e=s.directionReverse?-1:1,t=s.directionReverse?1:-1;i.sort((i,n)=>i.flexbox.order===n.flexbox.order?0:i.flexbox.order>n.flexbox.order?e:t)}s.directionRow?(s.rowCount=1,s.columnCount=e.length):(s.rowCount=e.length,s.columnCount=1)}e.data(P.FLEXBOX,k.EXT_DATA,s)}}const{constant:Ke,css:Qe,util:Ze}=squared.lib;function Je(e,t){const i=t.linear.top;for(const t of e){const e=t.findIndex(e=>Ze.withinRange(i,e.linear.top)||i>e.linear.top&&i<e.linear.bottom);if(-1!==e)return e}return-1}class et extends pe{static createDataAttribute(e=0){return{paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,columnCount:e}}static createDataCellAttribute(){return{rowSpan:0,columnSpan:0,index:-1,cellStart:!1,cellEnd:!1,rowEnd:!1,rowStart:!1,block:!1}}condition(e){if(e.length>1&&!e.layoutElement&&!e.has("listStyle")){if("table"===e.display)return e.every(e=>"table-row"===e.display&&e.every(e=>"table-cell"===e.display));{let t=0,i=0;for(const n of e){if(!n.pageFlow||n.visibleStyle.background||!n.blockStatic||n.autoMargin.leftRight||n.autoMargin.left)return!1;n.length>1&&t++,"list-item"!==n.display||n.has("listStyleType")||i++}if(i===e.length)return!0;if(t>0)return e.every(e=>e.length>0&&$.linearData(e.children).linearX)}}return!1}processNode(e){const t=[],i=[],n={};for(const t of e)for(const e of t){const t=Math.floor(e.linear.left);void 0===n[t]&&(n[t]=[]),n[t].push(e)}const s=Object.keys(n),a=s.length;if(a){let o=-1;for(let e=0;e<a;e++){const t=n[s[e]];if(0===e)o=a;else if(o!==t.length){o=-1;break}}if(-1!==o)for(let e=0;e<a;e++)i.push(n[s[e]]);else{const o=[];for(let e=0;e<a;e++){const t=n[s[e]],a=t.length;if(0===e&&0===a)return;o[e]=0===e?0:o[e-1];for(let n=0;n<a;n++){const s=t[n];if(0===e||Ze.aboveRange(s.linear.left,o[e-1]))if(void 0===i[e]&&(i[e]=[]),0===e||i[0].length===a)i[e][n]=s;else{const t=Je(i,s);if(-1===t)return;i[e][t]=s}else{const e=i.length-1;if(i[e]){let t=1/0,n=-1/0;if(i[e].forEach(e=>{const{left:i,right:s}=e.linear;i<t&&(t=i),s>n&&(n=s)}),Math.floor(s.linear.left)>Math.ceil(t)&&Math.floor(s.linear.right)>Math.ceil(n)){const t=Je(i,s);if(-1!==t)for(let n=i.length-1;n>=0;n--)if(i[n]){void 0===i[n][t]&&(i[e].length=0);break}}}}o[e]=Math.max(s.linear.right,o[e])}}const r=o.length;for(let e=0,t=-1;e<r;e++)void 0===i[e]?-1===t?t=e-1:e===r-1&&(o[t]=o[e]):-1!==t&&(o[t]=o[e-1],t=-1);for(let e=0;e<i.length;e++)i[e]&&i[e].length?t.push(o[e]):i.splice(e--,1);const l=i.reduce((e,t)=>Math.max(e,t.length),0);for(let e=0;e<l;e++){const t=i.length;for(let n=0;n<t;n++)void 0===i[n][e]&&(i[n][e]={spacer:1})}t.push(e.box.right)}}const o=i.length;if(o>1&&i[0].length===e.length){const n=et.createDataAttribute(o),s=[],a=new Set;for(let e=0,n=0;e<o;e++){let r=0;for(let l=0,c=0;l<i[e].length;l++){const h=i[e][l],d=i[e].length;if(void 0===s[l]&&(s[l]=[]),h.spacer)1===h.spacer&&r++;else{const u=Object.assign(et.createDataCellAttribute(),h.data(P.GRID,"cellData"));let f=1,g=1+r;for(let t=e+1;t<o&&1===i[t][l].spacer;t++)g++,i[t][l].spacer=2;if(1===g)for(let t=l+1;t<d&&1===i[e][t].spacer;t++)f++,i[e][t].spacer=2;if(t.length){const i=Math.min(e+(g-1),t.length-1);for(const e of h.documentParent.naturalChildren)!a.has(e)&&e.visible&&!e.rendered&&Ze.aboveRange(e.linear.left,h.linear.right)&&Ze.belowRange(e.linear.right,t[i])&&(void 0===u.siblings&&(u.siblings=[]),u.siblings.push(e))}u.rowSpan=f,u.columnSpan=g,u.rowStart=0==c++,u.rowEnd=g+e===o,u.cellStart=0===n,u.cellEnd=u.rowEnd&&l===d-1,u.index=e,r=0,h.data(P.GRID,"cellData",u),s[l].push(h),a.add(h)}}}e.each(e=>e.hide()),e.clear();for(const t of s){let i=!0,s=!1;for(const e of t){const t=e.css(Ke.CSS.WIDTH);if(Qe.isPercent(t))s=!0;else if(!Qe.isLength(t)){i=!1;break}}if(i&&s&&t.length>1){const e=t[0].data(P.GRID,"cellData");if(e&&1===e.rowSpan){let i=e.siblings?e.siblings.slice(0):[];const s=t.length;for(let e=1;e<s;e++){const n=t[e].data(P.GRID,"cellData");if(!n||1!==n.rowSpan){i.length=0;break}i.push(t[e]),n.siblings&&(i=i.concat(n.siblings))}i.length&&(e.block=!0,e.columnSpan=n.columnCount,e.siblings=i,t.length=1)}}for(const n of t)n.parent=e,!i&&n.percentWidth&&n.css(Ke.CSS.WIDTH,Qe.formatPX(n.bounds.width))}e.tableElement&&"collapse"===e.css("borderCollapse")&&(e.modifyBox(32),e.modifyBox(64),e.modifyBox(128),e.modifyBox(256)),e.data(P.GRID,k.EXT_DATA,n)}}}const{constant:tt,css:it}=squared.lib,nt=e=>e.visibleStyle.backgroundImage&&!e.visibleStyle.backgroundRepeat;class st extends pe{static createDataAttribute(){return{ordinal:"",imageSrc:"",imagePosition:""}}condition(e){if(super.condition(e)){const t=e.length;if(t){const i=new Set,n=e.children;let s=0,a=0,o=0,r=0,l=0,c=0;for(let e=0;e<t;e++){const h=n[e],d=h.css("listStyleType")!==tt.CSS.NONE;if("list-item"===h.display?(d||h.innerBefore||nt(h))&&c++:nt(h)&&!d&&h.marginLeft<0&&l++,h.blockStatic?s++:s=1/0,h.inlineVertical?a++:s=1/0,h.floating?(i.add(h.float),o++,r=1/0):0===e||e===t-1||h.blockStatic||n[e-1].blockStatic&&n[e+1].blockStatic?(r++,o=1/0):(o=1/0,r=1/0),s===1/0&&a===1/0&&r===1/0&&o===1/0)return!1}return(l>0||c>0)&&(s===t||a===t||o===t&&1===i.size||r===t)}}return!1}processNode(e){let t=1;e.each(e=>{const i=st.createDataAttribute(),n=e.css("listStyleType");if("list-item"===e.display||n&&n!==tt.CSS.NONE||nt(e)){if(e.has("listStyleImage"))i.imageSrc=e.css("listStyleImage");else{let s=it.convertListStyle(n,t);if(""===s)switch(n){case"disc":s="●";break;case"square":s="■";break;case"none":let t="",a="";e.visibleStyle.backgroundRepeat||(t=e.backgroundImage,a=e.css("backgroundPosition")),t&&t!==tt.CSS.NONE&&(i.imageSrc=t,i.imagePosition=a,e.exclude(L.IMAGE_SOURCE));break;default:s="○"}else s+=".";i.ordinal=s}t++}e.data(P.LIST,k.EXT_DATA,i)})}}const{constant:at,dom:ot,util:rt}=squared.lib;const lt=squared.lib.css;const ct=squared.lib.css;const{constant:ht,css:dt,dom:ut,math:ft,util:gt}=squared.lib,pt=/rgba\(0, 0, 0, 0\)|transparent/;class mt extends pe{static createDataAttribute(e){return{layoutType:0,rowCount:0,columnCount:0,layoutFixed:"fixed"===e.css("tableLayout"),borderCollapse:"collapse"===e.css("borderCollapse"),expand:!1}}processNode(e){const t=mt.createDataAttribute(e);let i=[];function n(t){t.data(P.TABLE,"percent",`${Math.round(t.bounds.width/e.box.width*100)}%`),t.data(P.TABLE,"expand",!0)}function s(e){if(e.length){for(const t of e[0].cascade())"TH"!==t.tagName&&"TD"!==t.tagName||(t.inherit(e[0],"styleMap"),t.unsetCache("visibleStyle"));i=i.concat(e[0].children);for(const t of e)t.hide()}}const a=e=>e.css(ht.CSS.WIDTH,dt.formatPX(e.bounds.width),!0),o=[],r=[],l=[];e.each(e=>{switch(e.tagName){case"THEAD":o.push(e);break;case"TBODY":r.push(e);break;case"TFOOT":l.push(e)}}),s(o);for(const e of r)i=i.concat(e.children),e.hide();s(l);const[c,h]=t.borderCollapse?[0,0]:gt.replaceMap(e.css("borderSpacing").split(" "),(t,i)=>e.parseUnit(t,0===i?ht.CSS.WIDTH:ht.CSS.HEIGHT)),d=c>1?Math.round(c/2):c,u=h>1?Math.round(h/2):h,f=e.element.querySelector("COLGROUP"),g=[],p=[],m=[],b=[],S=i.length;let x=Array(S).fill(0),T=0;for(let n=0;n<S;n++){const s=i[n];g[n]=c,m[n]=[],s.each((i,s)=>{const a=i.element;for(let e=0;e<a.rowSpan-1;e++){const t=n+e+1;void 0!==x[t]&&(x[t]+=a.colSpan)}if(!i.hasPX(ht.CSS.WIDTH)){const e=ut.getNamedItem(a,ht.CSS.WIDTH);dt.isPercent(e)?i.css(ht.CSS.WIDTH,e):gt.isNumber(e)&&i.css(ht.CSS.WIDTH,dt.formatPX(parseFloat(e)))}if(!i.hasPX(ht.CSS.HEIGHT)){const e=ut.getNamedItem(a,ht.CSS.HEIGHT);dt.isPercent(e)?i.css(ht.CSS.HEIGHT,e):gt.isNumber(e)&&i.css(ht.CSS.HEIGHT,dt.formatPX(parseFloat(e)))}if(!i.visibleStyle.backgroundImage&&!i.visibleStyle.backgroundColor)if(f){const e=dt.getStyle(f.children[x[n]]);e.backgroundImage&&e.backgroundImage!==ht.CSS.NONE&&i.css("backgroundImage",e.backgroundImage,!0),e.backgroundColor&&!pt.test(e.backgroundColor)&&i.css("backgroundColor",e.backgroundColor,!0)}else{let e=dt.getInheritedStyle(a,"backgroundImage",/none/,"TABLE");""!==e&&i.css("backgroundImage",e,!0),""!==(e=dt.getInheritedStyle(a,"backgroundColor",pt,"TABLE"))&&i.css("backgroundColor",e,!0)}switch(i.tagName){case"TH":{function o(t){i.ascend(void 0,e).some(e=>!!e.has(`${t}Style`)&&(i.css(`${t}Style`,e.css(`${t}Style`)),i.css(`${t}Color`,e.css(`${t}Color`)),i.css(`${t}Width`,e.css(`${t}Width`),!0),i.css("border","inherit"),!0))}i.cssInitial("textAlign")||i.css("textAlign",i.css("textAlign")),0===i.borderTopWidth&&o("borderTop"),0===i.borderRightWidth&&o("borderRight"),0===i.borderBottomWidth&&o("borderBottom"),0===i.borderLeftWidth&&o("borderLeft")}case"TD":i.cssInitial("verticalAlign")||i.css("verticalAlign",ht.CSS.MIDDLE,!0)}const r=i.cssInitial(ht.CSS.WIDTH),l=x[n],m=void 0===b[l]||b[l]===ht.CSS.AUTO;if(0===n||m||!t.layoutFixed)if(""===r||r===ht.CSS.AUTO)void 0===b[l]?(b[l]=r||ht.CSS.PX_0,p[l]=0):n===S-1&&m&&0===p[l]&&(p[l]=i.bounds.width);else{const e=dt.isLength(b[l]),t=dt.isPercent(r);(m||i.bounds.width<p[l]||i.bounds.width===p[l]&&(e&&t||t&&dt.isPercent(b[l])&&gt.convertFloat(r)>gt.convertFloat(b[l])||e&&dt.isLength(r)&&gt.convertFloat(r)>gt.convertFloat(b[l])))&&(b[l]=r),(m||1===a.colSpan)&&(p[l]=i.bounds.width)}(i.length||i.inlineText)&&(g[n]+=i.bounds.width+c),d>0&&(i.modifyBox(16,0===x[n]?c:d),i.modifyBox(4,0===s?d:c)),u>0&&(i.modifyBox(2,0===n?h:u),i.modifyBox(8,n+a.rowSpan<S?u:h)),x[n]+=a.colSpan}),T=Math.max(T,x[n])}if(e.hasPX(ht.CSS.WIDTH,!1)&&b.some(e=>dt.isPercent(e))&&gt.replaceMap(b,(e,t)=>e===ht.CSS.AUTO&&p[t]>0?dt.formatPX(p[t]):e),b.every(e=>dt.isPercent(e))&&b.reduce((e,t)=>e+parseFloat(t),0)>1){let e=100;gt.replaceMap(b,t=>{const i=parseFloat(t);return e<=0?t=ht.CSS.PX_0:e-i<0&&(t=dt.formatPercent(e/100)),e-=i,t})}else if(b.every(e=>dt.isLength(e))){const i=b.reduce((e,t)=>e+parseFloat(t),0);if(e.hasWidth)if(i<e.width)gt.replaceMap(b,e=>e!==ht.CSS.PX_0?`${parseFloat(e)/i*100}%`:e);else if(i>e.width&&(e.css(ht.CSS.WIDTH,ht.CSS.AUTO,!0),!t.layoutFixed))for(const t of e.cascade())t.css(ht.CSS.WIDTH,ht.CSS.AUTO,!0);t.layoutFixed&&!e.hasPX(ht.CSS.WIDTH)&&e.css(ht.CSS.WIDTH,dt.formatPX(e.bounds.width),!0)}const y=b.reduce((e,t)=>e+(dt.isPercent(t)?parseFloat(t):0),0);t.layoutType=(()=>{if(t.layoutFixed&&b.reduce((e,t)=>e+(dt.isLength(t)?parseFloat(t):0),0)>=e.actualWidth)return 4;if(b.some(e=>dt.isPercent(e))||b.every(e=>dt.isLength(e)&&e!==ht.CSS.PX_0))return 3;if(b.every(e=>e===b[0])){if(e.cascadeSome(e=>e.hasHeight))return t.expand=!0,3;if(b[0]===ht.CSS.AUTO){if(e.hasWidth)return 3;{const t=e.cascade(e=>"TD"===e.tagName);return t.length&&t.every(e=>gt.withinRange(e.bounds.width,t[0].bounds.width))?0:3}}if(e.hasWidth)return 2}return b.every(e=>e===ht.CSS.AUTO||dt.isLength(e)&&e!==ht.CSS.PX_0)?(e.hasWidth||(t.expand=!0),1):0})();const _=e.find(e=>"CAPTION"===e.tagName);e.clear(),_&&(_.hasWidth||(_.textElement?_.hasPX("maxWidth")||_.css("maxWidth",dt.formatPX(_.bounds.width)):_.bounds.width>ft.maxArray(g)&&a(_)),_.cssInitial("textAlign")||_.css("textAlign",ht.CSS.CENTER),_.data(P.TABLE,"colSpan",T),_.parent=e);const C=e.hasWidth;x=Array(S).fill(0);for(let s=0;s<S;s++){const o=i[s],r=o.duplicate();for(const i of r){const o=i.element,r=o.rowSpan,l=o.colSpan;for(let e=0;e<r-1;e++){const t=s+1+e;void 0!==x[t]&&(x[t]+=l)}r>1&&i.data(P.TABLE,"rowSpan",r),l>1&&i.data(P.TABLE,"colSpan",l),i.has("verticalAlign")||i.css("verticalAlign",ht.CSS.MIDDLE);const c=b[x[s]];if(void 0!==c)switch(t.layoutType){case 3:c===ht.CSS.AUTO?y>=1?(a(i),i.data(P.TABLE,"exceed",!C),i.data(P.TABLE,"downsized",!0)):n(i):dt.isPercent(c)?(i.data(P.TABLE,"percent",c),i.data(P.TABLE,"expand",!0)):dt.isLength(c)&&parseInt(c)>0?i.bounds.width>=parseInt(c)?(a(i),i.data(P.TABLE,"expand",!1),i.data(P.TABLE,"downsized",!1)):t.layoutFixed?(n(i),i.data(P.TABLE,"downsized",!0)):(a(i),i.data(P.TABLE,"expand",!1)):(i.hasPX(ht.CSS.WIDTH)&&!i.percentWidth||a(i),i.data(P.TABLE,"expand",!1));break;case 2:i.css(ht.CSS.WIDTH,ht.CSS.PX_0);break;case 1:c===ht.CSS.AUTO?i.css(ht.CSS.WIDTH,ht.CSS.PX_0):(t.layoutFixed?i.data(P.TABLE,"downsized",!0):a(i),i.data(P.TABLE,"expand",!1));break;case 4:dt.isLength(c)||i.hide()}x[s]+=l;for(let e=0;e<r;e++)for(let t=0;t<l;t++)m[s+e].push(i);i.parent=e}if(x[s]<T){r[r.length-1].data(P.TABLE,"spaceSpan",T-x[s])}o.hide()}if(t.borderCollapse){const t=e.css("borderTopColor"),i=e.css("borderTopStyle"),n=e.css("borderTopWidth"),s=e.css("borderRightColor"),a=e.css("borderRightStyle"),o=e.css("borderRightWidth"),r=e.css("borderBottomColor"),l=e.css("borderBottomStyle"),c=e.css("borderBottomWidth"),h=e.css("borderLeftColor"),d=e.css("borderLeftStyle"),u=e.css("borderLeftWidth");let f=!1,g=!1,p=!1,b=!1;for(let e=0;e<S;e++)for(let x=0;x<T;x++){const y=m[e][x];if(y&&"visible"===y.css("visibility")){if(0===e&&(y.borderTopWidth<parseInt(n)?y.cssApply({borderTopColor:t,borderTopStyle:i,borderTopWidth:n}):f=!0),e>=0&&e<S-1){const t=m[e+1][x];t&&t!==y&&"visible"===t.css("visibility")&&(y.borderBottomWidth>=t.borderTopWidth?t.css("borderTopWidth",ht.CSS.PX_0,!0):y.css("borderBottomWidth",ht.CSS.PX_0,!0))}if(e===S-1&&(y.borderBottomWidth<parseInt(c)?y.cssApply({borderBottomColor:r,borderBottomStyle:l,borderBottomWidth:c}):p=!0),0===x&&(y.borderLeftWidth<parseInt(u)?y.cssApply({borderLeftColor:h,borderLeftStyle:d,borderLeftWidth:u}):b=!0),x>=0&&x<T-1){const t=m[e][x+1];t&&t!==y&&"visible"===t.css("visibility")&&(y.borderRightWidth>=t.borderLeftWidth?t.css("borderLeftWidth",ht.CSS.PX_0,!0):y.css("borderRightWidth",ht.CSS.PX_0,!0))}x===T-1&&(y.borderRightWidth<parseInt(o)?y.cssApply({borderRightColor:s,borderRightStyle:a,borderRightWidth:o}):g=!0)}}(f||g||p||b)&&e.cssApply({borderTopWidth:ht.CSS.PX_0,borderRightWidth:ht.CSS.PX_0,borderBottomWidth:ht.CSS.PX_0,borderLeftWidth:ht.CSS.PX_0},!0)}t.rowCount=S,t.columnCount=T,e.data(P.TABLE,k.EXT_DATA,t)}}const{constant:bt,css:St,util:xt}=squared.lib;const{constant:Tt,css:yt,session:_t,util:Ct}=squared.lib,Et=null!==document.doctype&&"html"===document.doctype.name;function vt(e,t){const i=e.hasPX("minHeight",!1)?e.parseUnit(e.css("minHeight")):0;e.css("minHeight",yt.formatPX(Math.max(t,i)))}function At(e){return!!e&&((e.blockStatic||"table"===e.display)&&!e.lineBreak)}function It(e,t){const i=e[B.get(t)];let n=!1;if(0===e.getBox(t)[0])e.modifyBox(t),n=!0;else for(const s of e.ascend(void 0,void 0,"outerWrapper"))if(s.getBox(t)[1]>=i){s.modifyBox(t,-i),n=!0;break}e.companion&&n&&e.companion.modifyBox(t,-i,!1)}function wt(e,t,i){if(At(t)){let n,s,a,o;if(i?(n="marginTop",s="borderTopWidth",a="paddingTop",o=2):(a="paddingBottom",s="borderBottomWidth",n="marginBottom",o=8),0===e[s])if(0===e[a]){for(;Et&&0===t[n]&&0===t[s]&&0===t[a]&&!t.layoutElement&&!t.tableElement;){const e=i?t.firstChild:t.lastChild;if(!At(e))break;t=e}let r=!1;if(!Et&&0===e[n]&&t[n]>0&&""===t.cssInitial(n))r=!0;else{const s=e[n]>=t[n];0===t.bounds.height&&s&&t.textEmpty&&0===t.extensions.length?t.hide():1!==t.getBox(o)[0]&&(e.documentBody?s?r=!0:(It(e,o),i&&(e.bounds.top=0,e.unsafe("box",!0),e.unsafe("linear",!0))):(s||1===e.getBox(o)[0]||(e.modifyBox(o),e.modifyBox(o,t[n])),r=!0))}r&&(It(t,o),0===t.bounds.height&&It(t,i?8:2))}else if(0===t[n]&&0===t[s]&&!t.layoutElement&&!t.tableElement){let o=!0;for(;;){const r=i?t.firstChild:t.lastChild;if(!r||0!==r[n]||0!==r[s])break;if(r[a]>0){r[a]>=e[a]?e.modifyBox(i?32:128):o&&e.modifyBox(i?32:128,-r[a]);break}At(r)||(o=!1),t=r}}}}const Rt={Accessibility:class extends pe{constructor(){super(...arguments),this.options={showLabel:!1}}beforeBaseLayout(){for(const e of this.application.processing.cache)if(e.hasProcedure(O.ACCESSIBILITY))switch(e.containerName){case"INPUT_IMAGE":e.extracted=[e];break;case"INPUT_RADIO":case"INPUT_CHECKBOX":const t=e.element;[e.nextSibling,e.previousSibling].some(i=>{if(i&&i.visible&&i.pageFlow&&!i.visibleStyle.backgroundImage){const n=i.element,s="LABEL"===i.documentParent.tagName?i.documentParent:void 0;if(t.id&&t.id===n.htmlFor?e.companion=i:i.textElement&&s?(e.companion=i,s.renderAs=e):i.plainText&&(e.companion=i),e.companion)return this.options.showLabel||i.hide(),!0}return!1});break;case"BUTTON":if(e.length){const t=e.filter(e=>!e.textElement);t.length&&(e.extracted=t),e.clear()}}}},CssGrid:$e,External:class extends pe{init(e){return this.included(e)&&this.application.rootElements.add(e),!1}},Flexbox:Ye,Grid:et,List:st,Relative:class extends pe{condition(e){return e.positionRelative||0!==e.toFloat("verticalAlign",!0)}processNode(){return{include:!0}}postOptimize(e){const t=e.renderParent;if(t){const i=rt.convertFloat(e.verticalAlign);let n=e,s=e.top,a=e.right,o=e.bottom,r=e.left;if(t.support.container.positionRelative&&t.layoutHorizontal&&0===e.renderChildren.length&&(0!==e.top||0!==e.bottom||0!==i)){const i=this.application;(n=e.clone(this.application.nextId,!0,!0)).baselineAltered=!0,e.hide(!0),i.session.cache.append(n,!1);const s=new j(t,n,n.containerType,n.alignmentType),a=t.renderChildren.findIndex(t=>t===e);if(-1!==a&&(s.renderIndex=a+1),i.addLayout(s),t.layoutHorizontal&&e.documentParent.toInt("textIndent")<0&&t.renderEach(t=>{t.alignSibling(k.TOP_BOTTOM)===e.documentId?t.alignSibling(k.TOP_BOTTOM,n.documentId):t.alignSibling(k.BOTTOM_TOP)===e.documentId&&t.alignSibling(k.BOTTOM_TOP,n.documentId)}),e.baselineActive&&!e.baselineAltered)for(const i of t.horizontalRows||[t.renderChildren])if(i.includes(e)){const t=rt.filterArray(i,t=>t.positionRelative&&t.length>0&&0!==rt.convertFloat(e.verticalAlign)),n=t.length;if(n){t.sort((e,t)=>rt.withinRange(e.linear.top,t.linear.top)?0:e.linear.top<t.linear.top?-1:1);for(let i=0;i<n;i++){const n=t[i];0===i?e.modifyBox(2,rt.convertFloat(n.verticalAlign)):n.modifyBox(2,n.linear.top-t[0].linear.top),n.css("verticalAlign",at.CSS.PX_0,!0)}}break}}else if(e.naturalElement&&e.positionRelative){const i=e.actualParent;if(i){let n,l=!1;for(const c of i.naturalElements){if(c===e){if(l){if(t.layoutVertical&&(0!==e.top||0!==e.bottom)){const t=ot.assignRect(e.element.getBoundingClientRect(),!0);0!==s&&(s-=t.top-e.bounds.top),0!==o&&(o+=t.bottom-e.bounds.bottom)}if(t.layoutHorizontal&&(0!==e.left||0!==e.right)&&""===e.alignSibling(k.LEFT_RIGHT)){const t=ot.assignRect(e.element.getBoundingClientRect(),!0);0!==r&&(r-=t.left-e.bounds.left),0!==a&&(a+=t.right-e.bounds.right)}}else t.layoutVertical&&(0!==s?n&&n.blockStatic&&n.positionRelative&&c.blockStatic&&(s-=n.top):0!==o&&1===c.getBox(2)[0]&&(o-=c.marginTop));break}c.positionRelative&&c.renderParent===t&&(l=!0),n=c}}}0!==s?n.modifyBox(2,s):0!==o&&n.modifyBox(2,-1*o),0!==i&&n.modifyBox(2,-1*i),0!==r?n.autoMargin.left?n.modifyBox(4,-1*r):n.modifyBox(16,r):0!==a&&n.modifyBox(16,-1*a)}}},Sprite:class extends pe{condition(e){let t=!1;if(e.hasWidth&&e.hasHeight&&0===e.length&&""!==e.backgroundImage&&(this.included(e.element)||!e.dataset.use)){const i=this.application.resourceHandler,n=i.getRawData(e.backgroundImage)||i.getImage(lt.resolveURL(e.backgroundImage));if(n){const i=e.actualDimension,s=lt.getBackgroundPosition(`${e.css("backgroundPositionX")} ${e.css("backgroundPositionY")}`,i,e.fontSize);s.left<=0&&s.top<=0&&n.width>i.width&&n.height>i.height&&(e.data(P.SPRITE,k.EXT_DATA,{image:n,position:s}),t=!0)}}return t}},Substitute:class extends pe{constructor(e,t,i,n){super(e,t,i,n),this.require(P.EXTERNAL,!0)}processNode(e,t){const i=ct.getDataSet(e.element,this.name);if(i.tag)return e.setControlType(i.tag),e.render(t),i.tagChild&&(e.addAlign(4),e.each(e=>{e.styleElement&&(e.dataset.use=this.name,e.dataset.squaredSubstituteTag=i.tagChild)})),{output:{type:1,node:e,controlName:i.tag}}}},Table:mt,VerticalAlign:class extends pe{condition(e){let t=!1,i=0,n=0;for(const s of e)s.inlineVertical&&(n++,0!==xt.convertInt(s.verticalAlign)&&(t=!0)),(s.positionStatic||s.positionRelative&&s.length)&&i++;return t&&n>1&&i===e.length&&$.linearData(e.children).linearX}processNode(e){return e.each(e=>{(e.inlineVertical&&!e.baseline||e.imageElement)&&(e.baselineAltered=!0)}),{include:!0}}postConstraints(e){if(e.layoutHorizontal)for(const t of e.horizontalRows||[e.renderChildren]){const e=[];let i,n=1/0;for(const s of t)s.inlineVertical&&s.linear.top<=n&&(s.linear.top<n&&(e.length=0),e.push(s),n=s.linear.top),s.baselineActive&&(i=s);if(e.length){const n=e[0].linear.top;for(const s of t)if(s!==i){if(s.inlineVertical&&!s.baseline&&!e.includes(s)){let e=!1;switch(s.verticalAlign){case"super":case"sub":e=!0;break;default:(St.isLength(s.verticalAlign)||void 0===i)&&(e=!0)}e&&s.modifyBox(2,s.linear.top-n)}s.baselineAltered&&s.css("verticalAlign",bt.CSS.PX_0,!0)}i&&(i.modifyBox(2,i.linear.top-n),i.baselineAltered=!0)}}else e.each(e=>e.baselineAltered=!1)}},WhiteSpace:class extends pe{afterBaseLayout(){const e=new Set,t=new Set,i=new Set;for(const n of this.application.processing.cache)if(n.naturalElement&&!n.layoutElement&&n.naturalElements.length){const s=n.naturalChildren;let a,o;const r=s.length;for(let l=0;l<r;l++){const r=s[l];if(r.pageFlow&&(n.blockStatic&&(r.floating?o=void 0:(void 0===a&&(a=r),o=r)),0!==l&&At(r))){const n=r.previousSiblings({floating:!1});if(n.length){const s=n.find(e=>!e.floating);if(s)if(At(s)){let n=s.marginBottom,a=r.marginTop;if(s.excluded&&!r.excluded){const t=Math.min(n,s.marginTop);if(t<0){const i=Math.abs(t)>=a?void 0:t;r.modifyBox(2,i),r.companion&&r.companion.modifyBox(2,i),e.add(s.id)}}else if(!s.excluded&&r.excluded){const t=Math.min(a,r.marginBottom);t<0&&(s.modifyBox(8,Math.abs(t)>=n?void 0:t),e.add(r.id))}else{if(0===s.paddingBottom&&0===s.borderBottomWidth){const e=s.lastChild;if(At(e)&&1!==e.getBox(8)[0]){const t=e.marginBottom;t>n&&(s.css("marginBottom",yt.formatPX(n=t),!0),i.add(s.id)),It(e,8)}}if(0===r.borderTopWidth&&0===r.paddingTop){const e=r.firstChild;if(At(e)&&1!==e.getBox(2)[0]){const i=e.marginTop;i>a&&(r.css("marginTop",yt.formatPX(a=i),!0),t.add(r.id)),It(e,2)}}n>0&&(a>0?t.has(r.id)&&i.has(s.id)&&(Ct.hasBit(r.overflow,64)||Ct.hasBit(s.overflow,64))||(a<=n?t.has(r.id)?r.css("marginTop",Tt.CSS.PX_0,!0):It(r,2):i.has(s.id)?r.css("marginBottom",Tt.CSS.PX_0,!0):It(s,8)):0===s.bounds.height&&It(s,8))}}else if(s.blockDimension&&!s.block&&0===r.length){const e=r.linear.top-s.linear.bottom;Math.floor(e)>0&&0===r.ascend(e=>e.hasPX(Tt.CSS.HEIGHT)).length&&r.modifyBox(2,e)}}}}if(!(Ct.hasBit(n.overflow,64)||n.documentParent.layoutElement&&"column"===n.documentParent.css("flexDirection"))&&(a&&wt(n,a,!0),o&&(wt(n,o,!1),o.marginTop<0))){const e=o.bounds.height+o.marginBottom+o.marginTop;e<0&&n.modifyBox(128,e,!1)}}for(const t of this.application.processing.excluded)if(!e.has(t.id)&&t.lineBreak&&!t.lineBreakTrailing){const i=t.previousSiblings({floating:!1}),s=t.nextSiblings({floating:!1});let a=!1;if(i.length&&s.length){let o=i.pop();const r=s.pop();if(o.inlineStatic&&r.inlineStatic){if(0===i.length){e.add(t.id);continue}{const e=i.pop();e.lineBreak&&(e.setBounds(),e.linear.bottom>o.linear.bottom&&(o=e))}}const l=o.renderParent,c=r.renderParent;function n(){let e;return r.lineHeight>0&&r.cssTry("line-height","normal")?(e=_t.getClientRect(r.element,r.sessionId).top-r.marginTop,r.cssFinally("line-height")):e=r.linear.top,o.lineHeight>0&&o.cssTry("line-height","normal")?(e-=_t.getClientRect(o.element,o.sessionId).bottom+o.marginBottom,o.cssFinally("line-height")):e-=o.linear.bottom,e}if(a=!0,l&&c){const e=l.nodeGroup&&l.lastChild===o;if(c.nodeGroup&&c.firstChild===r)c.modifyBox(2,c.linear.top-(e?l:o).linear.bottom);else if(e)l.modifyBox(8,r.linear.top-l.linear.bottom);else{const e=n();0!==e&&(c.layoutVertical&&r.visible?r.modifyBox(2,e):l.layoutVertical&&o.visible&&o.modifyBox(8,e))}}else{const e=t.actualParent;if(e){const t=n();0!==t&&(r.lineBreak||r.excluded?e.modifyBox(128,t):o.lineBreak||o.excluded?e.modifyBox(32,t):a=!1)}else a=!1}}else{const e=t.actualParent;if(e&&e.visible){if(!e.documentRoot&&0===e.ascend(e=>e.documentRoot,void 0,"outerWrapper").length&&i.length){const t=i[i.length-1],n=e.box.bottom-t.linear[t.lineBreak||t.excluded?Tt.CSS.TOP:Tt.CSS.BOTTOM];0!==n&&(t.rendered||e.visibleStyle.background?e.modifyBox(128,n):e.hasHeight||vt(e,n))}else if(s.length){const t=s[s.length-1],i=t.linear[t.lineBreak||t.excluded?Tt.CSS.BOTTOM:Tt.CSS.TOP]-e.box.top;0!==i&&(t.rendered||e.visibleStyle.background?e.modifyBox(32,i):e.hasHeight||vt(e,i))}a=!0}}if(a){for(const t of i)e.add(t.id);for(const t of s)e.add(t.id)}}}afterConstraints(){for(const t of this.application.processing.cache){const i=t.renderParent;if(i&&t.pageFlow){function e(e,i){let n=0;switch(e){case 16:n=t.actualRect(Tt.CSS.LEFT)-i;break;case 2:n=t.actualRect(Tt.CSS.TOP)-i}n>0&&(t.renderAs||t.outerWrapper||t).modifyBox(e,n)}if(t.styleElement&&t.inlineVertical&&!t.positioned&&!t.documentParent.layoutElement&&!i.tableElement){if(t.blockDimension&&!t.floating){let n;if(i.layoutVertical){if(!t.lineBreakLeading){const n=i.renderChildren.findIndex(e=>e===t);if(-1!==n){const t=i.renderChildren[n-1];t&&t.pageFlow&&e(2,t.linear.bottom)}}}else if(i.horizontalRows)e:{const s=i.horizontalRows;let a=-1/0;const o=s.length;for(let i=0;i<o;i++){const o=s[i],r=o.length;for(let s=0;s<r;s++)if(t===o[s]){i>0?e(2,a):n=o;break e}for(const e of o)e.blockDimension&&!e.floating&&e.linear.bottom>a&&(a=e.linear.bottom);if(a===-1/0)break}}else i.layoutHorizontal&&(n=i.renderChildren);if(n){const i=t.actualParent;if(i){let s=-1/0;for(const e of i.naturalChildren){if(n.includes(e))break;e.lineBreak?s=-1/0:e.blockDimension&&!e.floating&&e.linear.bottom>s&&(s=e.linear.bottom)}s!==-1/0&&t.linear.top>s&&e(2,s)}}}if(!t.alignParent(Tt.CSS.LEFT)){let i=t;for(;;){const t=i.siblingsLeading;if(t.length&&!t.some(e=>e.lineBreak||e.excluded&&e.blockStatic)){const n=t[0];if(n.inlineVertical)e(16,n.actualRect(Tt.CSS.RIGHT));else if(n.floating){i=n;continue}}break}}}}}}}},kt={constant:M,enumeration:H};e.Application=C,e.ApplicationUI=se,e.Controller=E,e.ControllerUI=class extends E{constructor(){super(...arguments),this._requireFormat=!1,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}reset(){this._requireFormat=!1,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}preventNodeCascade(e){return this.localSettings.unsupported.cascade.has(e.tagName)}applyDefaultStyles(e){const t=this.application.processing.sessionId;let i;if(le.isPlainText(e))i={position:"static",display:"inline",verticalAlign:"baseline",float:oe.CSS.NONE,clear:oe.CSS.NONE};else{i=ce.getElementCache(e,"styleMap",t)||{};const n=()=>{if(void 0===i.border&&function(e){for(let t=0;t<4;t++)if(i[re.BOX_BORDER[t][e]])return!1;return!0}(0)){const e=this.localSettings.style.inputBorderColor;i.border=`outset 1px ${e}`;for(let t=0;t<4;t++)i[re.BOX_BORDER[t][0]]="outset",i[re.BOX_BORDER[t][1]]="1px",i[re.BOX_BORDER[t][2]]=e;return!0}return!1},s=e=>{e&&void 0===i.backgroundColor&&(i.backgroundColor=this.localSettings.style.inputBackgroundColor),void 0===i.textAlign&&(i.textAlign=oe.CSS.CENTER),void 0!==i.padding||re.BOX_PADDING.some(e=>!!i[e])||(i.paddingTop="2px",i.paddingRight="6px",i.paddingBottom="3px",i.paddingLeft="6px")};if(ae.isUserAgent(8))switch(e.tagName){case"INPUT":case"SELECT":case"BUTTON":case"TEXTAREA":void 0===i.display&&(i.display="inline-block");break;case"FIELDSET":void 0===i.display&&(i.display="block")}switch(e.tagName){case"INPUT":{const t=e.type;switch(t){case"radio":case"checkbox":break;case"week":case"month":case"time":case"date":case"datetime-local":i.paddingTop=re.formatPX(he.convertFloat(i.paddingTop)+1),i.paddingRight=re.formatPX(he.convertFloat(i.paddingRight)+1),i.paddingBottom=re.formatPX(he.convertFloat(i.paddingBottom)+1),i.paddingLeft=re.formatPX(he.convertFloat(i.paddingLeft)+1);break;case"image":void 0===i.verticalAlign&&(i.verticalAlign="text-bottom");break;default:const e=n();switch(t){case"file":case"reset":case"submit":case"button":s(e)}}break}case"BUTTON":s(n());break;case"TEXTAREA":case"SELECT":n();break;case"FORM":void 0===i.marginTop&&(i.marginTop=oe.CSS.PX_0);break;case"LI":if(void 0===i.listStyleImage){const t=re.getStyle(e);i.listStyleImage=t.getPropertyValue("list-style-image")}break;case"IFRAME":void 0===i.display&&(i.display="block");case"IMG":const t=(t,n)=>{if(void 0===i[t]||i[t]===oe.CSS.AUTO){const s=RegExp(`\\s+${t}="([^"]+)"`).exec(e.outerHTML);if(s)re.isLength(s[1])?i[t]=`${s[1]}px`:re.isPercent(s[1])&&(i[t]=s[1]);else if("IFRAME"===e.tagName)t===oe.CSS.WIDTH?i.width="300px":i.height="150px";else if(i[n]&&re.isLength(i[n])){const s=`max${he.capitalize(t)}`;if(void 0===i[s]||!re.isPercent(s)){const s=this.application.resourceHandler.getImage(e.src);s&&s.width>0&&s.height>0&&(i[t]=re.formatPX(s[t]*parseFloat(i[n])/s[n]))}}}};t(oe.CSS.WIDTH,oe.CSS.HEIGHT),t(oe.CSS.HEIGHT,oe.CSS.WIDTH)}}ce.setElementCache(e,"styleMap",t,i)}addBeforeOutsideTemplate(e,t,i=!0,n=-1){void 0===this._beforeOutside[e]&&(this._beforeOutside[e]=[]),-1!==n&&n<this._beforeOutside[e].length?this._beforeOutside[e].splice(n,0,t):this._beforeOutside[e].push(t),i&&(this._requireFormat=!0)}addBeforeInsideTemplate(e,t,i=!0,n=-1){void 0===this._beforeInside[e]&&(this._beforeInside[e]=[]),-1!==n&&n<this._beforeInside[e].length?this._beforeInside[e].splice(n,0,t):this._beforeInside[e].push(t),i&&(this._requireFormat=!0)}addAfterInsideTemplate(e,t,i=!0,n=-1){void 0===this._afterInside[e]&&(this._afterInside[e]=[]),-1!==n&&n<this._afterInside[e].length?this._afterInside[e].splice(n,0,t):this._afterInside[e].push(t),i&&(this._requireFormat=!0)}addAfterOutsideTemplate(e,t,i=!0,n=-1){void 0===this._afterOutside[e]&&(this._afterOutside[e]=[]),-1!==n&&n<this._afterOutside[e].length?this._afterOutside[e].splice(n,0,t):this._afterOutside[e].push(t),i&&(this._requireFormat=!0)}getBeforeOutsideTemplate(e,t=0){return this._beforeOutside[e]?de.pushIndentArray(this._beforeOutside[e],t):""}getBeforeInsideTemplate(e,t=0){return this._beforeInside[e]?de.pushIndentArray(this._beforeInside[e],t):""}getAfterInsideTemplate(e,t=0){return this._afterInside[e]?de.pushIndentArray(this._afterInside[e],t):""}getAfterOutsideTemplate(e,t=0){return this._afterOutside[e]?de.pushIndentArray(this._afterOutside[e],t):""}hasAppendProcessing(e){return void 0===e?this._requireFormat:void 0!==this._beforeOutside[e]||void 0!==this._beforeInside[e]||void 0!==this._afterInside[e]||void 0!==this._afterOutside[e]}includeElement(e){return!this.localSettings.unsupported.tagName.has(e.tagName)||"INPUT"===e.tagName&&!this.localSettings.unsupported.tagName.has(`${e.tagName}:${e.type}`)||"true"===e.contentEditable}visibleElement(e){const t=ce.getClientRect(e,this.application.processing.sessionId);if(ue(t)){if(t.width>0&&t.height>0)return!0;const i=re.getStyle(e);return"IMG"===e.tagName&&i.getPropertyValue("display")!==oe.CSS.NONE||t.width>0&&i.getPropertyValue("float")!==oe.CSS.NONE||i.getPropertyValue("clear")!==oe.CSS.NONE||"block"===i.getPropertyValue("display")&&(0!==parseInt(i.getPropertyValue("margin-top"))||0!==parseInt(i.getPropertyValue("margin-bottom")))||"__squared.pseudo"===e.className}return!1}evaluateNonStatic(e,t){const i=new Set;for(const n of t)if(!n.documentRoot){const t=n.parent,s=n.absoluteParent;let a;switch(n.css("position")){case"relative":if(n===t.lastChild){let i=!1;if(n.outsideX(t.box)){if(!t.hasPX(oe.CSS.WIDTH)||"hidden"===t.css("overflowX"))continue;i=!0}if(n.outsideY(t.box)){if(!t.hasHeight&&!t.hasPX(oe.CSS.HEIGHT)||"hidden"===t.css("overflowY"))continue;i=!0}if(i){a=t.actualParent;do{if(n.withinX(a.box)&&n.withinY(a.box)||"hidden"===a.css("overflow"))break;a=t.actualParent}while(a&&a!==e);a&&(n.css("position","absolute",!0),n.setBounds(!1))}}break;case"fixed":if(!n.positionAuto){a=e;break}case"absolute":if(s)if(a=s,n.positionAuto)n.siblingsLeading.some(e=>e.multiline||e.excluded&&!e.blockStatic)?n.positionAuto=!1:n.cssApply({display:"inline-block",verticalAlign:oe.CSS.TOP},!0),a=t;else if(this.userSettings.supportNegativeLeftTop){let t=!1;for(;a&&a!==e;){if(t){if(a.layoutElement){a=s;break}if(n.withinX(a.box)&&n.withinY(a.box))break}else{const e="hidden"===a.css("overflowX"),i="hidden"===a.css("overflowY");if(e&&i||n.cssInitial(oe.CSS.TOP)===oe.CSS.PX_0||n.cssInitial(oe.CSS.RIGHT)===oe.CSS.PX_0||n.cssInitial(oe.CSS.BOTTOM)===oe.CSS.PX_0||n.cssInitial(oe.CSS.LEFT)===oe.CSS.PX_0)break;{const s=!e&&n.outsideX(a.box),o=!i&&n.outsideY(a.box);if(!i&&n.linear.top<Math.floor(a.box.top)&&(n.top<0||n.marginTop<0))t=!0;else if(s&&!n.hasPX(oe.CSS.LEFT)&&n.right>0||o&&!n.hasPX(oe.CSS.TOP)&&0!==n.bottom)t=!0;else if(s&&o&&(!a.pageFlow||a.actualParent&&a.actualParent.documentBody)&&(n.top>0||n.left>0))t=!0;else if(!e&&n.outsideX(a.linear)&&!n.pseudoElement&&(n.left<0||n.marginLeft<0||!n.hasPX(oe.CSS.LEFT)&&n.right<0&&n.linear.left>=a.linear.right))t=!0;else{if(e||i||n.intersectX(a.box)||n.intersectY(a.box))break;t=!0}}}a=a.actualParent}}}if(void 0===a&&(a=n.pageFlow?t:e),a!==t){if(s&&s.positionRelative&&a!==s){const e=n.bounds;0!==s.left?(e.left+=s.left,e.right+=s.left):s.hasPX(oe.CSS.LEFT)||0===s.right||(e.left-=s.right,e.right-=s.right),0!==s.top?(e.top+=s.top,e.bottom+=s.top):s.hasPX(oe.CSS.TOP)||0===s.bottom||(e.top-=s.bottom,e.bottom-=s.bottom),n.unsafe("box",!0),n.unsafe("linear",!0)}let e=n.toFloat("opacity",!1,1),o=t;for(;o&&o!==a;)e*=o.toFloat("opacity",!1,1),o=o.actualParent;n.css("opacity",""+e),n.parent=a,n.containerIndex=1/0,i.add(a)}n.documentParent=a}for(const e of i){const t=[];let i=-1;e.each(n=>{if(n.containerIndex===1/0)for(const i of e.children){let e=i.naturalElements.includes(n);if(!e){const t=i.cascade();e=n.ascend(e=>t.includes(e)).length>0}if(e){const e=i.containerIndex+(n.zIndex>=0||i!==n.actualParent?1:0);void 0===t[e]&&(t[e]=[]),t[e].push(n);break}}else n.containerIndex>i&&(i=n.containerIndex)});const n=t.length;if(n){const s=e.children;for(let e=0,a=0,o=1;e<n;e++,a++){const n=t[e];if(n){n.sort((e,t)=>e.parent===t.parent?e.zIndex===t.zIndex?e.id<t.id?-1:1:e.zIndex<t.zIndex?-1:1:0);for(const e of n)e.containerIndex=i+o++;for(let e=0;e<s.length;e++)n.includes(s[e])&&(s[e]=void 0);s.splice(a,0,...n),a+=n.length}}e.retain(he.flatArray(s))}}}sortInitialCache(e){e.sort((e,t)=>{if(e.depth!==t.depth)return e.depth<t.depth?-1:1;{const i=e.documentParent,n=t.documentParent;if(i!==n)return i.depth!=i.depth?i.depth<i.depth?-1:1:i.actualParent===n.actualParent?i.childIndex<n.childIndex?-1:1:i.id<n.id?-1:1}return 0})}cascadeDocument(e,t){const i=t>0?"\t".repeat(t):"";let n="";for(const s of e)if(s){const e=s.node;switch(s.type){case 1:{const{controlName:a,attributes:o}=s,r=t+1,l=this.getBeforeInsideTemplate(e.id,r),c=this.getAfterInsideTemplate(e.id,r);let h=i+`<${a+(0===t?"{#0}":"")+(this.userSettings.showAttributes?o?de.pushIndent(o,r):e.extractAttributes(r):"")}`;h+=e.renderTemplates||""!==l||""!==c?">\n"+l+(e.renderTemplates?this.cascadeDocument(this.sortRenderPosition(e,e.renderTemplates),r):"")+c+i+`</${a}>\n`:" />\n",n+=this.getBeforeOutsideTemplate(e.id,t)+h+this.getAfterOutsideTemplate(e.id,t);break}case 2:{const e=s.content;e&&(n+=de.pushIndent(e,t));break}}}return n}getEnclosingXmlTag(e,t,i){return"<"+e+(t||"")+(i?">\n"+i+"</"+e+">\n":" />\n")}get generateSessionId(){return""+(new Date).getTime()}},e.Extension=v,e.ExtensionManager=class{constructor(e){this.application=e}include(e){const t=this.application,i=t.extensions.findIndex(t=>t.name===e.name);return-1!==i?(t.extensions[i]=e,!0):!(0!==e.framework&&!A.hasBit(e.framework,t.framework)||!e.dependencies.every(e=>!!this.retrieve(e.name))||(e.application=t,t.extensions.push(e),0))}exclude(e){const t=this.application.extensions;for(let i=0;i<t.length;i++)if(t[i]===e)return t.splice(i,1),!0;return!1}retrieve(e){for(const t of this.application.extensions)if(t.name===e)return t;return null}optionValue(e,t){const i=this.retrieve(e);if(i&&"object"==typeof i.options)return i.options[t]}optionValueAsObject(e,t){const i=this.optionValue(e,t);return"object"==typeof i?i:null}optionValueAsString(e,t){const i=this.optionValue(e,t);return"string"==typeof i?i:""}optionValueAsNumber(e,t){const i=this.optionValue(e,t);return"number"==typeof i?i:0}optionValueAsBoolean(e,t){const i=this.optionValue(e,t);return"boolean"==typeof i&&i}},e.ExtensionUI=pe,e.File=R,e.FileUI=class extends R{constructor(){super(...arguments),this.appName=""}get directory(){return this.resource.application.controllerHandler.localSettings.directory}},e.LayoutUI=j,e.Node=c,e.NodeGroupUI=class extends ${init(){if(this.length){for(const e of this.children)e.parent=this;this.setBounds(),this.saveAsInitial(),this.actualParent&&(this.dir=this.actualParent.dir)}}setBounds(){if(this.length){const e=$.outerRegion(this);e.width=e.right-e.left,e.height=e.bottom-e.top,this._bounds=e}}previousSiblings(e){const t=this._initial.children[0];return t?t.previousSiblings(e):[]}nextSiblings(e){const t=this._initial.children[this._initial.children.length-1];return t?t.nextSiblings(e):[]}get block(){return void 0===this._cached.block&&(this._cached.block=this.some(e=>e.block)),this._cached.block}get blockStatic(){if(void 0===this._cached.blockStatic){const e=this.naturalChildren.length&&this.naturalChildren[0].blockStatic||this.actualWidth===this.documentParent.actualWidth&&!this.some(e=>e.plainText||e.naturalElement&&e.rightAligned)||this.layoutVertical&&this.some(e=>e.naturalElement&&e.blockStatic)||this.documentParent.blockStatic&&this.hasAlign(256);(e||0!==this.containerType)&&(this._cached.blockStatic=e)}return this._cached.blockStatic||this.hasAlign(64)}get blockDimension(){return void 0===this._cached.blockDimension&&(this._cached.blockDimension=this.some(e=>e.blockDimension)),this._cached.blockDimension}get inline(){return void 0===this._cached.inline&&(this._cached.inline=this.every(e=>e.inline)),this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.every(e=>e.inlineStatic)),this._cached.inlineStatic}get inlineVertical(){return void 0===this._cached.inlineVertical&&(this._cached.inlineVertical=this.every(e=>e.inlineVertical)),this._cached.inlineVertical}get inlineFlow(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inlineStatic||this.hasAlign(128)),this._cached.inlineStatic}get pageFlow(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=!this.cssAny("position","absolute","fixed")),this._cached.pageFlow}set baseline(e){this._cached.baseline=e}get baseline(){if(void 0===this._cached.baseline){const e=this.cssInitial("verticalAlign",!0);this._cached.baseline=""!==e?"baseline"===e:this.layoutHorizontal&&this.every(e=>e.baseline)}return this._cached.baseline}get float(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.hasAlign(2048)?me.CSS.RIGHT:me.CSS.LEFT:me.CSS.NONE),this._cached.float}get floating(){return void 0===this._cached.floating&&(this._cached.floating=this.every(e=>e.floating)),this._cached.floating}get display(){return super.display||this.some(e=>e.blockStatic)?"block":this.blockDimension?"inline-block":"inline"}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e.length?e[e.length-1]:null}get tagName(){return""}get plainText(){return!1}get multiline(){return!1}get nodeGroup(){return!0}get naturalChild(){return!1}get naturalElement(){return!1}get pseudoElement(){return!1}get previousSibling(){return null}get nextSibling(){return null}get previousElementSibling(){return null}get nextElementSibling(){return null}},e.NodeList=h,e.NodeUI=$,e.Resource=f,e.ResourceUI=Ne,e.extensions=Rt,e.lib=kt,Object.defineProperty(e,"__esModule",{value:!0})});
