!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t=t||self).squared=t.squared||{},t.squared.base={}))}(this,(function(t){"use strict";class e extends squared.lib.base.Container{constructor(t){super(t),this._currentId=0}append(t,e=!0){return super.append(t),e&&this.afterAppend&&this.afterAppend.call(this,t),this}reset(){return this._currentId=0,this.clear(),this}get nextId(){return++this._currentId}}const i=squared.lib,{CSS:n,STRING:s}=i.regex,{buildAlphaString:o,fromLastIndexOf:r}=i.util;class a{reset(){for(const t in a.ASSETS)a.ASSETS[t].clear();const t=this.fileHandler;t&&t.reset()}addImage(t){var e;if(null===(e=t)||void 0===e?void 0:e.complete){if(t.src.startsWith("data:image/")){const e=RegExp(`^${s.DATAURI}$`).exec(t.src);e&&e[1]&&e[2]&&this.addRawData(t.src,e[1],e[2],e[3],t.naturalWidth,t.naturalHeight)}const e=t.src;""!==e&&a.ASSETS.images.set(e,{width:t.naturalWidth,height:t.naturalHeight,uri:e})}}getImage(t){return a.ASSETS.images.get(t)}addFont(t){const e=a.ASSETS.fonts,i=t.fontFamily.trim().toLowerCase();t.fontFamily=i;const n=e.get(i)||[];n.push(t),e.set(i,n)}getFont(t,e="normal",i){const n=a.ASSETS.fonts.get(t.trim().toLowerCase());if(n){const t=this.controllerSettings.supported.fontFormat;return n.find(n=>n.fontStyle===e&&(void 0===i||n.fontWeight===parseInt(i))&&("*"===t||t.includes(n.srcFormat)))}}addRawData(t,e,i,n,s=0,l=0){let c;e=e.toLowerCase(),"base64"===(i=i.toLowerCase())?(c=n,"image/svg+xml"===e&&(n=window.atob(n))):n=n.replace(/\\(["'])/g,(t,...e)=>e[0]);const h=this.controllerSettings.supported.imageFormat,d=t.startsWith(location.origin)?t.substring(location.origin.length+1,t.lastIndexOf("/")):"",u=()=>o(5).toLowerCase()+"_"+(new Date).getTime();let f;if("*"===h)if(t.startsWith(location.origin))f=r(t,"/");else{let t=e.split("/").pop();"svg+xml"===t&&(t="svg"),f=u()+"."+t}else for(const i of h)if(-1!==e.indexOf(i)){f=t.endsWith("."+i)?r(t,"/"):u()+"."+i;break}return f?(a.ASSETS.rawData.set(t,{pathname:d,filename:f,content:n,base64:c,mimeType:e,width:s,height:l}),f):""}getRawData(t){if(t.startsWith("url(")){const e=n.URL.exec(t);e&&(t=e[1])}return a.ASSETS.rawData.get(t)}setFileHandler(t){t.resource=this,this.fileHandler=t}}a.ASSETS={ids:new Map,images:new Map,fonts:new Map,rawData:new Map};var l=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};const c=squared.lib,{checkStyleValue:h,getSpecificity:d,getStyle:u,hasComputedStyle:f,parseSelectorText:g,validMediaRule:p}=c.css,{isTextNode:m}=c.dom,{convertCamelCase:b,isString:x,objectMap:v,resolvePath:y}=c.util,{STRING:S,XML:_}=c.regex,{getElementCache:E,setElementCache:w}=c.session,T=a.ASSETS,k=/all|screen/,A=RegExp(`(url\\("(${S.DATAURI})"\\)),?\\s*`,"g");let C,R,I,B,P,N,L,M;function W(t,e){const i=RegExp(`^@${t}([^{]+)`).exec(e);return i?i[1].trim():e}class F{constructor(t,i,n,s,o){this.framework=t,this.initializing=!1,this.closed=!1,this.rootElements=new Set,this.session={active:[]},this.processing={cache:new e,excluded:new e,sessionId:""},this._cascadeAll=!1,M=i;const r=this.processing.cache;this.controllerHandler=new n(this,r),this.resourceHandler=new s(this,r),this.extensionManager=new o(this,r),this._cache=r}copyToDisk(t,e,i){var n;null===(n=this.resourceHandler.fileHandler)||void 0===n||n.copyToDisk(t,i,e)}appendToArchive(t,e){var i;null===(i=this.resourceHandler.fileHandler)||void 0===i||i.appendToArchive(t,e)}saveToArchive(t,e){var i;null===(i=this.resourceHandler.fileHandler)||void 0===i||i.saveToArchive(t||this.userSettings.outputArchiveName,e)}reset(){const t=this.processing;t.cache.reset(),t.excluded.clear(),t.sessionId="",this.session.active.length=0,this.controllerHandler.reset();for(const t of this.extensions)t.subscribers.clear();this.closed=!1}parseDocument(...t){const{controllerHandler:e,resourceHandler:i}=this;let n;this.rootElements.clear(),this.initializing=!1;const s=e.generateSessionId;this.processing.sessionId=s,e.sessionId=s,this.session.active.push(s),e.init(),this.setStyleMap(),0===t.length&&t.push(document.body);for(const e of t){let t;if("string"==typeof e)t=document.getElementById(e);else{if(!f(e))continue;t=e}t&&this.rootElements.add(t)}const o=this.rootElements.values().next().value,r=[],a=()=>{this.initializing=!1;for(const t of r)t.parentElement&&o.removeChild(t);r.length=0;for(const t of this.extensions)t.beforeParseDocument();for(const t of this.rootElements)this.createCache(t)&&this.afterCreateCache(t);for(const t of this.extensions)t.afterParseDocument();"function"==typeof n&&n.call(this)},c=this.userSettings.preloadImages,h=[];if(c){for(const t of this.rootElements)t.querySelectorAll("input[type=image]").forEach(t=>{const{width:e,height:i,src:n}=t;""!==n&&T.images.set(n,{width:e,height:i,uri:n})});for(const t of T.images.values()){const e=t.uri;if(e)if(e.toLowerCase().endsWith(".svg"))h.push(e);else if(0===t.width&&0===t.height){const i=document.createElement("img");i.src=e;const{naturalWidth:n,naturalHeight:s}=i;n>0&&s>0?(t.width=n,t.height=s):(o.appendChild(i),r.push(i))}}}for(const[t,e]of T.rawData.entries()){const i=e.mimeType;if(i&&i.startsWith("image/")&&!i.endsWith("svg+xml")){const n=document.createElement("img");n.src="data:"+i+";"+(e.base64?"base64,"+e.base64:e.content);const{naturalWidth:s,naturalHeight:o}=n;s>0&&o>0?(e.width=s,e.height=o,T.images.set(t,{width:s,height:o,uri:e.filename})):(document.body.appendChild(n),r.push(n))}}for(const t of this.rootElements)t.querySelectorAll("img").forEach(t=>{t.src.toLowerCase().endsWith(".svg")?c&&h.push(t.src):t.complete?i.addImage(t):c&&h.push(t)});h.length?(this.initializing=!0,Promise.all(v(h,t=>new Promise((e,i)=>{"string"==typeof t?e(function(t){return l(this,void 0,void 0,(function*(){return(yield fetch(t,{method:"GET",headers:new Headers({Accept:"application/xhtml+xml, image/svg+xml","Content-Type":"image/svg+xml"})})).text()}))}(t)):(t.addEventListener("load",()=>e(t)),t.addEventListener("error",()=>i(t)))}))).then(t=>{const e=t.length;for(let n=0;n<e;n++){const e=t[n];if("string"==typeof e){const t=h[n];"string"==typeof t&&i.addRawData(t,"image/svg+xml","utf8",e)}else i.addImage(e)}a()}).catch(t=>{var e;const i=(null===(e=t.target)||void 0===e?void 0:e.src)||t.message;this.userSettings.showErrorMessages&&x(i)&&!confirm("FAIL: "+i)||a()})):a();return new class{then(t){h.length?n=t:t()}}}createCache(t){const e=this.createRootNode(t);if(e){e.parent.setBounds();for(const t of this._cache)t.setBounds(),t.saveAsInitial();return this.controllerHandler.sortInitialCache(this._cache),!0}return!1}createNode(t,e=!0,i,n){const s=new M(this.nextId,this.processing.sessionId,t,this.controllerHandler.afterInsertNode);if(i&&(s.depth=i.depth+1),n)for(const t of n)t.parent=s;return e&&this._cache.append(s,void 0!==n),s}toString(){return""}createRootNode(t){const e=this.processing;e.cache.clear(),e.excluded.clear(),this._cascadeAll=!1;const i=this.cascadeParentNode(t);if(i){const n=new M(0,e.sessionId,t.parentElement||document.body,this.controllerHandler.afterInsertNode);i.parent=n,i.actualParent=n,i.childIndex=0,i.documentRoot=!0}return e.node=i,e.cache.afterAppend=void 0,i}cascadeParentNode(t,e=0){const i=this.insertNode(t);if(i){const{controllerHandler:n,processing:s}=this,o=s.cache;if(i.depth=e,0===e&&o.append(i),n.preventNodeCascade(t))return i;const r=t.childNodes,a=r.length,l=Array(a),c=Array(t.childElementCount);let h=!0,d=0,u=0;for(let t=0;t<a;t++){const a=r[t];let f;"#"===a.nodeName.charAt(0)?m(a)&&(f=this.insertNode(a,i)):n.includeElement(a)?(f=this.cascadeParentNode(a,e+1),f&&(c[u++]=f,o.append(f),h=!1)):(f=this.insertNode(a),f&&(s.excluded.append(f),h=!1)),f&&(f.parent=i,f.actualParent=i,f.childIndex=d,l[d++]=f)}l.length=d,c.length=u,i.naturalChildren=l,i.naturalElements=c,i.inlineText=h,this.userSettings.createQuerySelectorMap&&u>0&&(i.queryMap=this.createQueryMap(c,u))}return i}createQueryMap(t,e){var i;const n=[t];for(let s=0;s<e;s++){const e=t[s].queryMap;if(e){const t=e.length;for(let s=0;s<t;s++){const t=s+1;n[t]=(null===(i=n[t])||void 0===i?void 0:i.concat(e[s]))||e[s]}}}return n}setStyleMap(){let t=!1;const e=i=>{try{const t=i.cssRules;if(t){const i=t.length;for(let n=0;n<i;n++){const i=t[n];switch(i.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(i);break;case CSSRule.IMPORT_RULE:e(i.styleSheet);break;case CSSRule.MEDIA_RULE:p(i.conditionText||W("media",i.cssText))&&this.applyCSSRuleList(i.cssRules);break;case CSSRule.SUPPORTS_RULE:CSS.supports&&CSS.supports(i.conditionText||W("supports",i.cssText))&&this.applyCSSRuleList(i.cssRules)}}}}catch(e){this.userSettings.showErrorMessages&&!t&&(alert("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+i.href+"\n\n"+e),t=!0)}},i=document.styleSheets,n=i.length;for(let t=0;t<n;t++){const n=i[t];let s="";try{s=n.media.mediaText}catch(t){}(""===s||k.test(s))&&e(n)}}applyCSSRuleList(t){const e=t.length;for(let i=0;i<e;i++)this.applyStyleRule(t[i])}applyStyleRule(t){var e;const i=this.resourceHandler,n=this.processing.sessionId,s=(null===(e=t.parentStyleSheet)||void 0===e?void 0:e.href)||void 0,o=t.cssText;switch(t.type){case CSSRule.STYLE_RULE:{const e=t.style,r=[],a={},l=(t,e)=>{const n=t[e];if(n&&"initial"!==n){A.lastIndex=0;let o,r=n;for(;null!==(o=A.exec(n));)if(o[3]&&o[4])i.addRawData(o[2],o[3],o[4],o[5]);else if(this.userSettings.preloadImages){const t=y(o[5],s);""!==t&&(void 0===i.getImage(t)&&T.images.set(t,{width:0,height:0,uri:t}),r=r.replace(o[1],`url("${t}")`))}t[e]=r}};for(const t of Array.from(e))r.push(b(t));if(-1!==o.indexOf("!important")){let t;for(C?C.lastIndex=0:C=/\s*([a-z\-]+):.*?!important;/g;null!==(t=C.exec(o));){const e=b(t[1]);switch(e){case"margin":a.marginTop=!0,a.marginRight=!0,a.marginBottom=!0,a.marginLeft=!0;break;case"padding":a.paddingTop=!0,a.paddingRight=!0,a.paddingBottom=!0,a.paddingLeft=!0;break;case"background":a.backgroundColor=!0,a.backgroundImage=!0,a.backgroundSize=!0,a.backgroundRepeat=!0,a.backgroundPositionX=!0,a.backgroundPositionY=!0;break;case"backgroundPosition":a.backgroundPositionX=!0,a.backgroundPositionY=!0;break;case"border":a.borderTopStyle=!0,a.borderRightStyle=!0,a.borderBottomStyle=!0,a.borderLeftStyle=!0,a.borderTopWidth=!0,a.borderRightWidth=!0,a.borderBottomWidth=!0,a.borderLeftWidth=!0,a.borderTopColor=!0,a.borderRightColor=!0,a.borderBottomColor=!0,a.borderLeftColor=!0;break;case"borderStyle":a.borderTopStyle=!0,a.borderRightStyle=!0,a.borderBottomStyle=!0,a.borderLeftStyle=!0;break;case"borderWidth":a.borderTopWidth=!0,a.borderRightWidth=!0,a.borderBottomWidth=!0,a.borderLeftWidth=!0;break;case"borderColor":a.borderTopColor=!0,a.borderRightColor=!0,a.borderBottomColor=!0,a.borderLeftColor=!0;break;case"font":a.fontFamily=!0,a.fontStyle=!0,a.fontSize=!0,a.fontWeight=!0,a.lineHeight=!0}a[e]=!0}}for(const i of g(t.selectorText)){const t=d(i),[s,o]=i.split("::"),c=o?"::"+o:"";document.querySelectorAll(s||"*").forEach(i=>{const s=u(i,c),o={};for(const t of r){const n=h(i,t,e[t],s);n&&(o[t]=n)}l(o,"backgroundImage"),l(o,"listStyleImage"),l(o,"content");const d="styleMap"+c,f="styleSpecificity"+c,g=E(i,d,n);if(g){const s=E(i,f,n)||{};for(const i in o){const n=t+(a[i]?1e3:0);if(void 0===s[i]||n>=s[i]){const t=o[i];if("initial"===t&&e.background&&i.startsWith("background"))continue;s[i]=n,g[i]=t}}}else{const e={};for(const i in o)e[i]=t+(a[i]?1e3:0);w(i,"style"+c,"0",s),w(i,"sessionId","0",n),w(i,d,n,o),w(i,f,n,e)}})}break}case CSSRule.FONT_FACE_RULE:{void 0===R&&(R=/\s*@font-face\s*{([^}]+)}\s*/,I=/\s*font-family:[^\w]*([^'";]+)/,B=/\s*src:\s*([^;]+);/,P=/\s*font-style:\s*(\w+)\s*;/,N=/\s*font-weight:\s*(\d+)\s*;/,L=/\s*(url|local)\((?:['"]([^'")]+)['"]|([^)]+))\)\s*format\(['"]?(\w+)['"]?\)\s*/);const t=R.exec(o);if(t){const e=t[1],n=I.exec(e),o=B.exec(e);if(n&&o){const t=P.exec(e),r=N.exec(e),a=n[1].trim(),l=t?t[1].toLowerCase():"normal",c=r?parseInt(r[1]):400;for(const t of o[1].split(_.SEPARATOR)){const e=L.exec(t);if(e){let t,n;const o=(e[2]||e[3]).trim();"url"===e[1]?t=y(o,s):n=o,i.addFont({fontFamily:a,fontWeight:c,fontStyle:l,srcUrl:t,srcLocal:n,srcFormat:e[4].toLowerCase().trim()})}}}}break}}}get nextId(){return this._cache.nextId}get length(){return 0}}class O{preventNodeCascade(t){return!1}get generateSessionId(){return""+(new Date).getTime()}}class D{constructor(t,e,i){this.name=t,this.framework=e,this.options={},this.dependencies=[],this.subscribers=new Set,i&&Object.assign(this.options,i)}require(t,e=!1){this.dependencies.push({name:t,preload:e})}beforeParseDocument(){}afterParseDocument(){}set application(t){this._application=t,this.controller=t.controllerHandler}get application(){return this._application}}const{hasBit:H,isObject:z}=squared.lib.util;const{fromLastIndexOf:X,trimString:U}=squared.lib.util;class V{constructor(){this.assets=[]}static getMimeType(t){switch(t.toLowerCase()){case"aac":return"audio/aac";case"abw":return"application/x-abiword";case"arc":return"application/x-freearc";case"avi":return"video/x-msvideo";case"azw":return"application/vnd.amazon.ebook";case"bin":return"application/octet-stream";case"bmp":return"image/bmp";case"bz":return"application/x-bzip";case"bz2":return"application/x-bzip2";case"csh":return"application/x-csh";case"css":return"text/css";case"csv":return"text/csv";case"doc":return"application/msword";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"eot":return"application/vnd.ms-fontobject";case"epub":return"application/epub+zip";case"gif":return"image/gif";case"htm":case"html":return"text/html";case"ico":return"image/vnd.microsoft.icon";case"ics":return"text/calendar";case"jar":return"application/java-archive";case"jpeg":case"jpg":return"image/jpeg";case"js":case"mjs":return"text/javascript";case"json":return"application/json";case"jsonld":return"application/ld+json";case"mid":case"midi":return"audio/midi";case"mp3":return"audio/mpeg";case"mpeg":return"video/mpeg";case"mpkg":return"application/vnd.apple.installer+xml";case"odp":return"application/vnd.oasis.opendocument.presentation";case"ods":return"application/vnd.oasis.opendocument.spreadsheet";case"odt":return"application/vnd.oasis.opendocument.text";case"oga":return"audio/ogg";case"ogv":return"video/ogg";case"ogx":return"application/ogg";case"otf":return"font/otf";case"png":return"image/png";case"pdf":return"application/pdf";case"ppt":return"application/vnd.ms-powerpoint";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"rar":return"application/x-rar-compressed";case"rtf":return"application/rtf";case"sh":return"application/x-sh";case"svg":return"image/svg+xml";case"swf":return"application/x-shockwave-flash";case"tar":return"application/x-tar";case"tif":case"tiff":return"image/tiff";case"ts":return"video/mp2t";case"ttf":return"font/ttf";case"txt":return"text/plain";case"vsd":return"application/vnd.visio";case"wav":return"audio/wav";case"weba":return"audio/webm";case"webm":return"video/webm";case"webp":return"image/webp";case"woff":return"font/woff";case"woff2":return"font/woff2";case"xhtml":return"application/xhtml+xml";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xml":return"text/xml";case"xul":return"application/vnd.mozilla.xul+xml";case"zip":return"application/zip";case"3gp":return"video/3gpp";case".3g2":return"video/3gpp2";case".7z":return"application/x-7z-compressed";default:return""}}static downloadFile(t,e,i){const n=new Blob([t],{type:i||"application/octet-stream"}),s=window.URL.createObjectURL(n),o=document.createElement("a");o.style.setProperty("display","none"),o.setAttribute("href",s),o.setAttribute("download",e),o.download||o.setAttribute("target","_blank");const r=document.body;r.appendChild(o),o.click(),r.removeChild(o),setTimeout(()=>window.URL.revokeObjectURL(s),1)}addAsset(t){if(t.content||t.uri||t.base64){const{pathname:e,filename:i}=t,n=this.assets.findIndex(t=>t.pathname===e&&t.filename===i);-1!==n?Object.assign(this.assets[n],t):this.assets.push(t)}}reset(){this.assets.length=0}copying(t,e,i){if(location.protocol.startsWith("http")){if((e=e.concat(this.assets)).length){const n=this.userSettings;fetch("/api/assets/copy?to="+encodeURIComponent(t.trim())+"&directory="+encodeURIComponent(U(n.outputDirectory,"/"))+"&timeout="+n.outputArchiveTimeout,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{t&&("function"==typeof i&&i(t),t.system&&this.userSettings.showErrorMessages&&alert(t.application+"\n\n"+t.system))}).catch(t=>{this.userSettings.showErrorMessages&&alert("ERROR: "+t)})}}else this.userSettings.showErrorMessages&&alert("SERVER (required): See README for instructions")}archiving(t,e,i){if(location.protocol.startsWith("http")){if((e=e.concat(this.assets)).length){const n=this.userSettings;fetch("/api/assets/archive?filename="+encodeURIComponent(t.trim())+"&directory="+encodeURIComponent(U(n.outputDirectory,"/"))+"&format="+n.outputArchiveFormat+(i?"&append_to="+encodeURIComponent(i.trim()):"")+"&timeout="+n.outputArchiveTimeout,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{if(t){const e=t.zipname;e?fetch("/api/browser/download?filename="+encodeURIComponent(e)).then(t=>t.blob()).then(t=>V.downloadFile(t,X(e,"/"))):t.system&&this.userSettings.showErrorMessages&&alert(t.application+"\n\n"+t.system)}}).catch(t=>{this.userSettings.showErrorMessages&&alert("ERROR: "+t)})}}else this.userSettings.showErrorMessages&&alert("SERVER (required): See README for instructions")}}const q=squared.lib,{BOX_BORDER:j,checkStyleValue:G,formatPX:Y,getInheritedStyle:$,getStyle:Q,isLength:K,isPercent:Z,parseSelectorText:J,parseUnit:tt}=q.css,{ELEMENT_BLOCK:et,assignRect:it,getNamedItem:nt,getRangeClientRect:st,newBoxRectDimension:ot}=q.dom,{CHAR:rt,CSS:at,XML:lt}=q.regex,{actualClientRect:ct,actualTextRangeRect:ht,deleteElementCache:dt,getElementAsNode:ut,getElementCache:ft,setElementCache:gt}=q.session,{aboveRange:pt,belowRange:mt,convertCamelCase:bt,convertFloat:xt,convertInt:vt,filterArray:yt,hasBit:St,hasValue:_t,isNumber:Et,isObject:wt,spliceArray:Tt,spliceString:kt}=q.util,At=/\s*(url\(.+?\))\s*/,Ct=/^:lang\(\s*(.+)\s*\)$/,Rt=/^:nth(-last)?-(child|of-type)\((.+)\)$/,It=/^(-)?(\d+)?n\s*([+\-]\d+)?$/,Bt=(t,e)=>t===e||K(t,!0)&&e.endsWith("px");class Pt extends squared.lib.base.Container{constructor(t,e="0",i){super(),this.id=t,this.sessionId=e,this.documentRoot=!1,this.depth=-1,this.childIndex=1/0,this._fontSize=0,this._element=null,this._initial={iteration:-1},this._data={},this._inlineText=!1,i?this._element=i:(this.style={},this._styleMap={})}static getPseudoElt(t){return ft(t.element,"pseudoElement",t.sessionId)||""}init(){const t=this._element;if(t){const e=this.sessionId;"0"!==e&&gt(t,"node",e,this);const i=ft(t,"styleMap",e)||{};if(this.styleElement)if(this.pseudoElement)this.style=Q(t.parentElement,Pt.getPseudoElt(this));else{const e=Q(t),n=Array.from(t.style);if(n.length){const s=t.style;for(const o of n){const n=bt(o),r=G(t,n,s.getPropertyValue(o),e);""!==r&&(i[n]=r)}}this.style=e}else this.style=Q(t);this._styleMap=i}}saveAsInitial(t=!1){const e=this._initial;(-1===e.iteration||t)&&(e.children=this.duplicate(),e.styleMap=Object.assign({},this._styleMap));const i=this._bounds;i&&(e.bounds=it(i)),e.iteration++}data(t,e,i,n=!0){const s=this._data;if(_t(i))wt(s[t])||(s[t]={}),(n||void 0===s[t][e])&&(s[t][e]=i);else if(null===i)return void delete s[t];const o=s[t];return wt(o)?o[e]:void 0}unsetCache(...t){if(t.length){const e=this._cached;for(const i of t){switch(i){case"position":case"display":return void(this._cached={});case"width":e.actualWidth=void 0,e.percentWidth=void 0;case"minWidth":e.width=void 0;break;case"height":e.actualHeight=void 0,e.percentHeight=void 0;case"minHeight":e.height=void 0;break;case"verticalAlign":e.baseline=void 0;break;case"backgroundColor":case"backgroundImage":e.visibleStyle=void 0;break;case"pageFlow":e.positionAuto=void 0,e.blockStatic=void 0,e.baseline=void 0,e.floating=void 0,e.autoMargin=void 0,e.rightAligned=void 0,e.bottomAligned=void 0;break;case"float":e.floating=void 0;break;case"visibleStyle":e.borderTopWidth=void 0,e.borderRightWidth=void 0,e.borderBottomWidth=void 0,e.borderLeftWidth=void 0,e.backgroundColor=void 0,e.backgroundImage=void 0;break;default:i.startsWith("margin")?e.autoMargin=void 0:(i.startsWith("padding")||i.startsWith("border"))&&(e.contentBoxWidth=void 0,e.contentBoxHeight=void 0)}e[i]=void 0}}else this._cached={},this._textStyle=void 0}ascend(t,e,i="actualParent"){const n=[];let s=this[i];for(;s&&0!==s.id;){if(t){if(t(s)){n.push(s);break}}else n.push(s);if(s===e)break;s=s[i]}return n}intersectX(t,e="linear"){if(t.width>0){const{left:i,right:n}=this[e],{left:s,right:o}=t;return pt(s,i)&&Math.ceil(s)<n||o>Math.ceil(i)&&mt(o,n)||pt(i,s)&&mt(n,o)||pt(s,i)&&mt(o,n)}return!1}intersectY(t,e="linear"){if(t.height>0){const{top:i,bottom:n}=this[e],{top:s,bottom:o}=t;return pt(s,i)&&Math.ceil(s)<n||o>Math.ceil(i)&&mt(o,n)||pt(i,s)&&mt(n,o)||pt(s,i)&&mt(o,n)}return!1}withinX(t,e="linear"){if(this.pageFlow||t.width>0){const i=this[e];return pt(i.left,t.left)&&mt(i.right,t.right)}return!0}withinY(t,e="linear"){if(this.pageFlow||t.height>0){const i=this[e];return pt(i.top,t.top)&&mt(i.bottom,t.bottom)}return!0}outsideX(t,e="linear"){if(this.pageFlow||t.width>0){const i=this[e];return i.left<Math.floor(t.left)||Math.floor(i.right)>t.right}return!1}outsideY(t,e="linear"){if(this.pageFlow||t.height>0){const i=this[e];return i.top<Math.floor(t.top)||Math.floor(i.bottom)>t.bottom}return!1}css(t,e,i=!0){return e&&this.styleElement&&(this.style[t]=e,Bt(e,this.style[t]))?(this._styleMap[t]=e,i&&this.unsetCache(t),e):this._styleMap[t]||this.styleElement&&this.style[t]||""}cssApply(t,e=!0){for(const i in t){const n=t[i];this.css(i,n,e)===n&&e&&this.unsetCache(i)}return this}cssInitial(t,e=!1,i=!1){-1!==this._initial.iteration||e||(i=!0);let n=(!e&&this._initial.styleMap||this._styleMap)[t];return i&&!n&&(n=this.style[t]),n||""}cssAny(t,...e){const i=this.css(t);for(const t of e)if(i===t)return!0;return!1}cssInitialAny(t,...e){for(const i of e)if(this.cssInitial(t)===i)return!0;return!1}cssAscend(t,e=!1){let i,n=e?this:this.actualParent;for(;n;){if(i=n.cssInitial(t),""!==i)return i;if(n.documentBody)break;n=n.actualParent}return""}cssSort(t,e=!0,i=!1){const n=i?this.duplicate():this.children;return n.sort((i,n)=>{const s=i.toFloat(t),o=n.toFloat(t);return s===o?0:e?s<o?-1:1:s>o?-1:1}),n}cssPX(t,e,i=!1,n=!1){const s=this._styleMap[t];if(s&&K(s)){e+=tt(s,this.fontSize),!i&&e<0&&(e=0);const o=Y(e);return this.css(t,o),n&&this.unsetCache(t),o}return""}cssSpecificity(t){if(this.styleElement){const e=this._element,i=ft(this.pseudoElement?e.parentElement:e,"styleSpecificity"+Pt.getPseudoElt(this),this.sessionId);return i&&i[t]||0}return 0}cssTry(t,e){if(this.styleElement){const i=this._element,n=Q(i).getPropertyValue(t);if(n===e)return!0;{const s=i.style;if(s.setProperty(t,e),Bt(e,s.getPropertyValue(t)))return gt(i,t,this.sessionId,n),!0}}return!1}cssFinally(t){if(this.styleElement){const e=this.sessionId,i=this._element,n=ft(i,t,e);if(n)return i.style.setProperty(t,n),dt(i,t,e),!0}return!1}toInt(t,e=!1,i=0){const n=parseInt((e&&this._initial.styleMap||this._styleMap)[t]);return isNaN(n)?i:n}toFloat(t,e=!1,i=0){const n=parseFloat((e&&this._initial.styleMap||this._styleMap)[t]);return isNaN(n)?i:n}toElementInt(t,e=NaN){var i;const n=parseInt(null===(i=this._element)||void 0===i?void 0:i[t]);return isNaN(n)?e:n}toElementFloat(t,e=NaN){var i;const n=parseFloat(null===(i=this._element)||void 0===i?void 0:i[t]);return isNaN(n)?e:n}toElementBoolean(t,e=!1){var i;const n=null===(i=this._element)||void 0===i?void 0:i[t];return"boolean"==typeof n?n:e}toElementString(t,e=""){var i;return((null===(i=this._element)||void 0===i?void 0:i[t])||e).toString()}parseUnit(t,e="width",i=!0){if(t){if(Z(t)){const n=i&&this.absoluteParent||this;let s=parseFloat(t)/100;switch(e){case"width":s*=n.bounds.width;break;case"height":s*=n.bounds.height}return s}return tt(t,this.fontSize)}return 0}convertPX(t,e="width",i=!0){return t.endsWith("px")?t:Math.round(this.parseUnit(t,e,i))+"px"}has(t,e=0,i){var n;const s=("initial"===(null===(n=i)||void 0===n?void 0:n.map)&&this._initial.styleMap||this._styleMap)[t];if(s)switch(s){case"auto":case"none":case"initial":case"normal":case"transparent":case"rgba(0, 0, 0, 0)":return!1;case"baseline":case"left":case"start":return this.flexElement||this.actualParent.flexElement;default:if(i&&i.not){if(s===i.not)return!1;if(Array.isArray(i.not))for(const t of i.not)if(s===t)return!1}if(e>0){if(St(e,2)&&K(s))return!0;if(St(e,4)&&Z(s))return!0}return 0===e}return!1}hasPX(t,e=!0,i=!1){const n=(i&&this._initial.styleMap||this._styleMap)[t];return!!n&&K(n,e)}setBounds(t=!0){if(this.styleElement)this._bounds=it(ct(this._element,this.sessionId,t),!0),this.documentBody&&0===this.marginTop&&(this._bounds.top=0);else if(this.plainText){const t=st(this._element),e=it(t,!0),i=t.numberOfLines;e.numberOfLines=i,this._bounds=e,this._textBounds=e,this._cached.multiline=i>1}t||(this._box=void 0,this._linear=void 0)}querySelector(t){return this.querySelectorAll(t,1)[0]||null}querySelectorAll(t,e=-1){let i=[];const n=this.queryMap;if(n){const o=J(t);for(let t=0;t<o.length;t++){const r=o[t],a=[];let l=-1;t:{let t,e;for(at.SELECTOR_G.lastIndex=0;null!==(e=at.SELECTOR_G.exec(r));){let i,n,s,o,r,c,h=e[1],d=!1;if(1===h.length){const e=h.charAt(0);switch(e){case"+":case"~":l--;case">":if(t||0===a.length){a.length=0;break t}t=e;continue;case"*":d=!0}}else if(h.endsWith("|*"))d="*|*"===h;else if("*"===h.charAt(0))h=h.substring(1);else if(h.startsWith("::")){a.length=0;break t}if(!d){let t;for(;null!==(t=at.SELECTOR_ATTR.exec(h));){void 0===o&&(o=[]);const e="i"===t[6];let i=t[3]||t[4]||t[5]||"";e&&(i=i.toLowerCase()),o.push({key:t[1],symbol:t[2],value:i,caseInsensitive:e}),h=kt(h,t.index,t[0].length)}if(-1!==h.indexOf("::")){a.length=0;break t}for(;null!==(t=at.SELECTOR_PSEUDO_CLASS.exec(h));)t[0].startsWith(":not(")?t[1]&&(void 0===c&&(c=[]),c.push(t[1])):(void 0===r&&(r=[]),r.push(t[0])),h=kt(h,t.index,t[0].length);for(;null!==(t=at.SELECTOR_LABEL.exec(h));){const e=t[0];switch(e.charAt(0)){case"#":n=e.substring(1);break;case".":void 0===s&&(s=[]),s.push(e.substring(1));break;default:i=e.toUpperCase()}h=kt(h,t.index,t[0].length)}}a.push({all:d,tagName:i,id:n,adjacent:t,classList:s,pseudoList:r,notList:c,attrList:o}),l++,t=void 0}}let c=n.length;if(a.length&&-1!==l&&l<c){const r=(e,i,n,s)=>{var o;if(i.all)return!0;let a=i.tagName;if(a&&a!==e.tagName.toUpperCase())return!1;const l=i.id;if(l&&l!==e.elementId)return!1;const c=i.pseudoList;if(c){const i=e.actualParent;a=e.tagName;for(const r of c)switch(r){case":first-child":case":nth-child(1)":if(e!==i.firstChild)return!1;break;case":last-child":case":nth-last-child(1)":if(e!==i.lastChild)return!1;break;case":only-child":if(i.naturalElements.length>1)return!1;break;case":only-of-type":{let t=0;for(const e of i.naturalElements)if(e.tagName===a&&++t>1)return!1;break}case":first-of-type":for(const t of i.naturalElements)if(t.tagName===a){if(t!==e)return!1;break}break;case":nth-child(n)":case":nth-last-child(n)":break;case":empty":if(e.element.childNodes.length)return!1;break;case":checked":if("INPUT"===a){if(!e.toElementBoolean("checked"))return!1}else{if("OPTION"!==a)return!1;if(!e.toElementBoolean("selected"))return!1}break;case":enabled":if(!e.inputElement||e.toElementBoolean("disabled"))return!1;break;case":disabled":if(!e.inputElement||!e.toElementBoolean("disabled"))return!1;break;case":read-only":{const t=e.element;if(t.isContentEditable||("INPUT"===a||"TEXTAREA"===a)&&!t.readOnly)return!1;break}case":read-write":{const t=e.element;if(!t.isContentEditable||("INPUT"===a||"TEXTAREA"===a)&&t.readOnly)return!1;break}case":required":if(!e.inputElement||"BUTTON"===a||!e.toElementBoolean("required"))return!1;break;case":optional":if(!e.inputElement||"BUTTON"===a||e.toElementBoolean("required"))return!1;break;case":placeholder-shown":if("INPUT"!==a&&"TEXTAREA"!==a||""===e.toElementString("placeholder"))return!1;break;case":default":switch(a){case"INPUT":{const t=e.element;switch(t.type){case"radio":case"checkbox":if(!t.checked)return!1;break;default:return!1}break}case"OPTION":if(void 0===e.element.attributes.selected)return!1;break;case"BUTTON":{const i=e.ascend(t=>"FORM"===t.tagName)[0];if(i){const n=e.element;let s=!1;const o=i.element.querySelectorAll("*"),r=o.length;for(let e=0;e<r;e++){const e=o[t];if("BUTTON"===e.tagName){s=n===e;break}if("INPUT"===e.tagName){const t=e.type;if("submit"===t||"image"===t){s=n===e;break}}}if(!s)return!1}break}default:return!1}break;case":in-range":case":out-of-range":if("INPUT"!==a)return!1;{const t=e.element,i=parseFloat(t.value);if(isNaN(i)){if(":in-range"===r)return!1}else{const e=xt(t.min),n=xt(t.max);if(i>=e&&i<=n){if(":out-of-range"===r)return!1}else if(":in-range"===r)return!1}}break;case":indeterminate":if("INPUT"===a){const t=e.element;switch(t.type){case"checkbox":if(!t.indeterminate)return!1;break;case"radio":if(t.checked)return!1;if(t.name){const i=((null===(o=e.ascend(t=>"FORM"===t.tagName)[0])||void 0===o?void 0:o.element)||document).querySelectorAll(`input[type=radio][name="${t.name}"`),n=i.length;for(let t=0;t<n;t++)if(i[t].checked)return!1}break;default:return!1}}else{if("PROGRESS"!==a)return!1;if(-1!==e.toElementInt("value",-1))return!1}break;case":target":if(""===location.hash)return!1;{const t=e.element;if(location.hash!=="#"+t.id&&("A"!==a||location.hash!=="#"+t.name))return!1}break;case":scope":if(!n||">"===s&&e!==this)return!1;break;case":root":if(!n||s)return!1;break;case":link":case":visited":case":any-link":case":hover":case":focus":case":focus-within":case":valid":case":invalid":{const n=e.element,s=i.element.querySelectorAll(":scope > "+r);let o=!1;const a=s.length;for(let e=0;e<a;e++)if(s.item(t)===n){o=!0;break}if(!o)return!1;break}default:{let t=Rt.exec(r);if(t){const n=t[3].trim();let s=i.naturalElements;t[1]&&(s=s.slice(0).reverse());const o=("child"===t[2]?s.indexOf(e):yt(s,t=>t.tagName===a).indexOf(e))+1;if(o>0){if(Et(n)){if(parseInt(n)!==o)return!1}else switch(n){case"even":if(o%2!=0)return!1;break;case"odd":if(o%2==0)return!1;break;default:const t=It.exec(n);if(t){const e=vt(t[3]);if(t[2]){if(t[1])return!1;const i=parseInt(t[2]);if(0!==i){if(o!==e)for(let t=i;;t+=i){const t=i+e;if(t===o)break;if(t>o)return!1}}else if(o!==e)return!1}else if(t[3]){if(!(e>0))return!1;if(t[1]){if(o>e)return!1}else if(o<e)return!1}}}continue}}else if(t=Ct.exec(r),t){const i=e.attributes;if(i.lang&&t[1].toLowerCase()===i.lang.toLowerCase())continue}return!1}}}const h=i.notList;if(h)for(const t of h){const i={all:!1};switch(t.charAt(0)){case".":i.classList=[t];break;case"#":i.id=t.substring(1);break;case":":i.pseudoList=[t];break;case"[":{at.SELECTOR_ATTR.lastIndex=0;const e=at.SELECTOR_ATTR.exec(t);if(!e)continue;{const t="i"===e[6];let n=e[3]||e[4]||e[5]||"";t&&(n=n.toLowerCase()),i.attrList=[{key:e[1],symbol:e[2],value:n,caseInsensitive:t}]}break}default:if(!rt.WORDDASH.test(t))return!1;i.tagName=t}if(r(e,i,n))return!1}const d=i.classList;if(d){const t=e.element.classList;for(const e of d)if(!t.contains(e))return!1}const u=i.attrList;if(u){const t=e.attributes;for(const e of u){let i=t[e.key];if(void 0===i)return!1;{const t=e.value;if(t)if(e.caseInsensitive&&(i=i.toLowerCase()),e.symbol)switch(e.symbol){case"~":if(!i.split(rt.SPACE).includes(t))return!1;break;case"^":if(!i.startsWith(t))return!1;break;case"$":if(!i.endsWith(t))return!1;break;case"*":if(-1===i.indexOf(t))return!1;break;case"|":if(i!==t&&!i.startsWith(t+"-"))return!1}else if(i!==t)return!1}}}return!0},h=a.pop(),d=0===a.length;let u=[];for(let t=l;t<c;t++){const e=n[t];if(h.all)u=u.concat(e);else for(const t of e)r(t,h,d)&&u.push(t)}if(a.length){const t=this.depth;function s(e,i,n){const o=a[e],l=e===c-1,h=[];for(const s of n)if(i){const t=s.actualParent;if(">"===i)r(t,o,l,i)&&h.push(t);else{const e=t.naturalElements;switch(i){case"+":{const t=e.indexOf(s);if(t>0){const n=e[t-1];n&&r(n,o,l,i)&&h.push(n)}break}case"~":{const t=e.length;for(let n=0;n<t;n++){const t=e[n];if(t===s)break;r(t,o,l,i)&&h.push(t)}break}}}}else if(s.depth-t>=c-e){let t=s.actualParent;do{r(t,o,l)&&h.push(t),t=t.actualParent}while(t)}return!!h.length&&(++e===c||s(e,o.adjacent,h))}a.reverse(),c=a.length;for(const t of u)if(s(0,h.adjacent,[t])&&(i.push(t),i.length===e))return i}else{if(0===i.length&&(t===o.length-1||e>=0&&e<=u.length))return e>=0&&u.length>e&&(u.length=e),u;if(i=i.concat(u),e>=0&&i.length>=e)return i.length=e,i}}}}return i}getTextStyle(){return void 0===this._textStyle&&(this._textStyle={fontFamily:this.css("fontFamily"),fontSize:this.css("fontSize"),fontWeight:this.css("fontWeight"),fontStyle:this.css("fontStyle"),color:this.css("color"),whiteSpace:this.css("whiteSpace"),textDecoration:this.css("textDecoration"),textTransform:this.css("textTransform"),letterSpacing:this.css("letterSpacing"),wordSpacing:this.css("wordSpacing")}),this._textStyle}setDimension(t,e,i){const n=this._styleMap,s=this.parseUnit(n[t],t);let o=Math.max(s,this.parseUnit(n[e],t));if(0===o&&this.styleElement){const e=this._element;switch(e.tagName){case"IMG":case"INPUT":if("image"!==e.type)break;case"TD":case"TH":case"SVG":case"IFRAME":case"VIDEO":case"CANVAS":case"OBJECT":case"EMBED":const i=nt(e,t);""!==i&&(o=this.parseUnit(i,t),o>0&&this.css(t,Z(i)?i:i+"px"))}}let r=0;return s>0&&!this.imageElement&&(n[i]===n[t]?delete n[i]:(r=this.parseUnit(n[i],t),r>0&&r<=s&&K(n[t])&&(r=0,n[t]=n[i],delete this._styleMap[i]))),r>0?Math.min(o,r):o}setBoxModel(t){const e="box"===t?this._box:this._linear;if(e)switch(e.width=this.bounds.width,e.height=this.bounds.height,t){case"box":e.width-=this.contentBoxWidth,e.height-=this.contentBoxHeight;break;case"linear":e.width+=Math.max(this.marginLeft,0)+this.marginRight,e.height+=Math.max(this.marginTop,0)+this.marginBottom}}convertPosition(t){let e=0;if(!this.positionStatic){const i=this.cssInitial(t,!0);K(i)?e=xt(this.convertPX(i,"left"===t||"right"===t?"width":"height")):Z(i)&&this.styleElement&&(e=xt(this.style[t]))}return e}convertBorderWidth(t){if(!this.plainText){if("none"!==this.css(j[t][0])){const e=this.css(j[t][1]);let i;switch(e){case"thin":case"medium":case"thick":i=xt(this.style[j[t][1]]);break;default:i=this.parseUnit(e,1===t||3===t?"width":"height")}if(i>0)return Math.max(Math.round(i),1)}}return 0}convertBox(t,e){switch(this.display){case"table":if(!e&&"collapse"===this.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if(e){switch(this.tagName){case"TD":case"TH":return 0;default:const e=this.actualParent;if(e){const[i,n]=e.css("borderSpacing").split(" ");switch(t){case"marginTop":case"marginBottom":return n?this.parseUnit(n,"height",!1):this.parseUnit(i,"width",!1);case"marginRight":if(e.lastChild!==this)return this.parseUnit(i,"width",!1);case"marginLeft":return 0}}}return 0}}const i=this.parseUnit(this.css(t));if(!e){let e=this.toFloat("paddingInlineStart"),n=this.toFloat("paddingInlineEnd");if(e>0||n>0)return"vertical-rl"===this.css("writingMode")?"rtl"===this.dir?("paddingBottom"!==t&&(e=0),"paddingTop"!==t&&(n=0)):("paddingTop"!==t&&(e=0),"paddingBottom"!==t&&(n=0)):"rtl"===this.dir?("paddingRight"!==t&&(e=0),"paddingLeft"!==t&&(n=0)):("paddingLeft"!==t&&(e=0),"paddingRight"!==t&&(n=0)),e+i+n}return i}set parent(t){t&&(t!==this._parent&&(this._parent&&this._parent.remove(this),this._parent=t),t.contains(this)||t.append(this),-1===this.depth&&(this.depth=t.depth+1))}get parent(){return this._parent}get tagName(){let t=this._cached.tagName;if(void 0===t){const e=this._element;if(e){const i=e.nodeName;t="#"===i.charAt(0)?i:e.tagName}else t="";this._cached.tagName=t}return t}get element(){return this._element}get elementId(){var t;return(null===(t=this._element)||void 0===t?void 0:t.id)||""}get htmlElement(){let t=this._cached.htmlElement;return void 0===t&&(t=!this.plainText&&this._element instanceof HTMLElement,this._cached.htmlElement=t),t}get svgElement(){let t=this._cached.svgElement;return void 0===t&&(t=!this.htmlElement&&!this.plainText&&this._element instanceof SVGElement||this.imageElement&&this.src.toLowerCase().endsWith(".svg"),this._cached.svgElement=t),t}get styleElement(){return this.htmlElement||this.svgElement}get naturalChild(){return!0}get naturalElement(){let t=this._cached.naturalElement;return void 0===t&&(t=this.naturalChild&&this.styleElement&&!this.pseudoElement,this._cached.naturalElement=t),t}get pseudoElement(){return!1}get imageElement(){return"IMG"===this.tagName}get flexElement(){let t=this._cached.flexElement;return void 0===t&&(t=this.display.endsWith("flex"),this._cached.flexElement=t),t}get gridElement(){let t=this._cached.gridElement;return void 0===t&&(t=this.display.endsWith("grid"),this._cached.gridElement=t),t}get textElement(){let t=this._cached.textElement;return void 0===t&&(t=this.plainText||this.inlineText,this._cached.textElement=t),t}get tableElement(){let t=this._cached.tableElement;return void 0===t&&(t="TABLE"===this.tagName||"table"===this.display,this._cached.tableElement=t),t}get inputElement(){let t=this._cached.inputElement;if(void 0===t){switch(this.tagName){case"INPUT":case"BUTTON":case"SELECT":case"TEXTAREA":t=!0;break;default:t=!1}this._cached.inputElement=t}return t}get layoutElement(){let t=this._cached.layoutElement;return void 0===t&&(t=this.flexElement||this.gridElement,this._cached.layoutElement=t),t}get plainText(){return"#text"===this.tagName}get styleText(){return this.naturalElement&&this.inlineText}get lineBreak(){return"BR"===this.tagName}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||ot()}get linear(){return this._linear||(()=>{const t=this._bounds;return t?(this.styleElement?(this._linear={top:t.top-(this.marginTop>0?this.marginTop:0),right:t.right+this.marginRight,bottom:t.bottom+this.marginBottom,left:t.left-(this.marginLeft>0?this.marginLeft:0),width:0,height:0},this.setBoxModel("linear")):this._linear=t,this._linear):ot()})()}get box(){return this._box||(()=>{const t=this._bounds;return t?(this.styleElement?(this._box={top:t.top+(this.paddingTop+this.borderTopWidth),right:t.right-(this.paddingRight+this.borderRightWidth),bottom:t.bottom-(this.paddingBottom+this.borderBottomWidth),left:t.left+(this.paddingLeft+this.borderLeftWidth),width:0,height:0},this.setBoxModel("box")):this._box=t,this._box):ot()})()}get dataset(){return this.styleElement?this._element.dataset:(void 0===this._dataset&&(this._dataset={}),this._dataset)}get flexbox(){let t=this._cached.flexbox;if(void 0===t){const e=this.actualParent;if(e){const i=this.css("alignSelf"),n=this.css("justifySelf"),s=(t,i,n)=>{const o=(n||this).css(t);return Et(o)?parseFloat(o):"inherit"===o&&void 0===n?s(t,i,e):i};t={alignSelf:"auto"===i&&e.has("alignItems")?e.css("alignItems"):i,justifySelf:"auto"===n&&e.has("justifyItems")?e.css("justifyItems"):n,basis:this.css("flexBasis"),grow:s("flexGrow",0),shrink:s("flexShrink",1),order:this.toInt("order")}}else t={alignSelf:"auto",justifySelf:"auto",basis:"auto",grow:0,shrink:1,order:1/0};this._cached.flexbox=t}return t}get width(){let t=this._cached.width;return void 0===t&&(t=this.setDimension("width","minWidth","maxWidth"),this._cached.width=t),t}get height(){let t=this._cached.height;return void 0===t&&(t=this.setDimension("height","minHeight","maxHeight"),this._cached.height=t),t}get hasWidth(){return this.width>0}get hasHeight(){var t;const e=this.css("height");return Z(e)?!!(this.pageFlow&&(null===(t=this.actualParent)||void 0===t?void 0:t.hasHeight))&&parseFloat(e)>0:this.height>0}get lineHeight(){let t=this._cached.lineHeight;if(void 0===t){if(t=0,!this.imageElement&&!this.svgElement){let e=this.has("lineHeight"),i=0;if(e){const t=this.css("lineHeight");if(Z(t))i=xt(this.style.lineHeight);else if(i=tt(t,this.fontSize),t.endsWith("px")){const t=this.cssInitial("fontSize");t.endsWith("em")&&(i*=parseFloat(t))}}else if(this.naturalChild){let t=this.actualParent;for(;t;){if(t.lineHeight>0){i=t.lineHeight;break}t=t.actualParent}if(this.styleElement){const t=this.cssInitial("fontSize");if(t.endsWith("em")){const n=parseFloat(t);1!==n&&(i*=n,this.css("lineHeight",Y(i)),e=!0)}}}(e||i>this.actualHeight||this.multiline||this.block&&this.naturalChildren.some(t=>t.textElement))&&(t=i)}this._cached.lineHeight=t}return t}get display(){return this.css("display")}get positionStatic(){var t;let e=this._cached.positionStatic;if(void 0===e){switch(this.css("position")){case"fixed":case"absolute":e=!1;break;case"relative":e=!(this.hasPX("top")||this.hasPX("right")||this.hasPX("bottom")||this.hasPX("left")),e&&(this._cached.positionRelative=!1);break;case"inherit":const i=this._element,n=(null===(t=i)||void 0===t?void 0:t.parentElement)?$(i.parentElement,"position"):"";e=""!==n&&!("absolute"===n||"fixed"===n);break;default:e=!0}this._cached.positionStatic=e}return e}get positionRelative(){let t=this._cached.positionRelative;return void 0===t&&(t="relative"===this.css("position"),this._cached.positionRelative=t),t}get positionAuto(){let t=this._cached.positionAuto;if(void 0===t){if(this.pageFlow)t=!1;else{const{top:e,right:i,bottom:n,left:s}=-1!==this._initial.iteration&&this._initial.styleMap||this._styleMap;t=!(e&&"auto"!==e||i&&"auto"!==i||n&&"auto"!==n||s&&"auto"!==s||!(this.toFloat("opacity",!0,1)>0))}this._cached.positionAuto=t}return t}get top(){let t=this._cached.top;return void 0===t&&(t=this.convertPosition("top"),this._cached.top=t),t}get right(){let t=this._cached.right;return void 0===t&&(t=this.convertPosition("right"),this._cached.right=t),t}get bottom(){let t=this._cached.bottom;return void 0===t&&(t=this.convertPosition("bottom"),this._cached.bottom=t),t}get left(){let t=this._cached.left;return void 0===t&&(t=this.convertPosition("left"),this._cached.left=t),t}get marginTop(){let t=this._cached.marginTop;return void 0===t&&(t=this.inlineStatic?0:this.convertBox("marginTop",!0),this._cached.marginTop=t),t}get marginRight(){let t=this._cached.marginRight;return void 0===t&&(t=this.convertBox("marginRight",!0),this._cached.marginRight=t),t}get marginBottom(){let t=this._cached.marginBottom;return void 0===t&&(t=this.inlineStatic?0:this.convertBox("marginBottom",!0),this._cached.marginBottom=t),t}get marginLeft(){let t=this._cached.marginLeft;return void 0===t&&(t=this.convertBox("marginLeft",!0),this._cached.marginLeft=t),t}get borderTopWidth(){let t=this._cached.borderTopWidth;return void 0===t&&(t=this.convertBorderWidth(0),this._cached.borderTopWidth=t),t}get borderRightWidth(){let t=this._cached.borderRightWidth;return void 0===t&&(t=this.convertBorderWidth(1),this._cached.borderRightWidth=t),t}get borderBottomWidth(){let t=this._cached.borderBottomWidth;return void 0===t&&(t=this.convertBorderWidth(2),this._cached.borderBottomWidth=t),t}get borderLeftWidth(){let t=this._cached.borderLeftWidth;return void 0===t&&(t=this.convertBorderWidth(3),this._cached.borderLeftWidth=t),t}get paddingTop(){let t=this._cached.paddingTop;return void 0===t&&(t=this.convertBox("paddingTop",!1),this._cached.paddingTop=t),t}get paddingRight(){let t=this._cached.paddingRight;return void 0===t&&(t=this.convertBox("paddingRight",!1),this._cached.paddingRight=t),t}get paddingBottom(){let t=this._cached.paddingBottom;return void 0===t&&(t=this.convertBox("paddingBottom",!1),this._cached.paddingBottom=t),t}get paddingLeft(){let t=this._cached.paddingLeft;return void 0===t&&(t=this.convertBox("paddingLeft",!1),this._cached.paddingLeft=t),t}get contentBox(){return"border-box"!==this.css("boxSizing")}get contentBoxWidth(){let t=this._cached.contentBoxWidth;return void 0===t&&(t=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth,this._cached.contentBoxWidth=t),t}get contentBoxHeight(){let t=this._cached.contentBoxHeight;return void 0===t&&(t=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth,this._cached.contentBoxHeight=t),t}get inline(){let t=this._cached.inline;if(void 0===t){const e=this.display;t="inline"===e||"initial"===e&&!et.includes(this.tagName),this._cached.inline=t}return t}get inlineStatic(){let t=this._cached.inlineStatic;return void 0===t&&(t=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement,this._cached.inlineStatic=t),t}get inlineHorizontal(){let t=this._cached.inlineHorizontal;if(void 0===t){if(this.naturalElement){const e=this.display;t=e.startsWith("inline-")||e.startsWith("table")||this.flexElement||this.floating||"RUBY"===this.tagName}else t=this.plainText;this._cached.inlineVertical=t}return t}get inlineVertical(){let t=this._cached.inlineVertical;if(void 0===t){if(this.naturalElement){const e=this.display;t=(e.startsWith("inline")||"table-cell"===e)&&!this.floating&&!this.plainText}else t=!1;this._cached.inlineVertical=t}return t}set inlineText(t){switch(this.tagName){case"INPUT":case"IMG":case"SELECT":case"SVG":case"BR":case"HR":case"TEXTAREA":this._inlineText=!1;break;case"BUTTON":this._inlineText=""!==this.textContent.trim();break;default:this._inlineText=t}}get inlineText(){return this._inlineText}get block(){var t;let e=this._cached.block;if(void 0===e){switch(this.display){case"block":case"flex":case"grid":case"list-item":e=!0;break;case"initial":e=et.includes(this.tagName);break;case"inline":if("svg"===this.tagName&&(null===(t=this.actualParent)||void 0===t?void 0:t.htmlElement)){e=!this.hasPX("width")&&0===xt(nt(this._element,"width"));break}default:e=!1}this._cached.block=e}return e}get blockStatic(){let t=this._cached.blockStatic;return void 0===t&&(t=this.pageFlow&&(this.block&&!this.floating||this.blockDimension&&"100%"===this.cssInitial("width")&&!this.hasPX("maxWidth")),this._cached.blockStatic=t),t}get blockDimension(){let t=this._cached.blockDimension;if(void 0===t){const e=this.display;t=this.block||e.startsWith("inline-")||"table"===e||this.imageElement||this.svgElement,this._cached.blockDimension=t}return t}get blockVertical(){let t=this._cached.blockVertical;return void 0===t&&(t=this.blockDimension&&this.hasPX("height"),this._cached.blockVertical=t),t}get pageFlow(){let t=this._cached.pageFlow;return void 0===t&&(t=this.positionStatic||this.positionRelative,this._cached.pageFlow=t),t}get inlineFlow(){let t=this._cached.inlineFlow;if(void 0===t){const e=this.display;t=this.inline||e.startsWith("inline")||"table-cell"===e||this.imageElement||this.floating,this._cached.inlineFlow=t}return t}get centerAligned(){let t=this._cached.centerAligned;return void 0===t&&(t=this.autoMargin.leftRight||this.textElement&&this.blockStatic&&"center"===this.cssInitial("textAlign")||this.inlineStatic&&"center"===this.cssAscend("textAlign",!0),this._cached.centerAligned=t),t}get rightAligned(){let t=this._cached.rightAligned;return void 0===t&&(t="right"===this.float||this.autoMargin.left||!this.pageFlow&&this.hasPX("right")||this.textElement&&this.blockStatic&&"right"===this.cssInitial("textAlign"),this._cached.rightAligned=t),t}get bottomAligned(){let t=this._cached.bottomAligned;return void 0===t&&(t=!this.pageFlow&&this.hasPX("bottom")&&this.bottom>=0,this._cached.bottomAligned=t),t}get horizontalAligned(){let t=this._cached.horizontalAligned;return void 0===t&&(t=!(this.blockStatic||this.autoMargin.horizontal||this.blockDimension&&"100%"===this.css("width")),this._cached.horizontalAligned=t),t}get autoMargin(){let t=this._cached.autoMargin;if(void 0===t){if(!this.pageFlow||this.blockStatic||"table"===this.display){const e=this._initial,i=-1!==e.iteration&&e.styleMap||this._styleMap,n="auto"===i.marginLeft&&(this.pageFlow||this.hasPX("right")),s="auto"===i.marginRight&&(this.pageFlow||this.hasPX("left")),o="auto"===i.marginTop&&(this.pageFlow||this.hasPX("bottom")),r="auto"===i.marginBottom&&(this.pageFlow||this.hasPX("top"));t={horizontal:n||s,left:n&&!s,right:!n&&s,leftRight:n&&s,vertical:o||r,top:o&&!r,bottom:!o&&r,topBottom:o&&r}}else t={};this._cached.autoMargin=t}return t}get floating(){let t=this._cached.floating;return void 0===t&&(t="none"!==this.float,this._cached.floating=t),t}get float(){let t=this._cached.float;return void 0===t&&(t=this.pageFlow&&this.css("float")||"none",this._cached.float=t),t}get zIndex(){return this.toInt("zIndex")}get textContent(){let t=this._cached.textContent;return void 0===t&&(t=this.svgElement?"":this._element.textContent,this._cached.textContent=t),t}get src(){return this.htmlElement&&this._element.src||""}get overflow(){let t=this._cached.overflow;if(void 0===t){if(t=0,this.htmlElement&&!this.inputElement&&!this.imageElement&&"HR"!==this.tagName&&!this.documentBody){const e=this._element,i=this.css("overflowX"),n=this.css("overflowY");this.hasHeight&&(this.hasPX("height")||this.hasPX("maxHeight"))&&("scroll"===n||"auto"===n&&e.clientHeight!==e.scrollHeight)&&(t|=16),(this.hasPX("width")||this.hasPX("maxWidth"))&&("scroll"===i||"auto"===i&&e.clientWidth!==e.scrollWidth)&&(t|=8),"auto"!==i&&"hidden"!==i&&"overlay"!==i&&"auto"!==n&&"hidden"!==n&&"overlay"!==n||(t|=64)}this._cached.overflow=t}return t}get overflowX(){return St(this.overflow,8)}get overflowY(){return St(this.overflow,16)}get baseline(){let t=this._cached.baseline;if(void 0===t){if(this.pageFlow&&!this.floating){const e=this.verticalAlign;t="baseline"===e||"0px"===e||"initial"===e}else t=!1;this._cached.baseline=t}return t}get verticalAlign(){let t=this._cached.verticalAlign;return void 0===t&&(t=this.css("verticalAlign"),K(t,!0)&&(t=this.convertPX(t,"height")),this._cached.verticalAlign=t),t}set textBounds(t){this._textBounds=t}get textBounds(){return this.naturalChild&&void 0===this._textBounds&&(this._textBounds=ht(this._element,this.sessionId)),this._textBounds}get multiline(){let t=this._cached.multiline;if(void 0===t){if(this.plainText)t=st(this._element).numberOfLines>1;else if(this.styleText&&(this.inlineFlow||0===this.naturalElements.length)){const e=this.textBounds;t=!!e&&e.numberOfLines>1}else t=!1;this._cached.multiline=t}return t}get positiveAxis(){let t=this._cached.positiveAxis;return void 0===t&&(t=(!this.positionRelative||this.positionRelative&&this.top>=0&&this.left>=0&&(this.right<=0||this.hasPX("left"))&&(this.bottom<=0||this.hasPX("top")))&&this.marginTop>=0&&this.marginLeft>=0&&this.marginRight>=0,this._cached.positiveAxis=t),t}get backgroundColor(){let t=this._cached.backgroundColor;if(void 0===t){switch(t=this.css("backgroundColor"),t){case"initial":case"rgba(0, 0, 0, 0)":case"transparent":t="";break;default:if(""!==t&&this.pageFlow&&!this.plainText&&!this.inputElement&&(-1===this._initial.iteration||this.cssInitial("backgroundColor")===t)){let e=this.actualParent;for(;e&&0!==e.id;){const i=e.cssInitial("backgroundColor",!0);if(""!==i){i===t&&""===e.backgroundColor&&(t="");break}e=e.actualParent}}}this._cached.backgroundColor=t}return t}get backgroundImage(){let t=this._cached.backgroundImage;if(void 0===t){const e=this.css("backgroundImage");if(""!==e&&"none"!==e&&"initial"!==e)t=e;else{const e=At.exec(this.css("background"));t=e?e[1]:""}this._cached.backgroundImage=t}return t}get visibleStyle(){let t=this._cached.visibleStyle;if(void 0===t){if(this.plainText)t={background:!1,borderWidth:!1,backgroundImage:!1,backgroundColor:!1,backgroundRepeat:!1,backgroundRepeatX:!1,backgroundRepeatY:!1};else{const e=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,i=""!==this.backgroundColor,n=""!==this.backgroundImage;let s=!1,o=!1;if(n)for(const t of this.css("backgroundRepeat").split(lt.SEPARATOR)){const[e,i]=t.split(" ");s||(s="repeat"===e||"repeat-x"===e),o||(o="repeat"===e||"repeat-y"===e||"repeat"===i)}t={background:e||n||i,borderWidth:e,backgroundImage:n,backgroundColor:i,backgroundRepeat:s||o,backgroundRepeatX:s,backgroundRepeatY:o}}this._cached.visibleStyle=t}return t}get percentWidth(){let t=this._cached.percentWidth;return void 0===t&&(t=Z(this.cssInitial("width",!0)),this._cached.percentWidth=t),t}get percentHeight(){let t=this._cached.percentHeight;return void 0===t&&(t=Z(this.cssInitial("height",!0)),this._cached.percentHeight=t),t}get absoluteParent(){let t=this._cached.absoluteParent;if(void 0===t){if(t=this.actualParent,!this.pageFlow)for(;t&&0!==t.id;){const e=t.cssInitial("position",!1,!0);if(t.documentBody||"static"!==e&&"initial"!==e)break;t=t.actualParent}this._cached.absoluteParent=t}return t}set actualParent(t){this._cached.actualParent=t}get actualParent(){var t;let e=this._cached.actualParent;if(void 0===e){const i=this._element;e=(null===(t=i)||void 0===t?void 0:t.parentElement)&&ut(i.parentElement,this.sessionId)||null,this._cached.actualParent=e}return e}get actualWidth(){var t;let e=this._cached.actualWidth;if(void 0===e){if(this.plainText)e=this.bounds.right-this.bounds.left;else{const i=this.actualParent;if((null===(t=i)||void 0===t?void 0:t.flexElement)&&i.css("flexDirection").startsWith("row")||"table-cell"===this.display)e=this.bounds.width;else{const t=this.parseUnit(this.cssInitial("width",!0));if(t>0){e=t;const i=this.parseUnit(this.css("maxWidth"));i>0&&(e=Math.min(e,i)),this.contentBox&&!this.tableElement&&(e+=this.contentBoxWidth)}else e=this.bounds.width}}this._cached.actualWidth=e}return e}get actualHeight(){var t;let e=this._cached.actualHeight;if(void 0===e){if(this.plainText)e=this.bounds.height;else{const i=this.actualParent;if((null===(t=i)||void 0===t?void 0:t.flexElement)&&i.css("flexDirection").startsWith("column")||"table-cell"===this.display)e=this.bounds.height;else{const t=this.parseUnit(this.cssInitial("height",!0),"height");if(t>0){e=t;const i=this.parseUnit(this.css("maxHeight"));i>0&&(e=Math.min(e,i)),this.contentBox&&!this.tableElement&&(e+=this.contentBoxHeight)}else e=this.bounds.height}}this._cached.actualHeight=e}return e}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}set naturalChildren(t){this._naturalChildren=t}get naturalChildren(){if(void 0===this._naturalChildren)if(this.naturalElement){const t=this.sessionId,e=[];let i=0;this._element.childNodes.forEach(n=>{const s=ut(n,t);s&&(s.childIndex=i++,e.push(s))}),this._naturalChildren=e}else-1===this._initial.iteration&&this.saveAsInitial(),this._naturalChildren=this._initial.children||this.children;return this._naturalChildren}set naturalElements(t){this._naturalElements=t}get naturalElements(){return void 0===this._naturalElements&&(this._naturalElements=yt(this.naturalChildren,t=>t.naturalElement)),this._naturalElements}get firstChild(){return this.naturalElements[0]||null}get lastChild(){const t=this.naturalElements,e=t.length;return e?t[e-1]:null}get firstStaticChild(){for(const t of this.naturalChildren)if(t.pageFlow)return t;return null}get lastStaticChild(){const t=this.naturalChildren;for(let e=t.length-1;e>=0;e--){const i=t[e];if(i.pageFlow)return i}return null}get previousSibling(){var t;return(null===(t=this.actualParent)||void 0===t?void 0:t.naturalChildren[this.childIndex-1])||null}get nextSibling(){var t;return(null===(t=this.actualParent)||void 0===t?void 0:t.naturalChildren[this.childIndex+1])||null}get previousElementSibling(){const t=this.actualParent;if(t){const e=t.naturalElements,i=e.indexOf(this);if(i>0)return e[i-1]}return null}get nextElementSibling(){const t=this.actualParent;if(t){const e=t.naturalElements,i=e.indexOf(this);if(i<e.length-1)return e[i+1]}return null}get attributes(){let t=this._cached.attributes;if(void 0===t){if(t={},this.styleElement){const e=this._element.attributes,i=e.length;for(let n=0;n<i;n++){const{name:i,value:s}=e.item(n);t[i]=s}}this._cached.attributes=t}return t}get boundingClientRect(){var t;return(null===(t=this._element)||void 0===t?void 0:t.getBoundingClientRect())||ot()}get fontSize(){return 0===this._fontSize&&(this._fontSize=this.naturalElement?parseFloat(this.style.getPropertyValue("font-size")):tt(this.css("fontSize"))),this._fontSize||parseFloat(Q(document.body).getPropertyValue("font-size"))}set dir(t){this._cached.dir=t}get dir(){let t=this._cached.dir;if(void 0===t){if(t=this.naturalElement?this._element.dir:"",""===t){let e=this.actualParent;for(;e&&(t=e.dir,""===t);)e=e.actualParent}this._cached.dir=t}return t}get center(){const t=this.bounds;return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}get extensions(){let t=this._cached.extensions;return void 0===t&&(t=this.dataset.use?Tt(this.dataset.use.split(lt.SEPARATOR),t=>""===t):[],this._cached.extensions=t),t}}const Nt=new Map([[2,"marginTop"],[4,"marginRight"],[8,"marginBottom"],[16,"marginLeft"],[32,"paddingTop"],[64,"paddingRight"],[128,"paddingBottom"],[256,"paddingLeft"]]),Lt={ACCESSIBILITY:"squared.accessibility",CSS_GRID:"squared.css-grid",FLEXBOX:"squared.flexbox",GRID:"squared.grid",LIST:"squared.list",RELATIVE:"squared.relative",SPRITE:"squared.sprite",TABLE:"squared.table",VERTICAL_ALIGN:"squared.verticalalign",WHITESPACE:"squared.whitespace"};var Mt,Wt,Ft,Ot=Object.freeze({__proto__:null,CSS_SPACING:Nt,EXT_NAME:Lt});!function(t){t[t.DOM_TRAVERSE=2]="DOM_TRAVERSE",t[t.EXTENSION=4]="EXTENSION",t[t.RENDER=8]="RENDER",t[t.ALL=14]="ALL"}(Mt||(Mt={})),function(t){t[t.BOX_STYLE=2]="BOX_STYLE",t[t.BOX_SPACING=4]="BOX_SPACING",t[t.FONT_STYLE=8]="FONT_STYLE",t[t.VALUE_STRING=16]="VALUE_STRING",t[t.IMAGE_SOURCE=32]="IMAGE_SOURCE",t[t.ASSET=56]="ASSET",t[t.ALL=126]="ALL"}(Wt||(Wt={})),function(t){t[t.CONSTRAINT=2]="CONSTRAINT",t[t.LAYOUT=4]="LAYOUT",t[t.ALIGNMENT=8]="ALIGNMENT",t[t.ACCESSIBILITY=16]="ACCESSIBILITY",t[t.LOCALIZATION=32]="LOCALIZATION",t[t.CUSTOMIZATION=64]="CUSTOMIZATION",t[t.ALL=126]="ALL"}(Ft||(Ft={}));var Dt=Object.freeze({__proto__:null,get APP_SECTION(){return Mt},get NODE_RESOURCE(){return Wt},get NODE_PROCEDURE(){return Ft}});const Ht=squared.lib,{BOX_MARGIN:zt,BOX_PADDING:Xt,BOX_POSITION:Ut,formatPX:Vt,isLength:qt}=Ht.css,{assignRect:jt,isTextNode:Gt,newBoxModel:Yt}=Ht.dom,{isEqual:$t}=Ht.math,{getElementAsNode:Qt}=Ht.session,{aboveRange:Kt,assignEmptyProperty:Zt,belowRange:Jt,cloneObject:te,filterArray:ee,hasBit:ie,isArray:ne,searchObject:se,withinRange:oe}=Ht.util,re=Array.from(Nt.keys()),ae=["position","display","verticalAlign","float","clear","zIndex"],le=t=>t.naturalElements.length>0&&!t.layoutElement&&!t.tableElement;class ce extends Pt{constructor(){super(...arguments),this.alignmentType=0,this.baselineActive=!1,this.baselineAltered=!1,this.positioned=!1,this.rendered=!1,this.excluded=!1,this.controlId="",this.floatContainer=!1,this.containerIndex=1/0,this.lineBreakLeading=!1,this.lineBreakTrailing=!1,this._excludeSection=0,this._excludeProcedure=0,this._excludeResource=0,this._visible=!0,this._locked={}}static outerRegion(t){let e,i,n,s,o=1/0,r=-1/0,a=-1/0,l=1/0,c=-1/0,h=-1/0;return t.each(t=>{if(t.companion)e=t.actualRect("top","linear",!0),i=t.actualRect("right","linear",!0),n=t.actualRect("bottom","linear",!0),s=t.actualRect("left","linear",!0);else{if(({top:e,right:i,bottom:n,left:s}=t.linear),t.marginRight<0){const e=i+Math.abs(t.marginRight);e>c&&(c=e)}if(t.marginBottom<0){const e=n+Math.abs(t.marginBottom);e>h&&(h=e)}}e<o&&(o=e),i>r&&(r=i),n>a&&(a=n),s<l&&(l=s)}),{top:o,right:r,bottom:a,left:l,width:Math.max(r,c)-l,height:Math.max(a,h)-o}}static baseline(t,e=!1){return(t=ee(t,t=>!(!t.baseline&&!qt(t.verticalAlign)||e&&!t.textElement)&&(!t.floating&&!t.baselineAltered&&(t.naturalChild&&0===t.length||!t.layoutVertical&&t.every(t=>t.baseline&&!t.multiline))))).length>1&&t.sort((t,e)=>{if(t.length&&0===e.length)return 1;if(e.length&&0===t.length)return-1;let i=t.baselineHeight,n=e.baselineHeight;if(0!==t.marginTop){if(!(t.imageElement||i>=n||t.marginTop<0))return t.marginTop>(n-i)/2?-1:1;i+=t.marginTop}if(0!==e.marginTop){if(!(e.imageElement||n>=i||e.marginTop<0))return e.marginTop>(i-n)/2?1:-1;n+=e.marginTop}if(!$t(i,n))return i>n?-1:1;if(t.textElement&&e.textElement){if(!t.plainText&&e.plainText)return-1;if(t.plainText&&!e.plainText)return 1}else if(t.inputElement&&e.inputElement&&t.containerType!==e.containerType)return t.containerType>e.containerType?-1:1;return t.bounds.bottom>e.bounds.bottom?-1:t.bounds.bottom<e.bounds.bottom?1:0}),t.shift()||null}static linearData(t,e=!1){const i=new Set,n=new Map;let s=!1,o=!1;if(t.length>1){const r=[],a=new Set,l={};for(const e of t)if(e.pageFlow){if(a.size){const t=[],i=e.css("clear");switch(i){case"left":t.push(l.left);break;case"right":t.push(l.right);break;case"both":t.push(l.left,l.right)}for(const i of t)if(i&&a.has(i.float)&&!e.floating&&Kt(e.linear.top,i.linear.bottom)){const t=i.float;a.delete(t),l[t]=void 0}"both"===i?(n.set(e,2===a.size?"both":a.values().next().value),a.clear(),l.left=void 0,l.right=void 0):a.has(i)&&(n.set(e,i),a.delete(i),l[i]=void 0)}if(e.floating){const t=e.float;a.add(t),i.add(t),l[t]=e}r.push(e)}else e.positionAuto&&r.push(e);const c=r.length;if(c>0&&!e){const t=[r[0]];let e=1,a=1;for(let i=1;i<c;i++)r[i].alignedVertically(t,n)?a++:e++,t.push(r[i]);if(s=e===c,o=a===c,s&&i.size){let t=1/0,e=-1/0,i=-1/0,n=1/0;for(const s of r){const{left:o,right:r}=s.linear;t=Math.min(t,o),e=Math.max(e,r),s.floating&&("left"===s.float?i=Math.max(i,r):n=Math.min(n,o))}for(let o=0,a=0,l=0,h=0,d=0;o<c;o++){const c=r[o],{left:u,right:f}=c.linear;if(Math.floor(u)<=t&&a++,Math.ceil(f)>=e&&l++,c.floating||(u===i&&h++,f===n&&d++),0===o)continue;if(2===a||2===l||2===h||2===d){s=!1;break}const g=r[o-1];if(oe(u,g.linear.left)||g.floating&&Kt(c.linear.top,g.linear.bottom)){s=!1;break}}}}}else t.length&&(o=t[0].blockStatic,s=!o);return{linearX:s,linearY:o,cleared:n,floated:i}}static partitionRows(t){var e;const i=t[0].actualParent,n=(null===(e=i)||void 0===e?void 0:e.floatContainer)?ce.linearData(i.naturalElements,!0).cleared:void 0,s=[];let o=[],r=[];const a=t.length;for(let e=0;e<a;e++){const i=t[e];let a=i;if(!i.naturalChild){if(i.nodeGroup){o.length&&s.push(o),s.push([i]),o=[],r.length=0;continue}let t=i.innerWrapped;for(;t;){if(t.naturalChild){a=t;break}t=t.innerWrapped}}0===o.length?(o.push(i),r.push(a)):a.alignedVertically(r,n)?(o.length&&s.push(o),o=[i],r=[a]):(o.push(i),r.push(a))}return o.length&&s.push(o),s}is(t){return this.containerType===t}of(t,...e){return this.containerType===t&&e.some(t=>this.hasAlign(t))}attr(t,e,i,n=!0){let s=this["__"+t];return i?(void 0===s&&(this._namespaces.includes(t)||this._namespaces.push(t),s={},this["__"+t]=s),!n&&s[e]?i=s[e]:s[e]=i,i):s&&s[e]||""}unsafe(t,e){if(void 0===e)return this["_"+t];this["_"+t]=e}unset(t){delete this["_"+t]}namespace(t){return this["__"+t]||{}}delete(t,...e){const i=this["__"+t];if(i)for(const t of e)if(-1!==t.indexOf("*"))for(const[e]of se(i,t))delete i[e];else delete i[t]}lockAttr(t,e){let i=this._locked[t];void 0===i&&(i={},this._locked[t]=i),i[e]=!0}lockedAttr(t,e){const i=this._locked[t];return i&&i[e]||!1}render(t){this.renderParent=t,this.rendered=!0}renderEach(t){const e=this.renderChildren,i=e.length;for(let n=0;n<i;n++){const i=e[n];i.visible&&t(i,n,e)}return this}renderFilter(t){return ee(this.renderChildren,t)}hide(t){var e;const i=this.renderParent;if(i){const t=i.renderTemplates;if(t){const n=i.renderChildren.findIndex(t=>t===this);if(-1!==n){(null===(e=t[n])||void 0===e?void 0:e.node)===this&&(t[n]=null)}}}this.rendered=!0,this.visible=!1}inherit(t,...e){for(const i of e)switch(i){case"base":this._documentParent=t.documentParent,this._bounds=jt(t.bounds),this._linear=jt(t.linear),this._box=jt(t.box),this._boxReset=Yt(),this._boxAdjustment=Yt(),-1===this.depth&&(this.depth=t.depth);const e=t.actualParent;e&&(this.actualParent=e,this.dir=e.dir);break;case"initial":te(t.unsafe("initial"),this.initial);break;case"alignment":{const e=this._styleMap;for(const i of ae)e[i]=t.css(i);if(!this.positionStatic)for(const i of Ut)t.hasPX(i)&&(e[i]=t.css(i));if(t.autoMargin.horizontal||t.autoMargin.vertical)for(const i of zt)"auto"===t.cssInitial(i)&&(e[i]="auto");this.positionAuto=t.positionAuto;break}case"styleMap":Zt(this._styleMap,t.unsafe("styleMap"));break;case"textStyle":this.cssApply(t.getTextStyle()),this.fontSize=t.fontSize;break;case"boxStyle":const{backgroundColor:i,backgroundImage:n}=t;this.cssApply({backgroundColor:i,backgroundImage:n,backgroundRepeat:t.css("backgroundRepeat"),backgroundSize:t.css("backgroundSize"),backgroundPositionX:t.css("backgroundPositionX"),backgroundPositionY:t.css("backgroundPositionY"),backgroundClip:t.css("backgroundClip"),border:"initial",borderRadius:"initial",borderTopWidth:t.css("borderTopWidth"),borderBottomWidth:t.css("borderBottomWidth"),borderRightWidth:t.css("borderRightWidth"),borderLeftWidth:t.css("borderLeftWidth"),borderTopColor:t.css("borderTopColor"),borderBottomColor:t.css("borderBottomColor"),borderRightColor:t.css("borderRightColor"),borderLeftColor:t.css("borderLeftColor"),borderTopStyle:t.css("borderTopStyle"),borderBottomStyle:t.css("borderBottomStyle"),borderRightStyle:t.css("borderRightStyle"),borderLeftStyle:t.css("borderLeftStyle"),borderTopLeftRadius:t.css("borderTopLeftRadius"),borderTopRightRadius:t.css("borderTopRightRadius"),borderBottomRightRadius:t.css("borderBottomRightRadius"),borderBottomLeftRadius:t.css("borderBottomLeftRadius")},!0),this.setCacheValue("backgroundColor",i),this.setCacheValue("backgroundImage",n),t.cssApply({borderTopWidth:"0px",borderBottomWidth:"0px",borderRightWidth:"0px",borderLeftWidth:"0px",backgroundColor:"transparent",backgroundImage:"none",border:"0px none solid",borderRadius:"0px"},!0),t.setCacheValue("backgroundColor",""),t.setCacheValue("backgroundImage",""),t.resetBox(510,this)}}addAlign(t){this.hasAlign(t)||(this.alignmentType|=t)}removeAlign(t){this.hasAlign(t)&&(this.alignmentType^=t)}hasAlign(t){return ie(this.alignmentType,t)}hasResource(t){return!ie(this.excludeResource,t)}hasProcedure(t){return!ie(this.excludeProcedure,t)}hasSection(t){return!ie(this.excludeSection,t)}exclude(t=0,e=0,i=0){t>0&&!ie(this._excludeResource,t)&&(this._excludeResource|=t),e>0&&!ie(this._excludeProcedure,e)&&(this._excludeProcedure|=e),i>0&&!ie(this._excludeSection,i)&&(this._excludeSection|=i)}setExclusions(){var t;if(this.styleElement){const e=(null===(t=this.actualParent)||void 0===t?void 0:t.dataset)||{},i=(t,i)=>{let n=this.dataset[t]||"",s=0;if(e[t+"Child"]&&(n+=(""!==n?"|":"")+e[t+"Child"]),""!==n)for(let t of n.split("|")){t=t.trim().toUpperCase();const e=i[t];e&&!ie(s,e)&&(s|=e)}return s};this.exclude(i("excludeResource",Wt),i("excludeProcedure",Ft),i("excludeSection",Mt))}}appendTry(t,e,i=!0){let n=!1;const s=this.children,o=s.length;for(let i=0;i<o;i++)if(s[i]===t){s[i]=e,e.parent=this,e.containerIndex=t.containerIndex,n=!0;break}return!n&&i&&(e.parent=this,n=!0),n}sort(t){return t?super.sort(t):this.children.sort((t,e)=>t.containerIndex<e.containerIndex?-1:1),this}alignedVertically(t,e,i){var n,s,o,r,a;if(this.lineBreak)return 2;if(this.pageFlow||this.positionAuto){const l=t=>t.blockVertical||t.percentWidth,c=t=>Kt(this.linear.top,t.linear.bottom)&&(l(this)||l(t)||this.float!==t.float);if(ne(t)){if(null===(n=e)||void 0===n?void 0:n.has(this))return 5;{const n=t[t.length-1];if(this.floating&&n.floating){if(i&&this.float===n.float)return 0;if(Kt(this.linear.top,n.linear.bottom))return 4;if(i&&(null===(s=e)||void 0===s?void 0:s.size)&&!t.some((t,i)=>i>0&&e.get(t)===this.float))return 0}else{if(!1===i&&this.floating&&n.blockStatic)return 0;if(void 0!==i&&!this.display.startsWith("inline-")){const{top:n,bottom:s}=this.linear;if(this.textElement&&(null===(o=e)||void 0===o?void 0:o.size)&&t.some(t=>e.has(t))&&t.some(t=>n<t.linear.top&&s>t.linear.bottom))return 7;if("right"===t[0].float){if(t.length>1){let e=n;if(this.multiline)if(this.plainText)e=s;else if(this.styleText){const t=this.textBounds;t&&t.top>n&&(e=t.top)}let o=-1/0;for(const e of t)"right"===e.float&&e.bounds.bottom>o&&(o=e.bounds.bottom);return Jt(e,o)?i?0:6:i?6:0}if(!i)return 6}}}if(this.blockDimension&&c(n))return 3}}if(this.blockDimension&&"100%"===this.css("width")&&!this.hasPX("maxWidth"))return 1;const h=this.actualParent||this.documentParent,d=this.blockStatic||"table"===this.display;for(const i of this.siblingsLeading){if(i.lineBreak)return 2;if(!("both"!==(null===(r=e)||void 0===r?void 0:r.get(i))||ne(t)&&t[0]===i))return 5;if(d&&(!i.floating||!i.rightAligned&&oe(i.linear.right,h.box.right)||(null===(a=e)||void 0===a?void 0:a.has(i)))||i.blockStatic||i.autoMargin.leftRight)return 1;if(i.floating){if("left"===i.float&&this.autoMargin.right||"right"===i.float&&this.autoMargin.left)return 1;if(d&&this.some(t=>t.floating&&Kt(t.linear.top,i.linear.bottom)))return 6}if(this.blockDimension&&c(i))return 3}}return 0}previousSiblings(t={}){const{floating:e,pageFlow:i,lineBreak:n,excluded:s}=t,o=[];let r=this.element;if(r)r=r.previousSibling;else{const t=this.firstChild;t&&(r=t.element,r&&(r=r.previousSibling))}for(;r;){const t=Qt(r,this.sessionId);if(t)if(!1!==n&&t.lineBreak||!1!==s&&t.excluded&&!t.lineBreak)o.push(t);else if(t.pageFlow&&!t.excluded){if(!1===i)break;if(o.push(t),!1!==e||!t.floating&&(t.visible||t.rendered)&&"none"!==t.display)break}r=r.previousSibling}return o}nextSiblings(t={}){const{floating:e,pageFlow:i,lineBreak:n,excluded:s}=t,o=[];let r=this._element;if(r)r=r.nextSibling;else{const t=this.lastChild;t&&(r=t.element,r&&(r=r.nextSibling))}for(;r;){const t=Qt(r,this.sessionId);if(t)if(!1!==n&&t.lineBreak||!1!==s&&t.excluded&&!t.lineBreak)o.push(t);else if(t.pageFlow&&!t.excluded){if(!1===i)break;if(o.push(t),!1!==e||!t.floating&&(t.visible||t.rendered)&&"none"!==t.display)break}r=r.nextSibling}return o}modifyBox(t,e,i=!0){if(0!==e){const n=Nt.get(t);if(n&&(void 0===e?(void 0===this._boxReset&&(this._boxReset=Yt()),this._boxReset[n]=1):(void 0===this._boxAdjustment&&(this._boxAdjustment=Yt()),i?this._boxAdjustment[n]+=e:this[n]+this._boxAdjustment[n]+e<=0?(void 0===this._boxReset&&(this._boxReset=Yt()),this._boxReset[n]=1,this._boxAdjustment[n]=0):this._boxAdjustment[n]+=e),this._boxRegister)){const n=this._boxRegister[t];if(n)for(const s of n)s.modifyBox(t,e,i)}}}getBox(t){const e=Nt.get(t);return e?[this._boxReset?this._boxReset[e]:0,this._boxAdjustment?this._boxAdjustment[e]:0]:[0,0]}resetBox(t,e){void 0===this._boxReset&&(this._boxReset=Yt());const i=this._boxReset,n=(t,n)=>{for(let s=0;s<4;s++)if(0===i[t[s]]&&(i[t[s]]=1,e)){const t=re[s+n],i=Nt.get(t),o=this[i];0!==o&&(e.naturalChild||0!==e[i]?e.modifyBox(t,o):e.css(i,Vt(o),!0),this.registerBox(t,e))}};ie(t,30)&&n(zt,0),ie(t,480)&&n(Xt,4)}transferBox(t,e){void 0===this._boxAdjustment&&(this._boxAdjustment=Yt());const i=this._boxAdjustment;if(i){const n=(t,n)=>{for(let s=0;s<4;s++){const o=i[t[s]];if(o>0){const r=re[s+n];e.modifyBox(r,o,!1),this.registerBox(r,e),i[t[s]]=0}}};ie(t,30)&&n(zt,0),ie(t,480)&&n(Xt,4)}}registerBox(t,e){void 0===this._boxRegister&&(this._boxRegister={});const i=this._boxRegister;return void 0===i[t]&&(i[t]=new Set),e&&i[t].add(e),i[t]}actualRect(t,e="linear",i=!1){var n;const s=this[e][t];if(this.inputElement||i){const i=this.companion;if(!1===(null===(n=i)||void 0===n?void 0:n.visible)){const n=i[e][t];switch(t){case"top":case"left":if(n<s)return n;break;case"right":case"bottom":if(n>s)return n}}}return s}actualPadding(t,e){let i=this;for(;!i.naturalChild;){const n=i.innerWrapped;if(!n)return e;if(i=n,i.naturalChild&&1!==i.getBox("paddingTop"===t?32:128)[0])return e}let n=!1;if(le(i)){n=function i(n){let s=!1;for(const o of n){if(o.blockStatic)return!1;if(o.inlineStatic){if(o.has("lineHeight")&&o.lineHeight>o.bounds.height)return!1;if(o[t]>=e)s=!0;else if(le(o)){if(!i(o.naturalElements))return!1;s=!0}}}return s}(i.naturalElements)}return n?0:e}cloneBase(t){t.localSettings=this.localSettings,t.alignmentType=this.alignmentType,t.containerName=this.containerName,t.depth=this.depth,t.visible=this.visible,t.excluded=this.excluded,t.rendered=this.rendered,t.childIndex=this.childIndex,t.containerIndex=this.containerIndex,t.inlineText=this.inlineText,t.lineBreakLeading=this.lineBreakLeading,t.lineBreakTrailing=this.lineBreakTrailing,t.actualParent=this.actualParent,t.documentParent=this.documentParent,t.documentRoot=this.documentRoot,t.renderParent=this.renderParent,this.length&&t.retain(this.duplicate()),t.inherit(this,"initial","base","alignment","styleMap","textStyle"),Object.assign(t.unsafe("cached"),this._cached)}css(t,e,i=!1){return arguments.length>=2&&(e?this._styleMap[t]=e:delete this._styleMap[t],i&&this.unsetCache(t)),this._styleMap[t]||this.styleElement&&this.style[t]||""}cssApply(t,e=!1){if(Object.assign(this._styleMap,t),e)for(const e in t)this.unsetCache(e);return this}cssSet(t,e,i=!0){return super.css(t,e,i)}setCacheValue(t,e){this._cached[t]=e}get element(){let t=this._element;if(null===t){let e=this.innerWrapped;for(;e&&(t=e.unsafe("element"),!t);)e=e.innerWrapped}return t}get naturalChild(){var t;return!!(null===(t=this._element)||void 0===t?void 0:t.parentElement)}get pseudoElement(){var t;return"__squared.pseudo"===(null===(t=this._element)||void 0===t?void 0:t.className)}set documentParent(t){this._documentParent=t}get documentParent(){return this._documentParent||this.absoluteParent||this.actualParent||this.parent||this}set containerName(t){this._cached.containerName=t.toUpperCase()}get containerName(){let t=this._cached.containerName;if(void 0===t){t="";const e=this.element;e&&(t=Gt(e)?"PLAINTEXT":"INPUT"===e.tagName?"INPUT_"+e.type.toUpperCase():e.tagName.toUpperCase()),this._cached.containerName=t}return t}get excludeSection(){return this._excludeSection}get excludeProcedure(){return this._excludeProcedure}get excludeResource(){return this._excludeResource}get layoutHorizontal(){return this.hasAlign(8)}get layoutVertical(){return this.hasAlign(16)}get nodeGroup(){return!1}set renderAs(t){var e;this.rendered||!1!==(null===(e=t)||void 0===e?void 0:e.rendered)||(this._renderAs=t)}get renderAs(){return this._renderAs}get blockStatic(){return super.blockStatic||this.hasAlign(64)&&!this.floating}get rightAligned(){return super.rightAligned||this.hasAlign(2048)}set positionAuto(t){this._cached.positionAuto=t}get positionAuto(){return super.positionAuto}set flexbox(t){this._cached.flexbox=t}get flexbox(){return super.flexbox}set contentBoxWidth(t){this._cached.contentBoxWidth=t}get contentBoxWidth(){return super.contentBoxWidth}set contentBoxHeight(t){this._cached.contentBoxHeight=t}get contentBoxHeight(){return super.contentBoxHeight}set textContent(t){this._cached.textContent=t}get textContent(){let t=this._cached.textContent;return void 0===t&&(t=this.naturalChild&&this._element?this._element.textContent:"",this._cached.textContent=t),t}set overflow(t){0!==t&&16!==t&&8!==t&&24!==t||(ie(this.overflow,64)&&(t|=64),this._cached.overflow=t)}get overflow(){return super.overflow}set baseline(t){this._cached.baseline=t}get baseline(){return super.baseline}set multiline(t){this._cached.multiline=t}get multiline(){return super.multiline}set visible(t){this._visible=t}get visible(){return this._visible}set controlName(t){this.rendered&&void 0!==this._controlName||(this._controlName=t)}get controlName(){return this._controlName||""}set siblingsLeading(t){this._siblingsLeading=t}get siblingsLeading(){return void 0===this._siblingsLeading&&(this._siblingsLeading=this.previousSiblings()),this._siblingsLeading}set siblingsTrailing(t){this._siblingsTrailing=t}get siblingsTrailing(){return void 0===this._siblingsTrailing&&(this._siblingsTrailing=this.nextSiblings()),this._siblingsTrailing}get previousSibling(){const t=this.actualParent;if(t){const e=t.naturalChildren,i=e.indexOf(this);if(-1!==i)for(let t=i-1;t>=0;t--){const i=e[t];if(i&&(!i.excluded||i.lineBreak))return i}}return null}get nextSibling(){const t=this.actualParent;if(t){const e=t.naturalChildren,i=e.indexOf(this);if(-1!==i){const t=e.length;for(let n=i+1;n<t;n++){const t=e[n];if(t&&(!t.excluded||t.lineBreak))return t}}}return null}get firstChild(){return this.naturalChildren[0]||null}get lastChild(){const t=this.naturalChildren;return t[t.length-1]||null}get onlyChild(){const t=this.renderParent;if(t)return 1===t.length;{const t=this.parent;if(t&&0!==t.id)return 1===t.length}return!1}get textEmpty(){let t=this._cached.textEmpty;return void 0===t&&(t=this.styleElement&&(""===this.textContent||!this.preserveWhiteSpace&&!this.pseudoElement&&""===this.textContent.trim())&&!this.imageElement&&!this.svgElement&&"HR"!==this.tagName,this._cached.textEmpty=t),t}get preserveWhiteSpace(){let t=this._cached.whiteSpace;if(void 0===t){const e=this.css("whiteSpace");t="pre"===e||"pre-wrap"===e,this._cached.whiteSpace=t}return t}get outerExtensionElement(){if(this.naturalChild){let t=this._element.parentElement;for(;t;){if(t.dataset.use)return t;t=t.parentElement}}return null}set fontSize(t){this._fontSize=t}get fontSize(){return super.fontSize}}const{aboveRange:he,hasBit:de}=squared.lib.util;class ue extends squared.lib.base.Container{constructor(t,e,i=0,n=0,s){var o;super(s),this.parent=t,this.node=e,this.containerType=i,this.alignmentType=n,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,(null===(o=s)||void 0===o?void 0:o.length)&&this.init()}init(){var t;const e=this.children,i=e.length;if(i>0){if(i>1){const t=ce.linearData(e);this._floated=t.floated,this._cleared=t.cleared,this._linearX=t.linearX,this._linearY=t.linearY}else this._linearY=e[0].blockStatic,this._linearX=!this._linearY;let n=0,s=0;for(let t=0;t<i;t++){const i=e[t];if(i.floating?n++:n=1/0,i.rightAligned?s++:s=1/0,n===1/0&&s===1/0)break}n!==i&&2!==(null===(t=this._floated)||void 0===t?void 0:t.size)||(this.add(512),this.some(t=>t.blockStatic)&&this.add(64)),s===i&&this.add(2048),this.itemCount=i}}setType(t){this.setContainerType(t.containerType,t.alignmentType)}setContainerType(t,e){this.containerType=t,e&&this.add(e)}hasAlign(t){return de(this.alignmentType,t)}add(t){return de(this.alignmentType,t)||(this.alignmentType|=t),this.alignmentType}delete(t){return de(this.alignmentType,t)&&(this.alignmentType^=t),this.alignmentType}retain(t){return super.retain(t),this.init(),this}get linearX(){return void 0===this._linearX||this._linearX}get linearY(){return void 0!==this._linearY&&this._linearY}get floated(){return this._floated||new Set}get cleared(){return this._cleared||new Map}get singleRowAligned(){if(void 0===this._singleRow){const t=this.length;if(!(t>0))return!1;if(this._singleRow=!0,t>1){let t=1/0;for(const e of this.children){if(e.multiline||e.blockStatic){this._singleRow=!1;break}if(he(e.linear.top,t)){this._singleRow=!1;break}t=e.linear.bottom}}}return this._singleRow}get unknownAligned(){return this.length>1&&!this.linearX&&!this.linearY}get visible(){return this.filter(t=>t.visible)}}const fe=squared.lib,{BOX_POSITION:ge,convertListStyle:pe,formatPX:me,getStyle:be,insertStyleSheetRule:xe,isLength:ve,resolveURL:ye}=fe.css,{getNamedItem:Se,getRangeClientRect:_e,isTextNode:Ee,removeElementsByClassName:we}=fe.dom,{aboveRange:Te,captureMap:ke,convertFloat:Ae,convertInt:Ce,convertWord:Re,filterArray:Ie,fromLastIndexOf:Be,hasBit:Pe,isString:Ne,partitionArray:Le,spliceArray:Me,trimString:We}=fe.util,{XML:Fe}=fe.regex,{getElementCache:Oe,setElementCache:De}=fe.session,{isPlainText:He}=fe.xml;let ze;function Xe(t,e){if(t.dataset.use){const i=t.dataset.use.split(Fe.SEPARATOR),n=[],s=[];for(const t of e){const e=i.indexOf(t.name);-1!==e?n[e]=t:s.push(t)}if(n.length)return Me(n,t=>void 0===t).concat(s)}return e}const Ue=squared.lib,{isUserAgent:Ve}=Ue.client,{BOX_BORDER:qe,BOX_PADDING:je,formatPX:Ge,getStyle:Ye,isLength:$e,isPercent:Qe}=Ue.css,{isTextNode:Ke}=Ue.dom,{capitalize:Ze,convertFloat:Je,flatArray:ti}=Ue.util,{actualClientRect:ei,getElementCache:ii,setElementCache:ni}=Ue.session,{pushIndent:si,pushIndentArray:oi}=Ue.xml,ri=t=>!(t.left<0&&Math.abs(t.left)>=t.width||t.top<0&&Math.abs(t.top)>=t.height);const ai=squared.lib,{hasComputedStyle:li}=ai.css,{includes:ci}=ai.util;class hi extends D{constructor(t,e,i,n=[]){super(t,e,i),this.eventOnly=!1,this.documentBase=!1,this.cascadeAll=!1,this.removeIs=!1,this.tagNames=n}static findNestedElement(t,e){if(t&&li(t)){const i=t.children,n=i.length;for(let t=0;t<n;t++){const n=i[t];if(ci(n.dataset.use,e))return n}}return null}condition(t,e){return!!t.styleElement&&(t.dataset.use?this.included(t.element):this.tagNames.length>0)}is(t){return!!t.styleElement&&(0===this.tagNames.length||this.tagNames.includes(t.toElementString("tagName")))}included(t){return ci(t.dataset.use,this.name)}init(t){return!1}processNode(t,e){}processChild(t,e){}addDescendant(t){const e=this.application.session.extensionMap,i=t.id,n=e.get(i)||[];n.includes(this)||n.push(this),e.set(i,n)}postBaseLayout(t){}postConstraints(t){}postOptimize(t){}afterBaseLayout(){}afterConstraints(){}afterResources(){}beforeBaseLayout(){}beforeCascade(){}afterFinalize(){}set application(t){this._application=t,this.controller=t.controllerHandler,this.resource=t.resourceHandler}get application(){return this._application}}const di=squared.lib,{isUserAgent:ui}=di.client,{parseColor:fi}=di.color,{BOX_BORDER:gi,calculate:pi,convertAngle:mi,formatPX:bi,getBackgroundPosition:xi,getInheritedStyle:vi,isCalc:yi,isLength:Si,isParentStyle:_i,isPercent:Ei,parseAngle:wi}=di.css,{isEqual:Ti,offsetAngleX:ki,offsetAngleY:Ai,relativeAngle:Ci,triangulate:Ri,truncateFraction:Ii}=di.math,{CHAR:Bi,ESCAPE:Pi,STRING:Ni,XML:Li}=di.regex,{getElementAsNode:Mi}=di.session,{convertCamelCase:Wi,convertFloat:Fi,hasValue:Oi,isEqual:Di,isNumber:Hi,isString:zi,trimEnd:Xi,trimStart:Ui}=di.util,Vi="&#160;",qi=`(rgba?\\(\\d+, \\d+, \\d+(?:, [\\d.]+)?\\)|#[A-Za-z\\d]{3,8}|[a-z]+)\\s*(${Ni.LENGTH_PERCENTAGE}|${Ni.CSS_ANGLE}|(?:${Ni.CSS_CALC}(?=,)|${Ni.CSS_CALC}))?,?\\s*`,ji=RegExp(`(?:initial|url\\([^)]+\\)|(repeating)?-?(linear|radial|conic)-gradient\\(((?:to [a-z ]+|(?:from )?-?[\\d.]+(?:deg|rad|turn|grad)|(?:circle|ellipse)?\\s*(?:closest-side|closest-corner|farthest-side|farthest-corner)?)?(?:\\s*(?:(?:-?[\\d.]+(?:[a-z%]+)?\\s*)+)?(?:at [\\w %]+)?)?),?\\s*((?:${qi})+)\\))`,"g");let Gi;function Yi(t,e,i){Gi?Gi.lastIndex=0:Gi=RegExp(qi,"g");const n=e,s=!0===n.repeating;let o,r=1;s&&"radial"===e.type?(r=n.radiusExtent/n.radius,o=n.radius):o=n.horizontal?e.dimension.width:e.dimension.height;const a=[];let l,c=0;for(;null!==(l=Gi.exec(i));){const i=fi(l[1],1,!0);if(i){let h=-1;"conic"===e.type?l[3]&&l[4]&&(h=mi(l[3],l[4])/360):l[2]&&(Ei(l[2])?h=parseFloat(l[2])/100:Si(l[2])?h=t.parseUnit(l[2],n.horizontal?"width":"height",!1)/o:yi(l[2])&&(h=pi(l[6],o,t.fontSize)/o),s&&-1!==h&&(h*=r)),0===a.length&&(-1===h?h=0:h>0&&a.push({color:i,offset:0})),-1!==h&&(h=Math.max(c,h),c=h),a.push({color:i,offset:h})}}const h=a.length,d=a[h-1];-1===d.offset&&(d.offset=1);let u=0;for(let t=0;t<h;t++){const e=a[t];if(-1===e.offset)if(0===t)e.offset=0;else{for(let i=t+1,n=2;i<h-1;i++,n++)if(-1!==a[i].offset){e.offset=(u+a[i].offset)/n;break}-1===e.offset&&(e.offset=u+d.offset/(h-1))}u=e.offset}if(s){if(u<100)t:{const t=a.slice(0);let e=u;for(;u<100;){for(let i=0;i<h;i++)if(u=Math.min(e+t[i].offset,1),a.push(Object.assign(Object.assign({},t[i]),{offset:u})),1===u)break t;e=u}}}else u<1&&a.push(Object.assign(Object.assign({},a[h-1]),{offset:1}));return a}function $i(t,e=0){if(t){let e=wi(t.trim());return e<0&&(e+=360),e}return e}function Qi(t,e,i){var n;switch(i=i.replace(/\u00A0/g,Vi),e.css("whiteSpace")){case"nowrap":i=i.replace(/\n/g," ");break;case"pre":case"pre-wrap":!1===(null===(n=t)||void 0===n?void 0:n.layoutVertical)&&(i=i.replace(/^\s*?\n/,"")),i=i.replace(/\n/g,"\\n").replace(/ /g,Vi);break;case"pre-line":i=i.replace(/\n/g,"\\n").replace(/[ ]+/g," ");break;default:const{previousSibling:s,nextSibling:o}=e;return(s&&(s.lineBreak||s.blockStatic)||e.onlyChild&&e.htmlElement)&&(i=i.replace(Bi.LEADINGSPACE,"")),(o&&(o.lineBreak||o.blockStatic)||e.onlyChild&&e.htmlElement)&&(i=i.replace(Bi.TRAILINGSPACE,"")),[i,!1]}return[i,!0]}function Ki(t,e,i){if(i){const n=i.split(Li.SEPARATOR);return Ji.getBackgroundSize(t,n[e%n.length])}}function Zi(t){return t?-1!==t.indexOf("at ")?/(.+?)?\s*at (.+?)\s*$/.exec(t):[t,t]:null}class Ji extends a{static generateId(t,e,i=1){const n=e;let s=i;1===i&&(e+="_"+s);const o=this.ASSETS.ids.get(t)||[];for(;;){if(!o.includes(e)){o.push(e);break}e=n+"_"+ ++s}return this.ASSETS.ids.set(t,o),e}static insertStoredAsset(t,e,i){const n=Ji.STORED[t];if(n&&Oi(i)){let s=this.getStoredName(t,i);if(""===s){Hi(e)&&(e="__"+e);let t=0;do{s=e,t>0&&(s+="_"+t),n.has(s)||n.set(s,i),t++}while(n.has(s)&&n.get(s)!==i)}return s}return""}static getOptionArray(t,e=!1){const i=[];let n=!0;const s=t.children,o=s.length;for(let t=0;t<o;t++){const o=s[t];if(!e&&o.disabled)continue;const r=o.text.trim()||o.value.trim();""!==r&&(n&&!Hi(r)&&(n=!1),i.push(r))}return n?[void 0,i]:[i]}static isBackgroundVisible(t){return!(!t||!(t.backgroundImage||t.borderTop||t.borderRight||t.borderBottom||t.borderLeft))}static parseBackgroundImage(t){const e=t.backgroundImage;if(""!==e){ji.lastIndex=0;const i=[];let n,s=0;for(;null!==(n=ji.exec(e));){if("initial"===n[0]||n[0].startsWith("url"))i.push(n[0]);else{const e="repeating"===n[1],o=n[2],r=n[3],a=Ki(t,s,t.css("backgroundSize")),l=a||t.actualDimension;let c;switch(o){case"conic":{const e=Zi(r),i={type:o,dimension:l,angle:$i(r)};i.center=xi(e&&e[2]||"center",l,t.fontSize,a),i.colorStops=Yi(t,i,n[4]),c=i;break}case"radial":{const{width:i,height:s}=l,h=Zi(r),d={type:o,repeating:e,horizontal:t.actualWidth<=t.actualHeight,dimension:l},u=xi(h&&h[2]||"center",l,t.fontSize,a),{left:f,top:g}=u;d.center=u,d.closestCorner=1/0,d.farthestCorner=-1/0;let p="ellipse";if(h){const e=h[1]&&h[1].trim();if(e)if(e.startsWith("circle"))p="circle";else{const i=e.split(" ");let n=1/0;const s=i.length;for(let e=0;e<s;e++){const s=t.parseUnit(i[e],0===e?"width":"height",!1);s<n&&(n=s)}d.radius=n,d.radiusExtent=n,1!==s&&i[0]!==i[1]||(p="circle")}}d.shape=p;for(const t of[[0,0],[i,0],[i,s],[0,s]]){const e=Math.round(Math.sqrt(Math.pow(Math.abs(t[0]-f),2)+Math.pow(Math.abs(t[1]-g),2)));e<d.closestCorner&&(d.closestCorner=e),e>d.farthestCorner&&(d.farthestCorner=e)}d.closestSide=g,d.farthestSide=g;for(const t of[i-f,s-g,f])t<d.closestSide&&(d.closestSide=t),t>d.farthestSide&&(d.farthestSide=t);if(!d.radius&&!d.radiusExtent){d.radius=d.farthestCorner;const t=h&&h[1]?h[1].split(" ").pop():"";switch(t){case"closest-corner":case"closest-side":case"farthest-side":const i=d[Wi(t)];e?d.radiusExtent=i:d.radius=i;break;default:d.radiusExtent=d.farthestCorner}}d.colorStops=Yi(t,d,n[4]),c=d;break}case"linear":{const{width:i,height:s}=l;let a=180;switch(r){case"to top":a=360;break;case"to right top":a=45;break;case"to right":a=90;break;case"to right bottom":a=135;break;case"to bottom":break;case"to left bottom":a=225;break;case"to left":a=270;break;case"to left top":a=315;break;default:r&&(a=$i(r,180)||360)}const h={type:o,repeating:e,horizontal:a>=45&&a<=135||a>=225&&a<=315,dimension:l,angle:a};h.colorStops=Yi(t,h,n[4]);let d=Ii(ki(a,i)),u=Ii(Ai(a,s));if(d!==i&&u!==s&&!Ti(Math.abs(d),Math.abs(u))){let t;t=a<=90?Ci({x:0,y:s},{x:i,y:0}):a<=180?Ci({x:0,y:0},{x:i,y:s}):a<=270?Ci({x:0,y:0},{x:-i,y:s}):Ci({x:0,y:s},{x:-i,y:0});const e=Math.abs(t-a);d=Ii(ki(a,Ri(e,90-e,Math.sqrt(Math.pow(i,2)+Math.pow(s,2)))[1])),u=Ii(Ai(a,Ri(90,90-a,d)[0]))}h.angleExtent={x:d,y:u},c=h;break}}i.push(c||"initial")}s++}if(i.length)return i}}static getBackgroundSize(t,e){let i=0,n=0;switch(e){case"":case"cover":case"contain":case"100% 100%":case"auto":case"auto auto":case"initial":return;default:const s=e.split(" "),o=s.length;1===o&&(s[1]=s[0]);for(let e=0;e<o;e++){let o=s[e];"auto"===o&&(o="100%"),0===e?i=t.parseUnit(o,"width",!1):n=t.parseUnit(o,"height",!1)}}return i>0&&n>0?{width:Math.round(i),height:Math.round(n)}:void 0}static isInheritedStyle(t,e){if(t.styleElement){const i=t.actualParent;if(i&&""===t.cssInitial(e))return t.style[e]===i.style[e]}return!1}static hasLineBreak(t,e=!1,i=!1){if(t.naturalElements.length)return t.naturalElements.some(t=>t.lineBreak);if(!e&&t.naturalChild){const e=t.element;let n=e.textContent;if(i&&(n=n.trim()),/\n/.test(n))return!(!t.plainText||!_i(e,"whiteSpace","pre","pre-wrap"))||t.css("whiteSpace").startsWith("pre")}return!1}static getStoredName(t,e){if(Ji.STORED[t])for(const[i,n]of Ji.STORED[t].entries())if(Di(e,n))return i;return""}finalize(t){}reset(){super.reset();for(const t in Ji.STORED)Ji.STORED[t].clear()}writeRawImage(t,e){this.fileHandler&&this.fileHandler.addAsset({pathname:this.controllerSettings.directory.image,filename:t,base64:e})}setBoxStyle(t){var e;if(t.styleElement||t.visibleStyle.background){const s={backgroundSize:t.css("backgroundSize"),backgroundRepeat:t.css("backgroundRepeat"),backgroundPositionX:t.css("backgroundPositionX"),backgroundPositionY:t.css("backgroundPositionY")};function i(e,i){const n=t.css(i[0])||"none";let o=bi("outline"!==e?t[i[1]]:Fi(t.style[i[1]])),r=t.css(i[2])||"initial";switch(r){case"initial":r="rgb(0, 0, 0)";break;case"inherit":case"currentcolor":r=vi(t.element,i[2])}if("0px"!==o&&"none"!==n){"2px"!==o||"inset"!==n&&"outset"!==n||(o="1px");const t=fi(r,1,!0);t&&(s[e]={width:o,style:n,color:t})}}function n(e){switch(t.css(e)){case"border-box":return!0;case"padding-box":s[e]={top:t.borderTopWidth,right:t.borderRightWidth,bottom:t.borderBottomWidth,left:t.borderLeftWidth};break;case"content-box":s[e]={top:t.borderTopWidth+t.paddingTop,right:t.borderRightWidth+t.paddingRight,bottom:t.borderBottomWidth+t.paddingBottom,left:t.borderLeftWidth+t.paddingLeft}}return!1}if(n("backgroundClip")&&t.has("backgroundOrigin")&&n("backgroundOrigin"),"0px"!==t.css("borderRadius")){const[e,i]=t.css("borderTopLeftRadius").split(" "),[n,o]=t.css("borderTopRightRadius").split(" "),[r,a]=t.css("borderBottomRightRadius").split(" "),[l,c]=t.css("borderBottomLeftRadius").split(" "),h=i||o||a||c?[e,i||e,n,o||n,r,a||r,l,c||l]:[e,n,r,l],d=t.actualWidth>=t.actualHeight;h.every(t=>t===h[0])&&(h.length="0px"===h[0]||""===h[0]?0:1);const u=h.length;if(u>0){const e=d?"width":"height";for(let i=0;i<u;i++)h[i]=t.convertPX(h[i],e,!1);s.borderRadius=h}}t.visibleStyle.borderWidth&&(t.borderTopWidth>0&&i("borderTop",gi[0]),t.borderRightWidth>0&&i("borderRight",gi[1]),t.borderBottomWidth>0&&i("borderBottom",gi[2]),t.borderLeftWidth>0&&i("borderLeft",gi[3])),i("outline",gi[4]),t.hasResource(Wt.IMAGE_SOURCE)&&(s.backgroundImage=Ji.parseBackgroundImage(t));let o=t.backgroundColor;""!==o||t.documentParent.visible||(o=t.css("backgroundColor")),""!==o&&(s.backgroundColor=(null===(e=fi(o))||void 0===e?void 0:e.valueAsRGBA)||""),t.data(Ji.KEY_NAME,"boxStyle",s)}}setFontStyle(t){if(((t.textElement||t.inlineText)&&(!t.textEmpty||t.visibleStyle.background)||t.inputElement)&&t.visible){const e=fi(t.css("color"));let i=t.css("fontWeight");if(!Hi(i))switch(i){case"lighter":i="200";break;case"bold":i="700";break;case"bolder":i="900";break;default:i="400"}t.data(Ji.KEY_NAME,"fontStyle",{fontFamily:t.css("fontFamily").trim(),fontStyle:t.css("fontStyle"),fontSize:bi(t.fontSize),fontWeight:i,color:e?e.valueAsRGBA:""})}}setValueString(t){var e,i;if(t.visible&&!t.svgElement){const n=t.renderParent,s=t.element;if(s){let o="",r="",a="",l=!1,c=!1;switch(s.tagName){case"INPUT":switch(r=s.value,s.type){case"radio":case"checkbox":const i=t.companion;!1===(null===(e=i)||void 0===e?void 0:e.visible)&&(r=i.textContent.trim());break;case"submit":""!==r||t.visibleStyle.backgroundImage||(r="Submit");break;case"time":""===r&&(a="--:-- --");break;case"date":case"datetime-local":if(""===r){switch((new Intl.DateTimeFormat).resolvedOptions().locale){case"en-US":a="mm/dd/yyyy";break;default:a="dd/mm/yyyy"}"datetime-local"===s.type&&(a+=" --:-- --")}break;case"week":""===r&&(a="Week: --, ----");break;case"month":""===r&&(a="--------- ----");break;case"url":case"email":case"search":case"number":case"tel":""===r&&(a=s.placeholder);break;case"file":r=ui(8)?"Browse...":"Choose File"}break;case"TEXTAREA":r=s.value;break;case"IFRAME":r=s.src;break;default:const i=t.textContent;t.plainText||t.pseudoElement?(o=i.trim(),[r]=Qi(n,t,i.replace(/&/g,"&amp;")),c=!0,l=!t.actualParent.preserveWhiteSpace):t.inlineText?(o=i.trim(),[r,c]=Qi(n,t,this.removeExcludedFromText(s,t.sessionId)),l=!0):0===t.naturalElements.length&&i&&""===i.trim()&&!t.hasPX("height")&&Ji.isBackgroundVisible(t.data(Ji.KEY_NAME,"boxStyle"))&&(r=i)}if(""!==r){if(l){const e=t.siblingsLeading[0];let n=!1;if(r.length>1)if(void 0===e||e.multiline||e.lineBreak||e.plainText&&Bi.TRAILINGSPACE.test(e.textContent))r=r.replace(Bi.LEADINGSPACE,"");else if(e.naturalElement){const t=e.textContent;t.length&&(n=32===t.charCodeAt(t.length-1))}if(c){const s=!t.lineBreakTrailing&&Bi.TRAILINGSPACE.test(r);if(r=!e||!Bi.LEADINGSPACE.test(r)||e.block||e.lineBreak||n?r.trim():Vi+r.trim(),s){!1===(null===(i=t.siblingsTrailing.find(t=>!t.excluded||t.lineBreak))||void 0===i?void 0:i.blockStatic)&&(r+=Vi)}}else if(""!==r.trim())r=r.replace(Bi.LEADINGSPACE,e&&(e.block||e.lineBreak||n&&e.htmlElement&&e.textContent.length>1||t.multiline&&Ji.hasLineBreak(t))?"":Vi),r=r.replace(Bi.TRAILINGSPACE,"table-cell"===t.display||t.lineBreakTrailing||t.blockStatic?"":Vi);else if(!t.inlineText)return}""!==r&&t.data(Ji.KEY_NAME,"valueString",{key:o,value:r})}""!==a&&t.data(Ji.KEY_NAME,"hintString",a)}else if(t.inlineText){const e=t.textContent;e&&t.data(Ji.KEY_NAME,"valueString",{key:e,value:e})}}}removeExcludedFromText(t,e){const i=t.children.length||"CODE"===t.tagName?"innerHTML":"textContent";let n=t[i]||"";const s=t.childNodes,o=s.length;for(let t=0;t<o;t++){const r=s[t],a=Mi(r,e);if(void 0===a||!a.textElement||!a.pageFlow||a.positioned||a.pseudoElement||a.excluded||a.dataset.target){if(a){if(a.htmlElement&&"innerHTML"===i){n=a.lineBreak?n.replace(RegExp(`\\s*${a.toElementString("outerHTML")}\\s*`),"\\n"):n.replace(a.toElementString("outerHTML"),a.pageFlow&&""!==a.textContent.trim()?Vi:"");continue}if(zi(a[i])){n=n.replace(a[i],"");continue}}else if(r instanceof HTMLElement){const t=getComputedStyle(r).getPropertyValue("position");n=n.replace(r.outerHTML,"absolute"!==t&&"fixed"!==t&&""!==r.textContent.trim()?Vi:"")}0===t?n=Ui(n," "):t===o-1&&(n=Xi(n," "))}}return"innerHTML"===i&&(n=n.replace(Pi.ENTITY,(t,e)=>String.fromCharCode(parseInt(e)))),n}}Ji.KEY_NAME="squared.resource",Ji.STORED={strings:new Map,arrays:new Map,fonts:new Map,colors:new Map,images:new Map};const tn=squared.lib,{isLength:en,isPercent:nn}=tn.css,{CHAR:sn}=tn.regex,{convertInt:on,isNumber:rn,trimString:an,withinRange:ln}=tn.util,cn=Lt.CSS_GRID,hn="[\\d.]+[a-z%]+|auto|max-content|min-content",dn="minmax\\(([^,]+), ([^)]+)\\)",un="fit-content\\(([\\d.]+[a-z%]+)\\)",fn="\\[([\\w\\-\\s]+)\\]",gn={};function pn(t,e){const i=t.repeat,n=[],s=[],o=e.length;for(let t=0;t<o;t++)i[t]?s.push(e[t]):n.push(e[t]);const r=t.length,a=r-n.length,l=s.length,c=Array(r);for(let t=0;t<r;t++)if(i[t]){for(let e=0,i=0;e<a;t++,e++,i++)i===l&&(i=0),c[t]=s[i];t--}else c[t]=n.shift();return c}function mn(t){let e=0;for(const i of t)i&&e++;return e}const bn=(t,e)=>en(e)?t.convertPX(e):e;class xn extends hi{static createDataAttribute(t,e,i,n){return{children:[],rowData:[],rowHeight:void 0,rowWeight:void 0,rowSpanMultiple:[],templateAreas:{},row:xn.createDataRowAttribute(),column:xn.createDataRowAttribute(),emptyRows:[],alignItems:t,alignContent:e,justifyItems:i,justifyContent:n}}static createDataRowAttribute(){return{length:0,gap:0,unit:[],unitMin:[],unitTotal:[],repeat:[],auto:[],autoFill:!1,autoFit:!1,name:{},normal:!0}}is(t){return t.gridElement}condition(t){return t.length>0}processNode(t){void 0===gn.UNIT&&(gn.UNIT=RegExp(`^(${hn})$`),gn.NAMED=RegExp(`\\s*(repeat\\((auto-fit|auto-fill|\\d+), (.+)\\)|${fn}|${dn}|${un}|${hn})\\s*`,"g"),gn.REPEAT=RegExp(`\\s*(${fn}|${dn}|${un}|${hn})\\s*`,"g"),gn.STARTEND=/^([\w\-]+)-(start|end)$/);const e=xn.createDataAttribute(t.css("alignItems"),t.css("alignContent"),t.css("justifyItems"),t.css("justifyContent")),i=t.css("gridAutoFlow"),n=-1===i.indexOf("column"),s=-1!==i.indexOf("dense"),o=[],r=[],a=[];let l={};if(e.row.gap=t.parseUnit(t.css("rowGap"),"height",!1),e.column.gap=t.parseUnit(t.css("columnGap"),"width",!1),[t.cssInitial("gridTemplateRows",!0),t.cssInitial("gridTemplateColumns",!0),t.css("gridAutoRows"),t.css("gridAutoColumns")].forEach((i,n)=>{if(""!==i&&"none"!==i&&"auto"!==i){gn.NAMED.lastIndex=0;const s=0===n?e.row:e.column,{name:o,repeat:r,unit:a,unitMin:l}=s;let c,h=1;for(;null!==(c=gn.NAMED.exec(i));){const i=c[1];if(n<2)if(i.startsWith("repeat")){let e=1;switch(c[2]){case"auto-fit":s.autoFit=!0;break;case"auto-fill":s.autoFill=!0;break;default:e=on(c[2])}if(e>0){void 0===gn.CELL_UNIT?(gn.CELL_UNIT=/[\d.]+[a-z%]+|auto|max-content|min-content/,gn.CELL_MINMAX=/minmax\(([^,]+), ([^)]+)\)/,gn.CELL_FIT_CONTENT=/fit-content\(([\d.]+[a-z%]+)\)/,gn.CELL_NAMED=/\[([\w\-\s]+)\]/):gn.REPEAT.lastIndex=0;const i=[];let n;for(;null!==(n=gn.REPEAT.exec(c[3]));){const e=n[1];let s;if(null!==(s=gn.CELL_NAMED.exec(e))){const t=s[1];void 0===o[t]&&(o[t]=[]),i.push({name:t})}else null!==(s=gn.CELL_MINMAX.exec(e))?i.push({unit:bn(t,s[2]),unitMin:bn(t,s[1])}):null!==(s=gn.CELL_FIT_CONTENT.exec(e))?i.push({unit:bn(t,s[1]),unitMin:"0px"}):null!==(s=gn.CELL_UNIT.exec(e))&&i.push({unit:bn(t,s[0])})}if(i.length)for(let t=0;t<e;t++)for(const t of i)t.name?o[t.name].push(h):t.unit&&(a.push(t.unit),l.push(t.unitMin||""),r.push(!0),h++)}}else if("["===i.charAt(0)){const t=c[4];void 0===o[t]&&(o[t]=[]),o[t].push(h)}else i.startsWith("minmax")?(a.push(bn(t,c[6])),l.push(bn(t,c[5])),r.push(!1),h++):i.startsWith("fit-content")?(a.push(bn(t,c[7])),l.push("0px"),r.push(!1),h++):gn.UNIT.test(i)&&(a.push("auto"===i?"auto":bn(t,i)),l.push(""),r.push(!1),h++);else(2===n?e.row:e.column).auto.push(t.convertPX(i))}}}),t.sort(n?(t,e)=>{const{left:i,top:n}=t.linear,{left:s,top:o}=e.linear;return ln(n,o)?ln(i,s)?0:i<s?-1:1:n<o?-1:1}:(t,e)=>{const{left:i,top:n}=t.linear,{left:s,top:o}=e.linear;return ln(i,s)?ln(n,o)?0:n<o?-1:1:i<s?-1:1}),!t.has("gridTemplateAreas")&&t.every(t=>"auto"===t.css("gridRowStart")&&"auto"===t.css("gridColumnStart"))){let i,s,o,r,l;n?(i="top",s="bottom",o=2,r=1,l=3):(i="left",s="right",o=3,r=0,l=2);let c,h=0,d=0,u=0;t.each((t,f)=>{(void 0===c||t.linear[i]>=c.linear[s]||d>0&&d===u)&&(u=Math.max(d,u),h++,d=1);const g=t.css("gridRowEnd"),p=t.css("gridColumnEnd");let m=1,b=1;if(g.startsWith("span")?m=parseInt(g.split(" ")[1]):rn(g)&&(m=parseInt(g)-h),p.startsWith("span")?b=parseInt(p.split(" ")[1]):rn(p)&&(b=parseInt(p)-d),1===d&&u>0){let t=!1;do{const i=Array(u-1).fill(1);for(const t of a){const e=t.placement;if(e[o]>h)for(let t=e[r];t<e[l];t++)i[t-1]=0}for(let e=0,n=0,s=0;e<i.length;e++)if(i[e]){if(0===n&&(s=e),++n===b){d=s+1,t=!0;break}}else n=0;t||(e.emptyRows[h-1]=i,h++)}while(!t)}a[f]={placement:n?[h,d,h+m,d+b]:[d,h,d+b,h+m],rowSpan:m,columnSpan:b},d+=b,c=t})}else t.css("gridTemplateAreas").split(/"[\s\n]+"/).forEach((t,i)=>{if("none"!==t){const n=e.templateAreas;an(t.trim(),'"').split(sn.SPACE).forEach((t,e)=>{if("."!==t.charAt(0)){const s=n[t];s?(s.rowSpan=i-s.rowStart+1,s.columnSpan=e-s.columnStart+1):n[t]={rowStart:i,rowSpan:1,columnStart:e,columnSpan:1}}})}}),t.each((t,i)=>{const s=e.templateAreas,o=[t.css("gridRowStart"),t.css("gridColumnStart"),t.css("gridRowEnd"),t.css("gridColumnEnd")],r=[];let l=1,c=1;if(Object.keys(s).length)for(let t=0;t<4;t++){const e=o[t];let i=s[e];if(i)switch(t){case 0:r[0]=i.rowStart+1;break;case 1:r[1]=i.columnStart+1;break;case 2:r[2]=i.rowStart+i.rowSpan+1;break;case 3:r[3]=i.columnStart+i.columnSpan+1}else{const n=gn.STARTEND.exec(e);if(n&&(i=s[n[1]],i))if("start"===n[2])switch(t){case 0:case 2:r[t]=i.rowStart+1;break;case 1:case 3:r[t]=i.columnStart+1}else switch(t){case 0:case 2:r[t]=i.rowStart+i.rowSpan+1;break;case 1:case 3:r[t]=i.columnStart+i.columnSpan+1}}}if(!(r[0]&&r[1]&&r[2]&&r[3])){function h(t,e){if(rn(t))return r[e]=parseInt(t),!0;if(t.startsWith("span")){const i=parseInt(t.split(" ")[1]);return r[e-2]?r[e]=r[e-2]+i:e%2==0?l=i:c=i,!0}return!1}let t,i;for(let n=0;n<4;n++){const s=o[n];if("auto"!==s&&!r[n]&&!h(s,n)){const a=e[n%2==0?"row":"column"],h=s.split(" ");1===h.length?(h[1]=h[0],h[0]="1"):rn(h[0])&&(n%2==0?t?l=parseInt(h[0])-parseInt(t[0]):t=h:i?c=parseInt(h[0])-parseInt(i[0]):i=h);const d=a.name[h[1]];if(d){const t=parseInt(h[0]);t<=d.length&&(r[n]=d[t-1]+(h[1]===o[n-2]?1:0))}}r[n]||h(s,n)}}a[i]={outerCoord:n?t.linear.top:t.linear.left,placement:r,rowSpan:l,columnSpan:c}});{const i=n?e.column:e.row,s=n?t.box.top:t.box.left;let o=i.unit,r=Math.max(1,o.length),l=0;for(const t of a)if(t){const e=t.placement;e.length&&(r=Math.max(r,n?t.columnSpan:t.rowSpan,e[n?1:0]||0,(e[n?3:2]||0)-1)),ln(t.outerCoord,s)&&(l+=n?t.columnSpan:t.rowSpan)}i.length=Math.max(r,l),(i.autoFill||i.autoFit)&&(0===o.length&&(o.push("auto"),i.unitMin.push(""),i.repeat.push(!0)),o=pn(i,o),i.unit=o,i.unitMin=pn(i,i.unitMin));let c=1,h=0;for(const t of o)nn(t)?c-=parseFloat(t)/100:t.endsWith("fr")&&(h+=parseFloat(t));if(c<1&&h>0){const t=o.length;for(let e=0;e<t;e++){const t=o[e];t.endsWith("fr")&&(o[e]=c*(parseFloat(t)/h)+"fr")}}const d=e.row.unit.length+1,u=e.column.unit.length+1;for(const t of a){const e=t.placement;e[2]<0&&(d>1?e[2]+=d+1:e[2]=void 0),e[3]<0&&(u>1?e[3]+=u+1:e[3]=void 0)}}t.each((t,i)=>{const c=a[i],h=c.placement;let d,u,f,g,p,m,b;for(n?(d=c.rowSpan,u=c.columnSpan,f=e.column.length,g=0,p=1,m=2,b=3):(d=c.columnSpan,u=c.rowSpan,f=e.row.length,g=1,p=0,m=3,b=2);!h[0]||!h[1];){const t=h.slice(0);if(!t[g]){let e=o.length;for(let i=0,n=0,s=-1;i<e;i++)if(!l[i])if(void 0===r[i]||r[i]<f){if(0===n&&(s=i,e=Math.max(e,i+d)),++n===d){t[g]=s+1;break}}else n=0,s=-1,e=o.length}if(t[g]){if(!t[p]){t[m]||(t[m]=t[g]+d);const e=[],i=t[g]-1,n=t[m]-1;for(let t=i;t<n;t++){const i=o[t];if(void 0===i)e.push([[0,-1]]);else{if(!(mn(i)+u<=f))break;{const t=[];let n=0;for(let e=0,s=-1;e<f;e++)void 0===i[e]&&(-1===s&&(s=e),n++),(i[e]||e===f-1)&&(n>=u&&t.push([s,s+n]),s=-1,n=0);if(!t.length)break;e.push(t)}}}const s=e.length;if(s>0){const o=e[0];if(-1===o[0][1])t[p]=1;else if(s===n-i)if(s>1)t:for(const i of o)for(let n=i[0];n<i[1];n++)for(let i=1;i<s;i++){const s=e[i].length;for(let o=0;o<s;o++){const s=e[i][o];if(n>=s[0]&&(-1===s[1]||n+u<=s[1])){t[p]=n+1;break t}}}else t[p]=o[0][0]+1}}}else h[g]=o.length+1,h[p]||(h[p]=1);const e=t[g];e&&t[p]?(h[g]=e,h[p]=t[p]):e&&(l[e-1]=!0)}if(h[m]||(h[m]=h[g]+d),h[b]||(h[b]=h[p]+u),function(t,e){if(e.every(t=>t>0)){for(let i=e[n?0:1]-1;i<e[n?2:3]-1;i++){let s=o[i];void 0===s&&(s=[],o[i]=s);for(let o=e[n?1:0]-1;o<e[n?3:2]-1;o++)void 0===r[i]&&(r[i]=0),void 0===s[o]&&(s[o]=[],r[i]++),s[o].push(t)}return!0}return!1}(t,h)){const i=h[0]-1,n=h[2]-h[0];if(n>1)for(let t=i;t<i+n;t++)e.rowSpanMultiple[t]=!0;t.data(cn,"cellData",{rowStart:i,rowSpan:n,columnStart:h[1]-1,columnSpan:h[3]-h[1]}),s&&(l={})}});const c=o.length;if(c>0){if(n)e.rowData=o;else for(let t=0;t<c;t++){const i=o[t],n=i.length;for(let s=0;s<n;s++){let n=e.rowData[s];void 0===n&&(n=[],e.rowData[s]=n),n[t]=i[s]}}const i=(n?e.row:e.column).unitTotal,s=e.children;let r=0;for(const t of e.rowData){const e=t.length;r=Math.max(e,r);for(let o=0;o<e;o++){const e=t[o];if(void 0===i[o]&&(i[o]=0),e){let t=0;for(const i of e)s.includes(i)||(t=Math.max(t,n?i.bounds.height:i.bounds.width),s.push(i));i[o]+=t}}}if(s.length===t.length){const i=e.rowData,n=i.length,o=new Set,a=Array(n),l=Array(n),c=e.column.gap,h=e.row.gap;e.row.length=n,e.column.length=r,e.rowHeight=a,e.rowWeight=l;for(let t=0;t<n;t++){a[t]=0;const e=i[t];for(let i=0;i<r;i++){const s=e[i];if(s)for(const e of s)if(!o.has(e)){const s=e.data(cn,"cellData"),l=t+s.rowSpan-1;i+s.columnSpan-1<r-1&&e.modifyBox(4,c),l<n-1&&e.modifyBox(8,h),1===s.rowSpan&&(a[t]=Math.max(a[t],e.bounds.height)),o.add(e)}}}const d=t.actualHeight;for(let t=0;t<n;t++)l[t]=a[t]/d;t.retain(s),t.cssSort("zIndex"),t.cssTry("display","block")&&(t.each(t=>{const e=t.boundingClientRect,i=t.initial.bounds;i?(i.width=e.width,i.height=e.height):t.initial.bounds=e}),t.cssFinally("display")),t.data(cn,"mainData",e)}}}}const{withinRange:vn}=squared.lib.util;class yn extends hi{static createDataAttribute(t,e){const i=t.css("flexWrap"),n=t.css("flexDirection"),s=n.startsWith("row");return{directionRow:s,directionColumn:!s,directionReverse:n.endsWith("reverse"),wrap:i.startsWith("wrap"),wrapReverse:"wrap-reverse"===i,alignContent:t.css("alignContent"),justifyContent:t.css("justifyContent"),rowCount:0,columnCount:0,children:e}}is(t){return t.flexElement}condition(t){return t.length>0}processNode(t){const e=this.controller,[i,n]=t.partition(t=>t.pageFlow&&!t.renderExclude),s=yn.createDataAttribute(t,i);if(t.cssTry("align-items","start")){if(t.cssTry("justify-items","start")){for(const t of i)if(t.cssTry("align-self","start")){if(t.cssTry("justify-self","start")){const e=t.boundingClientRect,i=t.initial.bounds;i?(i.width=e.width,i.height=e.height):t.initial.bounds=e,t.cssFinally("justify-self")}t.cssFinally("align-self")}t.cssFinally("justify-items")}t.cssFinally("align-items")}if(s.wrap){let o,r,a,l;s.directionRow?(o="top",r="left",a="right",l="intersectY"):(o="left",r="top",a="bottom",l="intersectX"),i.sort((t,e)=>{const i=t.linear,n=e.linear;return t[l](e.bounds,"bounds")?vn(i[r],n[r])?0:i[r]<n[r]?-1:1:i[o]<n[o]?-1:1});let c=[i[0]],h=i[0];const d=[c];let u=i.length;for(let t=1;t<u;t++){const e=i[t];h[l](e.bounds,"bounds")?c.push(e):(h=e,c=[e],d.push(c))}t.clear();let f,g=0;if(u=d.length,u>1){const i=t.box[a];for(let n=0;n<u;n++){const s=d[n],o=e.createNodeGroup(s[0],s,t,!0);o.containerIndex=n;const r=o.unsafe("box");r&&(r[a]=i),o.addAlign(128),g=Math.max(s.length,g)}f=u}else{const e=d[0];t.retain(e);for(let t=0;t<e.length;t++)e[t].containerIndex=t;g=e.length,f=g}for(let t=0;t<n.length;t++)n[t].containerIndex=f+t;t.concat(n),t.sort(),s.directionRow?(s.rowCount=u,s.columnCount=g):(s.rowCount=g,s.columnCount=u)}else{if(i.some(t=>0!==t.flexbox.order)){const[t,e]=s.directionReverse?[-1,1]:[1,-1];i.sort((i,n)=>{const s=i.flexbox.order,o=n.flexbox.order;return s===o?0:s>o?t:e})}s.directionRow?(s.rowCount=1,s.columnCount=t.length):(s.rowCount=t.length,s.columnCount=1)}t.data(Lt.FLEXBOX,"mainData",s)}}const Sn=squared.lib,{formatPX:_n,isLength:En,isPercent:wn}=Sn.css,{aboveRange:Tn,belowRange:kn,withinRange:An}=Sn.util,Cn=Lt.GRID;function Rn(t,e){const i=e.linear.top;for(const e of t){const t=e.findIndex(t=>{const e=t.linear.top;return An(i,e)||i>e&&i<t.linear.bottom});if(-1!==t)return t}return-1}class In extends hi{static createDataCellAttribute(){return{rowSpan:0,columnSpan:0,index:-1,cellStart:!1,cellEnd:!1,rowEnd:!1,rowStart:!1,block:!1}}condition(t){if(t.length>1&&!t.layoutElement&&!t.has("listStyle")){if("table"===t.display)return t.every(t=>"table-row"===t.display&&t.every(t=>"table-cell"===t.display))||t.every(t=>"table-cell"===t.display);{let e=0,i=0;for(const n of t){if(!n.pageFlow||n.visibleStyle.background||!n.blockStatic||n.autoMargin.leftRight||n.autoMargin.left)return!1;n.length>1&&e++,"list-item"!==n.display||n.has("listStyleType")||i++}if(i===t.length)return!0;if(e>0)return t.every(t=>t.length>0&&ce.linearData(t.children).linearX)}}return!1}processNode(t){var e,i,n;const s=[],o=[],r={};for(const e of t)for(const t of e)if(t.visible){const e=Math.floor(t.linear.left);void 0===r[e]&&(r[e]=[]),r[e].push(t)}const a=Object.keys(r),l=a.length;if(l>0){let i=-1;for(let t=0;t<l;t++){const e=r[a[t]];if(0===t)i=l;else if(i!==e.length){i=-1;break}}if(-1!==i)for(let t=0;t<l;t++)o.push(r[a[t]]);else{const i=[];for(let t=0;t<l;t++){const e=r[a[t]],n=e.length;if(0===t&&0===n)return;i[t]=0===t?0:i[t-1];for(let s=0;s<n;s++){const r=e[s],{left:a,right:l}=r.linear;if(0===t||Tn(a,i[t-1]))if(void 0===o[t]&&(o[t]=[]),0===t||o[0].length===n)o[t][s]=r;else{const e=Rn(o,r);if(-1===e)return;o[t][e]=r}else{const t=o.length-1;if(o[t]){let e=1/0,i=-1/0;if(o[t].forEach(t=>{const{left:n,right:s}=t.linear;n<e&&(e=n),s>i&&(i=s)}),Math.floor(a)>Math.ceil(e)&&Math.floor(l)>Math.ceil(i)){const e=Rn(o,r);if(-1!==e)for(let i=o.length-1;i>=0;i--)if(o[i]){void 0===o[i][e]&&(o[t].length=0);break}}}}i[t]=Math.max(l,i[t])}}const n=i.length;for(let t=0,e=-1;t<n;t++)void 0===o[t]?-1===e?e=t-1:t===n-1&&(i[e]=i[t]):-1!==e&&(i[e]=i[t-1],e=-1);for(let t=0;t<o.length;t++)(null===(e=o[t])||void 0===e?void 0:e.length)?s.push(i[t]):o.splice(t--,1);const c=o.reduce((t,e)=>Math.max(t,e.length),0);for(let t=0;t<c;t++){const e=o.length;for(let i=0;i<e;i++)void 0===o[i][t]&&(o[i][t]={spacer:1})}s.push(t.box.right)}}const c=o.length;if(c>1&&o[0].length===t.length){const e=[],r=new Set;for(let t=0,i=0;t<c;t++){let n=0;const a=o[t];for(let l=0,h=0;l<a.length;l++){const d=a[l],u=a.length;if(void 0===e[l]&&(e[l]=[]),d.spacer)1===d.spacer&&n++;else{const f=Object.assign(In.createDataCellAttribute(),d.data(Cn,"cellData"));let g=1,p=1+n;for(let e=t+1;e<c&&1===o[e][l].spacer;e++)p++,o[e][l].spacer=2;if(1===p)for(let t=l+1;t<u&&1===a[t].spacer;t++)g++,a[t].spacer=2;if(s.length){const e=Math.min(t+(p-1),s.length-1);for(const t of d.documentParent.naturalChildren)if(!r.has(t)&&t.visible&&!t.rendered){const i=t.linear;Tn(i.left,d.linear.right)&&kn(i.right,s[e])&&(void 0===f.siblings&&(f.siblings=[]),f.siblings.push(t))}}f.rowSpan=g,f.columnSpan=p,f.rowStart=0==h++,f.rowEnd=p+t===c,f.cellStart=0===i,f.cellEnd=f.rowEnd&&l===u-1,f.index=t,n=0,d.data(Cn,"cellData",f),e[l].push(d),r.add(d)}}}t.each(t=>t.hide()),t.clear();for(const s of e){let e=!0,o=!1;for(const t of s){const i=t.css("width");if(wn(i))o=!0;else if(!En(i)){e=!1;break}}if(e&&o&&s.length>1){const t=s[0].data(Cn,"cellData");if(1===(null===(i=t)||void 0===i?void 0:i.rowSpan)){let e=t.siblings?t.siblings.slice(0):[];const i=s.length;for(let t=1;t<i;t++){const i=s[t],o=i.data(Cn,"cellData");if(1!==(null===(n=o)||void 0===n?void 0:n.rowSpan)){e.length=0;break}e.push(i),o.siblings&&(e=e.concat(o.siblings))}e.length&&(t.block=!0,t.columnSpan=c,t.siblings=e,s.length=1)}}for(const i of s)i.parent=t,!e&&i.percentWidth&&i.css("width",_n(i.bounds.width))}t.tableElement&&"collapse"===t.css("borderCollapse")&&(t.modifyBox(32),t.modifyBox(64),t.modifyBox(128),t.modifyBox(256)),t.data(Cn,"columnCount",c)}}}const{convertListStyle:Bn}=squared.lib.css,Pn=t=>t.visibleStyle.backgroundImage&&!t.visibleStyle.backgroundRepeat;class Nn extends hi{static createDataAttribute(){return{ordinal:"",imageSrc:"",imagePosition:""}}condition(t){if(super.condition(t)){const e=t.length;if(e>0){const i=new Set,n=t.children;let s=0,o=0,r=0,a=0,l=0,c=0;for(let t=0;t<e;t++){const h=n[t],d="none"!==h.css("listStyleType");if("list-item"===h.display&&(d||h.innerBefore)?c++:h.marginLeft<0&&!d&&Pn(h)&&l++,h.blockStatic?s++:s=1/0,h.inlineVertical?o++:s=1/0,h.floating?(i.add(h.float),r++,a=1/0):0===t||t===e-1||h.blockStatic||n[t-1].blockStatic&&n[t+1].blockStatic?(a++,r=1/0):(r=1/0,a=1/0),s===1/0&&o===1/0&&a===1/0&&r===1/0)return!1}return(l>0||c>0)&&(s===e||o===e||r===e&&1===i.size||a===e)}}return!1}processNode(t){const e="OL"===t.tagName;let i=e&&t.toElementInt("start")||1;t.each(t=>{const n=Nn.createDataAttribute(),s=t.css("listStyleType"),o="list-item"===t.display;if(o||""!==s&&"none"!==s||Pn(t)){if(t.has("listStyleImage"))n.imageSrc=t.css("listStyleImage");else{e&&o&&"LI"===t.tagName&&(i=t.toElementInt("value")||i);let r=Bn(s,i);if(""===r)switch(s){case"disc":r="●";break;case"square":r="■";break;case"none":let e="",i="";t.visibleStyle.backgroundRepeat||(e=t.backgroundImage,i=t.css("backgroundPosition")),""!==e&&"none"!==e&&(n.imageSrc=e,n.imagePosition=i,t.exclude(Wt.IMAGE_SOURCE));break;default:r="○"}else r+=".";n.ordinal=r}o&&i++}t.data(Lt.LIST,"mainData",n)})}}const Ln=squared.lib,{assignRect:Mn}=Ln.dom,{convertFloat:Wn,filterArray:Fn,withinRange:On}=Ln.util;const{getBackgroundPosition:Dn,resolveURL:Hn}=squared.lib.css;const zn=squared.lib,{formatPercent:Xn,formatPX:Un,getInheritedStyle:Vn,getStyle:qn,isLength:jn,isPercent:Gn}=zn.css,{getNamedItem:Yn}=zn.dom,{maxArray:$n}=zn.math,{isNumber:Qn,replaceMap:Kn,withinRange:Zn}=zn.util,Jn=Lt.TABLE,ts=/rgba\(0, 0, 0, 0\)|transparent/;function es(t,e,i){i.percent=Math.round(e.bounds.width/t.box.width*100)+"%",i.expand=!0}const is=t=>t.css("width",Un(t.bounds.width),!0);class ns extends hi{static createDataAttribute(t){return{layoutType:0,rowCount:0,columnCount:0,layoutFixed:"fixed"===t.css("tableLayout"),borderCollapse:"collapse"===t.css("borderCollapse"),expand:!1}}processNode(t){var e,i,n;const s=ns.createDataAttribute(t),o=[],r=[],a=[];let l=[];function c(t){if(t.length){const e=t[0];for(const t of e.cascade())switch(t.tagName){case"TH":case"TD":t.inherit(e,"styleMap"),t.unsetCache("visibleStyle")}l=l.concat(e.children);for(const e of t)e.hide()}}t.each(t=>{switch(t.tagName){case"THEAD":o.push(t);break;case"TBODY":r.push(t);break;case"TFOOT":a.push(t)}}),c(o);for(const t of r)l=l.concat(t.children),t.hide();c(a);const[h,d]=s.borderCollapse?[0,0]:Kn(t.css("borderSpacing").split(" "),(e,i)=>t.parseUnit(e,0===i?"width":"height")),u=h>1?Math.round(h/2):h,f=d>1?Math.round(d/2):d,g=t.element.querySelector("COLGROUP"),p=[],m=[],b=[],x=[],v=l.length;let y=Array(v).fill(0),S=0;for(let e=0;e<v;e++){const i=l[e];p[e]=h,b[e]=[],i.each((i,n)=>{const o=i.element;for(let t=0;t<o.rowSpan-1;t++){const i=e+t+1;y[i]>=0&&(y[i]+=o.colSpan)}const r=y[e];if(!i.hasPX("width")){const t=Yn(o,"width");Gn(t)?i.css("width",t):Qn(t)&&i.css("width",Un(parseFloat(t)))}if(!i.hasPX("height")){const t=Yn(o,"height");Gn(t)?i.css("height",t):Qn(t)&&i.css("height",Un(parseFloat(t)))}if(!i.visibleStyle.backgroundImage&&!i.visibleStyle.backgroundColor)if(g){const{backgroundImage:t,backgroundColor:e}=qn(g.children[r]);t&&"none"!==t&&i.css("backgroundImage",t,!0),e&&!ts.test(e)&&i.css("backgroundColor",e,!0)}else{let t=Vn(o,"backgroundImage",/none/,"TABLE");""!==t&&i.css("backgroundImage",t,!0),t=Vn(o,"backgroundColor",ts,"TABLE"),""!==t&&i.css("backgroundColor",t,!0)}switch(i.tagName){case"TH":{function a(e){const n=e+"Style",s=e+"Color",o=e+"Width";i.ascend(void 0,t).some(t=>!!t.has(n)&&(i.css(n,t.css(n)),i.css(s,t.css(s)),i.css(o,t.css(o),!0),i.css("border","inherit"),!0))}i.cssInitial("textAlign")||i.css("textAlign",i.css("textAlign")),0===i.borderTopWidth&&a("borderTop"),0===i.borderRightWidth&&a("borderRight"),0===i.borderBottomWidth&&a("borderBottom"),0===i.borderLeftWidth&&a("borderLeft")}case"TD":i.cssInitial("verticalAlign")||i.css("verticalAlign","middle",!0)}const l=i.cssInitial("width"),c=void 0===x[r]||"auto"===x[r],b=i.bounds.width;if(0===e||c||!s.layoutFixed)if(""===l||"auto"===l)void 0===x[r]?(x[r]=l||"0px",m[r]=0):e===v-1&&c&&0===m[r]&&(m[r]=b);else{const t=Gn(l),e=jn(x[r]);(c||b<m[r]||b===m[r]&&(e&&t||t&&Gn(x[r])&&i.parseUnit(l)>=i.parseUnit(x[r])||e&&jn(l)&&i.parseUnit(l)>i.parseUnit(x[r])))&&(x[r]=l),(c||1===o.colSpan)&&(m[r]=b)}(i.length||i.inlineText)&&(p[e]+=b+h),u>0&&(i.modifyBox(16,0===y[e]?h:u),i.modifyBox(4,0===n?u:h)),f>0&&(i.modifyBox(2,0===e?d:f),i.modifyBox(8,e+o.rowSpan<v?f:d)),y[e]+=o.colSpan}),S=Math.max(S,y[e])}t.hasPX("width",!1)&&x.some(t=>Gn(t))&&Kn(x,(t,e)=>"auto"===t&&m[e]>0?Un(m[e]):t);let _=!1;if(x.every(t=>Gn(t))){if(x.reduce((t,e)=>t+parseFloat(e),0)>1){let t=100;Kn(x,e=>{const i=parseFloat(e);return t<=0?e="0px":t-i<0&&(e=Xn(t/100)),t-=i,e})}t.hasWidth||(s.expand=!0),_=!0}else if(x.every(t=>jn(t))){const e=x.reduce((t,e)=>t+parseFloat(e),0);if(t.hasWidth)if(e<t.width)Kn(x,t=>"0px"!==t?parseFloat(t)/e*100+"%":t);else if(e>t.width&&(t.css("width","auto",!0),!s.layoutFixed))for(const e of t.cascade())e.css("width","auto",!0);s.layoutFixed&&!t.hasPX("width")&&t.css("width",Un(t.bounds.width),!0)}let E=0;s.layoutType=(()=>{if(x.length>1){if(E=x.reduce((t,e)=>t+(Gn(e)?parseFloat(e):0),0),s.layoutFixed&&x.reduce((t,e)=>t+(jn(e)?parseFloat(e):0),0)>=t.actualWidth)return 4;if(x.length>1&&x.some(t=>Gn(t))||x.every(t=>jn(t)&&"0px"!==t))return 3;if(x.every(t=>t===x[0])){if(t.cascadeSome(t=>t.hasHeight))return s.expand=!0,3;if("auto"===x[0]){if(t.hasWidth)return 3;{const e=t.cascade(t=>"TD"===t.tagName);return e.length&&e.every(t=>Zn(t.bounds.width,e[0].bounds.width))?0:3}}if(t.hasWidth)return 2}if(x.every(t=>"auto"===t||jn(t)&&"0px"!==t))return t.hasWidth||(s.expand=!0),1}return 0})();const w=t.find(t=>"CAPTION"===t.tagName);t.clear(),w&&(w.hasWidth||(w.textElement?w.hasPX("maxWidth")||w.css("maxWidth",Un(w.bounds.width)):w.bounds.width>$n(p)&&is(w)),w.cssInitial("textAlign")||w.css("textAlign","center"),w.data(Jn,"cellData",{colSpan:S}),w.parent=t);const T=t.hasWidth;y=Array(v).fill(0);for(let e=0;e<v;e++){const i=l[e];let n;for(const o of i.duplicate()){const i=o.element,{rowSpan:r,colSpan:a}=i,l={rowSpan:r,colSpan:a};for(let t=0;t<r-1;t++){const i=e+1+t;void 0!==y[i]&&(y[i]+=a)}o.has("verticalAlign")||o.css("verticalAlign","middle");const c=x[y[e]];if(c)switch(s.layoutType){case 0:break;case 3:"auto"===c?E>=1?(is(o),l.exceed=!T,l.downsized=!0):es(t,o,l):Gn(c)?_?(l.percent=c,l.expand=!0):is(o):jn(c)&&parseInt(c)>0?o.bounds.width>=parseInt(c)?(is(o),l.expand=!1,l.downsized=!1):s.layoutFixed?(es(t,o,l),l.downsized=!0):(is(o),l.expand=!1):(o.hasPX("width")&&!o.percentWidth||is(o),l.expand=!1);break;case 2:o.css("width","0px");break;case 1:"auto"===c?o.css("width","0px"):(s.layoutFixed?l.downsized=!0:is(o),l.expand=!1);break;case 4:jn(c)||o.hide()}y[e]+=a;for(let t=0;t<r;t++)for(let i=0;i<a;i++)b[e+t].push(o);o.data(Jn,"cellData",l),o.parent=t,n=o}if(n&&y[e]<S){const t=n.data(Jn,"cellData");t&&(t.spaceSpan=S-y[e])}i.hide()}if(s.borderCollapse){const s=t.css("borderTopColor"),o=t.css("borderTopStyle"),r=t.css("borderTopWidth"),a=t.css("borderRightColor"),l=t.css("borderRightStyle"),c=t.css("borderRightWidth"),h=t.css("borderBottomColor"),d=t.css("borderBottomStyle"),u=t.css("borderBottomWidth"),f=t.css("borderLeftColor"),g=t.css("borderLeftStyle"),p=t.css("borderLeftWidth");let m=!1,x=!1,y=!1,_=!1;for(let t=0;t<v;t++)for(let E=0;E<S;E++){const w=b[t][E];if("visible"===(null===(e=w)||void 0===e?void 0:e.css("visibility"))){if(0===t&&(w.borderTopWidth<parseInt(r)?w.cssApply({borderTopColor:s,borderTopStyle:o,borderTopWidth:r}):m=!0),t>=0&&t<v-1){const e=b[t+1][E];"visible"===(null===(i=e)||void 0===i?void 0:i.css("visibility"))&&e!==w&&(w.borderBottomWidth>=e.borderTopWidth?e.css("borderTopWidth","0px",!0):w.css("borderBottomWidth","0px",!0))}if(t===v-1&&(w.borderBottomWidth<parseInt(u)?w.cssApply({borderBottomColor:h,borderBottomStyle:d,borderBottomWidth:u}):y=!0),0===E&&(w.borderLeftWidth<parseInt(p)?w.cssApply({borderLeftColor:f,borderLeftStyle:g,borderLeftWidth:p}):_=!0),E>=0&&E<S-1){const e=b[t][E+1];"visible"===(null===(n=e)||void 0===n?void 0:n.css("visibility"))&&e!==w&&(w.borderRightWidth>=e.borderLeftWidth?e.css("borderLeftWidth","0px",!0):w.css("borderRightWidth","0px",!0))}E===S-1&&(w.borderRightWidth<parseInt(c)?w.cssApply({borderRightColor:a,borderRightStyle:l,borderRightWidth:c}):x=!0)}}(m||x||y||_)&&t.cssApply({borderTopWidth:"0px",borderRightWidth:"0px",borderBottomWidth:"0px",borderLeftWidth:"0px"},!0)}s.rowCount=v,s.columnCount=S,t.data(Jn,"mainData",s)}}const ss=squared.lib,{isLength:os}=ss.css,{convertFloat:rs}=ss.util;const as=squared.lib,{formatPX:ls}=as.css,{hasBit:cs}=as.util,hs=null!==document.doctype&&"html"===document.doctype.name;function ds(t,e,i,n=0){let s;switch(e){case 2:s=t.actualRect("top")-i;break;case 16:s=t.actualRect("left")-i;break;case 8:s=i-t.actualRect("bottom");break;default:s=0}s-=n,s>0&&(t.renderAs||t.outerWrapper||t).modifyBox(e,s)}function us(t,e,i){if(gs(e,i)){let n,s,o,r;if(i?(n="marginTop",s="borderTopWidth",o="paddingTop",r=2):(n="marginBottom",s="borderBottomWidth",o="paddingBottom",r=8),0===t[s])if(0===t[o]){for(;hs&&0===e[n]&&0===e[s]&&0===e[o]&&ms(e);){const t=i?e.firstStaticChild:e.lastStaticChild;if(!gs(t,i))break;e=t}const a=t[n],l=e[n],c=e.bounds.height;let h=!1;if(!hs&&0===a&&l>0&&""===e.cssInitial(n))h=!0;else{const n=a>=l;0===c&&n&&e.textEmpty&&0===e.extensions.length?e.hide():1!==e.getBox(r)[0]&&(n?h=!0:t.documentBody?(fs(t,r),i&&(t.bounds.top=0,t.unset("box"),t.unset("linear"))):(1!==t.getBox(r)[0]&&(t.modifyBox(r),t.modifyBox(r,l)),h=!0))}h&&(fs(e,r),0!==c||e.every(t=>t.floating)||fs(e,i?8:2))}else if(0===e[n]&&0===e[s]&&ms(e)){let r=!0;for(;;){const a=i?e.firstStaticChild:e.lastStaticChild;if(!a||0!==a[n]||0!==a[s]||a.visibleStyle.background||!ms(a))break;{const n=a[o];if(n>0){n>=t[o]?t.modifyBox(i?32:128):r&&t.modifyBox(i?32:128,-n);break}gs(a,i)||(r=!1),e=a}}}}}function fs(t,e){const i=t[Nt.get(e)];if(0===t.getBox(e)[0])t.modifyBox(e);else for(const n of t.ascend(void 0,void 0,"outerWrapper"))if(n.getBox(e)[1]>=i){n.modifyBox(e,-i);break}}function gs(t,e,i=!1){if(t&&!t.lineBreak){let n=!1;if(t.blockStatic)n=!0;else if(!t.floating){const i=t.display;if("list-item"===i&&(n=!0),void 0!==e)if("table"===i&&(n=!0),e){const e=t.firstStaticChild;n=gs(e)&&bs(e)}else{const e=t.lastStaticChild;n=gs(e)&&xs(e)}}return n&&(!i||void 0===e||t.bounds.height>0)}return!1}const ps=(t,e)=>t.css("minHeight",ls(Math.max(e,t.hasPX("minHeight",!1)?t.parseUnit(t.css("minHeight")):0))),ms=t=>!t.layoutElement&&!t.tableElement&&"FIELDSET"!==t.tagName,bs=t=>!t.hasPX("height")&&0===t.paddingBottom&&0===t.borderBottomWidth&&ms(t),xs=t=>!t.hasPX("height")&&0===t.borderTopWidth&&0===t.paddingTop&&ms(t);const vs={Accessibility:class extends hi{constructor(){super(...arguments),this.options={showLabel:!1}}beforeBaseLayout(){for(const t of this.application.processing.cache)if(t.inputElement&&t.hasProcedure(Ft.ACCESSIBILITY))switch(t.containerName){case"INPUT_IMAGE":t.extracted=[t];break;case"INPUT_RADIO":case"INPUT_CHECKBOX":const e=t.elementId;[t.nextSibling,t.previousSibling].some(i=>{var n;if((null===(n=i)||void 0===n?void 0:n.visible)&&i.pageFlow&&!i.visibleStyle.backgroundImage){if(e&&e===i.toElementString("htmlFor"))t.companion=i;else if(i.textElement&&"LABEL"===i.documentParent.tagName)t.companion=i,i.documentParent.renderAs=t;else{if(!i.plainText)return!1;t.companion=i}return this.options.showLabel||i.hide(),!0}return!1});break;case"BUTTON":if(t.length){const e=t.filter(t=>!t.textElement);e.length&&(t.extracted=e),t.clear()}}}},CssGrid:xn,Flexbox:yn,Grid:In,List:Nn,Relative:class extends hi{is(t){return t.positionRelative||0!==t.toFloat("verticalAlign",!0)}condition(){return!0}processNode(){return{include:!0}}postOptimize(t){var e;const i=t.renderParent,n=Wn(t.verticalAlign);let{top:s,right:o,bottom:r,left:a}=t,l=t;if(i.support.container.positionRelative&&i.layoutHorizontal&&0===t.renderChildren.length&&(0!==t.top||0!==t.bottom||0!==n)){const e=this.application;l=t.clone(e.nextId,!0,!0),l.baselineAltered=!0,t.hide(!0),e.session.cache.append(l,!1);const n=new ue(i,l,l.containerType,l.alignmentType),s=i.renderChildren.findIndex(e=>e===t);if(-1!==s&&(n.renderIndex=s+1),e.addLayout(n),i.layoutHorizontal&&t.documentParent.parseUnit(t.css("textIndent"))<0&&i.renderEach(e=>{const i=t.documentId;e.alignSibling("topBottom")===i?e.alignSibling("topBottom",l.documentId):e.alignSibling("bottomTop")===i&&e.alignSibling("bottomTop",l.documentId)}),t.baselineActive&&!t.baselineAltered)for(const e of i.horizontalRows||[i.renderChildren])if(e.includes(t)){const i=Fn(e,e=>e.positionRelative&&e.length>0&&0!==Wn(t.verticalAlign)),n=i.length;if(n>0){i.sort((t,e)=>{const i=t.linear.top,n=e.linear.top;return On(i,n)?0:i<n?-1:1});for(let e=0;e<n;e++){const n=i[e];0===e?t.modifyBox(2,Wn(n.verticalAlign)):n.modifyBox(2,n.linear.top-i[0].linear.top),n.css("verticalAlign","0px",!0)}}break}}else if(t.naturalElement&&t.positionRelative){const n=t.actualParent;let l,c=!1;for(const h of n.naturalElements){if(h===t){if(c){if(i.layoutVertical&&(0!==t.top||0!==t.bottom)){const e=Mn(t.boundingClientRect,!0);0!==s&&(s-=e.top-t.bounds.top),0!==r&&(r+=e.bottom-t.bounds.bottom)}if(i.layoutHorizontal&&(0!==t.left||0!==t.right)&&""===t.alignSibling("leftRight")){const e=Mn(t.boundingClientRect,!0);0!==a&&(a-=e.left-t.bounds.left),0!==o&&(o+=e.right-t.bounds.right)}}else if(i.layoutVertical)if(0!==s)(null===(e=l)||void 0===e?void 0:e.blockStatic)&&l.positionRelative&&h.blockStatic&&(s-=l.top);else if(0!==r){1===h.getBox(2)[0]&&(r-=h.marginTop)}break}h.positionRelative&&h.renderParent===i&&(c=!0),l=h}}0!==s?l.modifyBox(2,s):0!==r&&l.modifyBox(2,-1*r),0!==n&&l.modifyBox(2,-1*n),0!==a?l.autoMargin.left?l.modifyBox(4,-1*a):l.modifyBox(16,a):0!==o&&l.modifyBox(16,-1*o)}},Sprite:class extends hi{is(){return!0}condition(t){const e=t.backgroundImage;if(""!==e&&t.hasWidth&&t.hasHeight&&0===t.length&&(this.included(t.element)||!t.dataset.use)){const i=this.resource.getRawData(e)||this.resource.getImage(Hn(e));if(i){const e=/^0[a-z%]+|left|start|top/,n=t.actualDimension,s=t.css("backgroundPositionX"),o=t.css("backgroundPositionY"),r=Dn(s+" "+o,n,t.fontSize),a=(r.left<0||e.test(s))&&i.width>n.width,l=(r.top<0||e.test(o))&&i.height>n.height;if((a||l)&&(a||0===r.left)&&(l||0===r.top))return t.data(Lt.SPRITE,"mainData",{image:i,position:r}),!0}}return!1}},Table:ns,VerticalAlign:class extends hi{is(){return!0}condition(t){let e=!1,i=0,n=0,s=0;for(const o of t){if(o.inlineVertical){const t=rs(o.verticalAlign);0!==t&&(e=!0),isNaN(s)||(0===s?s=t:s!==t&&(s=NaN)),n++}else s=NaN;(o.positionStatic||o.positionRelative&&o.length)&&i++}return e&&isNaN(s)&&n>1&&i===t.length&&ce.linearData(t.children).linearX}processNode(t){return t.each(t=>{(t.inlineVertical&&!t.baseline||t.imageElement)&&(t.baselineAltered=!0)}),{include:!0}}postConstraints(t){var e;if(t.layoutHorizontal)for(const i of t.horizontalRows||[t.renderChildren]){const t=[];let n,s=1/0;for(const e of i){const i=e.linear.top;e.inlineVertical&&i<=s&&(i<s&&(t.length=0),t.push(e),s=i),e.baselineActive&&(n=e)}if(t.length){const s=t[0],o=s.linear.top;for(const s of i)if(s!==n){if(s.inlineVertical&&!s.baseline)if(t.includes(s))s.imageElement&&(null===(e=n)||void 0===e?void 0:e.documentId)===s.alignSibling("baseline")&&s.modifyBox(2,n.linear.top-s.linear.top);else{const t=s.verticalAlign;let e=!1;switch(t){case"super":case"sub":e=!0;break;default:(os(t)||void 0===n)&&(e=!0)}e&&s.modifyBox(2,s.linear.top-o)}s.baselineAltered&&s.css("verticalAlign","0px",!0)}if(n){const t=s.parseUnit(s.cssInitial("verticalAlign"),"height");n.modifyBox(2,n.linear.top-o+(t<0?t:0)),n.baselineAltered=!0}}}else t.each(t=>t.baselineAltered=!1)}},WhiteSpace:class extends hi{afterBaseLayout(){var t;const e=new Set;for(const i of this.application.processing.cache)if(i.naturalElement&&i.naturalElements.length&&!i.layoutElement&&!i.tableElement&&0!==i.id){let n,s;const o=gs(i)&&!i.actualParent.layoutElement,r=i.naturalChildren,a=r.length;for(let l=0;l<a;l++){const c=r[l];if(c.pageFlow&&(o&&(c.floating?s=void 0:c.bounds.height>0||1===a||gs(c,0===l||l!==a-1&&void 0,!0)?(void 0===n&&(n=c),s=c):0===c.bounds.height&&i.layoutVertical&&""===c.alignSibling("topBottom")&&""===c.alignSibling("bottomTop")&&(0===c.renderChildren.length||c.every(t=>!t.visible))&&(!c.pseudoElement||c.pseudoElement&&(1===a||l>0||r.every((t,e)=>0===e||t.floating||t.pseudoElement&&""===t.textContent.trim())))&&c.hide()),l>0&&gs(c,!1))){const n=c.previousSiblings({floating:!1}),s=n.length;if(s>0){const r=n[s-1];let a=!1;if(gs(r,!0)){let t=r.marginBottom,i=c.marginTop;if(r.excluded&&!c.excluded){const n=Math.min(t,r.marginTop);if(n<0){c.modifyBox(2,Math.abs(n)<i?n:void 0),e.add(r.id);continue}}else if(!r.excluded&&c.excluded){const n=Math.min(i,c.marginBottom);if(n<0){r.modifyBox(8,Math.abs(n)<t?n:void 0),e.add(c.id);continue}}let n=!1;if(o){let e=r;for(;bs(e);){const i=e.lastStaticChild;if(gs(i,!0)&&1!==i.getBox(8)[0]){const s=i.marginBottom;if(fs(i,8),s>t)t=s,r.setCacheValue("marginBottom",t),n=!0;else if(0===s&&0===t){e=i;continue}}break}for(e=c;xs(e);){const t=e.firstStaticChild;if(gs(t,!1)&&1!==t.getBox(2)[0]){const n=t.marginTop;if(fs(t,2),n>i)i=n,c.setCacheValue("marginTop",i),a=!0;else if(0===n&&0===i){e=t;continue}}break}}if(t>0&&(i>0?i<=t?a&&cs(c.overflow,64)||(a&&(c.setCacheValue("marginTop",0),a=!1),fs(c,2)):n&&cs(r.overflow,64)||(n&&(r.setCacheValue("marginBottom",0),n=!1),fs(r,8)):0===r.bounds.height&&fs(r,8)),a)for(const t of c.registerBox(2))t.setCacheValue("marginTop",i);if(n)for(const e of r.registerBox(8))e.setCacheValue("marginBottom",t)}if(!a&&n.length>1&&n[0].floating&&(i.layoutVertical||(null===(t=c.renderParent)||void 0===t?void 0:t.layoutVertical))){const t=n[0].linear.top-c.linear.top;t<0&&c.modifyBox(2,t,!1)}}}}if(!(cs(i.overflow,64)||i.documentParent.layoutElement&&i.documentParent.css("flexDirection").startsWith("column")||"FIELDSET"===i.tagName)&&(n&&us(i,n,!0),s&&(us(i,s,!1),s.marginTop<0))){const t=s.bounds.height+s.marginBottom+s.marginTop;t<0&&i.modifyBox(128,t,!1)}}for(const t of this.application.processing.excluded)if(t.lineBreak&&!t.lineBreakTrailing&&!e.has(t.id)){const n=t.previousSiblings({floating:!1});let s=!1;if(n.length){const o=t.actualParent,r=t.nextSiblings({floating:!1});if(r.length){let a=n.pop(),l=r.pop();const c=a.inlineStatic&&l.inlineStatic;if(c&&0===n.length){e.add(t.id);continue}let h,d=0;function i(){const t=l.linear.top;if(h){const e=Math.max(h.linear.top,a.linear.bottom);if(e<t)return t-e-d}return t-a.linear.bottom-d}if(!a.multiline&&a.has("lineHeight")){const t=Math.floor((a.lineHeight-a.bounds.height)/2);t>0&&(d+=t)}if(!l.multiline&&l.has("lineHeight")){const t=Math.round((l.lineHeight-l.bounds.height)/2);t>0&&(d+=t)}c&&(h=n[0],1===n.length&&(h=h.lineBreak?t:void 0),h&&h.setBounds(!1));let u=a.renderParent,f=l.renderParent;if(u&&f){for(;u&&u!==o;)a=u,u=a.renderParent;for(;f&&f!==o;)l=f,f=l.renderParent;if(f===u){const t=i();t>0&&(l.visible?(l.modifyBox(2,t),s=!0):a.visible&&(a.modifyBox(8,t),s=!0))}}else{const t=i();t>0&&(l.lineBreak||l.excluded?(o.modifyBox(128,t),s=!0):(a.lineBreak||a.excluded)&&(o.modifyBox(32,t),s=!0))}}else if(o.visible){if(o.documentRoot||0!==o.ascend(t=>t.documentRoot,void 0,"outerWrapper").length){if(r.length){const t=r[r.length-1],e=(t.lineBreak||t.excluded?t.linear.bottom:t.linear.top)-o.box.top;0!==e&&(t.rendered||o.visibleStyle.background?o.modifyBox(32,e):o.hasHeight||ps(o,e))}}else{const t=n[n.length-1],e=0===t.bounds.height&&t.length?ce.outerRegion(t):t.linear,i=o.box.bottom-(t.lineBreak||t.excluded?e.top:e.bottom);0!==i&&(t.rendered||o.visibleStyle.background?o.modifyBox(128,i):o.hasHeight||ps(o,i))}s=!0}if(s){for(const t of n)e.add(t.id);for(const t of r)e.add(t.id)}}}}afterConstraints(){var t,e,i;const n=this.application.processing.cache;for(const s of n)if(s.pageFlow){const n=s.renderParent;if(n&&s.styleElement&&s.inlineVertical&&!s.positioned&&!s.documentParent.layoutElement&&!n.tableElement){if(s.blockDimension&&!s.floating)if(n.layoutVertical){const i=n.renderChildren,o=i.findIndex(t=>t===s);if(-1!==o){if(!s.lineBreakLeading){const e=i[o-1];(null===(t=e)||void 0===t?void 0:t.pageFlow)&&ds(s,2,e.actualRect("bottom"),e.getBox(8)[1])}if(!s.lineBreakTrailing){const t=i[o+1];(null===(e=t)||void 0===e?void 0:e.pageFlow)&&t.styleElement&&!t.inlineVertical&&ds(s,8,t.actualRect("top"),t.getBox(2)[1])}}}else{let t;if(n.horizontalRows)t:{const e=n.horizontalRows;let i=-1/0;const o=e.length;for(let n=0;n<o;n++){const o=e[n],r=o.length;for(let e=0;e<r;e++)if(s===o[e]){n>0?ds(s,2,i):t=o;break t}for(const t of o)if(t.blockDimension&&!t.floating){const e=t.actualRect("bottom");e>i&&(i=e)}if(i===-1/0)break}}else n.layoutHorizontal&&(t=n.renderChildren);if(t){const e=s.actualParent;if(e){const i=s.actualRect("top");let n=-1/0;for(const i of e.naturalChildren){if(t.includes(i))break;if(i.lineBreak)n=-1/0;else if(i.blockDimension&&!i.floating){const t=i.actualRect("bottom");t>n&&(n=t)}}n!==-1/0&&i>n&&ds(s,2,n)}}}if(n.layoutHorizontal&&!s.alignParent("left")){const t=s.alignSibling("leftRight");if(""!==t){const e=n.renderChildren.find(e=>e.documentId===t);(null===(i=e)||void 0===i?void 0:i.inlineVertical)&&ds(s,16,e.actualRect("right"))}else{let t=s;for(;;){const e=t.siblingsLeading;if(e.length&&!e.some(t=>t.lineBreak||t.excluded&&t.blockStatic)){const i=e[0];if(i.inlineVertical)ds(s,16,i.actualRect("right"));else if(i.floating){t=i;continue}}break}}}}}}}},ys={constant:Ot,enumeration:Dt};t.Application=F,t.ApplicationUI=class extends F{constructor(t,i,n,s,o){super(t,i,n,s,o),this.session={cache:new e,excluded:new e,extensionMap:new Map,active:[],documentRoot:[],targetQueue:new Map},this.builtInExtensions={},this.extensions=[],this._layouts=[],ze=i,this._localSettings=this.controllerHandler.localSettings,this._excluded=this._localSettings.unsupported.excluded}finalize(){var t,e;const i=this.controllerHandler;for(const[t,e]of this.session.targetQueue.entries()){const i=t.dataset.target;if(i){const n=this.resolveTarget(i);n?(t.render(n),this.addLayoutTemplate(n,t,e)):void 0===t.renderParent&&this.session.cache.remove(t)}}const n=this.rendered;for(const t of n)t.hasProcedure(Ft.LAYOUT)&&t.setLayout(),t.hasProcedure(Ft.ALIGNMENT)&&t.setAlignment();i.optimize(n);for(const t of this.extensions)for(const e of t.subscribers)t.postOptimize(e);for(const t of this.rendered)t.hasResource(Wt.BOX_SPACING)&&t.setBoxSpacing();for(const t of this.extensions)t.beforeCascade();const s=this._localSettings.layout.baseTemplate;for(const n of this.session.documentRoot){const o=n.node;if(o.documentRoot&&0===o.renderChildren.length&&!o.inlineText&&o.naturalChildren.every(t=>t.documentRoot))continue;const r=null===(t=o.renderParent)||void 0===t?void 0:t.renderTemplates;r&&this.saveDocument(n.layoutName,s+i.cascadeDocument(r,0),o.dataset.pathname,(null===(e=o.renderExtension)||void 0===e?void 0:e.some(t=>t.documentBase))?0:void 0)}const o=this._layouts;this.resourceHandler.finalize(o),i.finalize(o);for(const t of this.extensions)t.afterFinalize();we("__squared.pseudo"),this.closed=!0}copyToDisk(t,e){super.copyToDisk(t,e,this.layouts)}appendToArchive(t){super.appendToArchive(t,this.layouts)}saveToArchive(t){super.saveToArchive(t,this.layouts)}reset(){super.reset();for(const t of this.rootElements)t.dataset.iteration="";const t=this.session;t.cache.reset(),t.excluded.reset(),t.extensionMap.clear(),t.documentRoot.length=0,t.targetQueue.clear(),this._layouts.length=0}conditionElement(t){if(!this._excluded.has(t.tagName)){if(this.controllerHandler.visibleElement(t)||this._cascadeAll||t.dataset.use&&t.dataset.use.split(Fe.SEPARATOR).some(t=>!!this.extensionManager.retrieve(t)))return!0;{switch(be(t).position){case"absolute":case"fixed":return!1}let e=t.parentElement;for(;e;){if("none"===be(e).display)return!1;e=e.parentElement}const i=this.controllerHandler,n=t.children,s=n.length;for(let t=0;t<s;t++)if(i.visibleElement(n[t]))return!0;return!1}}return!1}insertNode(t,e){var i;if(!Ee(t)){if(this.conditionElement(t))return this.controllerHandler.applyDefaultStyles(t),this.createNode(t,!1);{const e=this.createNode(t,!1);return e.visible=!1,e.excluded=!0,e}}if(He(t.textContent)||(null===(i=e)||void 0===i?void 0:i.preserveWhiteSpace)&&("PRE"!==e.tagName||0===e.element.children.length)){this.controllerHandler.applyDefaultStyles(t);const i=this.createNode(t,!1);return e&&(i.cssApply(e.getTextStyle()),i.fontSize=e.fontSize),i}}saveDocument(t,e,i,n){if(Ne(e)){const s={pathname:i?We(i,"/"):this._localSettings.layout.pathName,filename:t,content:e,index:n},o=this._layouts;void 0!==n&&n>=0&&n<o.length?o.splice(n,0,s):o.push(s)}}renderNode(t){return 0===t.itemCount?this.controllerHandler.renderNode(t):this.controllerHandler.renderNodeGroup(t)}addLayout(t){if(Pe(t.renderType,512)&&(Pe(t.renderType,8)?t=this.processFloatHorizontal(t):Pe(t.renderType,16)&&(t=this.processFloatVertical(t))),0!==t.containerType){const e=this.renderNode(t);if(e)return this.addLayoutTemplate(e.parent||t.parent,t.node,e,t.renderIndex)}return!1}addLayoutTemplate(t,e,i,n=-1){return!!i&&(e.renderExclude?(e.hide(),e.excluded=!0):e.renderParent?(void 0===t.renderTemplates&&(t.renderTemplates=[]),n>=0&&n<t.renderChildren.length?(t.renderChildren.splice(n,0,e),t.renderTemplates.splice(n,0,i)):(t.renderChildren.push(e),t.renderTemplates.push(i))):this.session.targetQueue.set(e,i),!0)}createNode(t,e=!0,i,n){var s;const o=this.processing,r=new ze(this.nextId,o.sessionId,t,this.controllerHandler.afterInsertNode);if(i&&(r.depth=i.depth+1),void 0===t&&(null===(s=i)||void 0===s?void 0:s.naturalElement)&&(r.actualParent=i),n)for(const t of n)t.parent=r;return e&&o.cache.append(r,void 0!==n),r}createCache(t){const e=this.createRootNode(t);if(e){const t=this._cache,n=e.parent;e.documentBody&&(n.visible=!1,n.exclude(Wt.ASSET,Ft.ALL,Mt.EXTENSION),t.append(n)),e.documentParent=n;const s=this.controllerHandler,o={},r=new Set;let a=!1;function i(t,e,i,n,s){void 0===o[e]&&(o[e]={}),o[e][i]=s,t.style.setProperty(i,n)}for(const e of t)if(e.styleElement){const t=e.element;if(e.length){const n=e.cssInitial("textAlign");switch(n){case"center":case"right":case"end":i(t,e.id,"text-align","left",n)}}if(e.positionRelative)for(const n of ge)e.hasPX(n)&&(i(t,e.id,n,"auto",e.css(n)),a=!0);"rtl"===e.dir&&(t.dir="ltr",r.add(t))}!a&&r.size&&(a=!0);for(const t of this.processing.excluded)t.pageFlow||t.cssTry("display","none");e.parent.setBounds();const l=[];for(const i of t)i.pseudoElement?l.push(i):(i.setBounds(void 0===o[i.id]&&!a),e.styleText&&(i.textBounds=_e(e.element)));if(l.length){const t=new Map;for(const e of l){const i=e.actualParent.element;let n,s=i.id;e.pageFlow&&(""===s&&(s="__squared_"+Math.round(Math.random()*(new Date).getTime()),i.id=s),n=xe(`#${s+ce.getPseudoElt(e)} { display: none !important; }`)),e.cssTry("display",e.display)&&t.set(e,{id:s,styleElement:n})}for(const e of l){t.get(e)&&e.setBounds(!1)}for(const e of l){const i=t.get(e);if(i){if(i.id.startsWith("__squared_")){e.actualParent.element.id=""}i.styleElement&&document.head.removeChild(i.styleElement),e.cssFinally("display")}}}for(const t of this.processing.excluded)t.lineBreak||(t.setBounds(),t.saveAsInitial()),t.pageFlow||t.cssFinally("display");for(const e of t){if(e.styleElement){const t=e.element,i=o[e.id];if(i)for(const e in i)t.style.setProperty(e,i[e]);r.has(t)&&(t.dir="rtl")}e.saveAsInitial()}return s.evaluateNonStatic(e,t),s.sortInitialCache(t),!0}return!1}afterCreateCache(t){const e=t.dataset,i=e.filename&&e.filename.replace(RegExp(`.${this._localSettings.layout.fileExtension}$`),"")||t.id||"document_"+this.length,n=(e.iteration?Ce(e.iteration):-1)+1;e.iteration=""+n,e.layoutName=Re(n>1?i+"_"+n:i,!0),this.setBaseLayout(e.layoutName),this.setConstraints(),this.setResources()}resolveTarget(t){for(const e of this._cache)if(e.elementId===t||e.controlId===t)return e;for(const e of this.session.cache)if(e.elementId===t||e.controlId===t)return e}toString(){const t=this._layouts;return t.length?t[0].content:""}cascadeParentNode(t,e=0){var i;const n=this.insertNode(t);if(n&&("none"!==n.display||0===e||n.outerExtensionElement)){if(n.depth=e,0===e){this._cache.append(n);const t=this.extensionManager;for(const e of n.extensions){if(null===(i=t.retrieve(e))||void 0===i?void 0:i.cascadeAll){this._cascadeAll=!0;break}}}const s=this.controllerHandler;if(s.preventNodeCascade(t))return n;const o=this.processing.sessionId,r=this.createPseduoElement(t,"::before",o),a=this.createPseduoElement(t,"::after",o),l=t.childNodes,c=l.length,h=Array(c),d=Array(t.childElementCount);let u=!0,f=0,g=0;for(let t=0;t<c;t++){const i=l[t];let o;i===r?(o=this.insertNode(r),o&&(n.innerBefore=o,o.textEmpty||(o.inlineText=!0),u=!1)):i===a?(o=this.insertNode(a),o&&(n.innerAfter=o,o.textEmpty||(o.inlineText=!0),u=!1)):"#"===i.nodeName.charAt(0)?Ee(i)&&(o=this.insertNode(i,n)):s.includeElement(i)&&(Xe(i,this.extensions).some(t=>t.init(i)),this.rootElements.has(i)?(o=this.insertNode(i),o&&(o.documentRoot=!0,o.visible=!1,o.excluded=!0),u=!1):(o=this.cascadeParentNode(i,e+1),!o||o.excluded&&"WBR"!==o.tagName||(u=!1)),o&&(d[g++]=o)),o&&(o.childIndex=f,h[f++]=o)}h.length=f,d.length=g,n.naturalChildren=h,n.naturalElements=d,this.cacheNodeChildren(n,h,u),this.userSettings.createQuerySelectorMap&&g>0&&(n.queryMap=this.createQueryMap(d,g))}return n}cacheNodeChildren(t,e,i){const n=e.length;if(n>0){const s=this._cache;let o=[],r=[];if(n>1){let a=e[0],l=!1;for(let c=0,h=0;c<n;c++){const d=e[c];d.excluded?this.processing.excluded.append(d):d.plainText&&i||(d.containerIndex=h++,d.parent=t,s.append(d)),d.pageFlow&&(d.floating&&(l=!0),c>0&&(r.push(d),d.lineBreak&&(e[c-1].lineBreakTrailing=!0)),d.excluded||(d.siblingsLeading=o,a.siblingsTrailing=r,o=[],r=[],a=d),c<n-1&&(o.push(d),d.lineBreak&&(e[c+1].lineBreakLeading=!0))),d.actualParent=t}a.siblingsTrailing=r,t.floatContainer=l}else{const i=e[0];i.excluded?this.processing.excluded.append(i):i.plainText||(i.siblingsLeading=o,i.siblingsTrailing=r,i.parent=t,i.containerIndex=0,s.append(i)),i.actualParent=t}}else i=!t.textEmpty;t.inlineText=i}createPseduoElement(t,e,i){var n;let s=Oe(t,"styleMap"+e,i),o=0;if("Q"===t.tagName&&(void 0===s&&(s={},De(t,"styleMap"+e,i,s)),s.content||(s.content=be(t,e).getPropertyValue("content")||("::before"===e?"open-quote":"close-quote")),s.content.endsWith("-quote"))){let e=t.parentElement;for(;"Q"===(null===(n=e)||void 0===n?void 0:n.tagName);)o++,e=e.parentElement}if(s){let n=s.content;if(n){if(""===We(n,'"').trim()&&0===Ae(s.width)&&0===Ae(s.height)&&("absolute"===s.position||"fixed"===s.position||s.clear&&"none"!==s.clear)){let t=!0;for(const e in s)if(/(Width|Height)$/.test(e)){const i=s[e];if(ve(i,!0)&&0!==Ae(i)){t=!1;break}}if(t)return}if("inherit"===n){let e=t;for(;e&&(n=be(e).getPropertyValue("content"),"inherit"===n);)e=e.parentElement}const c=be(t);void 0===s.fontFamily&&(s.fontFamily=c.getPropertyValue("font-family")),void 0===s.fontSize&&(s.fontSize=c.getPropertyValue("font-size")),void 0===s.fontWeight&&(s.fontWeight=c.getPropertyValue("font-weight")),void 0===s.color&&(s.color=c.getPropertyValue("color")),void 0===s.display&&(s.display="inline");let h=s.display.startsWith("inline")?"span":"div",d="";switch(n){case"normal":case"none":case"initial":case"inherit":case"no-open-quote":case"no-close-quote":case'""':break;case"open-quote":"::before"===e&&(d=o%2==0?"“":"‘");break;case"close-quote":"::after"===e&&(d=o%2==0?"”":"’");break;default:if(n.startsWith("url(")){d=ye(n);const t=Be(d,".").toLowerCase(),e=this._localSettings.supported.imageFormat;"*"===e||e.includes(t)?h="img":d=""}else{const s=/\s*(?:attr\(([^)]+)\)|(counter)\(([^,)]+)(?:, ([a-z\-]+))?\)|(counters)\(([^,]+), "([^"]*)"(?:, ([a-z\-]+))?\)|"([^"]+)")\s*/g;let o,h=!1;for(;null!==(o=s.exec(n));){if(o[1])d+=Se(t,o[1].trim());else if(o[2]||o[5]){const n="counter"===o[2];let s,h;function r(t){if("none"!==t){const e=/\s*([^\-\d][^\-\d]?[^ ]*) (-?\d+)\s*/g;let i;for(;null!==(i=e.exec(t));)if(i[1]===s)return parseInt(i[2])}}n?(s=o[3],h=o[4]||"decimal"):(s=o[6],h=o[8]||"decimal");const u=t=>{var n;const s=Oe(t,"styleMap"+e,i);if(null===(n=s)||void 0===n?void 0:n.counterIncrement)return r(s.counterIncrement)},f=(u(t)||0)+(r(c.getPropertyValue("counter-reset"))||0),g=[];let p,m=t,b=f,x=!1;function a(t,e){0===g.length?b+=t:(x||e)&&(g[g.length-1]+=t)}function l(t){if(void 0===r(be(t).getPropertyValue("counter-reset"))){const e=t.children,i=e.length;for(let t=0;t<i;t++){const i=e[t];if("__squared.pseudo"!==i.className){let t=u(i);t&&a(t,!0);const e=be(i);if(t=r(e.getPropertyValue("counter-increment")),t&&a(t,!1),t=r(e.getPropertyValue("counter-reset")),void 0!==t)return;l(i)}}}}for(;;){if(x=!1,m.previousElementSibling)m=m.previousElementSibling,l(m);else{if(!m.parentElement)break;m=m.parentElement,x=!0}if("__squared.pseudo"!==m.className){const t=u(m);t&&a(t,!0);const e=be(m),i=r(e.getPropertyValue("counter-increment"))||0;i&&a(i,!1);const s=r(e.getPropertyValue("counter-reset"));if(void 0!==s){if(void 0===p&&(b+=s),p=m,n)break;x&&g.push((t||0)+s)}}}if(p){if(!n&&g.length>1){g.reverse(),g.splice(1,1);for(const t of g)d+=pe(h,t,!0)+o[7]}}else b=f;d+=pe(h,b,!0)}else o[9]&&(d+=o[9]);h=!0}h||(d=n)}}if(d||'""'===n){const o=function(t,e="span",i=-1){const n=document.createElement(e);return n.className="__squared.pseudo",n.style.setProperty("display","none"),i>=0&&i<t.childNodes.length?t.insertBefore(n,t.childNodes[i]):t.appendChild(n),n}(t,h,"::before"===e?0:-1);if("img"===h){o.src=d;const t=this.resourceHandler.getImage(d);t&&(void 0===s.width&&t.width>0&&(s.width=me(t.width)),void 0===s.height&&t.height>0&&(s.height=me(t.height)))}else'""'!==n&&(o.innerText=d);for(const t in s)"display"!==t&&(o.style[t]=s[t]);return De(o,"pseudoElement",i,e),De(o,"styleMap",i,s),o}}}}setBaseLayout(t){const{processing:e,session:i}=this,n=e.cache,s=e.node,o=this.session.extensionMap,r=new Map;let a=Ie(this.extensions,t=>!t.eventOnly);function l(t,e,i){const n=r.get(t)||new Map;r.set(t,n.set(e,i))}function c(t){const e=r.get(t.depth);e&&e.delete(t.id)}l(-1,0,s.parent);let h=0;for(const t of n)if(t.length){const e=t.depth;l(e,t.id,t),e>h&&(h=e)}for(let t=0;t<h;t++)r.set(-1*t-2,new Map);n.afterAppend=t=>{c(t),l(-1*t.depth-2,t.id,t);for(const e of t.cascade())c(e),l(-1*e.depth-2,e.id,e)};for(const t of this.extensions)t.beforeBaseLayout();for(const t of r.values())for(const e of t.values()){if(0===e.length)continue;const t=e.floatContainer,i=e.renderExtension,n=e.duplicate(),s=n.length;let r;t&&(r=ce.linearData(e.naturalElements,!0).cleared);for(let e=0;e<s;e++){let l=n[e];if(l.rendered||!l.visible||l.naturalElement&&!l.documentRoot&&this.rootElements.has(l.element))continue;let c=l.parent;if(s>1&&e<s-1&&l.pageFlow&&!l.nodeGroup&&(0===c.alignmentType||c.hasAlign(2)||l.hasAlign(8192))&&!c.hasAlign(4)&&l.hasSection(Mt.DOM_TRAVERSE)){const i=[],o=[];let a=!1;function d(t){return!o.length&&!a&&(i.push(t),!0)}function u(t){return!i.length&&(o.push(t),!0)}let h,f,g=e,p=0;l.hasAlign(8192)&&c.layoutVertical&&(i.push(l),g++,p++);t:{let e,l;for(t&&(e=new Set,l=new Map);g<s;g++,p++){const s=n[g];if(s.pageFlow){if(t){if(e.size){const t=r.get(s);t&&("both"===t?e.clear():e.delete(t),l.set(s,t))}s.floating&&e.add(s.float)}if(0===p){const t=s.siblingsTrailing[0];if(t){!s.horizontalAligned||t.alignedVertically([s])?o.push(s):i.push(s);continue}}const n=s.siblingsLeading[0];if(!n)break t;if(t){const t=s.alignedVertically(i.length?i:o,r,i.length>0);if(t>0){if(i.length){if(7!==t&&6!==t&&e.size&&"both"!==l.get(s)&&!s.siblingsLeading.some(t=>t.lineBreak&&!r.has(t))&&(!s.floating||n.floating&&!Te(s.linear.top,n.linear.bottom))){if(l.has(s)){if(!s.floating){s.addAlign(8192),i.push(s),a=!0;continue}break t}{let t=-1/0;if(s.floating||ke(i,t=>t.floating,e=>t=Math.max(t,e.linear.bottom)),!s.floating&&!Te(s.linear.top,t)||s.floating&&e.has(s.float)){if(i.push(s),!s.floating&&Te(s.linear.bottom,t))break t;continue}}}break t}if(!u(s))break t}else if(!d(s))break t}else if(s.alignedVertically()){if(!u(s))break t}else if(!d(s))break t}else if(s.positionAuto){const t=o.length;if(t>0){o[t-1].blockStatic&&o.push(s);break}i.push(s)}}}i.length>1?(h=this.controllerHandler.processTraverseHorizontal(new ue(c,l,0,0,i),n),f=i[i.length-1]):o.length>1&&(h=this.controllerHandler.processTraverseVertical(new ue(c,l,0,0,o),n),f=o[o.length-1],f.horizontalAligned&&f!==n[s-1]&&f.addAlign(8192)),h&&this.addLayout(h)&&(f===n[s-1]&&c.removeAlign(2),c=l.parent)}if(l.removeAlign(8192),e===s-1&&c.removeAlign(2),l.renderAs&&c.appendTry(l,l.renderAs,!1)&&(l.hide(),l=l.renderAs,l.positioned&&(c=l.parent)),!l.rendered&&l.hasSection(Mt.EXTENSION)){const t=o.get(l.id);let e;if(e=t?i?i.concat(t):t:i,e){let t=!1;for(const i of e){const e=i.processChild(l,c);if(e){const{output:i,renderAs:n,outputAs:s}=e;if(i&&this.addLayoutTemplate(e.outerParent||c,l,i),n&&s&&this.addLayoutTemplate(e.parentAs||c,n,s),c=e.parent||c,t=!0===e.next,e.complete||t)break}}if(t)continue}if(l.styleElement){const e=Xe(l.element,a);let i=!1;function f(t){const e=a.indexOf(t);-1!==e&&(a=a.slice(0),a.splice(e,1))}for(const n of e)if(n.is(l)&&(n.removeIs&&f(n),n.condition(l,c)&&(void 0===t||!t.includes(n)))){const t=n.processNode(l,c);if(t){const{output:e,renderAs:s,outputAs:o,include:r}=t;if(e&&this.addLayoutTemplate(t.outerParent||c,l,e),s&&o&&this.addLayoutTemplate(t.parentAs||c,s,o),c=t.parent||c,(e&&!1!==r||r)&&(void 0===l.renderExtension&&(l.renderExtension=[]),l.renderExtension.push(n),n.subscribers.add(l)),t.remove&&f(n),i=!0===t.next,t.complete||i)break}}if(i)continue}}if(!l.rendered&&l.hasSection(Mt.RENDER)){let t=this.createLayoutControl(c,l);if(0===t.containerType){const e=l.length?this.controllerHandler.processUnknownParent(t):this.controllerHandler.processUnknownChild(t);if(e.next)continue;t=e.layout}this.addLayout(t)}}}for(const e of n)e.documentRoot&&e.renderParent&&i.documentRoot.push({node:e,layoutName:e===s?t:""});n.sort((t,e)=>t.depth===e.depth?t.nodeGroup&&(0===e.length||e.naturalChild)?-1:e.nodeGroup&&(0===t.length||t.naturalChild)?1:0:t.depth<e.depth?-1:1),i.cache.concat(n.children),i.excluded.concat(e.excluded.children);for(const t of this.extensions){for(const e of t.subscribers)n.contains(e)&&t.postBaseLayout(e);t.afterBaseLayout()}}setConstraints(){const t=this._cache;this.controllerHandler.setConstraints();for(const e of this.extensions){for(const i of e.subscribers)t.contains(i)&&e.postConstraints(i);e.afterConstraints()}}setResources(){const t=this.resourceHandler;for(const e of this._cache)t.setBoxStyle(e),t.setFontStyle(e),t.setValueString(e);for(const t of this.extensions)t.afterResources()}processFloatHorizontal(t){const e=this.controllerHandler,{containerType:i,alignmentType:n}=e.containerTypeVertical,s=[],o=[],r=[],a=[],l=[];let c,h,d,u,f=0;if(t.each((e,i)=>{if(i>0){const i=t.cleared.get(e);if(i)switch(i){case"left":Pe(f,2)||(f|=2);break;case"right":Pe(f,4)||(f|=4);break;default:f=6}}const n=e.float;if(0===f)if("right"===n)l.push(e);else if("left"===n)a.push(e);else if(a.length||l.length){let t=e.linear.top;if(e.styleText){const i=e.textBounds;i&&i.top>t&&(t=i.top)}a.some(e=>t>=e.linear.bottom)||l.some(e=>t>=e.linear.bottom)?r.push(e):o.push(e)}else o.push(e);else"right"===n?4===f||6===f?(void 0===h&&(h=[]),h.push(e)):l.push(e):"left"===n?2===f||6===f?(void 0===c&&(c=[]),c.push(e)):a.push(e):6===f?r.push(e):o.push(e)}),a.length&&(d=c?[a,c]:a),l.length&&(u=h?[l,h]:l),l.length+(h?h.length:0)===t.length&&t.add(2048),r.length){const{node:e,parent:s}=t;r.length>1&&r[0].addAlign(8192),r.unshift(e);const o=this.createNode(void 0,!0,s,r);o.containerName=e.containerName,o.inherit(e,"boxStyle"),o.innerWrapped=e,e.outerWrapper=o,this.addLayout(new ue(s,o,i,n|(s.blockStatic?64:0),r)),t.parent=o}o.length&&s.push(o),d&&s.push(d),u&&s.push(u),t.setType(e.containerTypeVerticalMargin),t.itemCount=s.length,t.add(64);for(const r of s){let s,c;if(Array.isArray(r[0])){s=r;const o=t.node;let a=s[0];for(let t=1;t<s.length;t++)a=a.concat(s[t]);if(a.sort((t,e)=>t.childIndex<e.childIndex?-1:1),o.layoutVertical)c=o;else{c=e.createNodeGroup(a[0],a,o);const t=new ue(o,c,i,n|(s.some(t=>t===u||t===l)?2048:0));t.itemCount=s.length,this.addLayout(t)}}else s=[r];for(const r of s){const s=c||t.node,h=e.createNodeGroup(r[0],r,s,!0),d=new ue(s,h,0,128|(r===o?256:0),r);if(1===r.length){const t=d.node;t.innerWrapped=r[0],r[0].outerWrapper=t,r[0].percentWidth?d.setType(e.containerTypePercent):d.setContainerType(i,n)}else d.linearY||d.unknownAligned?d.setContainerType(i,n|(d.unknownAligned?2:0)):e.processLayoutHorizontal(d);this.addLayout(d),r===o&&this.setFloatPadding(s,h,o,a,l)}}return t}processFloatVertical(t){const e=this.controllerHandler,{containerType:i,alignmentType:n}=e.containerTypeVertical;if(0!==t.containerType){const s=t.node,o=e.createNodeGroup(s,[s],t.parent);this.addLayout(new ue(o,s,i,n,o.children)),t.node=o}else t.containerType=i,t.add(n);const s=[],o=[],r=[],a=[];let l=!1,c=!1,h=!0;for(const e of t)e.blockStatic&&0===a.length?(r.push(e),c=!0):(t.cleared.has(e)&&(e.floating?l=!0:(e.modifyBox(2),s.push(r.slice(0)),o.push(a.slice(0)),r.length=0,a.length=0)),e.floating?(c&&(s.push(r.slice(0)),o.push(null),r.length=0,a.length=0,c=!1),a.push(e)):(l&&!t.cleared.has(e)&&(h=!1),r.push(e)));if(a.length&&o.push(a),r.length&&s.push(r),!h)for(let r=0;r<Math.max(o.length,s.length);r++){const a=s[r]||[];if(null===o[r]&&a.length){const i=e.containerTypeVertical;i.alignmentType|=192,this.addLayout(new ue(t.node,e.createNodeGroup(a[0],a,t.node),i.containerType,i.alignmentType,a))}else{const s=o[r]||[];if(a.length||s.length){const o=e.containerTypeVerticalMargin,r=e.createNodeGroup(s[0]||a[0],[],t.node),l=new ue(t.node,r,o.containerType,o.alignmentType),c=[];let h;if(s.length){const t=e.createNodeGroup(s[0],s,r);l.add(512),0===a.length&&s.every(t=>"right"===t.float)&&l.add(2048),c.push(t)}a.length&&(h=e.createNodeGroup(a[0],a,r),c.push(h)),r.init(),l.itemCount=c.length,this.addLayout(l);for(let t of c)t.nodeGroup||(t=e.createNodeGroup(t,[t],r,!0)),this.addLayout(new ue(r,t,i,192|n,t.children));if(a.length&&s.length){const[e,i]=Le(s,t=>"right"!==t.float);this.setFloatPadding(t.node,h,a,e,i)}}}}return t}setFloatPadding(t,e,i,n,s){const o=t=>t.textElement&&(t.blockStatic||t.multiline);if(i.some(t=>o(t)||t.blockStatic&&t.cascadeSome(t=>o(t)))){if(n.length){let s=-1/0,o=0,r=0,a=!1;for(const t of n){const e=t.linear.right+(t.marginLeft<0?t.marginLeft:0);e>s&&(s=e,a=t.marginRight>0)}for(const t of i)t.blockStatic&&(t.bounds.left>s?r++:o=Math.max(o,t.marginLeft));if(r<i.length){const i=s-t.box.left-o;i>0&&e.modifyBox(256,i+(!a&&e.cascadeSome(t=>t.multiline)?this._localSettings.deviations.textMarginBoundarySize:0))}}if(s.length){let n=1/0,o=0,r=0,a=!1;for(const t of s){const e=t.linear.left+(t.marginRight<0?t.marginRight:0);e<n&&(n=e,a=t.marginLeft>0)}for(const t of i)t.blockStatic&&(t.bounds.right<n?r++:o=Math.max(o,t.marginRight));if(r<i.length){const i=t.box.right-n-o;i>0&&e.modifyBox(64,i+(!a&&e.cascadeSome(t=>t.multiline)?this._localSettings.deviations.textMarginBoundarySize:0))}}}}createLayoutControl(t,e){return new ue(t,e,e.containerType,e.alignmentType,e.children)}get layouts(){return this._layouts.sort((t,e)=>{const i=t.index,n=e.index;if(i!==n){if(0===i||n===1/0||void 0===n&&i!==1/0)return-1;if(0===n||i===1/0||void 0===i&&n!==1/0)return 1;if(void 0!==i&&void 0!==n)return i<n?-1:1}return 0})}get rendered(){return this.session.cache.filter(t=>t.visible&&void 0!==t.renderParent)}get length(){return this.session.documentRoot.length}},t.Controller=O,t.ControllerUI=class extends O{constructor(){super(...arguments),this._requireFormat=!1,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}init(){const t=this.localSettings.unsupported;this._unsupportedCascade=t.cascade,this._unsupportedTagName=t.tagName}reset(){this._requireFormat=!1,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}preventNodeCascade(t){return this._unsupportedCascade.has(t.tagName)}applyDefaultStyles(t){const e=this.sessionId;let i;if(Ke(t))i={position:"static",display:"inline",verticalAlign:"baseline",float:"none",clear:"none"};else{i=ii(t,"styleMap",e)||{};const n=()=>{if(void 0===i.border&&function(t){for(let e=0;e<4;e++)if(i[qe[e][t]])return!1;return!0}(0)){const t=this.localSettings.style.inputBorderColor;i.border="outset 1px "+t;for(let e=0;e<4;e++){const n=qe[e];i[n[0]]="outset",i[n[1]]="1px",i[n[2]]=t}return!0}return!1},s=t=>{if(t){const t=i.backgroundColor;void 0!==t&&"initial"!==t||(i.backgroundColor=this.localSettings.style.inputBackgroundColor)}void 0===i.textAlign&&(i.textAlign="center"),void 0!==i.padding||je.some(t=>!!i[t])||(i.paddingTop="2px",i.paddingRight="6px",i.paddingBottom="3px",i.paddingLeft="6px")},o=t.tagName;if(Ve(8))switch(o){case"INPUT":case"SELECT":case"BUTTON":case"TEXTAREA":void 0===i.display&&(i.display="inline-block");break;case"FIELDSET":void 0===i.display&&(i.display="block")}switch(o){case"INPUT":{const e=t.type;switch(e){case"radio":case"checkbox":break;case"week":case"month":case"time":case"date":case"datetime-local":i.paddingTop=Ge(Je(i.paddingTop)+1),i.paddingRight=Ge(Je(i.paddingRight)+1),i.paddingBottom=Ge(Je(i.paddingBottom)+1),i.paddingLeft=Ge(Je(i.paddingLeft)+1);break;case"image":void 0===i.verticalAlign&&(i.verticalAlign="text-bottom");break;default:const t=n();switch(e){case"file":case"reset":case"submit":case"button":s(t)}}break}case"BUTTON":s(n());break;case"TEXTAREA":case"SELECT":n();break;case"BODY":void 0!==i.backgroundColor&&"initial"!==i.backgroundColor||(i.backgroundColor="rgb(255, 255, 255)");break;case"FORM":void 0===i.marginTop&&(i.marginTop="0px");break;case"LI":if(void 0===i.listStyleImage){const e=Ye(t);i.listStyleImage=e.getPropertyValue("list-style-image")}break;case"IFRAME":void 0===i.display&&(i.display="block");case"IMG":const e=(e,n)=>{const s=i[e];if(void 0===s||"auto"===s){const s=RegExp(`\\s+${e}="([^"]+)"`).exec(t.outerHTML);if(s){const t=s[1];$e(t)?i[e]=t+"px":Qe(t)&&(i[e]=t)}else if("IFRAME"===o)"width"===e?i.width="300px":i.height="150px";else{const s=i[n];if(s&&$e(s)){const o="max"+Ze(e);if(void 0===i[o]||!Qe(o)){const o=this.application.resourceHandler.getImage(t.src);o&&o.width>0&&o.height>0&&(i[e]=Ge(o[e]*parseFloat(s)/o[n]))}}}}};e("width","height"),e("height","width")}}ni(t,"styleMap",e,i)}addBeforeOutsideTemplate(t,e,i=!0,n=-1){let s=this._beforeOutside[t];void 0===s&&(s=[],this._beforeOutside[t]=s),-1!==n&&n<s.length?s.splice(n,0,e):s.push(e),i&&(this._requireFormat=!0)}addBeforeInsideTemplate(t,e,i=!0,n=-1){let s=this._beforeInside[t];void 0===s&&(s=[],this._beforeInside[t]=s),-1!==n&&n<s.length?s.splice(n,0,e):s.push(e),i&&(this._requireFormat=!0)}addAfterInsideTemplate(t,e,i=!0,n=-1){let s=this._afterInside[t];void 0===s&&(s=[],this._afterInside[t]=s),-1!==n&&n<s.length?s.splice(n,0,e):s.push(e),i&&(this._requireFormat=!0)}addAfterOutsideTemplate(t,e,i=!0,n=-1){let s=this._afterOutside[t];void 0===s&&(s=[],this._afterOutside[t]=s),-1!==n&&n<s.length?s.splice(n,0,e):s.push(e),i&&(this._requireFormat=!0)}getBeforeOutsideTemplate(t,e){const i=this._beforeOutside[t];return i?oi(i,e):""}getBeforeInsideTemplate(t,e){const i=this._beforeInside[t];return i?oi(i,e):""}getAfterInsideTemplate(t,e){const i=this._afterInside[t];return i?oi(i,e):""}getAfterOutsideTemplate(t,e){const i=this._afterOutside[t];return i?oi(i,e):""}hasAppendProcessing(t){return void 0===t?this._requireFormat:void 0!==this._beforeOutside[t]||void 0!==this._beforeInside[t]||void 0!==this._afterInside[t]||void 0!==this._afterOutside[t]}includeElement(t){return!(this._unsupportedTagName.has(t.tagName)||"INPUT"===t.tagName&&this._unsupportedTagName.has(t.tagName+":"+t.type))||"true"===t.contentEditable}visibleElement(t){const e=ei(t,this.sessionId);if(ri(e)){const i=Ye(t);if(e.width>0&&e.height>0){if("visible"===i.getPropertyValue("visibility"))return!0;const t=i.getPropertyValue("position");return"absolute"!==t&&"fixed"!==t}return"IMG"===t.tagName&&"none"!==i.getPropertyValue("display")||e.width>0&&"none"!==i.getPropertyValue("float")||"none"!==i.getPropertyValue("clear")||"block"===i.getPropertyValue("display")&&(0!==parseInt(i.getPropertyValue("margin-top"))||0!==parseInt(i.getPropertyValue("margin-bottom")))||"__squared.pseudo"===t.className}return!1}evaluateNonStatic(t,e){var i;const n=new Set;for(const s of e)if(!s.documentRoot){const e=s.parent,o=s.absoluteParent;let r;switch(s.css("position")){case"relative":if(s===e.lastChild){const i=e.box;let n=!1;if(s.outsideX(i)){if(!e.hasPX("width")||"hidden"===e.css("overflowX"))continue;n=!0}if(s.outsideY(i)){if(!e.hasHeight&&!e.hasPX("height")||"hidden"===e.css("overflowY"))continue;n=!0}if(n){r=e.actualParent;do{if(s.withinX(r.box)&&s.withinY(r.box)||"hidden"===r.css("overflow"))break;r=r.actualParent}while(r&&r!==t);r&&(s.css("position","absolute",!0),s.setBounds(!1))}}break;case"fixed":if(!s.positionAuto){r=t;break}case"absolute":if(o)if(r=o,s.positionAuto)s.siblingsLeading.some(t=>t.multiline||t.excluded&&!t.blockStatic)?s.positionAuto=!1:s.cssApply({display:"inline-block",verticalAlign:"top"},!0),r=e;else if(this.userSettings.supportNegativeLeftTop){const e=r.box;let i=!1;for(;r&&r!==t;){if(i){if(r.layoutElement){r=o;break}if(s.withinX(e)&&s.withinY(e))break}else{const t="hidden"===r.css("overflowX"),n="hidden"===r.css("overflowY");if(t&&n||0===parseFloat(s.cssInitial("top"))||0===parseFloat(s.cssInitial("right"))||0===parseFloat(s.cssInitial("bottom"))||0===parseFloat(s.cssInitial("left")))break;{const o=!t&&s.outsideX(e),a=!n&&s.outsideY(e);if(!n&&s.linear.top<Math.floor(e.top)&&(s.top<0||s.marginTop<0))i=!0;else if(o&&!s.hasPX("left")&&s.right>0||a&&!s.hasPX("top")&&0!==s.bottom)i=!0;else if(o&&a&&(!r.pageFlow||r.actualParent.documentBody)&&(s.top>0||s.left>0))i=!0;else if(!t&&s.outsideX(r.linear)&&!s.pseudoElement&&(s.left<0||s.marginLeft<0||!s.hasPX("left")&&s.right<0&&s.linear.left>=r.linear.right))i=!0;else{if(t||n||s.intersectX(e)||s.intersectY(e))break;i=!0}}}r=r.actualParent}}}if(void 0===r&&(r=s.pageFlow?e:t),r!==e){if((null===(i=o)||void 0===i?void 0:i.positionRelative)&&r!==o){const{left:t,right:e,top:i,bottom:n}=o,r=s.bounds;0!==t?(r.left+=t,r.right+=t):o.hasPX("left")||0===e||(r.left-=e,r.right-=e),0!==i?(r.top+=i,r.bottom+=i):o.hasPX("top")||0===n||(r.top-=n,r.bottom-=n),s.unset("box"),s.unset("linear")}let t=s.toFloat("opacity",!1,1),a=e;for(;a&&a!==r;)t*=a.toFloat("opacity",!1,1),a=a.actualParent;s.css("opacity",""+t),s.parent=r,s.containerIndex=1/0,n.add(r)}s.documentParent=r}for(const t of n){const e=[];let i=-1;t.each(n=>{if(n.containerIndex===1/0)for(const i of t.children){let t=i.naturalElements.includes(n);if(!t){const e=i.cascade();t=n.ascend(t=>e.includes(t)).length>0}if(t){const t=i.containerIndex+(n.zIndex>=0||i!==n.actualParent?1:0);void 0===e[t]&&(e[t]=[]),e[t].push(n);break}}else n.containerIndex>i&&(i=n.containerIndex)});const n=e.length;if(n>0){const s=t.children;for(let t=0,o=0,r=1;t<n;t++,o++){const n=e[t];if(n){n.sort((t,e)=>t.parent===e.parent?t.zIndex===e.zIndex?t.id<e.id?-1:1:t.zIndex<e.zIndex?-1:1:0);for(const t of n)t.containerIndex=i+r++;for(let t=0;t<s.length;t++)n.includes(s[t])&&(s[t]=void 0);s.splice(o,0,...n),o+=n.length}}t.retain(ti(s))}}}sortInitialCache(t){t.sort((t,e)=>{if(t.depth!==e.depth)return t.depth<e.depth?-1:1;{const i=t.documentParent,n=e.documentParent;if(i!==n)return i.depth!=i.depth?i.depth<i.depth?-1:1:i.actualParent===n.actualParent?i.childIndex<n.childIndex?-1:1:i.id<n.id?-1:1}return 0})}cascadeDocument(t,e){const i=e>0?"\t".repeat(e):"",n=this.userSettings.showAttributes;let s="";for(const o of t)if(o){const t=o.node;switch(o.type){case 1:{const{controlName:r,attributes:a}=o,{id:l,renderTemplates:c}=t,h=e+1,d=this.getBeforeInsideTemplate(l,h),u=this.getAfterInsideTemplate(l,h);let f=i+`<${r+(0===e?"{#0}":"")+(n?a?si(a,h):t.extractAttributes(h):"")}`;f+=c||""!==d||""!==u?">\n"+d+(c?this.cascadeDocument(this.sortRenderPosition(t,c),h):"")+u+i+`</${r}>\n`:" />\n",s+=this.getBeforeOutsideTemplate(l,e)+f+this.getAfterOutsideTemplate(l,e);break}case 2:{const t=o.content;t&&(s+=si(t,e));break}}}return s}getEnclosingXmlTag(t,e,i){return"<"+t+(e||"")+(i?">\n"+i+"</"+t+">\n":" />\n")}get generateSessionId(){return""+(new Date).getTime()}},t.Extension=D,t.ExtensionManager=class{constructor(t){this.application=t}include(t){const e=this.application,i=e.extensions,n=i.findIndex(e=>e.name===t.name);if(-1!==n)return i[n]=t,!0;{const n=t.framework;if(n>0)for(const i of t.dependencies)if(i.preload&&null===this.retrieve(i.name)){const t=e.builtInExtensions[i.name];t&&this.include(t)}if((0===n||H(n,e.framework))&&t.dependencies.every(t=>!!this.retrieve(t.name)))return t.application=e,i.push(t),!0}return!1}exclude(t){const e=this.application.extensions;for(let i=0;i<e.length;i++)if(e[i]===t)return e.splice(i,1),!0;return!1}retrieve(t){for(const e of this.application.extensions)if(e.name===t)return e;return null}optionValue(t,e){var i;const n=null===(i=this.retrieve(t))||void 0===i?void 0:i.options;if(z(n))return n[e]}optionValueAsObject(t,e){const i=this.optionValue(t,e);return"object"==typeof i?i:null}optionValueAsString(t,e){const i=this.optionValue(t,e);return"string"==typeof i?i:""}optionValueAsNumber(t,e){const i=this.optionValue(t,e);return"number"==typeof i?i:0}optionValueAsBoolean(t,e){const i=this.optionValue(t,e);return"boolean"==typeof i&&i}},t.ExtensionUI=hi,t.File=V,t.FileUI=class extends V{get directory(){return this.resource.controllerSettings.directory}},t.LayoutUI=ue,t.Node=Pt,t.NodeGroupUI=class extends ce{init(){var t;if(this.length){for(const t of this.children)t.parent=this;this.setBounds(),this.saveAsInitial(),this.dir=(null===(t=this.actualParent)||void 0===t?void 0:t.dir)||""}}setBounds(){this.length&&(this._bounds=ce.outerRegion(this))}previousSiblings(t){const e=(this._initial.children||this.children)[0];return e?e.previousSiblings(t):[]}nextSiblings(t){const e=this._initial.children||this.children,i=e[e.length-1];return i?i.nextSiblings(t):[]}get block(){return void 0===this._cached.block&&(this._cached.block=this.some(t=>t.block)),this._cached.block}get blockStatic(){if(void 0===this._cached.blockStatic){const t=this.documentParent,e=this.naturalChildren.length>0&&this.naturalChildren[0].blockStatic||this.actualWidth===t.actualWidth&&!this.some(t=>t.plainText||t.naturalElement&&t.rightAligned)||this.layoutVertical&&this.some(t=>t.blockStatic||t.rightAligned)||t.blockStatic&&(t.layoutVertical||this.hasAlign(256));(e||0!==this.containerType)&&(this._cached.blockStatic=e)}return this._cached.blockStatic||this.hasAlign(64)}get blockDimension(){return void 0===this._cached.blockDimension&&(this._cached.blockDimension=this.some(t=>t.blockDimension)),this._cached.blockDimension}get inline(){return void 0===this._cached.inline&&(this._cached.inline=this.every(t=>t.inline)),this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.every(t=>t.inlineStatic)),this._cached.inlineStatic}get inlineVertical(){return void 0===this._cached.inlineVertical&&(this._cached.inlineVertical=this.every(t=>t.inlineVertical)),this._cached.inlineVertical}get inlineFlow(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inlineStatic||this.hasAlign(128)),this._cached.inlineStatic}get pageFlow(){if(void 0===this._cached.pageFlow){const t=this.css("position");this._cached.pageFlow="absolute"!==t&&"fixed"!==t}return this._cached.pageFlow}set baseline(t){this._cached.baseline=t}get baseline(){if(void 0===this._cached.baseline){const t=this.cssInitial("verticalAlign",!0);this._cached.baseline=""!==t?"baseline"===t:this.layoutHorizontal&&this.every(t=>t.baseline)}return this._cached.baseline}get float(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.hasAlign(2048)?"right":"left":"none"),this._cached.float}get floating(){return void 0===this._cached.floating&&(this._cached.floating=this.every(t=>t.floating)),this._cached.floating}get display(){return super.display||this.some(t=>t.blockStatic)?"block":this.blockDimension?"inline-block":"inline"}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}get tagName(){return""}get plainText(){return!1}get styleText(){return!1}get multiline(){return!1}get nodeGroup(){return!0}get naturalChild(){return!1}get naturalElement(){return!1}get pseudoElement(){return!1}get previousSibling(){return null}get nextSibling(){return null}get previousElementSibling(){return null}get nextElementSibling(){return null}},t.NodeList=e,t.NodeUI=ce,t.Resource=a,t.ResourceUI=Ji,t.extensions=vs,t.lib=ys,Object.defineProperty(t,"__esModule",{value:!0})}));
