!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e=e||self).squared=e.squared||{},e.squared.base={}))}(this,(function(e){"use strict";class t extends squared.lib.base.Container{constructor(e){super(e),this._currentId=0}append(e,t=!0){return super.append(e),t&&this.afterAppend&&this.afterAppend.call(this,e),this}reset(){return this._currentId=0,this.clear(),this}get nextId(){return++this._currentId}}const{regex:i,util:n}=squared.lib;class s{reset(){for(const e in s.ASSETS)s.ASSETS[e].clear();this.fileHandler&&this.fileHandler.reset()}addImage(e){if(e&&e.complete){if(e.src.startsWith("data:image/")){const t=RegExp(`^${i.STRING.DATAURI}$`).exec(e.src);t&&t[1]&&t[2]&&this.addRawData(e.src,t[1],t[2],t[3],e.naturalWidth,e.naturalHeight)}const t=e.src;""!==t&&s.ASSETS.images.set(t,{width:e.naturalWidth,height:e.naturalHeight,uri:t})}}getImage(e){return s.ASSETS.images.get(e)}addFont(e){const t=s.ASSETS.fonts,i=t.get(e.fontFamily)||[];i.push(e),t.set(e.fontFamily,i)}getFont(e,t="normal",i){const n=s.ASSETS.fonts.get(e);if(n){const e=this.controllerSettings.supported.fontFormat;return n.find(n=>n.fontStyle===t&&(void 0===i||n.fontWeight===parseInt(i))&&("*"===e||e.includes(n.srcFormat)))}}addRawData(e,t,i,o,r=0,a=0){t=t.toLowerCase(),i=i.toLowerCase();const l=this.controllerSettings.supported.imageFormat;let c;"base64"===i?(c=o,"image/svg+xml"===t&&(o=window.atob(o))):o=o.replace(/\\(["'])/g,(e,...t)=>t[0]);const h=()=>n.buildAlphaString(5).toLowerCase()+"_"+(new Date).getTime(),d=e.startsWith(location.origin)?e.substring(location.origin.length+1,e.lastIndexOf("/")):"";let u;if("*"===l)if(e.startsWith(location.origin))u=n.fromLastIndexOf(e,"/");else{let e=t.split("/").pop();"svg+xml"===e&&(e="svg"),u=h()+"."+e}else for(const i of l)if(-1!==t.indexOf(i)){u=e.endsWith("."+i)?n.fromLastIndexOf(e,"/"):h()+"."+i;break}return u?(s.ASSETS.rawData.set(e,{pathname:d,filename:u,content:o,base64:c,mimeType:t,width:r,height:a}),u):""}getRawData(e){if(e.startsWith("url(")){const t=i.CSS.URL.exec(e);t&&(e=t[1])}return s.ASSETS.rawData.get(e)}setFileHandler(e){e.resource=this,this.fileHandler=e}}s.ASSETS={ids:new Map,images:new Map,fonts:new Map,rawData:new Map};var o=function(e,t,i,n){return new(i||(i=Promise))((function(s,o){function r(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};const{css:r,dom:a,regex:l,session:c,util:h}=squared.lib,d=s.ASSETS,u=/all|screen/,f=RegExp(`(url\\("(${l.STRING.DATAURI})"\\)),?\\s*`,"g");let g,p,m,b,x,y,v,S;function _(e,t){const i=RegExp(`^@${e}([^{]+)`).exec(t);return i?i[1].trim():t}class E{constructor(e,i,n,s,o){this.framework=e,this.initializing=!1,this.closed=!1,this.rootElements=new Set,this.session={active:[]},this.processing={cache:new t,excluded:new t,sessionId:""},this._cascadeAll=!1,S=i;const r=this.processing.cache;this.controllerHandler=new n(this,r),this.resourceHandler=new s(this,r),this.extensionManager=new o(this,r)}copyToDisk(e,t,i){const n=this.resourceHandler.fileHandler;n&&n.copyToDisk(e,i,t)}appendToArchive(e,t){const i=this.resourceHandler.fileHandler;i&&i.appendToArchive(e,t)}saveToArchive(e,t){const i=this.resourceHandler.fileHandler;i&&i.saveToArchive(e||this.userSettings.outputArchiveName,t)}reset(){this.session.active.length=0;const e=this.processing;e.cache.reset(),e.excluded.clear(),e.sessionId="",this.controllerHandler.reset();for(const e of this.extensions)e.subscribers.clear();this.closed=!1}parseDocument(...e){const t=this.controllerHandler,i=this.resourceHandler;let n;this.rootElements.clear(),this.initializing=!1;const s=t.generateSessionId;this.processing.sessionId=s,t.sessionId=s,this.session.active.push(s),t.init(),this.setStyleMap(),0===e.length&&e.push(document.body);for(const t of e){let e;if("string"==typeof t)e=document.getElementById(t);else{if(!r.hasComputedStyle(t))continue;e=t}e&&this.rootElements.add(e)}const a=this.rootElements.values().next().value,l=[],c=()=>{this.initializing=!1;for(const e of l)e.parentElement&&a.removeChild(e);l.length=0;for(const e of this.extensions)e.beforeParseDocument();for(const e of this.rootElements)this.createCache(e)&&this.afterCreateCache(e);for(const e of this.extensions)e.afterParseDocument();"function"==typeof n&&n.call(this)},u=this.userSettings.preloadImages,f=[];if(u){for(const e of this.rootElements)e.querySelectorAll("input[type=image]").forEach(e=>{const{width:t,height:i,src:n}=e;""!==n&&d.images.set(n,{width:t,height:i,uri:n})});for(const e of d.images.values()){const t=e.uri;if(t)if(t.toLowerCase().endsWith(".svg"))f.push(t);else if(0===e.width&&0===e.height){const i=document.createElement("img");i.src=t;const n=i.naturalWidth,s=i.naturalHeight;n>0&&s>0?(e.width=n,e.height=s):(a.appendChild(i),l.push(i))}}}for(const[e,t]of d.rawData.entries())if(t.mimeType&&t.mimeType.startsWith("image/")&&!t.mimeType.endsWith("svg+xml")){const i=document.createElement("img");i.src="data:"+t.mimeType+";"+(t.base64?"base64,"+t.base64:t.content);const n=i.naturalWidth,s=i.naturalHeight;n>0&&s>0?(t.width=n,t.height=s,d.images.set(e,{width:n,height:s,uri:t.filename})):(document.body.appendChild(i),l.push(i))}for(const e of this.rootElements)e.querySelectorAll("img").forEach(e=>{e.src.toLowerCase().endsWith(".svg")?u&&f.push(e.src):e.complete?i.addImage(e):u&&f.push(e)});f.length?(this.initializing=!0,Promise.all(h.objectMap(f,e=>new Promise((t,i)=>{"string"==typeof e?t(function(e){return o(this,void 0,void 0,(function*(){return(yield fetch(e,{method:"GET",headers:new Headers({Accept:"application/xhtml+xml, image/svg+xml","Content-Type":"image/svg+xml"})})).text()}))}(e)):(e.addEventListener("load",()=>t(e)),e.addEventListener("error",()=>i(e)))}))).then(e=>{const t=e.length;for(let n=0;n<t;n++){const t=e[n];if("string"==typeof t){const e=f[n];"string"==typeof e&&i.addRawData(e,"image/svg+xml","utf8",t)}else i.addImage(t)}c()}).catch(e=>{const t=e.target?e.target.src:e.message;this.userSettings.showErrorMessages&&h.isString(t)&&!confirm("FAIL: "+t)||c()})):c();return new class{then(e){f.length?n=e:e()}}}createCache(e){const t=this.createRootNode(e);if(t){const e=this.processing.cache;t.parent.setBounds();for(const t of e)t.setBounds(),t.saveAsInitial();return this.controllerHandler.sortInitialCache(e),!0}return!1}createNode(e,t=!0,i,n){const s=new S(this.nextId,this.processing.sessionId,e,this.controllerHandler.afterInsertNode);if(i&&(s.depth=i.depth+1),n)for(const e of n)e.parent=s;return t&&this.processing.cache.append(s,void 0!==n),s}toString(){return""}createRootNode(e){const t=this.processing;t.cache.clear(),t.excluded.clear(),this._cascadeAll=!1;const i=this.cascadeParentNode(e);if(i){const n=new S(0,t.sessionId,e.parentElement||document.body,this.controllerHandler.afterInsertNode);i.parent=n,i.actualParent=n,i.childIndex=0,i.documentRoot=!0}return t.node=i,t.cache.afterAppend=void 0,i}cascadeParentNode(e,t=0){const i=this.insertNode(e);if(i){const n=this.controllerHandler,s=this.processing,o=s.cache;if(i.depth=t,0===t&&o.append(i),n.preventNodeCascade(e))return i;const r=e.childNodes,l=r.length,c=Array(l),h=Array(e.childElementCount);let d=!0,u=0,f=0;for(let e=0;e<l;e++){const l=r[e];let g;"#"===l.nodeName.charAt(0)?a.isTextNode(l)&&(g=this.insertNode(l,i)):n.includeElement(l)?(g=this.cascadeParentNode(l,t+1))&&(h[f++]=g,o.append(g),d=!1):(g=this.insertNode(l))&&(s.excluded.append(g),d=!1),g&&(g.parent=i,g.actualParent=i,g.childIndex=u,c[u++]=g)}c.length=u,h.length=f,i.naturalChildren=c,i.naturalElements=h,i.inlineText=d,this.userSettings.createQuerySelectorMap&&f>0&&(i.queryMap=this.createQueryMap(h,f))}return i}createQueryMap(e,t){const i=[e];for(let n=0;n<t;n++){const t=e[n].queryMap;if(t){const e=t.length;for(let n=0;n<e;n++){const e=n+1,s=i[e];i[e]=s?s.concat(t[n]):t[n]}}}return i}setStyleMap(){let e=!1;const t=i=>{try{const e=i.cssRules;if(e){const i=e.length;for(let n=0;n<i;n++){const i=e[n];switch(i.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(i);break;case CSSRule.IMPORT_RULE:t(i.styleSheet);break;case CSSRule.MEDIA_RULE:r.validMediaRule(i.conditionText||_("media",i.cssText))&&this.applyCSSRuleList(i.cssRules);break;case CSSRule.SUPPORTS_RULE:CSS.supports&&CSS.supports(i.conditionText||_("supports",i.cssText))&&this.applyCSSRuleList(i.cssRules)}}}}catch(t){this.userSettings.showErrorMessages&&!e&&(alert("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+i.href+"\n\n"+t),e=!0)}},i=document.styleSheets,n=i.length;for(let e=0;e<n;e++){const n=i[e],s=n.media.mediaText;(""===s||u.test(s))&&t(n)}}applyCSSRuleList(e){const t=e.length;for(let i=0;i<t;i++)this.applyStyleRule(e[i])}applyStyleRule(e){const t=this.resourceHandler,i=this.processing.sessionId,n=e.parentStyleSheet&&e.parentStyleSheet.href||void 0,s=e.cssText;switch(e.type){case CSSRule.STYLE_RULE:{const o=e.style,a=[],l={},u=(e,i)=>{const s=e[i];if(s&&"initial"!==s){f.lastIndex=0;let o,r=s;for(;null!==(o=f.exec(s));)if(o[3]&&o[4])t.addRawData(o[2],o[3],o[4],o[5]);else if(this.userSettings.preloadImages){const e=h.resolvePath(o[5],n);""!==e&&(void 0===t.getImage(e)&&d.images.set(e,{width:0,height:0,uri:e}),r=r.replace(o[1],`url("${e}")`))}e[i]=r}};for(const e of Array.from(o))a.push(h.convertCamelCase(e));if(-1!==s.indexOf("!important")){let e;for(g?g.lastIndex=0:g=/\s*([a-z\-]+):.*?!important;/g;null!==(e=g.exec(s));){const t=h.convertCamelCase(e[1]);switch(t){case"margin":l.marginTop=!0,l.marginRight=!0,l.marginBottom=!0,l.marginLeft=!0;break;case"padding":l.paddingTop=!0,l.paddingRight=!0,l.paddingBottom=!0,l.paddingLeft=!0;break;case"background":l.backgroundColor=!0,l.backgroundImage=!0,l.backgroundSize=!0,l.backgroundRepeat=!0,l.backgroundPositionX=!0,l.backgroundPositionY=!0;break;case"backgroundPosition":l.backgroundPositionX=!0,l.backgroundPositionY=!0;break;case"border":l.borderTopStyle=!0,l.borderRightStyle=!0,l.borderBottomStyle=!0,l.borderLeftStyle=!0,l.borderTopWidth=!0,l.borderRightWidth=!0,l.borderBottomWidth=!0,l.borderLeftWidth=!0,l.borderTopColor=!0,l.borderRightColor=!0,l.borderBottomColor=!0,l.borderLeftColor=!0;break;case"borderStyle":l.borderTopStyle=!0,l.borderRightStyle=!0,l.borderBottomStyle=!0,l.borderLeftStyle=!0;break;case"borderWidth":l.borderTopWidth=!0,l.borderRightWidth=!0,l.borderBottomWidth=!0,l.borderLeftWidth=!0;break;case"borderColor":l.borderTopColor=!0,l.borderRightColor=!0,l.borderBottomColor=!0,l.borderLeftColor=!0;break;case"font":l.fontFamily=!0,l.fontStyle=!0,l.fontSize=!0,l.fontWeight=!0,l.lineHeight=!0}l[t]=!0}}for(const t of r.parseSelectorText(e.selectorText)){const e=r.getSpecificity(t),[n,s]=t.split("::"),h=s?"::"+s:"";document.querySelectorAll(n||"*").forEach(t=>{const n=r.getStyle(t,h),s={};for(const e of a){const i=r.checkStyleValue(t,e,o[e],n);i&&(s[e]=i)}u(s,"backgroundImage"),u(s,"listStyleImage"),u(s,"content");const d="styleMap"+h,f="styleSpecificity"+h,g=c.getElementCache(t,d,i);if(g){const n=c.getElementCache(t,f,i)||{};for(const t in s){const i=s[t],r=e+(l[t]?1e3:0);if(void 0===n[t]||r>=n[t]){if(n[t]=r,"initial"===i&&o.background&&t.startsWith("background"))continue;g[t]=i}}}else{const o={};for(const t in s)o[t]=e+(l[t]?1e3:0);c.setElementCache(t,"style"+h,"0",n),c.setElementCache(t,"sessionId","0",i),c.setElementCache(t,d,i,s),c.setElementCache(t,f,i,o)}})}break}case CSSRule.FONT_FACE_RULE:{void 0===p&&(p=/\s*@font-face\s*{([^}]+)}\s*/,m=/\s*font-family:[^\w]*([^'";]+)/,b=/\s*src:\s*([^;]+);/,x=/\s*font-style:\s*(\w+)\s*;/,y=/\s*font-weight:\s*(\d+)\s*;/,v=/\s*(url|local)\((?:['"]([^'")]+)['"]|([^)]+))\)\s*format\(['"]?(\w+)['"]?\)\s*/);const e=p.exec(s);if(e){const i=m.exec(e[1]),s=b.exec(e[1]);if(i&&s){const o=x.exec(e[1]),r=y.exec(e[1]),a=i[1].trim(),c=o?o[1].toLowerCase():"normal",d=r?parseInt(r[1]):400;for(const e of s[1].split(l.XML.SEPARATOR)){const i=v.exec(e);if(i){let e,s;const o=(i[2]||i[3]).trim();"url"===i[1]?e=h.resolvePath(o,n):s=o,t.addFont({fontFamily:a,fontWeight:d,fontStyle:c,srcUrl:e,srcLocal:s,srcFormat:i[4].toLowerCase().trim()})}}}}break}}}get nextId(){return this.processing.cache.nextId}get length(){return 0}}class T{preventNodeCascade(e){return!1}get generateSessionId(){return""+(new Date).getTime()}}class w{constructor(e,t,i){this.name=e,this.framework=t,this.options={},this.dependencies=[],this.subscribers=new Set,i&&Object.assign(this.options,i)}require(e,t=!1){this.dependencies.push({name:e,preload:t})}beforeParseDocument(){}afterParseDocument(){}set application(e){this._application=e,this.controller=e.controllerHandler}get application(){return this._application}}const k=squared.lib.util;const A=squared.lib.util;class R{constructor(){this.assets=[]}static getMimeType(e){switch(e.toLowerCase()){case"aac":return"audio/aac";case"abw":return"application/x-abiword";case"arc":return"application/x-freearc";case"avi":return"video/x-msvideo";case"azw":return"application/vnd.amazon.ebook";case"bin":return"application/octet-stream";case"bmp":return"image/bmp";case"bz":return"application/x-bzip";case"bz2":return"application/x-bzip2";case"csh":return"application/x-csh";case"css":return"text/css";case"csv":return"text/csv";case"doc":return"application/msword";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"eot":return"application/vnd.ms-fontobject";case"epub":return"application/epub+zip";case"gif":return"image/gif";case"htm":case"html":return"text/html";case"ico":return"image/vnd.microsoft.icon";case"ics":return"text/calendar";case"jar":return"application/java-archive";case"jpeg":case"jpg":return"image/jpeg";case"js":case"mjs":return"text/javascript";case"json":return"application/json";case"jsonld":return"application/ld+json";case"mid":case"midi":return"audio/midi";case"mp3":return"audio/mpeg";case"mpeg":return"video/mpeg";case"mpkg":return"application/vnd.apple.installer+xml";case"odp":return"application/vnd.oasis.opendocument.presentation";case"ods":return"application/vnd.oasis.opendocument.spreadsheet";case"odt":return"application/vnd.oasis.opendocument.text";case"oga":return"audio/ogg";case"ogv":return"video/ogg";case"ogx":return"application/ogg";case"otf":return"font/otf";case"png":return"image/png";case"pdf":return"application/pdf";case"ppt":return"application/vnd.ms-powerpoint";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"rar":return"application/x-rar-compressed";case"rtf":return"application/rtf";case"sh":return"application/x-sh";case"svg":return"image/svg+xml";case"swf":return"application/x-shockwave-flash";case"tar":return"application/x-tar";case"tif":case"tiff":return"image/tiff";case"ts":return"video/mp2t";case"ttf":return"font/ttf";case"txt":return"text/plain";case"vsd":return"application/vnd.visio";case"wav":return"audio/wav";case"weba":return"audio/webm";case"webm":return"video/webm";case"webp":return"image/webp";case"woff":return"font/woff";case"woff2":return"font/woff2";case"xhtml":return"application/xhtml+xml";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xml":return"text/xml";case"xul":return"application/vnd.mozilla.xul+xml";case"zip":return"application/zip";case"3gp":return"video/3gpp";case".3g2":return"video/3gpp2";case".7z":return"application/x-7z-compressed";default:return""}}static downloadFile(e,t,i){const n=new Blob([e],{type:i||"application/octet-stream"}),s=window.URL.createObjectURL(n),o=document.createElement("a");o.style.setProperty("display","none"),o.setAttribute("href",s),o.setAttribute("download",t),o.download||o.setAttribute("target","_blank");const r=document.body;r.appendChild(o),o.click(),r.removeChild(o),setTimeout(()=>window.URL.revokeObjectURL(s),1)}addAsset(e){if(e.content||e.uri||e.base64){const t=this.assets.findIndex(t=>t.pathname===e.pathname&&t.filename===e.filename);-1!==t?Object.assign(this.assets[t],e):this.assets.push(e)}}reset(){this.assets.length=0}copying(e,t,i){if(location.protocol.startsWith("http")){if((t=t.concat(this.assets)).length){const n=this.userSettings;fetch("/api/assets/copy?to="+encodeURIComponent(e.trim())+"&directory="+encodeURIComponent(A.trimString(n.outputDirectory,"/"))+"&timeout="+n.outputArchiveTimeout,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{e&&("function"==typeof i&&i(e),e.system&&this.userSettings.showErrorMessages&&alert(e.application+"\n\n"+e.system))}).catch(e=>{this.userSettings.showErrorMessages&&alert("ERROR: "+e)})}}else this.userSettings.showErrorMessages&&alert("SERVER (required): See README for instructions")}archiving(e,t,i){if(location.protocol.startsWith("http")){if((t=t.concat(this.assets)).length){const n=this.userSettings;fetch("/api/assets/archive?filename="+encodeURIComponent(e.trim())+"&directory="+encodeURIComponent(A.trimString(n.outputDirectory,"/"))+"&format="+n.outputArchiveFormat+(i?"&append_to="+encodeURIComponent(i.trim()):"")+"&timeout="+n.outputArchiveTimeout,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{if(e){const t=e.zipname;t?fetch("/api/browser/download?filename="+encodeURIComponent(t)).then(e=>e.blob()).then(e=>R.downloadFile(e,A.fromLastIndexOf(t,"/"))):e.system&&this.userSettings.showErrorMessages&&alert(e.application+"\n\n"+e.system)}}).catch(e=>{this.userSettings.showErrorMessages&&alert("ERROR: "+e)})}}else this.userSettings.showErrorMessages&&alert("SERVER (required): See README for instructions")}}const{css:C,dom:I,regex:B,session:P,util:L}=squared.lib,N={BACKGROUND:/\s*(url\(.+?\))\s*/,NTH_CHILD_OFTYPE:/^:nth(-last)?-(child|of-type)\((.+)\)$/,NTH_CHILD_OFTYPE_VALUE:/^(-)?(\d+)?n\s*([+\-]\d+)?$/,LANG:/^:lang\(\s*(.+)\s*\)$/};function M(e){let t=e.parentElement;for(;t;){if("FORM"===t.tagName)return t;t=t.parentElement}return null}const O=(e,t)=>e===t||C.isLength(e,!0)&&t.endsWith("px");class W extends squared.lib.base.Container{constructor(e,t="0",i){super(),this.id=e,this.sessionId=t,this.documentRoot=!1,this.depth=-1,this.childIndex=1/0,this._fontSize=0,this._element=null,this._initial={iteration:-1,children:[],styleMap:{}},this._data={},this._inlineText=!1,i?this._element=i:(this.style={},this._styleMap={})}static getPseudoElt(e){return e.pseudoElement?P.getElementCache(e.element,"pseudoElement",e.sessionId):""}init(){const e=this._element;if(e){const t=this.sessionId;if("0"!==t&&P.setElementCache(e,"node",t,this),this.style=this.pseudoElement?C.getStyle(e.parentElement,W.getPseudoElt(this)):C.getStyle(e),this._styleMap=P.getElementCache(e,"styleMap",t)||{},this.styleElement&&!this.pseudoElement&&"0"!==t)for(let t of Array.from(e.style)){let i=e.style.getPropertyValue(t);t=L.convertCamelCase(t),""!==(i=C.checkStyleValue(e,t,i,this.style))&&(this._styleMap[t]=i)}}}saveAsInitial(e=!1){const t=this._initial;(-1===t.iteration||e)&&(t.children=this.duplicate(),t.styleMap=Object.assign({},this._styleMap));const i=this._bounds;i&&(t.bounds=I.assignRect(i),t.linear=I.assignRect(this.linear),t.box=I.assignRect(this.box)),t.iteration++}data(e,t,i,n=!0){const s=this._data;return L.hasValue(i)?("object"!=typeof s[e]&&(s[e]={}),(n||void 0===s[e][t])&&(s[e][t]=i)):null===i&&delete this._data[e],"object"==typeof s[e]&&null!==s[e]?s[e][t]:void 0}unsetCache(...e){if(e.length){const t=this._cached;for(const i of e){switch(i){case"position":return void(this._cached={});case"width":t.actualWidth=void 0,t.percentWidth=void 0;case"minWidth":t.width=void 0;break;case"height":t.actualHeight=void 0,t.percentHeight=void 0;case"minHeight":t.height=void 0;break;case"verticalAlign":t.baseline=void 0;break;case"display":t.block=void 0,t.blockDimension=void 0,t.blockStatic=void 0,t.inline=void 0,t.inlineVertical=void 0,t.inlineFlow=void 0,t.autoMargin=void 0,t.flexElement=void 0,t.gridElement=void 0,t.tableElement=void 0,t.layoutElement=void 0;break;case"backgroundColor":case"backgroundImage":t.visibleStyle=void 0;break;case"pageFlow":t.positionAuto=void 0,t.blockStatic=void 0,t.baseline=void 0,t.floating=void 0,t.autoMargin=void 0,t.rightAligned=void 0,t.bottomAligned=void 0;break;case"float":t.floating=void 0;break;default:i.startsWith("margin")&&(t.autoMargin=void 0),(i.startsWith("padding")||i.startsWith("border"))&&(t.contentBoxWidth=void 0,t.contentBoxHeight=void 0)}t[i]=void 0}}else this._cached={},this._textStyle=void 0}ascend(e,t,i="actualParent"){const n=[];let s=this[i];for(;s&&0!==s.id;){if(e){if(e(s))return[s]}else n.push(s);if(s===t)break;s=s[i]}return n}intersectX(e,t="linear"){const i=this[t];return L.aboveRange(e.left,i.left)&&Math.ceil(e.left)<i.right||e.right>Math.ceil(i.left)&&L.belowRange(e.right,i.right)||L.aboveRange(i.left,e.left)&&L.belowRange(i.right,e.right)||L.aboveRange(e.left,i.left)&&L.belowRange(e.right,i.right)}intersectY(e,t="linear"){const i=this[t];return L.aboveRange(e.top,i.top)&&Math.ceil(e.top)<i.bottom||e.bottom>Math.ceil(i.top)&&L.belowRange(e.bottom,i.bottom)||L.aboveRange(i.top,e.top)&&L.belowRange(i.bottom,e.bottom)||L.aboveRange(e.top,i.top)&&L.belowRange(e.bottom,i.bottom)}withinX(e,t="linear"){const i=this[t];return L.aboveRange(i.left,e.left)&&L.belowRange(i.right,e.right)}withinY(e,t="linear"){const i=this[t];return L.aboveRange(i.top,e.top)&&L.belowRange(i.bottom,e.bottom)}outsideX(e,t="linear"){const i=this[t];return i.left<Math.floor(e.left)||Math.floor(i.right)>e.right}outsideY(e,t="linear"){const i=this[t];return i.top<Math.floor(e.top)||Math.floor(i.bottom)>e.bottom}css(e,t,i=!0){return t&&this.styleElement&&(this.style[e]=t,O(t,this.style[e]))?(this._styleMap[e]=t,i&&this.unsetCache(e),t):this._styleMap[e]||this.styleElement&&this.style[e]||""}cssApply(e,t=!0){for(const i in e){const n=e[i];this.css(i,n,t)===n&&t&&this.unsetCache(i)}return this}cssInitial(e,t=!1,i=!1){-1!==this._initial.iteration||t||(i=!0);let n=(t?this._styleMap:this._initial.styleMap)[e];return i&&!n&&(n=this.style[e]),n||""}cssAny(e,...t){for(const i of t)if(this.css(e)===i)return!0;return!1}cssInitialAny(e,...t){for(const i of t)if(this.cssInitial(e)===i)return!0;return!1}cssAscend(e,t=!1){let i,n=t?this:this.actualParent;for(;n;){if(""!==(i=n.cssInitial(e)))return i;if(n.documentBody)break;n=n.actualParent}return""}cssSort(e,t=!0,i=!1){const n=i?this.duplicate():this.children;return n.sort((i,n)=>{const s=i.toFloat(e),o=n.toFloat(e);return s===o?0:t?s<o?-1:1:s>o?-1:1}),n}cssPX(e,t,i=!1,n=!1){const s=this._styleMap[e];if(s&&C.isLength(s)){t+=C.parseUnit(s,this.fontSize),!i&&t<0&&(t=0);const o=C.formatPX(t);return this.css(e,o),n&&this.unsetCache(e),o}return""}cssSpecificity(e){if(this.styleElement){const t=this._element,i=P.getElementCache(this.pseudoElement?t.parentElement:t,"styleSpecificity"+W.getPseudoElt(this),this.sessionId);if(i)return i[e]||0}return 0}cssTry(e,t){if(this.styleElement){const i=C.getStyle(this._element).getPropertyValue(e);if(i===t)return!0;{const n=this._element;if(n.style.setProperty(e,t),O(t,n.style.getPropertyValue(e)))return P.setElementCache(n,e,this.sessionId,i),!0}}return!1}cssFinally(e){if(this.styleElement){const t=this._element,i=P.getElementCache(t,e,this.sessionId);if(i)return t.style.setProperty(e,i),P.deleteElementCache(t,e,this.sessionId),!0}return!1}toInt(e,t=!1,i=0){const n=parseInt((t?this._initial.styleMap:this._styleMap)[e]);return isNaN(n)?i:n}toFloat(e,t=!1,i=0){const n=parseFloat((t?this._initial.styleMap:this._styleMap)[e]);return isNaN(n)?i:n}parseUnit(e,t="width",i=!0){if(e){if(C.isPercent(e)){const n=i&&this.absoluteParent||this;let s=parseFloat(e)/100;switch(t){case"width":s*=n.bounds.width;break;case"height":s*=n.bounds.height}return s}return C.parseUnit(e,this.fontSize)}return 0}convertPX(e,t="width",i=!0){return e.endsWith("px")?e:Math.round(this.parseUnit(e,t,i))+"px"}has(e,t=0,i){const n=(i&&"initial"===i.map?this._initial.styleMap:this._styleMap)[e];if(n)switch(n){case"auto":case"none":case"initial":case"unset":case"normal":case"transparent":case"rgba(0, 0, 0, 0)":return!1;case"baseline":case"left":case"start":return this.flexElement||!!this.actualParent&&this.actualParent.flexElement;default:if(i&&i.not){if(n===i.not)return!1;if(Array.isArray(i.not))for(const e of i.not)if(n===e)return!1}if(t>0){if(L.hasBit(t,2)&&C.isLength(n))return!0;if(L.hasBit(t,4)&&C.isPercent(n))return!0}return 0===t}return!1}hasPX(e,t=!0,i=!1){const n=(i?this._initial.styleMap:this._styleMap)[e];return!!n&&C.isLength(n,t)}setBounds(e=!0){if(this.styleElement)this._bounds=I.assignRect(P.actualClientRect(this._element,this.sessionId,e),!0),this.documentBody&&0===this.marginTop&&(this._bounds.top=0);else if(this.plainText){const e=I.getRangeClientRect(this._element),t=I.assignRect(e,!0),i=e.numberOfLines;t.numberOfLines=i,this._bounds=t,this._textBounds=t,this._cached.multiline=i>1}e||(this._box=void 0,this._linear=void 0)}querySelector(e){return this.querySelectorAll(e,1)[0]||null}querySelectorAll(e,t=-1){let i=[];const n=this.queryMap;if(n){const o=C.parseSelectorText(e);for(let e=0;e<o.length;e++){const r=o[e],a=[];let l=-1;e:{let e,t;for(B.CSS.SELECTOR_G.lastIndex=0;null!==(t=B.CSS.SELECTOR_G.exec(r));){let i,n,s,o,r,c,h=t[1],d=!1;if(1===h.length){const t=h.charAt(0);switch(t){case"+":case"~":l--;case">":if(e||0===a.length){a.length=0;break e}e=t;continue;case"*":d=!0}}else if(h.endsWith("|*"))d="*|*"===h;else if("*"===h.charAt(0))h=h.substring(1);else if(h.startsWith("::")){a.length=0;break e}if(!d){let e;for(;null!==(e=B.CSS.SELECTOR_ATTR.exec(h));){void 0===o&&(o=[]);const t="i"===e[6];let i=e[3]||e[4]||e[5]||"";t&&(i=i.toLowerCase()),o.push({key:e[1],symbol:e[2],value:i,caseInsensitive:t}),h=L.spliceString(h,e.index,e[0].length)}if(-1!==h.indexOf("::")){a.length=0;break e}for(;null!==(e=B.CSS.SELECTOR_PSEUDO_CLASS.exec(h));)e[0].startsWith(":not(")?e[1]&&(void 0===c&&(c=[]),c.push(e[1])):(void 0===r&&(r=[]),r.push(e[0])),h=L.spliceString(h,e.index,e[0].length);for(;null!==(e=B.CSS.SELECTOR_LABEL.exec(h));){const t=e[0];switch(t.charAt(0)){case"#":n=t.substring(1);break;case".":void 0===s&&(s=[]),s.push(t.substring(1));break;default:i=t.toUpperCase()}h=L.spliceString(h,e.index,e[0].length)}}a.push({all:d,tagName:i,id:n,adjacent:e,classList:s,pseudoList:r,notList:c,attrList:o}),l++,e=void 0}}let c=n.length;if(a.length&&-1!==l&&l<c){const r=(t,i,n,s)=>{if(i.all)return!0;if(i.tagName&&i.tagName!==t.tagName.toUpperCase())return!1;if(i.id&&i.id!==t.elementId)return!1;if(i.pseudoList){const o=t.actualParent,r=t.tagName;for(const a of i.pseudoList)switch(a){case":first-child":case":nth-child(1)":if(t!==o.firstChild)return!1;break;case":last-child":case":nth-last-child(1)":if(t!==o.lastChild)return!1;break;case":only-child":if(o.naturalElements.length>1)return!1;break;case":only-of-type":{let e=0;for(const t of o.naturalElements)if(t.tagName===r&&++e>1)return!1;break}case":first-of-type":for(const e of o.naturalElements)if(e.tagName===r){if(e!==t)return!1;break}break;case":nth-child(n)":case":nth-last-child(n)":break;case":empty":if(t.element.childNodes.length)return!1;break;case":checked":if("INPUT"===r){if(!t.element.checked)return!1}else{if("OPTION"!==r)return!1;if(!t.element.selected)return!1}break;case":enabled":if(!t.inputElement||t.element.disabled)return!1;break;case":disabled":if(!t.inputElement||!t.element.disabled)return!1;break;case":read-only":{const e=t.element;if(e.isContentEditable||("INPUT"===r||"TEXTAREA"===r)&&!e.readOnly)return!1;break}case":read-write":{const e=t.element;if(!e.isContentEditable||("INPUT"===r||"TEXTAREA"===r)&&e.readOnly)return!1;break}case":required":if(!t.inputElement||"BUTTON"===r||!t.element.required)return!1;break;case":optional":if(!t.inputElement||"BUTTON"===r||t.element.required)return!1;break;case":placeholder-shown":if("INPUT"!==r&&"TEXTAREA"!==r||!t.element.placeholder)return!1;break;case":default":switch(r){case"INPUT":{const e=t.element;switch(e.type){case"radio":case"checkbox":if(!e.checked)return!1;break;default:return!1}break}case"OPTION":if(void 0===t.element.attributes.selected)return!1;break;case"BUTTON":{const i=t.element,n=M(i);if(n){let t=!1;const s=n.querySelectorAll("*"),o=s.length;for(let n=0;n<o;n++){const n=s[e];if("BUTTON"===n.tagName){t=i===n;break}if("INPUT"===n.tagName){const e=n.type;if("submit"===e||"image"===e){t=i===n;break}}}if(!t)return!1}break}default:return!1}break;case":in-range":case":out-of-range":if("INPUT"!==r)return!1;{const e=t.element,i=parseFloat(e.value);if(isNaN(i)){if(":in-range"===a)return!1}else{const t=L.convertFloat(e.min),n=L.convertFloat(e.max);if(i>=t&&i<=n){if(":out-of-range"===a)return!1}else if(":in-range"===a)return!1}}break;case":indeterminate":if("INPUT"===r){const e=t.element;switch(e.type){case"checkbox":if(!e.indeterminate)return!1;break;case"radio":if(e.checked)return!1;if(e.name){const t=(M(e)||document).querySelectorAll(`input[type=radio][name="${e.name}"`),i=t.length;for(let e=0;e<i;e++)if(t[e].checked)return!1}break;default:return!1}}else{if("PROGRESS"!==r)return!1;if(-1!==t.element.value)return!1}break;case":target":if(""===location.hash)return!1;{const e=t.element;if(location.hash!=="#"+e.id&&("A"!==r||location.hash!=="#"+e.name))return!1}break;case":scope":if(!n||">"===s&&t!==this)return!1;break;case":root":if(!n||s)return!1;break;case":link":case":visited":case":any-link":case":hover":case":focus":case":focus-within":case":valid":case":invalid":{const i=t.element,n=o.element.querySelectorAll(":scope > "+a);let s=!1;const r=n.length;for(let t=0;t<r;t++)if(n.item(e)===i){s=!0;break}if(!s)return!1;break}default:{let e=N.NTH_CHILD_OFTYPE.exec(a);if(e){const i=e[3].trim();let n=o.naturalElements;e[1]&&(n=n.slice(0).reverse());const s=("child"===e[2]?n.indexOf(t):L.filterArray(n,e=>e.tagName===r).indexOf(t))+1;if(s>0){if(L.isNumber(i)){if(parseInt(i)!==s)return!1}else switch(i){case"even":if(s%2!=0)return!1;break;case"odd":if(s%2==0)return!1;break;default:const e=N.NTH_CHILD_OFTYPE_VALUE.exec(i);if(e){const t=L.convertInt(e[3]);if(e[2]){if(e[1])return!1;const i=parseInt(e[2]);if(0!==i){if(s!==t)for(let e=i;;e+=i){const e=i+t;if(e===s)break;if(e>s)return!1}}else if(s!==t)return!1}else if(e[3]){if(!(t>0))return!1;if(e[1]){if(s>t)return!1}else if(s<t)return!1}}}continue}}else if(e=N.LANG.exec(a)){const i=t.attributes;if(i.lang&&e[1].toLowerCase()===i.lang.toLowerCase())continue}return!1}}}if(i.notList)for(const e of i.notList){const i={all:!1};switch(e.charAt(0)){case".":i.classList=[e];break;case"#":i.id=e.substring(1);break;case":":i.pseudoList=[e];break;case"[":{B.CSS.SELECTOR_ATTR.lastIndex=0;const t=B.CSS.SELECTOR_ATTR.exec(e);if(!t)continue;{const e="i"===t[6];let n=t[3]||t[4]||t[5]||"";e&&(n=n.toLowerCase()),i.attrList=[{key:t[1],symbol:t[2],value:n,caseInsensitive:e}]}break}default:if(!B.CHAR.WORDDASH.test(e))return!1;i.tagName=e}if(r(t,i,n))return!1}if(i.classList){const e=t.element.classList;for(const t of i.classList)if(!e.contains(t))return!1}if(i.attrList){const e=t.attributes;for(const t of i.attrList){let i=e[t.key];if(void 0===i)return!1;if(t.value)if(t.caseInsensitive&&(i=i.toLowerCase()),t.symbol)switch(t.symbol){case"~":if(!i.split(B.CHAR.SPACE).includes(t.value))return!1;break;case"^":if(!i.startsWith(t.value))return!1;break;case"$":if(!i.endsWith(t.value))return!1;break;case"*":if(-1===i.indexOf(t.value))return!1;break;case"|":if(i!==t.value&&!i.startsWith(t.value+"-"))return!1}else if(i!==t.value)return!1}}return!0},h=a.pop(),d=0===a.length;let u=[];for(let e=l;e<c;e++){const t=n[e];if(h.all)u=u.concat(t);else for(const e of t)r(e,h,d)&&u.push(e)}if(a.length){const e=this.depth;function s(t,i,n){const o=a[t],l=t===c-1,h=[];for(const s of n)if(i){const e=s.actualParent;if(">"===i)r(e,o,l,i)&&h.push(e);else{const t=e.naturalElements;switch(i){case"+":{const e=t.indexOf(s);if(e>0){const n=t[e-1];n&&r(n,o,l,i)&&h.push(n)}break}case"~":{const e=t.length;for(let n=0;n<e;n++){const e=t[n];if(e===s)break;r(e,o,l,i)&&h.push(e)}break}}}}else if(s.depth-e>=c-t){let e=s.actualParent;do{r(e,o,l)&&h.push(e),e=e.actualParent}while(e)}return!!h.length&&(++t===c||s(t,o.adjacent,h))}a.reverse(),c=a.length;for(const e of u)if(s(0,h.adjacent,[e])&&(i.push(e),i.length===t))return i}else{if(0===i.length&&(e===o.length-1||t>=0&&t<=u.length))return t>=0&&u.length>t&&(u.length=t),u;if(i=i.concat(u),t>=0&&i.length>=t)return i.length=t,i}}}}return i}getTextStyle(){return void 0===this._textStyle&&(this._textStyle={fontFamily:this.css("fontFamily"),fontSize:this.css("fontSize"),fontWeight:this.css("fontWeight"),fontStyle:this.css("fontStyle"),color:this.css("color"),whiteSpace:this.css("whiteSpace"),textDecoration:this.css("textDecoration"),textTransform:this.css("textTransform"),letterSpacing:this.css("letterSpacing"),wordSpacing:this.css("wordSpacing")}),this._textStyle}setDimension(e,t,i){const n=this._styleMap,s=this.parseUnit(n[e],e);let o=Math.max(s,this.parseUnit(n[t],e));if(0===o&&this.styleElement){const t=this._element;switch(t.tagName){case"IMG":case"INPUT":if("image"!==t.type)break;case"TD":case"TH":case"SVG":case"IFRAME":case"VIDEO":case"CANVAS":case"OBJECT":case"EMBED":const i=I.getNamedItem(t,e);""!==i&&(o=this.parseUnit(i,e))>0&&this.css(e,C.isPercent(i)?i:i+"px")}}let r=0;return s>0&&!this.imageElement&&(n[i]===n[e]?delete n[i]:(r=this.parseUnit(n[i],e))>0&&r<=s&&C.isLength(n[e])&&(r=0,n[e]=n[i],delete this._styleMap[i])),r>0?Math.min(o,r):o}setBoxModel(e){const t="box"===e?this._box:this._linear;if(t){if(t.width=this.bounds.width,this.plainText)t.height=t.bottom-t.top;else switch(t.height=this.bounds.height,e){case"box":t.width-=this.contentBoxWidth,t.height-=this.contentBoxHeight;break;case"linear":t.width+=Math.max(this.marginLeft,0)+this.marginRight,t.height+=Math.max(this.marginTop,0)+this.marginBottom}void 0===this._initial[e]&&(this._initial[e]=I.assignRect(t))}}convertPosition(e){let t=0;if(!this.positionStatic){const i=this.cssInitial(e,!0);C.isLength(i)?t=L.convertFloat(this.convertPX(i,"left"===e||"right"===e?"width":"height")):C.isPercent(i)&&this.styleElement&&(t=L.convertFloat(this.style[e]))}return t}convertBorderWidth(e){if(!this.plainText){if("none"!==this.css(C.BOX_BORDER[e][0])){const t=this.css(C.BOX_BORDER[e][1]);let i;switch(t){case"thin":case"medium":case"thick":i=L.convertFloat(this.style[C.BOX_BORDER[e][1]]);break;default:i=this.parseUnit(t,1===e||3===e?"width":"height")}if(i>0)return Math.max(Math.round(i),1)}}return 0}convertBox(e,t){switch(this.display){case"table":if(!t&&"collapse"===this.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if(t)return 0}const i=this.parseUnit(this.css(e));if(!t){let t=this.toFloat("paddingInlineStart"),n=this.toFloat("paddingInlineEnd");if(t>0||n>0)return"vertical-rl"===this.css("writingMode")?"rtl"===this.dir?("paddingBottom"!==e&&(t=0),"paddingTop"!==e&&(n=0)):("paddingTop"!==e&&(t=0),"paddingBottom"!==e&&(n=0)):"rtl"===this.dir?("paddingRight"!==e&&(t=0),"paddingLeft"!==e&&(n=0)):("paddingLeft"!==e&&(t=0),"paddingRight"!==e&&(n=0)),t+i+n}return i}set parent(e){e&&(e!==this._parent&&(this._parent&&this._parent.remove(this),this._parent=e),e.contains(this)||e.append(this),-1===this.depth&&(this.depth=e.depth+1))}get parent(){return this._parent}get tagName(){let e=this._cached.tagName;if(void 0===e){const t=this._element;e=t?"#"===t.nodeName.charAt(0)?t.nodeName:t.tagName:"",this._cached.tagName=e}return e}get element(){return this._element}get elementId(){return this._element?this._element.id:""}get htmlElement(){let e=this._cached.htmlElement;return void 0===e&&(e=!this.plainText&&this._element instanceof HTMLElement,this._cached.htmlElement=e),e}get svgElement(){let e=this._cached.svgElement;return void 0===e&&(e=!this.htmlElement&&!this.plainText&&this._element instanceof SVGElement,this._cached.svgElement=e),e}get styleElement(){return this.htmlElement||this.svgElement}get naturalChild(){return!0}get naturalElement(){let e=this._cached.naturalElement;return void 0===e&&(this._cached.naturalElement=e=this.naturalChild&&this.styleElement&&!this.pseudoElement),e}get pseudoElement(){return!1}get imageElement(){return"IMG"===this.tagName}get flexElement(){let e=this._cached.flexElement;return void 0===e&&(e=this.display.endsWith("flex"),this._cached.flexElement=e),e}get gridElement(){let e=this._cached.gridElement;return void 0===e&&(e=this.display.endsWith("grid"),this._cached.gridElement=e),e}get textElement(){let e=this._cached.textElement;return void 0===e&&(this._cached.textElement=e=this.plainText||this.inlineText),e}get tableElement(){let e=this._cached.tableElement;return void 0===e&&(this._cached.tableElement=e="TABLE"===this.tagName||"table"===this.display),e}get inputElement(){let e=this._cached.inputElement;if(void 0===e){switch(this.tagName){case"INPUT":case"BUTTON":case"SELECT":case"TEXTAREA":e=!0;break;default:e=!1}this._cached.inputElement=e}return e}get layoutElement(){let e=this._cached.layoutElement;return void 0===e&&(this._cached.layoutElement=e=this.flexElement||this.gridElement),e}get plainText(){return"#text"===this.tagName}get styleText(){return this.naturalElement&&this.inlineText}get lineBreak(){return"BR"===this.tagName}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||I.newBoxRectDimension()}get linear(){if(void 0===this._linear&&this._bounds){if(this._element){const e=this._bounds;this._linear={top:e.top-(this.marginTop>0?this.marginTop:0),right:e.right+this.marginRight,bottom:e.bottom+this.marginBottom,left:e.left-(this.marginLeft>0?this.marginLeft:0),width:0,height:0}}else this._linear=I.assignRect(this._bounds);this.setBoxModel("linear")}return this._linear||I.newBoxRectDimension()}get box(){if(void 0===this._box&&this._bounds){if(this._element){const e=this._bounds;this._box={top:e.top+(this.paddingTop+this.borderTopWidth),right:e.right-(this.paddingRight+this.borderRightWidth),bottom:e.bottom-(this.paddingBottom+this.borderBottomWidth),left:e.left+(this.paddingLeft+this.borderLeftWidth),width:0,height:0}}else this._box=I.assignRect(this._bounds);this.setBoxModel("box")}return this._box||I.newBoxRectDimension()}get dataset(){return this.styleElement?this._element.dataset:(void 0===this._dataset&&(this._dataset={}),this._dataset)}get flexbox(){let e=this._cached.flexbox;if(void 0===e){const t=this.actualParent,i=this.css("alignSelf"),n=this.css("justifySelf"),s=(e,i,n)=>{const o=(n||this).css(e);return L.isNumber(o)?parseFloat(o):"inherit"===o&&void 0===n&&t?s(e,i,t):i};e={alignSelf:"auto"===i&&t&&t.has("alignItems")?t.css("alignItems"):i,justifySelf:"auto"===n&&t&&t.has("justifyItems")?t.css("justifyItems"):n,basis:this.css("flexBasis"),grow:s("flexGrow",0),shrink:s("flexShrink",1),order:this.toInt("order")},this._cached.flexbox=e}return e}get width(){let e=this._cached.width;return void 0===e&&(e=this.setDimension("width","minWidth","maxWidth"),this._cached.width=e),e}get height(){let e=this._cached.height;return void 0===e&&(e=this.setDimension("height","minHeight","maxHeight"),this._cached.height=e),e}get hasWidth(){return this.width>0}get hasHeight(){const e=this.css("height");if(C.isPercent(e)){if(this.pageFlow){const t=this.actualParent;if(t&&t.hasHeight)return parseFloat(e)>0}return!1}return this.height>0}get lineHeight(){let e=this._cached.lineHeight;if(void 0===e){if(e=0,!this.imageElement&&!this.svgElement){let t=this.has("lineHeight"),i=0;if(t){const e=this.css("lineHeight");if(C.isPercent(e))i=L.convertFloat(this.style.lineHeight);else if(i=C.parseUnit(e,this.fontSize),e.endsWith("px")){const e=this.cssInitial("fontSize");e.endsWith("em")&&(i*=parseFloat(e))}}else if(this.naturalChild){let e=this.actualParent;for(;e;){if(e.lineHeight>0){i=e.lineHeight;break}e=e.actualParent}if(this.styleElement){const e=this.cssInitial("fontSize");if(e.endsWith("em")){const n=parseFloat(e);1!==n&&(this.css("lineHeight",C.formatPX(i*=n)),t=!0)}}}(t||i>this.actualHeight||this.multiline||this.block&&this.naturalChildren.some(e=>e.textElement))&&(e=i)}this._cached.lineHeight=e}return e}get display(){return this.css("display")}get positionStatic(){let e=this._cached.positionStatic;if(void 0===e){switch(this.css("position")){case"fixed":case"absolute":e=!1;break;case"sticky":case"relative":(e=!(this.hasPX("top")||this.hasPX("right")||this.hasPX("bottom")||this.hasPX("left")))&&(this._cached.positionRelative=!1);break;case"inherit":const t=this._element,i=t&&t.parentElement?C.getInheritedStyle(t.parentElement,"position"):"";e=""!==i&&!("absolute"===i||"fixed"===i);break;default:e=!0}this._cached.positionStatic=e}return e}get positionRelative(){let e=this._cached.positionRelative;if(void 0===e){const t=this.css("position");this._cached.positionRelative=e="relative"===t||"sticky"===t}return e}get positionAuto(){let e=this._cached.positionAuto;if(void 0===e){const t=-1===this._initial.iteration?this._styleMap:this._initial.styleMap;this._cached.positionAuto=e=!(this.pageFlow||t.top&&"auto"!==t.top||t.right&&"auto"!==t.right||t.bottom&&"auto"!==t.bottom||t.left&&"auto"!==t.left)}return e}get top(){let e=this._cached.top;return void 0===e&&(e=this.convertPosition("top"),this._cached.top=e),e}get right(){let e=this._cached.right;return void 0===e&&(e=this.convertPosition("right"),this._cached.right=e),e}get bottom(){let e=this._cached.bottom;return void 0===e&&(e=this.convertPosition("bottom"),this._cached.bottom=e),e}get left(){let e=this._cached.left;return void 0===e&&(e=this.convertPosition("left"),this._cached.left=e),e}get marginTop(){let e=this._cached.marginTop;return void 0===e&&(e=this.inlineStatic?0:this.convertBox("marginTop",!0),this._cached.marginTop=e),e}get marginRight(){let e=this._cached.marginRight;return void 0===e&&(e=this.convertBox("marginRight",!0),this._cached.marginRight=e),e}get marginBottom(){let e=this._cached.marginBottom;return void 0===e&&(e=this.inlineStatic?0:this.convertBox("marginBottom",!0),this._cached.marginBottom=e),e}get marginLeft(){let e=this._cached.marginLeft;return void 0===e&&(e=this.convertBox("marginLeft",!0),this._cached.marginLeft=e),e}get borderTopWidth(){let e=this._cached.borderTopWidth;return void 0===e&&(e=this.convertBorderWidth(0),this._cached.borderTopWidth=e),e}get borderRightWidth(){let e=this._cached.borderRightWidth;return void 0===e&&(e=this.convertBorderWidth(1),this._cached.borderRightWidth=e),e}get borderBottomWidth(){let e=this._cached.borderBottomWidth;return void 0===e&&(e=this.convertBorderWidth(2),this._cached.borderBottomWidth=e),e}get borderLeftWidth(){let e=this._cached.borderLeftWidth;return void 0===e&&(e=this.convertBorderWidth(3),this._cached.borderLeftWidth=e),e}get paddingTop(){let e=this._cached.paddingTop;return void 0===e&&(e=this.convertBox("paddingTop",!1),this._cached.paddingTop=e),e}get paddingRight(){let e=this._cached.paddingRight;return void 0===e&&(e=this.convertBox("paddingRight",!1),this._cached.paddingRight=e),e}get paddingBottom(){let e=this._cached.paddingBottom;return void 0===e&&(e=this.convertBox("paddingBottom",!1),this._cached.paddingBottom=e),e}get paddingLeft(){let e=this._cached.paddingLeft;return void 0===e&&(e=this.convertBox("paddingLeft",!1),this._cached.paddingLeft=e),e}get contentBox(){return"border-box"!==this.css("boxSizing")}get contentBoxWidth(){let e=this._cached.contentBoxWidth;return void 0===e&&(e=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth,this._cached.contentBoxWidth=e),e}get contentBoxHeight(){let e=this._cached.contentBoxHeight;return void 0===e&&(e=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth,this._cached.contentBoxHeight=e),e}get inline(){let e=this._cached.inline;if(void 0===e){const t=this.display;e="inline"===t||("initial"===t||"unset"===t)&&!I.ELEMENT_BLOCK.includes(this.tagName),this._cached.inline=e}return e}get inlineStatic(){let e=this._cached.inlineStatic;return void 0===e&&(this._cached.inlineStatic=e=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement),e}get inlineVertical(){let e=this._cached.inlineVertical;if(void 0===e){if(this.naturalElement){const t=this.display;e=(t.startsWith("inline")||"table-cell"===t)&&!this.floating&&!this.plainText}else e=!1;this._cached.inlineVertical=e}return e}set inlineText(e){switch(this.tagName){case"INPUT":case"IMG":case"SELECT":case"SVG":case"BR":case"HR":case"TEXTAREA":this._inlineText=!1;break;case"BUTTON":this._inlineText=""!==this.textContent.trim();break;default:this._inlineText=e}}get inlineText(){return this._inlineText}get block(){let e=this._cached.block;if(void 0===e){switch(this.display){case"block":case"flex":case"grid":case"list-item":e=!0;break;case"initial":e=I.ELEMENT_BLOCK.includes(this.tagName);break;case"inline":if("svg"===this.tagName&&this.actualParent.htmlElement){e=!this.hasPX("width")&&0===L.convertFloat(I.getNamedItem(this._element,"width"));break}default:e=!1}this._cached.block=e}return e}get blockStatic(){let e=this._cached.blockStatic;return void 0===e&&(e=this.pageFlow&&(this.block&&!this.floating||this.blockDimension&&"100%"===this.cssInitial("width")&&!this.hasPX("maxWidth")),this._cached.blockStatic=e),e}get blockDimension(){let e=this._cached.blockDimension;if(void 0===e){const t=this.display;e=this.block||t.startsWith("inline-")||"table"===t||this.imageElement||this.svgElement,this._cached.blockDimension=e}return e}get blockVertical(){let e=this._cached.blockVertical;return void 0===e&&(e=this.blockDimension&&this.hasPX("height"),this._cached.blockVertical=e),e}get pageFlow(){let e=this._cached.pageFlow;return void 0===e&&(this._cached.pageFlow=e=this.positionStatic||this.positionRelative),e}get inlineFlow(){let e=this._cached.inlineFlow;if(void 0===e){const t=this.display;e=this.inline||t.startsWith("inline")||"table-cell"===t||this.imageElement||this.floating,this._cached.inlineFlow=e}return e}get centerAligned(){let e=this._cached.centerAligned;return void 0===e&&(e=this.autoMargin.leftRight||this.textElement&&this.blockStatic&&"center"===this.cssInitial("textAlign")||this.inlineStatic&&"center"===this.cssAscend("textAlign",!0),this._cached.centerAligned=e),e}get rightAligned(){let e=this._cached.rightAligned;return void 0===e&&(e="right"===this.float||this.autoMargin.left||!this.pageFlow&&this.hasPX("right")||this.textElement&&this.blockStatic&&"right"===this.cssInitial("textAlign"),this._cached.rightAligned=e),e}get bottomAligned(){let e=this._cached.bottomAligned;return void 0===e&&(e=!this.pageFlow&&this.hasPX("bottom")&&this.bottom>=0,this._cached.bottomAligned=e),e}get horizontalAligned(){let e=this._cached.horizontalAligned;return void 0===e&&(e=!(this.blockStatic||this.autoMargin.horizontal||this.blockDimension&&"100%"===this.css("width")),this._cached.horizontalAligned=e),e}get autoMargin(){let e=this._cached.autoMargin;if(void 0===e){if(!this.pageFlow||this.blockStatic||"table"===this.display){const t=-1===this._initial.iteration?this._styleMap:this._initial.styleMap,i="auto"===t.marginLeft&&(this.pageFlow||this.hasPX("right")),n="auto"===t.marginRight&&(this.pageFlow||this.hasPX("left")),s="auto"===t.marginTop&&(this.pageFlow||this.hasPX("bottom")),o="auto"===t.marginBottom&&(this.pageFlow||this.hasPX("top"));e={horizontal:i||n,left:i&&!n,right:!i&&n,leftRight:i&&n,vertical:s||o,top:s&&!o,bottom:!s&&o,topBottom:s&&o}}else e={};this._cached.autoMargin=e}return e}get floating(){let e=this._cached.floating;return void 0===e&&(e=!!this.pageFlow&&this.cssAny("float","left","right"),this._cached.floating=e),e}get float(){let e=this._cached.float;return void 0===e&&(e=this.css("float")||"none",this._cached.float=e),e}get zIndex(){return this.toInt("zIndex")}get textContent(){let e=this._cached.textContent;return void 0===e&&(this._cached.textContent=e=this.svgElement?"":this._element.textContent),e}get src(){return this.htmlElement&&this._element.src||""}get overflow(){let e=this._cached.overflow;if(void 0===e){if(e=0,this.htmlElement&&!this.inputElement&&!this.imageElement&&"HR"!==this.tagName&&!this.documentBody){const t=this._element,i=this.css("overflowX"),n=this.css("overflowY");this.hasHeight&&(this.hasPX("height")||this.hasPX("maxHeight"))&&("scroll"===n||"auto"===n&&t.clientHeight!==t.scrollHeight)&&(e|=16),(this.hasPX("width")||this.hasPX("maxWidth"))&&("scroll"===i||"auto"===i&&t.clientWidth!==t.scrollWidth)&&(e|=8),"auto"!==i&&"hidden"!==i&&"overlay"!==i&&"auto"!==n&&"hidden"!==n&&"overlay"!==n||(e|=64)}this._cached.overflow=e}return e}get overflowX(){return L.hasBit(this.overflow,8)}get overflowY(){return L.hasBit(this.overflow,16)}get baseline(){let e=this._cached.baseline;return void 0===e&&(e=this.pageFlow&&!this.floating&&this.cssAny("verticalAlign","baseline","initial","0px","0%","unset"),this._cached.baseline=e),e}get verticalAlign(){let e=this._cached.verticalAlign;return void 0===e&&(e=this.css("verticalAlign"),C.isLength(e,!0)&&(e=this.convertPX(e,"height")),this._cached.verticalAlign=e),e}set textBounds(e){this._textBounds=e||void 0}get textBounds(){return this.naturalChild&&void 0===this._textBounds&&(this._textBounds=P.actualTextRangeRect(this._element,this.sessionId)),this._textBounds}get multiline(){let e=this._cached.multiline;if(void 0===e){if(this.plainText)e=I.getRangeClientRect(this._element).numberOfLines>1;else if(this.styleText&&(this.inlineFlow||0===this.naturalElements.length)){const t=this.textBounds;e=!!t&&t.numberOfLines>1}else e=!1;this._cached.multiline=e}return e}get positiveAxis(){let e=this._cached.positiveAxis;return void 0===e&&(e=(!this.positionRelative||this.positionRelative&&this.top>=0&&this.left>=0&&(this.right<=0||this.hasPX("left"))&&(this.bottom<=0||this.hasPX("top")))&&this.marginTop>=0&&this.marginLeft>=0&&this.marginRight>=0,this._cached.positiveAxis=e),e}get backgroundColor(){let e=this._cached.backgroundColor;if(void 0===e){switch(e=this.css("backgroundColor")){case"initial":case"unset":case"rgba(0, 0, 0, 0)":case"transparent":e="";break;default:if(""!==e&&this.pageFlow&&!this.plainText&&!this.inputElement&&(-1===this._initial.iteration||this.cssInitial("backgroundColor")===e)){let t=this.actualParent;for(;t&&0!==t.id;){const i=t.cssInitial("backgroundColor",!0);if(""!==i){i===e&&""===t.backgroundColor&&(e="");break}t=t.actualParent}}}this._cached.backgroundColor=e}return e}get backgroundImage(){let e=this._cached.backgroundImage;if(void 0===e){const t=this.css("backgroundImage");if(""!==t&&"none"!==t&&"initial"!==t)e=t;else{const t=N.BACKGROUND.exec(this.css("background"));e=t?t[1]:""}this._cached.backgroundImage=e}return e}get visibleStyle(){let e=this._cached.visibleStyle;if(void 0===e){if(this.plainText)e={background:!1,borderWidth:!1,backgroundImage:!1,backgroundColor:!1,backgroundRepeat:!1};else{const t=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,i=""!==this.backgroundColor,n=""!==this.backgroundImage;e={background:t||n||i,borderWidth:t,backgroundImage:n,backgroundColor:i,backgroundRepeat:"no-repeat"!==this.css("backgroundRepeat")}}this._cached.visibleStyle=e}return e}get percentWidth(){let e=this._cached.percentWidth;return void 0===e&&(e=C.isPercent(this.cssInitial("width",!0)),this._cached.percentWidth=e),e}get percentHeight(){let e=this._cached.percentHeight;return void 0===e&&(e=C.isPercent(this.cssInitial("height",!0)),this._cached.percentHeight=e),e}get absoluteParent(){let e=this._cached.absoluteParent;if(void 0===e){if(e=this.actualParent,!this.pageFlow)for(;e&&0!==e.id;){const t=e.cssInitial("position",!1,!0);if(e.documentBody||"static"!==t&&"initial"!==t&&"unset"!==t)break;e=e.actualParent}this._cached.absoluteParent=e}return e}set actualParent(e){this._cached.actualParent=e}get actualParent(){let e=this._cached.actualParent;if(void 0===e){const t=this._element;e=t&&t.parentElement&&P.getElementAsNode(t.parentElement,this.sessionId)||null,this._cached.actualParent=e}return e}get actualWidth(){let e=this._cached.actualWidth;if(void 0===e){if(this.plainText)e=this.bounds.right-this.bounds.left;else{e=this.bounds.width;const t=this.actualParent;if(t&&!t.flexElement&&"table-cell"!==this.display){const t=this.parseUnit(this.cssInitial("width",!0));if(t>0){e=t;const i=this.parseUnit(this.css("maxWidth"));i>0&&(e=Math.min(e,i)),this.contentBox&&!this.tableElement&&(e+=this.contentBoxWidth)}}}this._cached.actualWidth=e}return e}get actualHeight(){let e=this._cached.actualHeight;if(void 0===e){if(e=this.bounds.height,!this.plainText){const t=this.actualParent;if(t&&!t.flexElement&&"table-cell"!==this.display){const t=this.parseUnit(this.cssInitial("height",!0),"height");if(t>0){e=t;const i=this.parseUnit(this.css("maxHeight"));i>0&&(e=Math.min(e,i)),this.contentBox&&!this.tableElement&&(e+=this.contentBoxHeight)}}}this._cached.actualHeight=e}return e}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}set naturalChildren(e){this._naturalChildren=e}get naturalChildren(){if(void 0===this._naturalChildren)if(this.naturalElement){const e=this.sessionId,t=[];let i=0;this._element.childNodes.forEach(n=>{const s=P.getElementAsNode(n,e);s&&(s.childIndex=i++,t.push(s))}),this._naturalChildren=t}else-1===this._initial.iteration&&this.saveAsInitial(),this._naturalChildren=this._initial.children;return this._naturalChildren}set naturalElements(e){this._naturalElements=e}get naturalElements(){return void 0===this._naturalElements&&(this._naturalElements=L.filterArray(this.naturalChildren,e=>e.naturalElement)),this._naturalElements}get firstChild(){return this.naturalElements[0]||null}get lastChild(){const e=this.naturalElements,t=e.length;return t?e[t-1]:null}get firstStaticChild(){for(const e of this.naturalChildren)if(e.pageFlow)return e;return null}get lastStaticChild(){const e=this.naturalChildren;for(let t=e.length-1;t>=0;t--){const i=e[t];if(i.pageFlow)return i}return null}get previousSibling(){const e=this.actualParent;return e&&e.naturalChildren[this.childIndex-1]||null}get nextSibling(){const e=this.actualParent;return e&&e.naturalChildren[this.childIndex+1]||null}get previousElementSibling(){const e=this.actualParent;if(e){const t=e.naturalElements,i=t.indexOf(this);if(i>0)return t[i-1]}return null}get nextElementSibling(){const e=this.actualParent;if(e){const t=e.naturalElements,i=t.indexOf(this);if(i<t.length-1)return t[i+1]}return null}get attributes(){let e=this._cached.attributes;if(void 0===e){if(e={},this.styleElement){const t=this._element.attributes,i=t.length;for(let n=0;n<i;n++){const i=t.item(n);e[i.name]=i.value}}this._cached.attributes=e}return e}get fontSize(){return 0===this._fontSize&&(this._fontSize=this.naturalElement?parseFloat(this.style.getPropertyValue("font-size")):C.parseUnit(this.css("fontSize"))),this._fontSize||parseFloat(C.getStyle(document.body).getPropertyValue("font-size"))}set dir(e){this._cached.dir=e}get dir(){let e=this._cached.dir;if(void 0===e){if(""===(e=this.naturalElement?this._element.dir:"")){let t=this.actualParent;for(;t&&""===e;)e=t.dir,t=t.actualParent}this._cached.dir=e}return e}get center(){const e=this.bounds;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}get extensions(){let e=this._cached.extensions;return void 0===e&&(e=this.dataset.use?L.spliceArray(this.dataset.use.split(B.XML.SEPARATOR),e=>""===e):[],this._cached.extensions=e),e}}const F={EXT_DATA:"mainData",TOP_BOTTOM:"topBottom",BOTTOM_TOP:"bottomTop",LEFT_RIGHT:"leftRight",RIGHT_LEFT:"rightLeft"},D=new Map([[2,"marginTop"],[4,"marginRight"],[8,"marginBottom"],[16,"marginLeft"],[32,"paddingTop"],[64,"paddingRight"],[128,"paddingBottom"],[256,"paddingLeft"]]),H={ACCESSIBILITY:"squared.accessibility",CSS_GRID:"squared.css-grid",FLEXBOX:"squared.flexbox",GRID:"squared.grid",LIST:"squared.list",RELATIVE:"squared.relative",SPRITE:"squared.sprite",TABLE:"squared.table",VERTICAL_ALIGN:"squared.verticalalign",WHITESPACE:"squared.whitespace"};var X,z,U,V=Object.freeze({__proto__:null,STRING_BASE:F,CSS_SPACING:D,EXT_NAME:H});!function(e){e[e.DOM_TRAVERSE=2]="DOM_TRAVERSE",e[e.EXTENSION=4]="EXTENSION",e[e.RENDER=8]="RENDER",e[e.ALL=14]="ALL"}(X||(X={})),function(e){e[e.BOX_STYLE=2]="BOX_STYLE",e[e.BOX_SPACING=4]="BOX_SPACING",e[e.FONT_STYLE=8]="FONT_STYLE",e[e.VALUE_STRING=16]="VALUE_STRING",e[e.IMAGE_SOURCE=32]="IMAGE_SOURCE",e[e.ASSET=56]="ASSET",e[e.ALL=126]="ALL"}(z||(z={})),function(e){e[e.CONSTRAINT=2]="CONSTRAINT",e[e.LAYOUT=4]="LAYOUT",e[e.ALIGNMENT=8]="ALIGNMENT",e[e.ACCESSIBILITY=16]="ACCESSIBILITY",e[e.LOCALIZATION=32]="LOCALIZATION",e[e.CUSTOMIZATION=64]="CUSTOMIZATION",e[e.ALL=126]="ALL"}(U||(U={}));var G=Object.freeze({__proto__:null,get APP_SECTION(){return X},get NODE_RESOURCE(){return z},get NODE_PROCEDURE(){return U}});const{css:q,dom:j,math:Y,session:$,util:K}=squared.lib,Q=Array.from(D.keys()),Z=["position","display","verticalAlign","float","clear","zIndex"],J=e=>e.naturalElements.length&&!e.layoutElement&&!e.tableElement;class ee extends W{constructor(){super(...arguments),this.alignmentType=0,this.baselineActive=!1,this.baselineAltered=!1,this.positioned=!1,this.rendered=!1,this.excluded=!1,this.controlId="",this.floatContainer=!1,this.containerIndex=1/0,this.lineBreakLeading=!1,this.lineBreakTrailing=!1,this._excludeSection=0,this._excludeProcedure=0,this._excludeResource=0,this._visible=!0}static outerRegion(e){let t=1/0,i=-1/0,n=-1/0,s=1/0;return e.each(e=>{let o,r,a,l;e.companion?(o=e.actualRect("top"),r=e.actualRect("right"),a=e.actualRect("bottom"),l=e.actualRect("left")):(o=e.linear.top,r=e.linear.right,a=e.linear.bottom,l=e.linear.left),o<t&&(t=o),r>i&&(i=r),a>n&&(n=a),l<s&&(s=l)}),{top:t,right:i,bottom:n,left:s}}static baseline(e,t=!1){return(e=K.filterArray(e,e=>!(!e.baseline&&!q.isLength(e.verticalAlign)||t&&!e.textElement)&&(!e.floating&&!e.baselineAltered&&(e.naturalChild&&0===e.length||!e.layoutVertical&&e.every(e=>e.baseline&&!e.multiline))))).length>1&&e.sort((e,t)=>{if(e.length&&0===t.length)return 1;if(t.length&&0===e.length)return-1;let i=e.baselineHeight,n=t.baselineHeight;if(0!==e.marginTop){if(!(e.imageElement||i>=n||e.marginTop<0))return e.marginTop>(n-i)/2?-1:1;i+=e.marginTop}if(0!==t.marginTop){if(!(t.imageElement||n>=i||t.marginTop<0))return t.marginTop>(i-n)/2?1:-1;n+=t.marginTop}if(!Y.isEqual(i,n))return i>n?-1:1;if(e.textElement&&t.textElement){if(!e.plainText&&t.plainText)return-1;if(e.plainText&&!t.plainText)return 1}else if(e.inputElement&&t.inputElement&&e.containerType!==t.containerType)return e.containerType>t.containerType?-1:1;return e.bounds.bottom>t.bounds.bottom?-1:e.bounds.bottom<t.bounds.bottom?1:0}),e.shift()||null}static linearData(e,t=!1){const i=new Set,n=new Map;let s=!1,o=!1;if(e.length>1){const r=[],a=new Set,l={};for(const t of e)if(t.pageFlow){if(a.size){const e=[],i=t.css("clear");switch(i){case"left":e.push(l.left);break;case"right":e.push(l.right);break;case"both":e.push(l.left,l.right)}for(const i of e)i&&a.has(i.float)&&!t.floating&&K.aboveRange(t.linear.top,i.linear.bottom)&&(a.delete(i.float),l[i.float]=void 0);"both"===i?(n.set(t,2===a.size?"both":a.values().next().value),a.clear(),l.left=void 0,l.right=void 0):a.has(i)&&(n.set(t,i),a.delete(i),l[i]=void 0)}t.floating&&(a.add(t.float),i.add(t.float),l[t.float]=t),r.push(t)}else t.positionAuto&&r.push(t);const c=r.length;if(c&&!t){const e=[r[0]];let t=1,a=1;for(let i=1;i<c;i++)r[i].alignedVertically(e,n)?a++:t++,e.push(r[i]);if(o=a===c,(s=t===c)&&i.size){let e=1/0,t=-1/0,i=-1/0,n=1/0;for(const s of r)e=Math.min(e,s.linear.left),t=Math.max(t,s.linear.right),s.floating&&("left"===s.float?i=Math.max(i,s.linear.right):n=Math.min(n,s.linear.left));for(let o=0,a=0,l=0,h=0,d=0;o<c;o++){const c=r[o];if(Math.floor(c.linear.left)<=e&&a++,Math.ceil(c.linear.right)>=t&&l++,c.floating||(c.linear.left===i&&h++,c.linear.right===n&&d++),0===o)continue;if(2===a||2===l||2===h||2===d){s=!1;break}const u=r[o-1];if(u.floating&&K.aboveRange(c.linear.top,u.linear.bottom)||K.withinRange(c.linear.left,u.linear.left)){s=!1;break}}}}}else e.length&&(s=!(o=e[0].blockStatic));return{linearX:s,linearY:o,cleared:n,floated:i}}static partitionRows(e){const t=e[0].actualParent,i=t&&t.floatContainer?ee.linearData(t.naturalElements,!0).cleared:void 0,n=[];let s=[],o=[];const r=e.length;for(let t=0;t<r;t++){const r=e[t];let a=r;if(!r.naturalChild){if(r.nodeGroup){s.length&&n.push(s),n.push([r]),s=[],o.length=0;continue}let e=r.innerWrapped;for(;e;){if(e.naturalChild){a=e;break}e=e.innerWrapped}}0===s.length?(s.push(r),o.push(a)):a.alignedVertically(o,i)?(s.length&&n.push(s),s=[r],o=[a]):(s.push(r),o.push(a))}return s.length&&n.push(s),n}is(e){return this.containerType===e}of(e,...t){return this.containerType===e&&t.some(e=>this.hasAlign(e))}attr(e,t,i,n=!0){let s=this["__"+e];return i?(void 0===s&&(this._namespaces.includes(e)||this._namespaces.push(e),this["__"+e]=s={}),!n&&s[t]?"":(s[t]=""+i,s[t])):s&&s[t]||""}unsafe(e,t){if(void 0===t)return this["_"+e];this["_"+e]=t}unset(e){delete this["_"+e]}namespace(e){return this["__"+e]||{}}delete(e,...t){const i=this["__"+e];if(i)for(const e of t)if(-1!==e.indexOf("*"))for(const[t]of K.searchObject(i,e))delete i[t];else delete i[e]}apply(e){for(const t in e){const i=e[t];if("object"==typeof i){for(const e in i)this.attr(t,e,i[e]);delete e[t]}}}render(e){this.renderParent=e,this.rendered=!0}renderEach(e){const t=this.renderChildren,i=t.length;for(let n=0;n<i;n++){const i=t[n];i.visible&&e(i,n,t)}return this}renderFilter(e){return K.filterArray(this.renderChildren,e)}hide(e){const t=this.renderParent;if(t){const e=t.renderTemplates;if(e){const i=t.renderChildren.findIndex(e=>e===this);if(-1!==i){const t=e[i];t&&t.node===this&&(e[i]=null)}}}this.rendered=!0,this.visible=!1}inherit(e,...t){for(const i of t)switch(i){case"base":this._documentParent=e.documentParent,this._bounds=j.assignRect(e.bounds),this._linear=j.assignRect(e.linear),this._box=j.assignRect(e.box),this._boxReset=j.newBoxModel(),this._boxAdjustment=j.newBoxModel(),-1===this.depth&&(this.depth=e.depth);const t=e.actualParent;t&&(this.actualParent=t,this.dir=t.dir);break;case"initial":K.cloneObject(e.unsafe("initial"),this.initial);break;case"alignment":{const t=e.unsafe("initial").styleMap,i=this._styleMap,n=this._initial.styleMap;this.positionAuto=e.positionAuto;for(const s of Z)i[s]=e.css(s),n[s]=t[s];if(!this.positionStatic)for(const s of q.BOX_POSITION)e.hasPX(s)&&(i[s]=e.css(s)),n[s]=t[s];if(e.autoMargin.horizontal||e.autoMargin.vertical)for(const t of q.BOX_MARGIN)"auto"===e.cssInitial(t)&&(i[t]="auto",n[t]="auto");break}case"styleMap":K.assignEmptyProperty(this._styleMap,e.unsafe("styleMap"));break;case"textStyle":this.cssApply(e.getTextStyle()),this.fontSize=e.fontSize;break;case"boxStyle":const{backgroundColor:i,backgroundImage:n}=e;this.cssApply({backgroundColor:i,backgroundImage:n,backgroundRepeat:e.css("backgroundRepeat"),backgroundSize:e.css("backgroundSize"),backgroundPositionX:e.css("backgroundPositionX"),backgroundPositionY:e.css("backgroundPositionY"),backgroundClip:e.css("backgroundClip"),border:"initial",borderRadius:"initial",borderTopWidth:e.css("borderTopWidth"),borderBottomWidth:e.css("borderBottomWidth"),borderRightWidth:e.css("borderRightWidth"),borderLeftWidth:e.css("borderLeftWidth"),borderTopColor:e.css("borderTopColor"),borderBottomColor:e.css("borderBottomColor"),borderRightColor:e.css("borderRightColor"),borderLeftColor:e.css("borderLeftColor"),borderTopStyle:e.css("borderTopStyle"),borderBottomStyle:e.css("borderBottomStyle"),borderRightStyle:e.css("borderRightStyle"),borderLeftStyle:e.css("borderLeftStyle"),borderTopLeftRadius:e.css("borderTopLeftRadius"),borderTopRightRadius:e.css("borderTopRightRadius"),borderBottomRightRadius:e.css("borderBottomRightRadius"),borderBottomLeftRadius:e.css("borderBottomLeftRadius")},!0),this.setCacheValue("backgroundColor",i),this.setCacheValue("backgroundImage",n),e.cssApply({borderTopWidth:"0px",borderBottomWidth:"0px",borderRightWidth:"0px",borderLeftWidth:"0px",backgroundColor:"transparent",backgroundImage:"none",border:"0px none solid",borderRadius:"0px"},!0),e.setCacheValue("backgroundColor",""),e.setCacheValue("backgroundImage",""),e.resetBox(510,this)}}addAlign(e){this.hasAlign(e)||(this.alignmentType|=e)}removeAlign(e){this.hasAlign(e)&&(this.alignmentType^=e)}hasAlign(e){return K.hasBit(this.alignmentType,e)}hasResource(e){return!K.hasBit(this.excludeResource,e)}hasProcedure(e){return!K.hasBit(this.excludeProcedure,e)}hasSection(e){return!K.hasBit(this.excludeSection,e)}exclude(e=0,t=0,i=0){e>0&&!K.hasBit(this._excludeResource,e)&&(this._excludeResource|=e),t>0&&!K.hasBit(this._excludeProcedure,t)&&(this._excludeProcedure|=t),i>0&&!K.hasBit(this._excludeSection,i)&&(this._excludeSection|=i)}setExclusions(){if(this.styleElement){const e=this.actualParent,t=(t,i)=>{let n=this.dataset[t]||"",s=0;if(e&&e.dataset[t+"Child"]&&(n+=(""!==n?"|":"")+e.dataset[t+"Child"]),""!==n)for(let e of n.split("|"))i[e=e.trim().toUpperCase()]&&!K.hasBit(s,i[e])&&(s|=i[e]);return s};this.exclude(t("excludeResource",z),t("excludeProcedure",U),t("excludeSection",X))}}appendTry(e,t,i=!0){let n=!1;const s=this.children,o=s.length;for(let i=0;i<o;i++)if(s[i]===e){s[i]=t,t.parent=this,t.containerIndex=e.containerIndex,n=!0;break}return!n&&i&&(t.parent=this,n=!0),n}sort(e){return e?super.sort(e):this.children.sort((e,t)=>e.containerIndex<t.containerIndex?-1:1),this}alignedVertically(e,t,i){if(this.lineBreak)return 2;if(this.pageFlow||this.positionAuto){const n=e=>e.blockVertical||e.percentWidth,s=e=>K.aboveRange(this.linear.top,e.linear.bottom)&&(n(this)||n(e)||this.float!==e.float);if(K.isArray(e)){if(t&&t.has(this))return 5;{const n=e[e.length-1];if(this.floating&&n.floating){if(i&&this.float===n.float)return 0;if(K.aboveRange(this.linear.top,n.linear.bottom))return 4;if(i&&t&&t.size&&!e.some((e,i)=>i>0&&t.get(e)===this.float))return 0}else{if(!1===i&&this.floating&&n.blockStatic)return 0;if(void 0!==i&&!this.display.startsWith("inline-")){const{top:n,bottom:s}=this.linear;if(this.textElement&&t&&t.size&&e.some(e=>t.has(e))&&e.some(e=>n<e.linear.top&&s>e.linear.bottom))return 7;if("right"===e[0].float){if(e.length>1){let t=n;if(this.multiline)if(this.plainText)t=s;else if(this.styleText){const e=this.textBounds;e&&e.top>n&&(t=e.top)}let o=-1/0;for(const t of e)"right"===t.float&&t.bounds.bottom>o&&(o=t.bounds.bottom);return K.belowRange(t,o)?i?0:6:i?6:0}if(!i)return 6}}}if(this.blockDimension&&s(n))return 3}}if(this.blockDimension&&"100%"===this.css("width")&&!this.hasPX("maxWidth"))return 1;const o=this.actualParent||this.documentParent,r=this.blockStatic||"table"===this.display;for(const i of this.siblingsLeading){if(i.lineBreak)return 2;if(t&&"both"===t.get(i)&&(!K.isArray(e)||e[0]!==i))return 5;if(r&&(!i.floating||!i.rightAligned&&K.withinRange(i.linear.right,o.box.right)||t&&t.has(i))||i.blockStatic||i.autoMargin.leftRight||"left"===i.float&&this.autoMargin.right||"right"===i.float&&this.autoMargin.left)return 1;if(i.floating&&r&&this.some(e=>e.floating&&K.aboveRange(e.linear.top,i.linear.bottom)))return 6;if(this.blockDimension&&s(i))return 3}}return 0}previousSiblings(e={}){const t=e.floating,i=e.pageFlow,n=e.lineBreak,s=e.excluded,o=[];let r=this.element;if(r)r=r.previousSibling;else{const e=this.firstChild;e&&(r=e.element)&&(r=r.previousSibling)}for(;r;){const e=$.getElementAsNode(r,this.sessionId);if(e)if(!1!==n&&e.lineBreak||!1!==s&&e.excluded&&!e.lineBreak)o.push(e);else if(e.pageFlow&&!e.excluded){if(!1===i)break;if(o.push(e),!1!==t||!e.floating&&(e.visible||e.rendered)&&"none"!==e.display)break}r=r.previousSibling}return o}nextSiblings(e={}){const t=e.floating,i=e.pageFlow,n=e.lineBreak,s=e.excluded,o=[];let r=this._element;if(r)r=r.nextSibling;else{const e=this.lastChild;e&&(r=e.element)&&(r=r.nextSibling)}for(;r;){const e=$.getElementAsNode(r,this.sessionId);if(e)if(!1!==n&&e.lineBreak||!1!==s&&e.excluded&&!e.lineBreak)o.push(e);else if(e.pageFlow&&!e.excluded){if(!1===i)break;if(o.push(e),!1!==t||!e.floating&&(e.visible||e.rendered)&&"none"!==e.display)break}r=r.nextSibling}return o}modifyBox(e,t,i=!0){if(0!==t){const n=D.get(e);if(n&&(void 0===t?(void 0===this._boxReset&&(this._boxReset=j.newBoxModel()),this._boxReset[n]=1):(void 0===this._boxAdjustment&&(this._boxAdjustment=j.newBoxModel()),i?this._boxAdjustment[n]+=t:this[n]+this._boxAdjustment[n]+t<=0?(void 0===this._boxReset&&(this._boxReset=j.newBoxModel()),this._boxReset[n]=1,this._boxAdjustment[n]=0):this._boxAdjustment[n]+=t),this._boxRegister)){const n=this._boxRegister[e];if(n)for(const s of n)s.modifyBox(e,t,i)}}}getBox(e){const t=D.get(e);return t?[this._boxReset?this._boxReset[t]:0,this._boxAdjustment?this._boxAdjustment[t]:0]:[0,0]}resetBox(e,t){void 0===this._boxReset&&(this._boxReset=j.newBoxModel());const i=this._boxReset,n=(e,n)=>{for(let s=0;s<4;s++)if(0===i[e[s]]&&(i[e[s]]=1,t)){const e=Q[s+n],i=D.get(e),o=this[i];0!==o&&(t.naturalChild||0!==t[i]?t.modifyBox(e,o):t.css(i,q.formatPX(o),!0),this.registerBox(e,t))}};K.hasBit(e,30)&&n(q.BOX_MARGIN,0),K.hasBit(e,480)&&n(q.BOX_PADDING,4)}transferBox(e,t){void 0===this._boxAdjustment&&(this._boxAdjustment=j.newBoxModel());const i=this._boxAdjustment;if(i){const n=(e,n)=>{for(let s=0;s<4;s++){const o=i[e[s]];if(o>0){const r=Q[s+n];t.modifyBox(r,o,!1),this.registerBox(r,t),i[e[s]]=0}}};K.hasBit(e,30)&&n(q.BOX_MARGIN,0),K.hasBit(e,480)&&n(q.BOX_PADDING,4)}}registerBox(e,t){void 0===this._boxRegister&&(this._boxRegister={});const i=this._boxRegister;return void 0===i[e]&&(i[e]=new Set),t&&i[e].add(t),i[e]}actualRect(e,t="linear"){const i=this[t][e];if(this.inputElement){const n=this.companion;switch(e){case"top":case"left":if(n&&!n.visible&&n[t][e]<i)return n[t][e];break;case"right":case"bottom":if(n&&!n.visible&&n[t][e]>i)return n[t][e];break;default:return NaN}}return i}actualPadding(e,t){let i=this;for(;!i.naturalChild;){const n=i.innerWrapped;if(!n)return t;if((i=n).naturalChild&&1!==i.getBox("paddingTop"===e?32:128)[0])return t}let n=!1;if(J(i)){n=function i(n){let s=!1;for(const o of n){if(o.blockStatic)return!1;if(o.inlineStatic){if(o.has("lineHeight")&&o.lineHeight>o.bounds.height)return!1;if(o[e]>=t)s=!0;else if(J(o)){if(!i(o.naturalElements))return!1;s=!0}}}return s}(i.naturalElements)}return n?0:t}cloneBase(e){e.localSettings=this.localSettings,e.alignmentType=this.alignmentType,e.containerName=this.containerName,e.depth=this.depth,e.visible=this.visible,e.excluded=this.excluded,e.rendered=this.rendered,e.childIndex=this.childIndex,e.containerIndex=this.containerIndex,e.inlineText=this.inlineText,e.lineBreakLeading=this.lineBreakLeading,e.lineBreakTrailing=this.lineBreakTrailing,e.actualParent=this.actualParent,e.documentParent=this.documentParent,e.documentRoot=this.documentRoot,e.renderParent=this.renderParent,this.length&&e.retain(this.duplicate()),e.inherit(this,"initial","base","alignment","styleMap","textStyle"),Object.assign(e.unsafe("cached"),this._cached)}css(e,t,i=!1){return arguments.length>=2&&(t?this._styleMap[e]=t:delete this._styleMap[e],i&&this.unsetCache(e)),this._styleMap[e]||this.styleElement&&this.style[e]||""}cssApply(e,t=!1){if(Object.assign(this._styleMap,e),t)for(const t in e)this.unsetCache(t);return this}cssSet(e,t,i=!0){return super.css(e,t,i)}setCacheValue(e,t){this._cached[e]=t}get element(){let e=this._element;if(null===e){let t=this.innerWrapped;for(;t&&!(e=t.unsafe("element"));)t=t.innerWrapped}return e}get naturalChild(){return null!==this._element&&null!==this._element.parentElement}get pseudoElement(){return null!==this._element&&"__squared.pseudo"===this._element.className}set documentParent(e){this._documentParent=e}get documentParent(){return this._documentParent||this.absoluteParent||this.actualParent||this.parent||this}set containerName(e){this._cached.containerName=e.toUpperCase()}get containerName(){let e=this._cached.containerName;if(void 0===e){e="";const t=this.element;t&&(e=j.isTextNode(t)?"PLAINTEXT":"INPUT"===t.tagName?"INPUT_"+t.type.toUpperCase():t.tagName.toUpperCase()),this._cached.containerName=e}return e}get excludeSection(){return this._excludeSection}get excludeProcedure(){return this._excludeProcedure}get excludeResource(){return this._excludeResource}get layoutHorizontal(){return this.hasAlign(8)}get layoutVertical(){return this.hasAlign(16)}get nodeGroup(){return!1}set renderAs(e){this.rendered||!e||e.rendered||(this._renderAs=e)}get renderAs(){return this._renderAs}get blockStatic(){return super.blockStatic||this.hasAlign(64)&&!this.floating}get rightAligned(){return super.rightAligned||this.hasAlign(2048)}set positionAuto(e){this._cached.positionAuto=e}get positionAuto(){return super.positionAuto}set flexbox(e){this._cached.flexbox=e}get flexbox(){return super.flexbox}set contentBoxWidth(e){this._cached.contentBoxWidth=e}get contentBoxWidth(){return super.contentBoxWidth}set contentBoxHeight(e){this._cached.contentBoxHeight=e}get contentBoxHeight(){return super.contentBoxHeight}set textContent(e){this._cached.textContent=e}get textContent(){let e=this._cached.textContent;return void 0===e&&(this._cached.textContent=e=this.naturalChild&&this._element?this._element.textContent:""),e}set overflow(e){0!==e&&16!==e&&8!==e&&24!==e||(K.hasBit(this.overflow,64)&&(e|=64),this._cached.overflow=e)}get overflow(){return super.overflow}set baseline(e){this._cached.baseline=e}get baseline(){return super.baseline}set multiline(e){this._cached.multiline=e}get multiline(){return super.multiline}set visible(e){this._visible=e}get visible(){return this._visible}set controlName(e){this.rendered&&void 0!==this._controlName||(this._controlName=e)}get controlName(){return this._controlName||""}set siblingsLeading(e){this._siblingsLeading=e}get siblingsLeading(){return void 0===this._siblingsLeading&&(this._siblingsLeading=this.previousSiblings()),this._siblingsLeading}set siblingsTrailing(e){this._siblingsTrailing=e}get siblingsTrailing(){return void 0===this._siblingsTrailing&&(this._siblingsTrailing=this.nextSiblings()),this._siblingsTrailing}get previousSibling(){const e=this.actualParent;if(e){const t=e.naturalChildren,i=t.indexOf(this);if(-1!==i)for(let e=i-1;e>=0;e--){const i=t[e];if(i&&(!i.excluded||i.lineBreak))return i}}return null}get nextSibling(){const e=this.actualParent;if(e){const t=e.naturalChildren,i=t.indexOf(this);if(-1!==i){const e=t.length;for(let n=i+1;n<e;n++){const e=t[n];if(e&&(!e.excluded||e.lineBreak))return e}}}return null}get firstChild(){return this.naturalChildren[0]||null}get lastChild(){const e=this.naturalChildren;return e[e.length-1]||null}get onlyChild(){if(this.renderParent)return 1===this.renderParent.length;{const e=this.parent;if(e&&0!==e.id)return 1===e.length}return!1}get textEmpty(){let e=this._cached.textEmpty;return void 0===e&&(e=this.styleElement&&(""===this.textContent||!this.preserveWhiteSpace&&""===this.textContent.trim())&&!this.imageElement&&!this.svgElement&&"HR"!==this.tagName,this._cached.textEmpty=e),e}get preserveWhiteSpace(){let e=this._cached.whiteSpace;return void 0===e&&(e=this.cssAny("whiteSpace","pre","pre-wrap"),this._cached.whiteSpace=e),e}get leftTopAxis(){let e=this._cached.leftTopAxis;if(void 0===e){const t=this.cssInitial("position");this._cached.leftTopAxis=e="absolute"===t&&this.absoluteParent===this.documentParent||"fixed"===t}return e}set fontSize(e){this._fontSize=e}get fontSize(){return super.fontSize}}const te=squared.lib.util;class ie extends squared.lib.base.Container{constructor(e,t,i=0,n=0,s){super(s),this.parent=e,this.node=t,this.containerType=i,this.alignmentType=n,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,s&&s.length&&this.init()}init(){const e=this.children,t=e.length;if(t){if(t>1){const t=ee.linearData(e);this._floated=t.floated,this._cleared=t.cleared,this._linearX=t.linearX,this._linearY=t.linearY}else this._linearY=e[0].blockStatic,this._linearX=!this._linearY;let i=0,n=0;for(let s=0;s<t;s++){const t=e[s];if(t.floating?i++:i=1/0,t.rightAligned?n++:n=1/0,i===1/0&&n===1/0)break}(i===t||this._floated&&2===this._floated.size)&&(this.add(512),this.some(e=>e.blockStatic)&&this.add(64)),n===t&&this.add(2048),this.itemCount=t}}setType(e){this.setContainerType(e.containerType,e.alignmentType)}setContainerType(e,t){this.containerType=e,t&&this.add(t)}hasAlign(e){return te.hasBit(this.alignmentType,e)}add(e){return te.hasBit(this.alignmentType,e)||(this.alignmentType|=e),this.alignmentType}delete(e){return te.hasBit(this.alignmentType,e)&&(this.alignmentType^=e),this.alignmentType}retain(e){return super.retain(e),this.init(),this}get linearX(){return void 0===this._linearX||this._linearX}get linearY(){return void 0!==this._linearY&&this._linearY}get floated(){return this._floated||new Set}get cleared(){return this._cleared||new Map}get singleRowAligned(){if(void 0===this._singleRow){const e=this.length;if(!e)return!1;if(this._singleRow=!0,e>1){let e=1/0;for(const t of this.children){if(t.multiline||t.blockStatic){this._singleRow=!1;break}if(te.aboveRange(t.linear.top,e)){this._singleRow=!1;break}e=t.linear.bottom}}}return this._singleRow}get unknownAligned(){return this.length>1&&!this.linearX&&!this.linearY}get visible(){return this.filter(e=>e.visible)}}const{css:ne,dom:se,regex:oe,session:re,util:ae,xml:le}=squared.lib,ce={};let he;class de extends E{constructor(e,i,n,s,o){super(e,i,n,s,o),this.session={cache:new t,excluded:new t,extensionMap:new Map,active:[],documentRoot:[],targetQueue:new Map},this.builtInExtensions={},this.extensions=[],this._layouts=[],he=i}static prioritizeExtensions(e,t){if(e.dataset.use){const i=e.dataset.use.split(oe.XML.SEPARATOR),n=[],s=[];for(const e of t){const t=i.indexOf(e.name);-1!==t?n[t]=e:s.push(e)}if(n.length)return ae.spliceArray(n,e=>void 0===e).concat(s)}return t}finalize(){const e=this.controllerHandler;for(const[e,t]of this.session.targetQueue.entries()){const i=e.dataset.target;if(i){const n=this.resolveTarget(i);n?(e.render(n),this.addLayoutTemplate(n,e,t)):void 0===e.renderParent&&this.session.cache.remove(e)}}const t=this.rendered;for(const e of t)e.hasProcedure(U.LAYOUT)&&e.setLayout(),e.hasProcedure(U.ALIGNMENT)&&e.setAlignment();e.optimize(t);for(const e of this.extensions)for(const t of e.subscribers)e.postOptimize(t);for(const e of this.rendered)e.hasResource(z.BOX_SPACING)&&e.setBoxSpacing();for(const e of this.extensions)e.beforeCascade();const i=e.localSettings.layout.baseTemplate;for(const t of this.session.documentRoot){const n=t.node;if(n.documentRoot&&0===n.renderChildren.length&&!n.inlineText&&n.naturalChildren.every(e=>e.documentRoot))continue;const s=n.renderParent;s&&s.renderTemplates&&this.saveDocument(t.layoutName,i+e.cascadeDocument(s.renderTemplates,0),n.dataset.pathname,n.renderExtension&&n.renderExtension.some(e=>e.documentBase)?0:void 0)}const n=this._layouts;this.resourceHandler.finalize(n),e.finalize(n);for(const e of this.extensions)e.afterFinalize();se.removeElementsByClassName("__squared.pseudo"),this.closed=!0}copyToDisk(e,t){super.copyToDisk(e,t,this.layouts)}appendToArchive(e){super.appendToArchive(e,this.layouts)}saveToArchive(e){super.saveToArchive(e,this.layouts)}reset(){super.reset();for(const e of this.rootElements)e.dataset.iteration="";const e=this.session;e.cache.reset(),e.excluded.reset(),e.extensionMap.clear(),e.documentRoot.length=0,e.targetQueue.clear(),this._layouts.length=0}conditionElement(e){const t=this.controllerHandler;if(!t.localSettings.unsupported.excluded.has(e.tagName)){if(t.visibleElement(e)||this._cascadeAll||e.dataset.use&&e.dataset.use.split(oe.XML.SEPARATOR).some(e=>!!this.extensionManager.retrieve(e)))return!0;{let i=e.parentElement,n=!0;for(;i;){if("none"===ne.getStyle(i).display){n=!1;break}i=i.parentElement}if(n){const i=e.children,n=i.length;for(let e=0;e<n;e++)if(t.visibleElement(i[e]))return!0}return!1}}return!1}insertNode(e,t){if(!se.isTextNode(e)){if(this.conditionElement(e))return this.controllerHandler.applyDefaultStyles(e),this.createNode(e,!1);{const t=this.createNode(e,!1);return t.visible=!1,t.excluded=!0,t}}if(le.isPlainText(e.textContent)||t&&t.preserveWhiteSpace&&("PRE"!==t.tagName||0===t.element.children.length)){this.controllerHandler.applyDefaultStyles(e);const i=this.createNode(e,!1);return t&&(i.cssApply(t.getTextStyle()),i.fontSize=t.fontSize),i}}saveDocument(e,t,i,n){if(ae.isString(t)){const s={pathname:i?ae.trimString(i,"/"):this.controllerHandler.localSettings.layout.pathName,filename:e,content:t,index:n},o=this._layouts;void 0!==n&&n>=0&&n<o.length?o.splice(n,0,s):o.push(s)}}renderNode(e){return 0===e.itemCount?this.controllerHandler.renderNode(e):this.controllerHandler.renderNodeGroup(e)}addLayout(e){if(ae.hasBit(e.renderType,512)&&(ae.hasBit(e.renderType,8)?e=this.processFloatHorizontal(e):ae.hasBit(e.renderType,16)&&(e=this.processFloatVertical(e))),0!==e.containerType){const t=this.renderNode(e);if(t)return this.addLayoutTemplate(t.parent||e.parent,e.node,t,e.renderIndex)}return!1}addLayoutTemplate(e,t,i,n=-1){return!!i&&(t.renderExclude?(t.hide(),t.excluded=!0):t.renderParent?(void 0===e.renderTemplates&&(e.renderTemplates=[]),n>=0&&n<e.renderChildren.length?(e.renderChildren.splice(n,0,t),e.renderTemplates.splice(n,0,i)):(e.renderChildren.push(t),e.renderTemplates.push(i))):this.session.targetQueue.set(t,i),!0)}createNode(e,t=!0,i,n){const s=this.processing,o=new he(this.nextId,s.sessionId,e,this.controllerHandler.afterInsertNode);if(i&&(o.depth=i.depth+1),void 0===e&&i&&i.naturalElement&&(o.actualParent=i),n)for(const e of n)e.parent=o;return t&&s.cache.append(o,void 0!==n),o}createCache(e){const t=this.createRootNode(e);if(t){const e=t.parent;t.documentBody&&(e.visible=!1,this.processing.cache.append(e)),t.documentParent=e;const n=this.controllerHandler,s=this.processing.cache,o={},r=new Set;let a=!1;function i(e,t,i,n,s){void 0===o[t]&&(o[t]={}),o[t][i]=s,e.style.setProperty(i,n)}for(const e of s)if(e.styleElement){const t=e.element;if(e.length){const n=e.cssInitial("textAlign");switch(n){case"center":case"right":case"end":i(t,e.id,"text-align","left",n)}}if(e.positionRelative)for(const n of ne.BOX_POSITION)e.hasPX(n)&&(i(t,e.id,n,"auto",e.css(n)),a=!0);"rtl"===e.dir&&(t.dir="ltr",r.add(t))}!a&&r.size&&(a=!0);for(const e of this.processing.excluded)e.pageFlow||e.cssTry("display","none");t.parent.setBounds();for(const e of s)if(e.pseudoElement){const t=e.actualParent.element;if(t){const i=t.id;let n;e.pageFlow&&(t.id="id_"+Math.round(Math.random()*(new Date).getTime()),n=ne.insertStyleSheetRule(`#${t.id+ee.getPseudoElt(e)} { display: none !important; }`)),e.cssTry("display",e.display)&&(e.setBounds(!1),e.cssFinally("display")),n&&document.head.removeChild(n),t.id=i}}else e.setBounds(void 0===o[e.id]&&!a),t.styleText&&(e.textBounds=se.getRangeClientRect(t.element));for(const e of this.processing.excluded)e.lineBreak||(e.setBounds(),e.saveAsInitial()),e.pageFlow||e.cssFinally("display");for(const e of s){if(e.styleElement){const t=e.element,i=o[e.id];if(i)for(const e in i)t.style.setProperty(e,i[e]);r.has(t)&&(t.dir="rtl")}e.saveAsInitial()}return n.evaluateNonStatic(t,s),n.sortInitialCache(s),!0}return!1}afterCreateCache(e){const t=e.dataset,i=t.filename&&t.filename.replace(RegExp(`.${this.controllerHandler.localSettings.layout.fileExtension}$`),"")||e.id||"document_"+this.length,n=(t.iteration?ae.convertInt(t.iteration):-1)+1;t.iteration=""+n,t.layoutName=ae.convertWord(n>1?i+"_"+n:i,!0),this.setBaseLayout(t.layoutName),this.setConstraints(),this.setResources()}resolveTarget(e){for(const t of this.processing.cache)if(t.elementId===e||t.controlId===e)return t;for(const t of this.session.cache)if(t.elementId===e||t.controlId===e)return t}toString(){const e=this._layouts;return e.length?e[0].content:""}cascadeParentNode(e,t=0){const i=this.insertNode(e);if(i){if(i.depth=t,0===t){this.processing.cache.append(i);const e=this.extensionManager;for(const t of i.extensions){const i=e.retrieve(t);if(i&&i.cascadeAll){this._cascadeAll=!0;break}}}const n=this.controllerHandler;if(n.preventNodeCascade(e))return i;const s=this.processing.sessionId,o=this.createPseduoElement(e,"::before",s),r=this.createPseduoElement(e,"::after",s),a=e.childNodes,l=a.length,c=Array(l),h=Array(e.childElementCount);let d=!0,u=0,f=0;for(let e=0;e<l;e++){const s=a[e];let l;s===o?(l=this.insertNode(o))&&(i.innerBefore=l,l.textEmpty||(l.inlineText=!0),d=!1):s===r?(l=this.insertNode(r))&&(i.innerAfter=l,l.textEmpty||(l.inlineText=!0),d=!1):"#"===s.nodeName.charAt(0)?se.isTextNode(s)&&(l=this.insertNode(s,i)):n.includeElement(s)&&(de.prioritizeExtensions(s,this.extensions).some(e=>e.init(s)),this.rootElements.has(s)?((l=this.insertNode(s))&&(l.documentRoot=!0,l.visible=!1,l.excluded=!0),d=!1):!(l=this.cascadeParentNode(s,t+1))||l.excluded&&"WBR"!==l.tagName||(d=!1),l&&(h[f++]=l)),l&&(l.childIndex=u,c[u++]=l)}c.length=u,h.length=f,i.naturalChildren=c,i.naturalElements=h,this.cacheNodeChildren(i,c,d),this.userSettings.createQuerySelectorMap&&f>0&&(i.queryMap=this.createQueryMap(h,f))}return i}cacheNodeChildren(e,t,i){const n=t.length;if(n){const s=this.processing.cache;let o=[],r=[];if(n>1){let a=t[0],l=!1;for(let c=0,h=0;c<n;c++){const d=t[c];d.excluded?this.processing.excluded.append(d):d.plainText&&i||(d.containerIndex=h++,d.parent=e,s.append(d)),d.pageFlow&&(d.floating&&(l=!0),c>0&&(r.push(d),d.lineBreak&&(t[c-1].lineBreakTrailing=!0)),d.excluded||(d.siblingsLeading=o,a.siblingsTrailing=r,o=[],r=[],a=d),c<n-1&&(o.push(d),d.lineBreak&&(t[c+1].lineBreakLeading=!0))),d.actualParent=e}a.siblingsTrailing=r,e.floatContainer=l}else{const i=t[0];i.excluded?this.processing.excluded.append(i):i.plainText||(i.siblingsLeading=o,i.siblingsTrailing=r,i.parent=e,i.containerIndex=0,s.append(i)),i.actualParent=e}}else i=!e.textEmpty;e.inlineText=i}createPseduoElement(e,t,i){let n=re.getElementCache(e,"styleMap"+t,i),s=0;if("Q"===e.tagName&&(void 0===n&&re.setElementCache(e,"styleMap"+t,i,n={}),n.content||(n.content=ne.getStyle(e,t).getPropertyValue("content")||("::before"===t?"open-quote":"close-quote")),n.content.endsWith("-quote"))){let t=e.parentElement;for(;t&&"Q"===t.tagName;)s++,t=t.parentElement}if(n){let l=n.content;if(l){if(""===ae.trimString(l,'"').trim()&&0===ae.convertFloat(n.width)&&0===ae.convertFloat(n.height)&&("absolute"===n.position||"fixed"===n.position||n.clear&&"none"!==n.clear)){let e=!0;for(const t in n)if(/(Width|Height)$/.test(t)){const i=n[t];if(ne.isLength(i,!0)&&0!==ae.convertFloat(i)){e=!1;break}}if(e)return}if("inherit"===l){let t=e;for(;t&&"inherit"===(l=ne.getStyle(t).getPropertyValue("content"));)t=t.parentElement}const c=ne.getStyle(e);void 0===n.fontFamily&&(n.fontFamily=c.getPropertyValue("font-family")),void 0===n.fontSize&&(n.fontSize=c.getPropertyValue("font-size")),void 0===n.fontWeight&&(n.fontWeight=c.getPropertyValue("font-weight")),void 0===n.color&&(n.color=c.getPropertyValue("color")),void 0===n.display&&(n.display="inline");let h=n.display.startsWith("inline")?"span":"div",d="";switch(l){case"normal":case"none":case"initial":case"inherit":case"no-open-quote":case"no-close-quote":case'""':break;case"open-quote":"::before"===t&&(d=s%2==0?"&#8220;":"&#8216;");break;case"close-quote":"::after"===t&&(d=s%2==0?"&#8221;":"&#8217;");break;default:if(l.startsWith("url(")){d=ne.resolveURL(l);const e=ae.fromLastIndexOf(d,".").toLowerCase(),t=this.controllerHandler.localSettings.supported.imageFormat;"*"===t||t.includes(e)?h="img":d=""}else{ce.COUNTER?ce.COUNTER.lastIndex=0:(ce.COUNTER=/\s*(?:attr\(([^)]+)\)|(counter)\(([^,)]+)(?:, ([a-z\-]+))?\)|(counters)\(([^,]+), "([^"]*)"(?:, ([a-z\-]+))?\)|"([^"]+)")\s*/g,ce.COUNTER_VALUE=/\s*([^\-\d][^\-\d]?[^ ]*) (-?\d+)\s*/g);let n,s=!1;for(;null!==(n=ce.COUNTER.exec(l));){if(n[1])d+=se.getNamedItem(e,n[1].trim());else if(n[2]||n[5]){const s="counter"===n[2];let l,h;function o(e){if("none"!==e){let t;for(ce.COUNTER_VALUE.lastIndex=0;null!==(t=ce.COUNTER_VALUE.exec(e));)if(t[1]===l)return parseInt(t[2])}}s?(l=n[3],h=n[4]||"decimal"):(l=n[6],h=n[8]||"decimal");const u=e=>{const n=re.getElementCache(e,"styleMap"+t,i);if(n&&n.counterIncrement)return o(n.counterIncrement)},f=(u(e)||0)+(o(c.getPropertyValue("counter-reset"))||0),g=[];let p,m=e,b=f,x=!1;function r(e,t){0===g.length?b+=e:(x||t)&&(g[g.length-1]+=e)}function a(e){if(void 0===o(ne.getStyle(e).getPropertyValue("counter-reset"))){const t=e.children,i=t.length;for(let e=0;e<i;e++){const i=t[e];if("__squared.pseudo"!==i.className){let e=u(i);e&&r(e,!0);const t=ne.getStyle(i);if((e=o(t.getPropertyValue("counter-increment")))&&r(e,!1),void 0!==(e=o(t.getPropertyValue("counter-reset"))))return;a(i)}}}}for(;;){if(x=!1,m.previousElementSibling)a(m=m.previousElementSibling);else{if(!m.parentElement)break;m=m.parentElement,x=!0}if("__squared.pseudo"!==m.className){const e=u(m);e&&r(e,!0);const t=ne.getStyle(m),i=o(t.getPropertyValue("counter-increment"))||0;i&&r(i,!1);const n=o(t.getPropertyValue("counter-reset"));if(void 0!==n){if(void 0===p&&(b+=n),p=m,s)break;x&&g.push((e||0)+n)}}}if(p){if(!s&&g.length>1){g.reverse(),g.splice(1,1);for(const e of g)d+=ne.convertListStyle(h,e,!0)+n[7]}}else b=f;d+=ne.convertListStyle(h,b,!0)}else n[9]&&(d+=n[9]);s=!0}s||(d=l)}}if(d||'""'===l){const s=function(e,t="span",i=-1){const n=document.createElement(t);return n.className="__squared.pseudo",n.style.setProperty("display","none"),i>=0&&i<e.childNodes.length?e.insertBefore(n,e.childNodes[i]):e.appendChild(n),n}(e,h,"::before"===t?0:-1);if("img"===h){s.src=d;const e=this.resourceHandler.getImage(d);if(e){const{width:t,height:i}=e;if(t>0){const e=ne.formatPX(t);void 0===n.width&&(n.width=e),s.style.width=e}if(i>0){const e=ne.formatPX(i);void 0===n.height&&(n.height=e),s.style.height=e}}}else'""'!==l&&(s.innerText=d);for(const e in n)"display"!==e&&(s.style[e]=n[e]);return re.setElementCache(s,"pseudoElement",i,t),re.setElementCache(s,"styleMap",i,n),s}}}}setBaseLayout(e){const t=this.controllerHandler,i=this.processing,n=this.session,s=i.cache,o=i.node,r=this.session.extensionMap,a=new Map;let l=ae.filterArray(this.extensions,e=>!e.eventOnly);function c(e,t,i){const n=a.get(e)||new Map;a.set(e,n.set(t,i))}function h(e){for(const t of a.values())for(const i of t.values())if(i.id===e)return void t.delete(i.id)}c(-1,0,o.parent);let d=0;for(const e of s)e.visible&&e.length&&(c(e.depth,e.id,e),d=Math.max(e.depth,d));for(let e=0;e<d;e++)a.set(-1*e-2,new Map);s.afterAppend=e=>{h(e.id),c(-1*e.depth-2,e.id,e);for(const t of e.cascade())h(t.id),c(-1*t.depth-2,t.id,t)};for(const e of this.extensions)e.beforeBaseLayout();for(const e of a.values())for(const i of e.values()){if(0===i.length)continue;const e=i.duplicate(),n=i.floatContainer,s=e.length,o=i.renderExtension;let a;n&&(a=ee.linearData(i.naturalElements,!0).cleared);for(let i=0;i<s;i++){let c=e[i];if(c.rendered||!c.visible||c.naturalElement&&!c.documentRoot&&this.rootElements.has(c.element))continue;let h=c.parent;if(s>1&&i<s-1&&c.pageFlow&&!c.nodeGroup&&(0===h.alignmentType||h.hasAlign(2)||c.hasAlign(8192))&&!h.hasAlign(4)&&c.hasSection(X.DOM_TRAVERSE)){const o=[],r=[];let l=!1;function u(e){return!r.length&&!l&&(o.push(e),!0)}function f(e){return!o.length&&(r.push(e),!0)}let d,g,p=i,m=0;c.hasAlign(8192)&&h.layoutVertical&&(o.push(c),p++,m++);e:{let t,i;for(n&&(t=new Set,i=new Map);p<s;p++,m++){const s=e[p];if(s.pageFlow){if(n){if(t.size){const e=a.get(s);e&&("both"===e?t.clear():t.delete(e),i.set(s,e))}s.floating&&t.add(s.float)}if(0===m){const e=s.siblingsTrailing[0];if(e){!s.horizontalAligned||e.alignedVertically([s])?r.push(s):o.push(s);continue}}const e=s.siblingsLeading[0];if(!e)break e;if(n){const n=s.alignedVertically(o.length?o:r,a,o.length>0);if(n>0){if(o.length){if(7!==n&&6!==n&&t.size&&"both"!==i.get(s)&&!s.siblingsLeading.some(e=>e.lineBreak&&!a.has(e))&&(!s.floating||e.floating&&!ae.aboveRange(s.linear.top,e.linear.bottom))){if(i.has(s)){if(!s.floating){s.addAlign(8192),o.push(s),l=!0;continue}break e}{let e=-1/0;if(s.floating||ae.captureMap(o,e=>e.floating,t=>e=Math.max(e,t.linear.bottom)),!s.floating&&!ae.aboveRange(s.linear.top,e)||s.floating&&t.has(s.float)){if(o.push(s),!s.floating&&ae.aboveRange(s.linear.bottom,e))break e;continue}}}break e}if(!f(s))break e}else if(!u(s))break e}else if(s.alignedVertically()){if(!f(s))break e}else if(!u(s))break e}else if(s.positionAuto){if(r.length){r[r.length-1].blockStatic&&r.push(s);break}o.push(s)}}}o.length>1?(d=t.processTraverseHorizontal(new ie(h,c,0,0,o),e),g=o[o.length-1]):r.length>1&&(d=t.processTraverseVertical(new ie(h,c,0,0,r),e),(g=r[r.length-1]).horizontalAligned&&g!==e[s-1]&&g.addAlign(8192)),d&&this.addLayout(d)&&(g===e[s-1]&&h.removeAlign(2),h=c.parent)}if(c.removeAlign(8192),i===s-1&&h.removeAlign(2),c.renderAs&&h.appendTry(c,c.renderAs,!1)&&(c.hide(),(c=c.renderAs).positioned&&(h=c.parent)),!c.rendered&&c.hasSection(X.EXTENSION)){const e=r.get(c.id);let t;if(t=e?o?o.concat(e):e:o){let e=!1;for(const i of t){const t=i.processChild(c,h);if(t){const{output:i,renderAs:n,outputAs:s}=t;if(i&&this.addLayoutTemplate(t.parentAs||h,c,i),n&&s&&this.addLayoutTemplate(h,n,s),t.parent&&(h=t.parent),e=!0===t.next,t.complete||e)break}}if(e)continue}if(c.styleElement){const t=de.prioritizeExtensions(c.element,l);let i=!1;function g(e){const t=l.indexOf(e);-1!==t&&(l=l.slice(0)).splice(t,1)}for(const n of t)if(n.is(c)&&(n.removeIs&&g(n),n.condition(c,h)&&(void 0===e||!e.includes(n)))){const e=n.processNode(c,h);if(e){const{output:t,renderAs:s,outputAs:o,include:r}=e;if(t&&this.addLayoutTemplate(e.parentAs||h,c,t),s&&o&&this.addLayoutTemplate(h,s,o),e.parent&&(h=e.parent),(t&&!1!==r||r)&&(void 0===c.renderExtension&&(c.renderExtension=[]),c.renderExtension.push(n),n.subscribers.add(c)),e.remove&&g(n),i=!0===e.next,e.complete||i)break}}if(i)continue}}if(!c.rendered&&c.hasSection(X.RENDER)){let e=this.createLayoutControl(h,c);if(0===e.containerType){const i=c.length?t.processUnknownParent(e):t.processUnknownChild(e);if(!0===i.next)continue;e=i.layout}this.addLayout(e)}}}for(const t of s)t.documentRoot&&t.rendered&&n.documentRoot.push({node:t,layoutName:t===o?e:""});s.sort((e,t)=>e.depth===t.depth?e.nodeGroup&&(0===t.length||t.naturalChild)?-1:t.nodeGroup&&(0===e.length||e.naturalChild)?1:0:e.depth<t.depth?-1:1),n.cache.concat(s.children),n.excluded.concat(i.excluded.children);for(const e of this.extensions){for(const t of e.subscribers)s.contains(t)&&e.postBaseLayout(t);e.afterBaseLayout()}}setConstraints(){const e=this.processing.cache;this.controllerHandler.setConstraints();for(const t of this.extensions){for(const i of t.subscribers)e.contains(i)&&t.postConstraints(i);t.afterConstraints()}}setResources(){const e=this.resourceHandler;for(const t of this.processing.cache)e.setBoxStyle(t),e.setFontStyle(t),e.setValueString(t);for(const e of this.extensions)e.afterResources()}processFloatHorizontal(e){const t=this.controllerHandler,i=[],n=[],s=[],o=[],r=[];let a,l,c,h,d=0;e.each((t,i)=>{if(i>0){const i=e.cleared.get(t);if(i)switch(i){case"left":ae.hasBit(d,2)||(d|=2);break;case"right":ae.hasBit(d,4)||(d|=4);break;default:d=6}}if(0===d)if("right"===t.float)r.push(t);else if("left"===t.float)o.push(t);else if(o.length||r.length){let e=t.linear.top;if(t.styleText){const i=t.textBounds;i&&i.top>e&&(e=i.top)}o.some(t=>e>=t.linear.bottom)||r.some(t=>e>=t.linear.bottom)?s.push(t):n.push(t)}else n.push(t);else"right"===t.float?4===d||6===d?(void 0===l&&(l=[]),l.push(t)):r.push(t):"left"===t.float?2===d||6===d?(void 0===a&&(a=[]),a.push(t)):o.push(t):6===d?s.push(t):n.push(t)}),o.length&&a?c=[o,a]:o.length&&(c=o),r.length&&l?h=[r,l]:r.length&&(h=r);const{containerType:u,alignmentType:f}=t.containerTypeVertical;if(r.length+(l?l.length:0)===e.length&&e.add(2048),s.length){const{node:t,parent:i}=e;s.length>1&&s[0].addAlign(8192),s.unshift(t);const n=this.createNode(void 0,!0,i,s);n.containerName=t.containerName,n.inherit(t,"boxStyle"),n.innerWrapped=t,t.outerWrapper=n,this.addLayout(new ie(i,n,u,f|(i.blockStatic?64:0),s)),e.parent=n}n.length&&i.push(n),c&&i.push(c),h&&i.push(h),e.setType(t.containerTypeVerticalMargin),e.itemCount=i.length,e.add(64);for(const s of i){let i,a;if(Array.isArray(s[0])){const n=e.node;let o=(i=s)[0];for(let e=1;e<i.length;e++)o=o.concat(i[e]);if(o.sort((e,t)=>e.childIndex<t.childIndex?-1:1),n.layoutVertical)a=n;else{a=t.createNodeGroup(o[0],o,n);const e=new ie(n,a,u,f|(i.some(e=>e===h||e===r)?2048:0));e.itemCount=i.length,this.addLayout(e)}}else i=[s];for(const s of i){const i=a||e.node,l=t.createNodeGroup(s[0],s,i,!0),c=new ie(i,l,0,128|(s===n?256:0),s);1===s.length?(c.node.innerWrapped=s[0],s[0].outerWrapper=c.node,s[0].percentWidth?c.setType(t.containerTypePercent):c.setContainerType(u,f)):c.linearY||c.unknownAligned?c.setContainerType(u,f|(c.unknownAligned?2:0)):t.processLayoutHorizontal(c),this.addLayout(c),s===n&&this.setFloatPadding(i,l,n,o,r)}}return e}processFloatVertical(e){const t=this.controllerHandler,{containerType:i,alignmentType:n}=t.containerTypeVertical;if(0!==e.containerType){const s=e.node,o=t.createNodeGroup(s,[s],e.parent);this.addLayout(new ie(o,s,i,n,o.children)),e.node=o}else e.containerType=i,e.add(n);const s=[],o=[],r=[],a=[];let l=!1,c=!1,h=!0;for(const t of e)t.blockStatic&&0===a.length?(r.push(t),c=!0):(e.cleared.has(t)&&(t.floating?l=!0:(t.modifyBox(2),s.push(r.slice(0)),o.push(a.slice(0)),r.length=0,a.length=0)),t.floating?(c&&(s.push(r.slice(0)),o.push(null),r.length=0,a.length=0,c=!1),a.push(t)):(l&&!e.cleared.has(t)&&(h=!1),r.push(t)));if(a.length&&o.push(a),r.length&&s.push(r),!h)for(let r=0;r<Math.max(o.length,s.length);r++){const a=s[r]||[];if(null===o[r]&&a.length){const i=t.containerTypeVertical;i.alignmentType|=192,this.addLayout(new ie(e.node,t.createNodeGroup(a[0],a,e.node),i.containerType,i.alignmentType,a))}else{const s=o[r]||[];if(a.length||s.length){const o=t.containerTypeVerticalMargin,r=t.createNodeGroup(s[0]||a[0],[],e.node),l=new ie(e.node,r,o.containerType,o.alignmentType),c=[];let h;if(s.length){const e=t.createNodeGroup(s[0],s,r);l.add(512),0===a.length&&s.every(e=>"right"===e.float)&&l.add(2048),c.push(e)}a.length&&(h=t.createNodeGroup(a[0],a,r),c.push(h)),r.init(),l.itemCount=c.length,this.addLayout(l);for(let e of c)e.nodeGroup||(e=t.createNodeGroup(e,[e],r,!0)),this.addLayout(new ie(r,e,i,192|n,e.children));if(a.length&&s.length){const[t,i]=ae.partitionArray(s,e=>"right"!==e.float);this.setFloatPadding(e.node,h,a,t,i)}}}}return e}setFloatPadding(e,t,i,n,s){const o=e=>e.textElement&&(e.blockStatic||e.multiline);if(i.some(e=>o(e)||e.blockStatic&&e.cascadeSome(e=>o(e)))){if(n.length){let s=-1/0,o=0,r=0,a=!1;for(const e of n){const t=e.linear.right+(e.marginLeft<0?e.marginLeft:0);t>s&&(s=t,a=e.marginRight>0)}for(const e of i)e.blockStatic&&(e.bounds.left>s?r++:o=Math.max(o,e.marginLeft));if(r<i.length){const i=s-e.box.left-o;i>0&&t.modifyBox(256,i+(!a&&t.cascadeSome(e=>e.multiline)?this.controllerHandler.localSettings.deviations.textMarginBoundarySize:0))}}if(s.length){let n=1/0,o=0,r=0,a=!1;for(const e of s){const t=e.linear.left+(e.marginRight<0?e.marginRight:0);t<n&&(n=t,a=e.marginLeft>0)}for(const e of i)e.blockStatic&&(e.bounds.right<n?r++:o=Math.max(o,e.marginRight));if(r<i.length){const i=e.box.right-n-o;i>0&&t.modifyBox(64,i+(!a&&t.cascadeSome(e=>e.multiline)?this.controllerHandler.localSettings.deviations.textMarginBoundarySize:0))}}}}createLayoutControl(e,t){return new ie(e,t,t.containerType,t.alignmentType,t.children)}get layouts(){return this._layouts.sort((e,t)=>{if(e.index!==t.index){if(0===e.index||void 0!==e.index&&e.index!==1/0&&void 0===t.index||t.index===1/0)return-1;if(0===t.index||void 0!==t.index&&t.index!==1/0&&void 0===e.index||e.index===1/0)return 1;if(void 0!==e.index&&void 0!==t.index)return e.index<t.index?-1:1}return 0})}get rendered(){return this.session.cache.filter(e=>e.visible&&e.rendered)}get nextId(){return this.processing.cache.nextId}get length(){return this.session.documentRoot.length}}const{client:ue,css:fe,dom:ge,session:pe,util:me,xml:be}=squared.lib,xe=e=>!(e.left<0&&Math.abs(e.left)>=e.width||e.top<0&&Math.abs(e.top)>=e.height);const{css:ye,util:ve}=squared.lib;class Se extends w{constructor(e,t,i,n=[]){super(e,t,i),this.eventOnly=!1,this.documentBase=!1,this.cascadeAll=!1,this.removeIs=!1,this.tagNames=n}static findNestedElement(e,t){if(e&&ye.hasComputedStyle(e)){const i=e.children,n=i.length;for(let e=0;e<n;e++){const n=i[e];if(ve.includes(n.dataset.use,t))return n}}return null}condition(e,t){return!!e.styleElement&&(e.dataset.use?this.included(e.element):this.tagNames.length>0)}is(e){return!!e.styleElement&&(0===this.tagNames.length||this.tagNames.includes(e.element.tagName))}included(e){return ve.includes(e.dataset.use,this.name)}init(e){return!1}processNode(e,t){}processChild(e,t){}addDescendant(e){const t=this.application.session.extensionMap,i=e.id,n=t.get(i)||[];n.includes(this)||n.push(this),t.set(i,n)}postBaseLayout(e){}postConstraints(e){}postOptimize(e){}afterBaseLayout(){}afterConstraints(){}afterResources(){}beforeBaseLayout(){}beforeCascade(){}afterFinalize(){}set application(e){this._application=e,this.controller=e.controllerHandler,this.resource=e.resourceHandler}get application(){return this._application}}const{client:_e,color:Ee,css:Te,math:we,regex:ke,session:Ae,util:Re}=squared.lib,Ce="&#160;",Ie=`(rgba?\\(\\d+, \\d+, \\d+(?:, [\\d.]+)?\\)|#[A-Za-z\\d]{3,8}|[a-z]+)\\s*(${ke.STRING.LENGTH_PERCENTAGE}|${ke.STRING.CSS_ANGLE}|(?:${ke.STRING.CSS_CALC}(?=,)|${ke.STRING.CSS_CALC}))?,?\\s*`,Be=RegExp(`(?:initial|url\\([^)]+\\)|(repeating)?-?(linear|radial|conic)-gradient\\(((?:to [a-z ]+|(?:from )?-?[\\d.]+(?:deg|rad|turn|grad)|(?:circle|ellipse)?\\s*(?:closest-side|closest-corner|farthest-side|farthest-corner)?)?(?:\\s*(?:(?:-?[\\d.]+(?:[a-z%]+)?\\s*)+)?(?:at [\\w %]+)?)?),?\\s*((?:${Ie})+)\\))`,"g");let Pe;function Le(e,t,i){Pe?Pe.lastIndex=0:Pe=RegExp(Ie,"g");const n=t,s=!0===n.repeating;let o,r;s&&"radial"===t.type?(o=n.radiusExtent/n.radius,r=n.radius):(o=1,r=t.dimension[n.horizontal?"width":"height"]);const a=[];let l,c=0;for(;null!==(l=Pe.exec(i));){const i=Ee.parseColor(l[1],1,!0);if(i){let h=-1;"conic"===t.type?l[3]&&l[4]&&(h=Te.convertAngle(l[3],l[4])/360):l[2]&&(Te.isPercent(l[2])?h=parseFloat(l[2])/100:Te.isLength(l[2])?h=e.parseUnit(l[2],n.horizontal?"width":"height",!1)/r:Te.isCalc(l[2])&&(h=Te.calculate(l[6],r,e.fontSize)/r),s&&-1!==h&&(h*=o)),0===a.length&&(-1===h?h=0:h>0&&a.push({color:i,offset:0})),-1!==h&&(c=h=Math.max(c,h)),a.push({color:i,offset:h})}}const h=a.length,d=a[h-1];-1===d.offset&&(d.offset=1);let u=0;for(let e=0;e<h;e++){const t=a[e];if(-1===t.offset)if(0===e)t.offset=0;else{for(let i=e+1,n=2;i<h-1;i++,n++)if(-1!==a[i].offset){t.offset=(u+a[i].offset)/n;break}-1===t.offset&&(t.offset=u+d.offset/(h-1))}u=t.offset}if(s){if(u<100)e:{const e=a.slice(0);let t=u;for(;u<100;){for(let i=0;i<h;i++)if(u=Math.min(t+e[i].offset,1),a.push(Object.assign(Object.assign({},e[i]),{offset:u})),1===u)break e;t=u}}}else u<1&&a.push(Object.assign(Object.assign({},a[h-1]),{offset:1}));return a}function Ne(e,t=0){if(e){let t=Te.parseAngle(e.trim());return t<0&&(t+=360),t}return t}function Me(e,t,i){switch(i=i.replace(/\u00A0/g,Ce),t.css("whiteSpace")){case"nowrap":i=i.replace(/\n/g," ");break;case"pre":case"pre-wrap":e.layoutVertical||(i=i.replace(/^\s*?\n/,"")),i=i.replace(/\n/g,"\\n").replace(/ /g,Ce);break;case"pre-line":i=i.replace(/\n/g,"\\n").replace(/[ ]+/g," ");break;default:const n=t.previousSibling,s=t.nextSibling;return(n&&(n.lineBreak||n.blockStatic)||t.onlyChild&&t.htmlElement)&&(i=i.replace(ke.CHAR.LEADINGSPACE,"")),(s&&(s.lineBreak||s.blockStatic)||t.onlyChild&&t.htmlElement)&&(i=i.replace(ke.CHAR.TRAILINGSPACE,"")),[i,!1]}return[i,!0]}function Oe(e,t,i){if(i){const n=i.split(ke.XML.SEPARATOR);return Fe.getBackgroundSize(e,n[t%n.length])}}function We(e){return e?-1!==e.indexOf("at ")?/(.+?)?\s*at (.+?)\s*$/.exec(e):[e,e]:null}class Fe extends s{static generateId(e,t,i=1){const n=t;let s=i;1===i&&(t+="_"+s);const o=this.ASSETS.ids.get(e)||[];for(;;){if(!o.includes(t)){o.push(t);break}t=n+"_"+ ++s}return this.ASSETS.ids.set(e,o),t}static insertStoredAsset(e,t,i){const n=Fe.STORED[e];if(n&&Re.hasValue(i)){let s=this.getStoredName(e,i);if(""===s){Re.isNumber(t)&&(t="__"+t);let e=0;do{s=t,e>0&&(s+="_"+e),n.has(s)||n.set(s,i),e++}while(n.has(s)&&n.get(s)!==i)}return s}return""}static getOptionArray(e,t=!1){const i=[];let n=!0;const s=e.children,o=s.length;for(let e=0;e<o;e++){const o=s[e];if(!t&&o.disabled)continue;const r=o.text.trim()||o.value.trim();""!==r&&(n&&!Re.isNumber(r)&&(n=!1),i.push(r))}return n?[void 0,i]:[i]}static isBackgroundVisible(e){return!(void 0===e||!e.backgroundImage&&!e.borderTop&&!e.borderRight&&!e.borderBottom&&!e.borderLeft)}static parseBackgroundImage(e){const t=e.backgroundImage;if(""!==t){Be.lastIndex=0;const i=[];let n,s=0;for(;null!==(n=Be.exec(t));){if("initial"===n[0]||n[0].startsWith("url"))i.push(n[0]);else{const t="repeating"===n[1],o=n[2],r=n[3],a=Oe(e,s,e.css("backgroundSize")),l=a||e.actualDimension;let c;switch(o){case"conic":{const t=We(r),i={type:o,dimension:l,angle:Ne(r)};i.center=Te.getBackgroundPosition(t&&t[2]||"center",l,e.fontSize,a),i.colorStops=Le(e,i,n[4]),c=i;break}case"radial":{const{width:i,height:s}=l,h=We(r),d={type:o,repeating:t,horizontal:e.actualWidth<=e.actualHeight,dimension:l},u=Te.getBackgroundPosition(h&&h[2]||"center",l,e.fontSize,a),{left:f,top:g}=u;d.center=u,d.closestCorner=1/0,d.farthestCorner=-1/0;let p="ellipse";if(h){const t=h[1]&&h[1].trim();if(t)if(t.startsWith("circle"))p="circle";else{const i=t.split(" ");let n=1/0;const s=i.length;for(let t=0;t<s;t++){const s=e.parseUnit(i[t],0===t?"width":"height",!1);s<n&&(n=s)}d.radius=n,d.radiusExtent=n,1!==s&&i[0]!==i[1]||(p="circle")}}d.shape=p;for(const e of[[0,0],[i,0],[i,s],[0,s]]){const t=Math.round(Math.sqrt(Math.pow(Math.abs(e[0]-f),2)+Math.pow(Math.abs(e[1]-g),2)));t<d.closestCorner&&(d.closestCorner=t),t>d.farthestCorner&&(d.farthestCorner=t)}d.closestSide=g,d.farthestSide=g;for(const e of[i-f,s-g,f])e<d.closestSide&&(d.closestSide=e),e>d.farthestSide&&(d.farthestSide=e);if(!d.radius&&!d.radiusExtent){d.radius=d.farthestCorner;const e=h&&h[1]?h[1].split(" ").pop():"";switch(e){case"closest-corner":case"closest-side":case"farthest-side":const i=d[Re.convertCamelCase(e)];t?d.radiusExtent=i:d.radius=i;break;default:d.radiusExtent=d.farthestCorner}}d.colorStops=Le(e,d,n[4]),c=d;break}case"linear":{const{width:i,height:s}=l;let a=180;switch(r){case"to top":a=360;break;case"to right top":a=45;break;case"to right":a=90;break;case"to right bottom":a=135;break;case"to bottom":break;case"to left bottom":a=225;break;case"to left":a=270;break;case"to left top":a=315;break;default:r&&(a=Ne(r,180)||360)}const h={type:o,repeating:t,horizontal:a>=45&&a<=135||a>=225&&a<=315,dimension:l,angle:a};h.colorStops=Le(e,h,n[4]);let d=we.truncateFraction(we.offsetAngleX(a,i)),u=we.truncateFraction(we.offsetAngleY(a,s));if(d!==i&&u!==s&&!we.isEqual(Math.abs(d),Math.abs(u))){let e;e=a<=90?we.relativeAngle({x:0,y:s},{x:i,y:0}):a<=180?we.relativeAngle({x:0,y:0},{x:i,y:s}):a<=270?we.relativeAngle({x:0,y:0},{x:-i,y:s}):we.relativeAngle({x:0,y:s},{x:-i,y:0});const t=Math.abs(e-a);d=we.truncateFraction(we.offsetAngleX(a,we.triangulate(t,90-t,Math.sqrt(Math.pow(i,2)+Math.pow(s,2)))[1])),u=we.truncateFraction(we.offsetAngleY(a,we.triangulate(90,90-a,d)[0]))}h.angleExtent={x:d,y:u},c=h;break}}i.push(c||"initial")}s++}if(i.length)return i}}static getBackgroundSize(e,t){let i=0,n=0;switch(t){case"":case"cover":case"contain":case"100% 100%":case"auto":case"auto auto":case"initial":return;default:const s=t.split(" "),o=s.length;1===o&&(s[1]=s[0]);for(let t=0;t<o;t++){let o=s[t];"auto"===o&&(o="100%"),0===t?i=e.parseUnit(o,"width",!1):n=e.parseUnit(o,"height",!1)}}return i>0&&n>0?{width:Math.round(i),height:Math.round(n)}:void 0}static isInheritedStyle(e,t){if(e.styleElement){const i=e.actualParent;if(i&&""===e.cssInitial(t))return e.style[t]===i.style[t]}return!1}static hasLineBreak(e,t=!1,i=!1){if(e.naturalElements.length)return e.naturalElements.some(e=>e.lineBreak);if(!t&&e.naturalChild){const t=e.element;let n=t.textContent;if(i&&(n=n.trim()),/\n/.test(n))return!(!e.plainText||!Te.isParentStyle(t,"whiteSpace","pre","pre-wrap"))||e.css("whiteSpace").startsWith("pre")}return!1}static getStoredName(e,t){if(Fe.STORED[e])for(const[i,n]of Fe.STORED[e].entries())if(Re.isEqual(t,n))return i;return""}finalize(e){}reset(){super.reset();for(const e in Fe.STORED)Fe.STORED[e].clear()}writeRawImage(e,t){this.fileHandler&&this.fileHandler.addAsset({pathname:this.controllerSettings.directory.image,filename:e,base64:t})}setBoxStyle(e){if(e.styleElement||e.visibleStyle.background){const n={backgroundSize:e.css("backgroundSize"),backgroundRepeat:e.css("backgroundRepeat"),backgroundPositionX:e.css("backgroundPositionX"),backgroundPositionY:e.css("backgroundPositionY")};function t(t,i){const s=e.css(i[0])||"none";let o=Te.formatPX("outline"!==t?e[i[1]]:Re.convertFloat(e.style[i[1]])),r=e.css(i[2])||"initial";switch(r){case"initial":r="rgb(0, 0, 0)";break;case"inherit":case"currentcolor":r=Te.getInheritedStyle(e.element,i[2])}if("0px"!==o&&"none"!==s){"2px"!==o||"inset"!==s&&"outset"!==s||(o="1px");const e=Ee.parseColor(r,1,!0);e&&(n[t]={width:o,style:s,color:e})}}function i(t){switch(e.css(t)){case"border-box":return!0;case"padding-box":n[t]={top:e.borderTopWidth,right:e.borderRightWidth,bottom:e.borderBottomWidth,left:e.borderLeftWidth};break;case"content-box":n[t]={top:e.borderTopWidth+e.paddingTop,right:e.borderRightWidth+e.paddingRight,bottom:e.borderBottomWidth+e.paddingBottom,left:e.borderLeftWidth+e.paddingLeft}}return!1}if(i("backgroundClip")&&i("backgroundOrigin"),"0px"!==e.css("borderRadius")){const[t,i]=e.css("borderTopLeftRadius").split(" "),[s,o]=e.css("borderTopRightRadius").split(" "),[r,a]=e.css("borderBottomRightRadius").split(" "),[l,c]=e.css("borderBottomLeftRadius").split(" "),h=i||o||a||c?[t,i||t,s,o||s,r,a||r,l,c||l]:[t,s,r,l],d=e.actualWidth>=e.actualHeight;h.every(e=>e===h[0])&&(h.length="0px"===h[0]||""===h[0]?0:1);const u=h.length;if(u){const t=d?"width":"height";for(let i=0;i<u;i++)h[i]=e.convertPX(h[i],t,!1);n.borderRadius=h}}e.css("border").startsWith("0px none")||(t("borderTop",Te.BOX_BORDER[0]),t("borderRight",Te.BOX_BORDER[1]),t("borderBottom",Te.BOX_BORDER[2]),t("borderLeft",Te.BOX_BORDER[3])),t("outline",Te.BOX_BORDER[4]),e.hasResource(z.IMAGE_SOURCE)&&(n.backgroundImage=Fe.parseBackgroundImage(e));let s=e.backgroundColor;if(""!==s||e.documentParent.visible||(s=e.css("backgroundColor")),""!==s){const e=Ee.parseColor(s);n.backgroundColor=e?e.valueAsRGBA:""}e.data(Fe.KEY_NAME,"boxStyle",n)}}setFontStyle(e){if(((e.textElement||e.inlineText)&&(!e.textEmpty||e.visibleStyle.background)||e.inputElement)&&e.visible){const t=Ee.parseColor(e.css("color"));let i=e.css("fontWeight");if(!Re.isNumber(i))switch(i){case"lighter":i="200";break;case"bold":i="700";break;case"bolder":i="900";break;default:i="400"}e.data(Fe.KEY_NAME,"fontStyle",{fontFamily:e.css("fontFamily").trim(),fontStyle:e.css("fontStyle"),fontSize:Te.formatPX(e.fontSize),fontWeight:i,color:t?t.valueAsRGBA:""})}}setValueString(e){if(e.visible&&!e.svgElement){const t=e.renderParent;if(t){const i=e.element;if(i){let n="",s="",o="",r=!1,a=!1;switch(i.tagName){case"INPUT":switch(s=i.value,i.type){case"radio":case"checkbox":const t=e.companion;t&&!t.visible&&(s=t.textContent.trim());break;case"submit":""!==s||e.visibleStyle.backgroundImage||(s="Submit");break;case"time":""===s&&(o="--:-- --");break;case"date":case"datetime-local":if(""===s){switch((new Intl.DateTimeFormat).resolvedOptions().locale){case"en-US":o="mm/dd/yyyy";break;default:o="dd/mm/yyyy"}"datetime-local"===i.type&&(o+=" --:-- --")}break;case"week":""===s&&(o="Week: --, ----");break;case"month":""===s&&(o="--------- ----");break;case"url":case"email":case"search":case"number":case"tel":""===s&&(o=i.placeholder);break;case"file":s=_e.isUserAgent(8)?"Browse...":"Choose File"}break;case"TEXTAREA":s=i.value;break;case"IFRAME":s=i.src;break;default:const l=e.textContent;e.plainText?(n=l.trim(),[s]=Me(t,e,l.replace(/&/g,"&amp;")),a=!0,r=!e.actualParent.preserveWhiteSpace):e.inlineText?(n=l.trim(),[s,a]=Me(t,e,this.removeExcludedFromText(i,e.sessionId)),r=!0):0===e.naturalElements.length&&l&&""===l.trim()&&!e.hasPX("height")&&Fe.isBackgroundVisible(e.data(Fe.KEY_NAME,"boxStyle"))&&(s=l)}if(""!==s){if(r){const t=e.siblingsLeading[0];let i=!1;if(s.length>1)if(void 0===t||t.multiline||t.lineBreak||t.plainText&&ke.CHAR.TRAILINGSPACE.test(t.textContent))s=s.replace(ke.CHAR.LEADINGSPACE,"");else if(t.naturalElement){const e=t.textContent;e.length&&(i=32===e.charCodeAt(e.length-1))}if(a){const n=s;if(s=s.trim(),!t||!ke.CHAR.LEADINGSPACE.test(n)||t.block||t.lineBreak||i||(s=Ce+s),!e.lineBreakTrailing&&ke.CHAR.TRAILINGSPACE.test(n)){const t=e.siblingsTrailing.find(e=>!e.excluded||e.lineBreak);t&&!t.blockStatic&&(s+=Ce)}}else if(""!==s.trim())s=(s=s.replace(ke.CHAR.LEADINGSPACE,t&&(t.block||t.lineBreak||i&&t.htmlElement&&t.textContent.length>1||e.multiline&&Fe.hasLineBreak(e))?"":Ce)).replace(ke.CHAR.TRAILINGSPACE,"table-cell"===e.display||e.lineBreakTrailing||e.blockStatic?"":Ce);else if(!e.inlineText)return}""!==s&&e.data(Fe.KEY_NAME,"valueString",{key:n,value:s})}""!==o&&e.data(Fe.KEY_NAME,"hintString",o)}else if(e.inlineText){const t=e.textContent;t&&e.data(Fe.KEY_NAME,"valueString",{key:t,value:t})}}}}removeExcludedFromText(e,t){const i=e.children.length||"CODE"===e.tagName?"innerHTML":"textContent";let n=e[i]||"";const s=e.childNodes,o=s.length;for(let e=0;e<o;e++){const r=s[e],a=Ae.getElementAsNode(r,t);if(void 0===a||!a.textElement||!a.pageFlow||a.positioned||a.pseudoElement||a.excluded||a.dataset.target){if(a){if(a.htmlElement&&"innerHTML"===i){n=a.lineBreak?n.replace(RegExp(`\\s*${a.element.outerHTML}\\s*`),"\\n"):n.replace(a.element.outerHTML,a.pageFlow&&""!==a.textContent.trim()?Ce:"");continue}if(Re.isString(a[i])){n=n.replace(a[i],"");continue}}else if(r instanceof HTMLElement){const e=getComputedStyle(r).getPropertyValue("position");n=n.replace(r.outerHTML,"absolute"!==e&&"fixed"!==e&&""!==r.textContent.trim()?Ce:"")}0===e?n=Re.trimStart(n," "):e===o-1&&(n=Re.trimEnd(n," "))}}return"innerHTML"===i&&(n=n.replace(ke.ESCAPE.ENTITY,(e,t)=>String.fromCharCode(parseInt(t)))),n}}Fe.KEY_NAME="squared.resource",Fe.STORED={strings:new Map,arrays:new Map,fonts:new Map,colors:new Map,images:new Map};const{css:De,regex:He,util:Xe}=squared.lib,ze="[\\d.]+[a-z%]+|auto|max-content|min-content",Ue="minmax\\(([^,]+), ([^)]+)\\)",Ve="fit-content\\(([\\d.]+[a-z%]+)\\)",Ge="\\[([\\w\\-\\s]+)\\]",qe={};function je(e,t){const i=e.repeat,n=[],s=[],o=t.length;for(let e=0;e<o;e++)i[e]?s.push(t[e]):n.push(t[e]);const r=e.length,a=r-n.length,l=Array(r);for(let e=0;e<r;e++){if(i[e]){for(let t=0,i=0;t<a;e++,t++,i++)i===s.length&&(i=0),l[e]=s[i];break}l[e]=n.shift()}return l}function Ye(e){let t=0;for(const i of e)i&&t++;return t}const $e=(e,t)=>De.isLength(t)?e.convertPX(t):t;class Ke extends Se{static createDataAttribute(e,t,i,n){return{children:[],rowData:[],rowHeight:void 0,rowWeight:void 0,rowSpanMultiple:[],templateAreas:{},row:Ke.createDataRowAttribute(),column:Ke.createDataRowAttribute(),emptyRows:[],alignItems:e,alignContent:t,justifyItems:i,justifyContent:n}}static createDataRowAttribute(){return{length:0,gap:0,unit:[],unitMin:[],unitTotal:[],repeat:[],auto:[],autoFill:!1,autoFit:!1,name:{},normal:!0}}is(e){return e.gridElement}condition(e){return e.length>0}processNode(e){void 0===qe.UNIT&&(qe.UNIT=RegExp(`^(${ze})$`),qe.NAMED=RegExp(`\\s*(repeat\\((auto-fit|auto-fill|\\d+), (.+)\\)|${Ge}|${Ue}|${Ve}|${ze})\\s*`,"g"),qe.REPEAT=RegExp(`\\s*(${Ge}|${Ue}|${Ve}|${ze})\\s*`,"g"),qe.STARTEND=/^([\w\-]+)-(start|end)$/);const t=Ke.createDataAttribute(e.css("alignItems"),e.css("alignContent"),e.css("justifyItems"),e.css("justifyContent")),i=e.css("gridAutoFlow"),n=-1===i.indexOf("column"),s=-1!==i.indexOf("dense"),o=[],r=[],a=[];let l={};if(t.row.gap=e.parseUnit(e.css("rowGap"),"height",!1),t.column.gap=e.parseUnit(e.css("columnGap"),"width",!1),[e.cssInitial("gridTemplateRows",!0),e.cssInitial("gridTemplateColumns",!0),e.css("gridAutoRows"),e.css("gridAutoColumns")].forEach((i,n)=>{if(i&&"none"!==i&&"auto"!==i){qe.NAMED.lastIndex=0;const s=0===n?t.row:t.column,{name:o,repeat:r,unit:a,unitMin:l}=s;let c,h=1;for(;null!==(c=qe.NAMED.exec(i));)if(n<2)if(c[1].startsWith("repeat")){let t=1;switch(c[2]){case"auto-fit":s.autoFit=!0;break;case"auto-fill":s.autoFill=!0;break;default:t=Xe.convertInt(c[2])}if(t>0){void 0===qe.CELL_UNIT?(qe.CELL_UNIT=/[\d.]+[a-z%]+|auto|max-content|min-content/,qe.CELL_MINMAX=/minmax\(([^,]+), ([^)]+)\)/,qe.CELL_FIT_CONTENT=/fit-content\(([\d.]+[a-z%]+)\)/,qe.CELL_NAMED=/\[([\w\-\s]+)\]/):qe.REPEAT.lastIndex=0;const i=[];let n;for(;null!==(n=qe.REPEAT.exec(c[3]));){let t;null!==(t=qe.CELL_NAMED.exec(n[1]))?(void 0===o[t[1]]&&(o[t[1]]=[]),i.push({name:t[1]})):null!==(t=qe.CELL_MINMAX.exec(n[1]))?i.push({unit:$e(e,t[2]),unitMin:$e(e,t[1])}):null!==(t=qe.CELL_FIT_CONTENT.exec(n[1]))?i.push({unit:$e(e,t[1]),unitMin:"0px"}):null!==(t=qe.CELL_UNIT.exec(n[1]))&&i.push({unit:$e(e,t[0])})}if(i.length)for(let e=0;e<t;e++)for(const e of i)e.name?o[e.name].push(h):e.unit&&(a.push(e.unit),l.push(e.unitMin||""),r.push(!0),h++)}}else"["===c[1].charAt(0)?(void 0===o[c[4]]&&(o[c[4]]=[]),o[c[4]].push(h)):c[1].startsWith("minmax")?(a.push($e(e,c[6])),l.push($e(e,c[5])),r.push(!1),h++):c[1].startsWith("fit-content")?(a.push($e(e,c[7])),l.push("0px"),r.push(!1),h++):qe.UNIT.test(c[1])&&(a.push("auto"===c[1]?"auto":$e(e,c[1])),l.push(""),r.push(!1),h++);else(2===n?t.row:t.column).auto.push(e.convertPX(c[1]))}}),e.sort(n?(e,t)=>{const{left:i,top:n}=e.linear,{left:s,top:o}=t.linear;return Xe.withinRange(n,o)?Xe.withinRange(i,s)?0:i<s?-1:1:n<o?-1:1}:(e,t)=>{const{left:i,top:n}=e.linear,{left:s,top:o}=t.linear;return Xe.withinRange(i,s)?Xe.withinRange(n,o)?0:n<o?-1:1:i<s?-1:1}),!e.has("gridTemplateAreas")&&e.every(e=>"auto"===e.css("gridRowStart")&&"auto"===e.css("gridColumnStart"))){let i,s,o,r,l;n?(i="top",s="bottom",o=2,r=1,l=3):(i="left",s="right",o=3,r=0,l=2);let c,h=0,d=0,u=0;e.each((e,f)=>{(void 0===c||e.linear[i]>=c.linear[s]||d>0&&d===u)&&(u=Math.max(d,u),h++,d=1);const g=e.css("gridRowEnd"),p=e.css("gridColumnEnd");let m=1,b=1;if(g.startsWith("span")?m=parseInt(g.split(" ")[1]):Xe.isNumber(g)&&(m=parseInt(g)-h),p.startsWith("span")?b=parseInt(p.split(" ")[1]):Xe.isNumber(p)&&(b=parseInt(p)-d),1===d&&u>0){let e=!1;do{const i=Array(u-1).fill(1);for(const e of a){const t=e.placement;if(t[o]>h)for(let e=t[r];e<t[l];e++)i[e-1]=0}for(let t=0,n=0,s=0;t<i.length;t++)if(i[t]){if(0===n&&(s=t),++n===b){d=s+1,e=!0;break}}else n=0;e||(t.emptyRows[h-1]=i,h++)}while(!e)}a[f]={placement:n?[h,d,h+m,d+b]:[d,h,d+b,h+m],rowSpan:m,columnSpan:b},d+=b,c=e})}else e.css("gridTemplateAreas").split(/"[\s\n]+"/).forEach((e,i)=>{if("none"!==e){const n=t.templateAreas;Xe.trimString(e.trim(),'"').split(He.CHAR.SPACE).forEach((e,t)=>{if("."!==e.charAt(0)){const s=n[e];s?(s.rowSpan=i-s.rowStart+1,s.columnSpan=t-s.columnStart+1):n[e]={rowStart:i,rowSpan:1,columnStart:t,columnSpan:1}}})}}),e.each((e,i)=>{const n=[e.css("gridRowStart"),e.css("gridColumnStart"),e.css("gridRowEnd"),e.css("gridColumnEnd")],s=[];let o=1,r=1;if(Object.keys(t.templateAreas).length)for(let e=0;e<4;e++){const i=n[e];let o=t.templateAreas[i];if(o)switch(e){case 0:s[0]=o.rowStart+1;break;case 1:s[1]=o.columnStart+1;break;case 2:s[2]=o.rowStart+o.rowSpan+1;break;case 3:s[3]=o.columnStart+o.columnSpan+1}else{const n=qe.STARTEND.exec(i);if(n&&(o=t.templateAreas[n[1]]))if("start"===n[2])switch(e){case 0:case 2:s[e]=o.rowStart+1;break;case 1:case 3:s[e]=o.columnStart+1}else switch(e){case 0:case 2:s[e]=o.rowStart+o.rowSpan+1;break;case 1:case 3:s[e]=o.columnStart+o.columnSpan+1}}}if(!(s[0]&&s[1]&&s[2]&&s[3])){function l(e,t){if(Xe.isNumber(e))return s[t]=parseInt(e),!0;if(e.startsWith("span")){const i=parseInt(e.split(" ")[1]);return s[t-2]?s[t]=s[t-2]+i:t%2==0?o=i:r=i,!0}return!1}let e,i;for(let a=0;a<4;a++){const c=n[a];if("auto"!==c&&!s[a]&&!l(c,a)){const l=t[a%2==0?"row":"column"],h=c.split(" ");1===h.length?(h[1]=h[0],h[0]="1"):Xe.isNumber(h[0])&&(a%2==0?e?o=parseInt(h[0])-parseInt(e[0]):e=h:i?r=parseInt(h[0])-parseInt(i[0]):i=h);const d=l.name[h[1]];if(d){const e=parseInt(h[0]);e<=d.length&&(s[a]=d[e-1]+(h[1]===n[a-2]?1:0))}}s[a]||l(c,a)}}a[i]={placement:s,rowSpan:o,columnSpan:r}});{const e=n?t.column:t.row;let i=e.unit,s=Math.max(1,i.length);for(const e of a)e&&(s=Math.max(s,n?e.columnSpan:e.rowSpan,e.placement[n?1:0]||0,(e.placement[n?3:2]||0)-1));e.length=s,(e.autoFill||e.autoFit)&&(0===i.length&&(i.push("auto"),e.unitMin.push(""),e.repeat.push(!0)),i=je(e,i),e.unit=i,e.unitMin=je(e,e.unitMin));let o=1,r=0;for(const e of i)De.isPercent(e)?o-=parseFloat(e)/100:e.endsWith("fr")&&(r+=parseFloat(e));if(o>0&&r>0){const e=i.length;for(let t=0;t<e;t++)i[t].endsWith("fr")&&(i[t]=o*(parseFloat(i[t])/r)+"fr")}const l=t.row.unit.length+1,c=t.column.unit.length+1;for(const e of a){const t=e.placement;t[2]<0&&(l>1?t[2]+=l+1:t[2]=void 0),t[3]<0&&(c>1?t[3]+=c+1:t[3]=void 0)}}e.each((e,i)=>{const c=a[i],h=c.placement;let d,u,f,g,p,m,b;for(n?(d=c.rowSpan,u=c.columnSpan,f=t.column.length,g=0,p=1,m=2,b=3):(d=c.columnSpan,u=c.rowSpan,f=t.row.length,g=1,p=0,m=3,b=2);!h[0]||!h[1];){const e=h.slice(0);if(!e[g]){let t=o.length;for(let i=0,n=0,s=-1;i<t;i++)if(!l[i])if(void 0===r[i]||r[i]<f){if(0===n&&(s=i,t=Math.max(t,i+d)),++n===d){e[g]=s+1;break}}else n=0,s=-1,t=o.length}if(e[g]){if(!e[p]){e[m]||(e[m]=e[g]+d);const t=[],i=e[g]-1,n=e[m]-1;for(let e=i;e<n;e++){const i=o[e];if(void 0===i)t.push([[0,-1]]);else{if(!(Ye(i)+u<=f))break;{const e=[];let n=0;for(let t=0,s=-1;t<f;t++)void 0===i[t]&&(-1===s&&(s=t),n++),(i[t]||t===f-1)&&(n>=u&&e.push([s,s+n]),s=-1,n=0);if(!e.length)break;t.push(e)}}}const s=t.length;if(s){const o=t[0];if(-1===o[0][1])e[p]=1;else if(s===n-i)if(s>1)e:for(const i of o)for(let n=i[0];n<i[1];n++)for(let i=1;i<s;i++){const s=t[i].length;for(let o=0;o<s;o++){const s=t[i][o];if(n>=s[0]&&(-1===s[1]||n+u<=s[1])){e[p]=n+1;break e}}}else e[p]=o[0][0]+1}}}else h[g]=o.length+1,h[p]||(h[p]=1);const t=e[g];t&&e[p]?(h[g]=t,h[p]=e[p]):t&&(l[t-1]=!0)}if(h[m]||(h[m]=h[g]+d),h[b]||(h[b]=h[p]+u),function(e,t){if(t.every(e=>e>0)){for(let i=t[n?0:1]-1;i<t[n?2:3]-1;i++){let s=o[i];void 0===s&&(o[i]=s=[]);for(let o=t[n?1:0]-1;o<t[n?3:2]-1;o++)void 0===r[i]&&(r[i]=0),void 0===s[o]&&(s[o]=[],r[i]++),s[o].push(e)}return!0}return!1}(e,h)){const i=h[0]-1,n=h[2]-h[0];if(n>1)for(let e=i;e<i+n;e++)t.rowSpanMultiple[e]=!0;e.data(H.CSS_GRID,"cellData",{rowStart:i,rowSpan:n,columnStart:h[1]-1,columnSpan:h[3]-h[1]}),s&&(l={})}});const c=o.length;if(c){if(n)t.rowData=o;else for(let e=0;e<c;e++){const i=o[e],n=i.length;for(let s=0;s<n;s++)void 0===t.rowData[s]&&(t.rowData[s]=[]),t.rowData[s][e]=i[s]}const i=(n?t.row:t.column).unitTotal,s=t.children;let r=0;for(const e of t.rowData){const t=e.length;r=Math.max(t,r);for(let o=0;o<t;o++){const t=e[o];if(void 0===i[o]&&(i[o]=0),t){let e=0;for(const i of t)s.includes(i)||(e=Math.max(e,n?i.bounds.height:i.bounds.width),s.push(i));i[o]+=e}}}if(s.length===e.length){const i=t.rowData,n=i.length,o=new Set,a=Array(n),l=Array(n),c=t.column.gap,h=t.row.gap;t.row.length=n,t.column.length=r,t.rowHeight=a,t.rowWeight=l;for(let e=0;e<n;e++){a[e]=0;const t=i[e];for(let i=0;i<r;i++){const s=t[i];if(s)for(const t of s)if(!o.has(t)){const s=t.data(H.CSS_GRID,"cellData"),l=e+s.rowSpan-1;i+s.columnSpan-1<r-1&&t.modifyBox(4,c),l<n-1&&t.modifyBox(8,h),1===s.rowSpan&&(a[e]=Math.max(a[e],t.bounds.height)),o.add(t)}}}const d=e.actualHeight;for(let e=0;e<n;e++)l[e]=a[e]/d;e.retain(s),e.cssSort("zIndex"),e.cssTry("display","block")&&(e.each(e=>{const t=e.initial.bounds;if(t){const i=e.element.getBoundingClientRect();t.width=i.width,t.height=i.height}}),e.cssFinally("display")),e.data(H.CSS_GRID,F.EXT_DATA,t)}}}}const Qe=squared.lib.util;class Ze extends Se{static createDataAttribute(e,t){const i=e.css("flexWrap"),n=e.css("flexDirection");return{directionRow:n.startsWith("row"),directionColumn:n.startsWith("column"),directionReverse:n.endsWith("reverse"),wrap:i.startsWith("wrap"),wrapReverse:"wrap-reverse"===i,alignContent:e.css("alignContent"),justifyContent:e.css("justifyContent"),rowCount:0,columnCount:0,children:t}}is(e){return e.flexElement}condition(e){return e.length>0}processNode(e){const t=this.controller,[i,n]=e.partition(e=>e.pageFlow&&!e.renderExclude),s=Ze.createDataAttribute(e,i);if(e.cssTry("align-items","start")){if(e.cssTry("justify-items","start")){for(const e of i){const t=e.initial.bounds;if(t&&e.cssTry("align-self","start")){if(e.cssTry("justify-self","start")){if(e.cssTry("flex-grow","0")){if(e.cssTry("flex-shrink","1")){const i=e.element.getBoundingClientRect();t.width=i.width,t.height=i.height,e.cssFinally("flex-shrink")}e.cssFinally("flex-grow")}e.cssFinally("justify-self")}e.cssFinally("align-self")}}e.cssFinally("justify-items")}e.cssFinally("align-items")}if(s.wrap){let o,r,a,l;s.directionRow?(o="top",r="left",a="right",l="intersectY"):(o="left",r="top",a="bottom",l="intersectX"),i.sort((e,t)=>e[l](t.bounds,"bounds")?Qe.withinRange(e.linear[r],t.linear[r])?0:e.linear[r]<t.linear[r]?-1:1:e.linear[o]<t.linear[o]?-1:1);let c=[i[0]],h=i[0];const d=[c];let u=i.length;for(let e=1;e<u;e++){const t=i[e];h[l](t.bounds,"bounds")?c.push(t):(h=t,d.push(c=[t]))}e.clear();let f=0,g=0;if((u=d.length)>1){const i=e.box[a];for(let n=0;n<u;n++){const s=d[n],o=t.createNodeGroup(s[0],s,e,!0);o.containerIndex=n;const r=o.unsafe("box");r&&(r[a]=i),o.addAlign(128),f=Math.max(s.length,f)}g=u}else{const t=d[0];e.retain(t);for(let e=0;e<t.length;e++)t[e].containerIndex=e;g=f=t.length}for(let e=0;e<n.length;e++)n[e].containerIndex=g+e;e.concat(n),e.sort(),s.directionRow?(s.rowCount=u,s.columnCount=f):(s.rowCount=f,s.columnCount=u)}else{if(i.some(e=>0!==e.flexbox.order)){const[e,t]=s.directionReverse?[-1,1]:[1,-1];i.sort((i,n)=>i.flexbox.order===n.flexbox.order?0:i.flexbox.order>n.flexbox.order?e:t)}s.directionRow?(s.rowCount=1,s.columnCount=e.length):(s.rowCount=e.length,s.columnCount=1)}e.data(H.FLEXBOX,F.EXT_DATA,s)}}const{css:Je,util:et}=squared.lib;function tt(e,t){const i=t.linear.top;for(const t of e){const e=t.findIndex(e=>et.withinRange(i,e.linear.top)||i>e.linear.top&&i<e.linear.bottom);if(-1!==e)return e}return-1}class it extends Se{static createDataCellAttribute(){return{rowSpan:0,columnSpan:0,index:-1,cellStart:!1,cellEnd:!1,rowEnd:!1,rowStart:!1,block:!1}}condition(e){if(e.length>1&&!e.layoutElement&&!e.has("listStyle")){if("table"===e.display)return e.every(e=>"table-row"===e.display&&e.every(e=>"table-cell"===e.display));{let t=0,i=0;for(const n of e){if(!n.pageFlow||n.visibleStyle.background||!n.blockStatic||n.autoMargin.leftRight||n.autoMargin.left)return!1;n.length>1&&t++,"list-item"!==n.display||n.has("listStyleType")||i++}if(i===e.length)return!0;if(t>0)return e.every(e=>e.length>0&&ee.linearData(e.children).linearX)}}return!1}processNode(e){const t=[],i=[],n={};for(const t of e)for(const e of t)if(e.visible){const t=Math.floor(e.linear.left);void 0===n[t]&&(n[t]=[]),n[t].push(e)}const s=Object.keys(n),o=s.length;if(o){let r=-1;for(let e=0;e<o;e++){const t=n[s[e]];if(0===e)r=o;else if(r!==t.length){r=-1;break}}if(-1!==r)for(let e=0;e<o;e++)i.push(n[s[e]]);else{const r=[];for(let e=0;e<o;e++){const t=n[s[e]],o=t.length;if(0===e&&0===o)return;r[e]=0===e?0:r[e-1];for(let n=0;n<o;n++){const s=t[n];if(0===e||et.aboveRange(s.linear.left,r[e-1]))if(void 0===i[e]&&(i[e]=[]),0===e||i[0].length===o)i[e][n]=s;else{const t=tt(i,s);if(-1===t)return;i[e][t]=s}else{const e=i.length-1;if(i[e]){let t=1/0,n=-1/0;if(i[e].forEach(e=>{const{left:i,right:s}=e.linear;i<t&&(t=i),s>n&&(n=s)}),Math.floor(s.linear.left)>Math.ceil(t)&&Math.floor(s.linear.right)>Math.ceil(n)){const t=tt(i,s);if(-1!==t)for(let n=i.length-1;n>=0;n--)if(i[n]){void 0===i[n][t]&&(i[e].length=0);break}}}}r[e]=Math.max(s.linear.right,r[e])}}const a=r.length;for(let e=0,t=-1;e<a;e++)void 0===i[e]?-1===t?t=e-1:e===a-1&&(r[t]=r[e]):-1!==t&&(r[t]=r[e-1],t=-1);for(let e=0;e<i.length;e++){const n=i[e];n&&n.length?t.push(r[e]):i.splice(e--,1)}const l=i.reduce((e,t)=>Math.max(e,t.length),0);for(let e=0;e<l;e++){const t=i.length;for(let n=0;n<t;n++)void 0===i[n][e]&&(i[n][e]={spacer:1})}t.push(e.box.right)}}const r=i.length;if(r>1&&i[0].length===e.length){const n=[],s=new Set;for(let e=0,o=0;e<r;e++){let a=0;const l=i[e];for(let c=0,h=0;c<l.length;c++){const d=l[c],u=l.length;if(void 0===n[c]&&(n[c]=[]),d.spacer)1===d.spacer&&a++;else{const f=Object.assign(it.createDataCellAttribute(),d.data(H.GRID,"cellData"));let g=1,p=1+a;for(let t=e+1;t<r&&1===i[t][c].spacer;t++)p++,i[t][c].spacer=2;if(1===p)for(let e=c+1;e<u&&1===l[e].spacer;e++)g++,l[e].spacer=2;if(t.length){const i=Math.min(e+(p-1),t.length-1);for(const e of d.documentParent.naturalChildren)!s.has(e)&&e.visible&&!e.rendered&&et.aboveRange(e.linear.left,d.linear.right)&&et.belowRange(e.linear.right,t[i])&&(void 0===f.siblings&&(f.siblings=[]),f.siblings.push(e))}f.rowSpan=g,f.columnSpan=p,f.rowStart=0==h++,f.rowEnd=p+e===r,f.cellStart=0===o,f.cellEnd=f.rowEnd&&c===u-1,f.index=e,a=0,d.data(H.GRID,"cellData",f),n[c].push(d),s.add(d)}}}e.each(e=>e.hide()),e.clear();for(const t of n){let i=!0,n=!1;for(const e of t){const t=e.css("width");if(Je.isPercent(t))n=!0;else if(!Je.isLength(t)){i=!1;break}}if(i&&n&&t.length>1){const e=t[0].data(H.GRID,"cellData");if(e&&1===e.rowSpan){let i=e.siblings?e.siblings.slice(0):[];const n=t.length;for(let e=1;e<n;e++){const n=t[e].data(H.GRID,"cellData");if(!n||1!==n.rowSpan){i.length=0;break}i.push(t[e]),n.siblings&&(i=i.concat(n.siblings))}i.length&&(e.block=!0,e.columnSpan=r,e.siblings=i,t.length=1)}}for(const n of t)n.parent=e,!i&&n.percentWidth&&n.css("width",Je.formatPX(n.bounds.width))}e.tableElement&&"collapse"===e.css("borderCollapse")&&(e.modifyBox(32),e.modifyBox(64),e.modifyBox(128),e.modifyBox(256)),e.data(H.GRID,"columnCount",r)}}}const nt=squared.lib.css,st=e=>e.visibleStyle.backgroundImage&&!e.visibleStyle.backgroundRepeat;class ot extends Se{static createDataAttribute(){return{ordinal:"",imageSrc:"",imagePosition:""}}condition(e){if(super.condition(e)){const t=e.length;if(t){const i=new Set,n=e.children;let s=0,o=0,r=0,a=0,l=0,c=0;for(let e=0;e<t;e++){const h=n[e],d="none"!==h.css("listStyleType");if("list-item"===h.display&&(d||h.innerBefore)?c++:h.marginLeft<0&&!d&&st(h)&&l++,h.blockStatic?s++:s=1/0,h.inlineVertical?o++:s=1/0,h.floating?(i.add(h.float),r++,a=1/0):0===e||e===t-1||h.blockStatic||n[e-1].blockStatic&&n[e+1].blockStatic?(a++,r=1/0):(r=1/0,a=1/0),s===1/0&&o===1/0&&a===1/0&&r===1/0)return!1}return(l>0||c>0)&&(s===t||o===t||r===t&&1===i.size||a===t)}}return!1}processNode(e){const t="OL"===e.tagName;let i=t&&e.element.start||1;e.each(e=>{const n=ot.createDataAttribute(),s=e.css("listStyleType"),o="list-item"===e.display;if(o||s&&"none"!==s||st(e)){if(e.has("listStyleImage"))n.imageSrc=e.css("listStyleImage");else{t&&o&&"LI"===e.tagName&&(i=e.element.value||i);let r=nt.convertListStyle(s,i);if(""===r)switch(s){case"disc":r="";break;case"square":r="";break;case"none":let t="",i="";e.visibleStyle.backgroundRepeat||(t=e.backgroundImage,i=e.css("backgroundPosition")),t&&"none"!==t&&(n.imageSrc=t,n.imagePosition=i,e.exclude(z.IMAGE_SOURCE));break;default:r=""}else r+=".";n.ordinal=r}o&&i++}e.data(H.LIST,F.EXT_DATA,n)})}}const{dom:rt,util:at}=squared.lib;const lt=squared.lib.css;const{css:ct,dom:ht,math:dt,util:ut}=squared.lib,ft=/rgba\(0, 0, 0, 0\)|transparent/;class gt extends Se{static createDataAttribute(e){return{layoutType:0,rowCount:0,columnCount:0,layoutFixed:"fixed"===e.css("tableLayout"),borderCollapse:"collapse"===e.css("borderCollapse"),expand:!1}}processNode(e){const t=gt.createDataAttribute(e);let i=[];const n=[],s=[],o=[];function r(t,i){i.percent=Math.round(t.bounds.width/e.box.width*100)+"%",i.expand=!0}function a(e){if(e.length){for(const t of e[0].cascade()){const i=t.tagName;"TH"!==i&&"TD"!==i||(t.inherit(e[0],"styleMap"),t.unsetCache("visibleStyle"))}i=i.concat(e[0].children);for(const t of e)t.hide()}}const l=e=>e.css("width",ct.formatPX(e.bounds.width),!0);e.each(e=>{switch(e.tagName){case"THEAD":n.push(e);break;case"TBODY":s.push(e);break;case"TFOOT":o.push(e)}}),a(n);for(const e of s)i=i.concat(e.children),e.hide();a(o);const[c,h]=t.borderCollapse?[0,0]:ut.replaceMap(e.css("borderSpacing").split(" "),(t,i)=>e.parseUnit(t,0===i?"width":"height")),d=c>1?Math.round(c/2):c,u=h>1?Math.round(h/2):h,f=e.element.querySelector("COLGROUP"),g=[],p=[],m=[],b=[],x=i.length;let y=Array(x).fill(0),v=0;for(let n=0;n<x;n++){const s=i[n];g[n]=c,m[n]=[],s.each((i,s)=>{const o=i.element;for(let e=0;e<o.rowSpan-1;e++){const t=n+e+1;y[t]>=0&&(y[t]+=o.colSpan)}const r=y[n];if(!i.hasPX("width")){const e=ht.getNamedItem(o,"width");ct.isPercent(e)?i.css("width",e):ut.isNumber(e)&&i.css("width",ct.formatPX(parseFloat(e)))}if(!i.hasPX("height")){const e=ht.getNamedItem(o,"height");ct.isPercent(e)?i.css("height",e):ut.isNumber(e)&&i.css("height",ct.formatPX(parseFloat(e)))}if(!i.visibleStyle.backgroundImage&&!i.visibleStyle.backgroundColor)if(f){const{backgroundImage:e,backgroundColor:t}=ct.getStyle(f.children[r]);e&&"none"!==e&&i.css("backgroundImage",e,!0),t&&!ft.test(t)&&i.css("backgroundColor",t,!0)}else{let e=ct.getInheritedStyle(o,"backgroundImage",/none/,"TABLE");""!==e&&i.css("backgroundImage",e,!0),""!==(e=ct.getInheritedStyle(o,"backgroundColor",ft,"TABLE"))&&i.css("backgroundColor",e,!0)}switch(i.tagName){case"TH":{function a(t){const n=t+"Style",s=t+"Color",o=t+"Width";i.ascend(void 0,e).some(e=>!!e.has(n)&&(i.css(n,e.css(n)),i.css(s,e.css(s)),i.css(o,e.css(o),!0),i.css("border","inherit"),!0))}i.cssInitial("textAlign")||i.css("textAlign",i.css("textAlign")),0===i.borderTopWidth&&a("borderTop"),0===i.borderRightWidth&&a("borderRight"),0===i.borderBottomWidth&&a("borderBottom"),0===i.borderLeftWidth&&a("borderLeft")}case"TD":i.cssInitial("verticalAlign")||i.css("verticalAlign","middle",!0)}const l=i.cssInitial("width"),m=void 0===b[r]||"auto"===b[r],v=i.bounds.width;if(0===n||m||!t.layoutFixed)if(""===l||"auto"===l)void 0===b[r]?(b[r]=l||"0px",p[r]=0):n===x-1&&m&&0===p[r]&&(p[r]=v);else{const e=ct.isPercent(l),t=ct.isLength(b[r]);(m||v<p[r]||v===p[r]&&(t&&e||e&&ct.isPercent(b[r])&&i.parseUnit(l)>=i.parseUnit(b[r])||t&&ct.isLength(l)&&i.parseUnit(l)>i.parseUnit(b[r])))&&(b[r]=l),(m||1===o.colSpan)&&(p[r]=v)}(i.length||i.inlineText)&&(g[n]+=v+c),d>0&&(i.modifyBox(16,0===y[n]?c:d),i.modifyBox(4,0===s?d:c)),u>0&&(i.modifyBox(2,0===n?h:u),i.modifyBox(8,n+o.rowSpan<x?u:h)),y[n]+=o.colSpan}),v=Math.max(v,y[n])}e.hasPX("width",!1)&&b.some(e=>ct.isPercent(e))&&ut.replaceMap(b,(e,t)=>"auto"===e&&p[t]>0?ct.formatPX(p[t]):e);let S=!1;if(b.every(e=>ct.isPercent(e))){if(b.reduce((e,t)=>e+parseFloat(t),0)>1){let e=100;ut.replaceMap(b,t=>{const i=parseFloat(t);return e<=0?t="0px":e-i<0&&(t=ct.formatPercent(e/100)),e-=i,t})}e.hasWidth||(t.expand=!0),S=!0}else if(b.every(e=>ct.isLength(e))){const i=b.reduce((e,t)=>e+parseFloat(t),0);if(e.hasWidth)if(i<e.width)ut.replaceMap(b,e=>"0px"!==e?parseFloat(e)/i*100+"%":e);else if(i>e.width&&(e.css("width","auto",!0),!t.layoutFixed))for(const t of e.cascade())t.css("width","auto",!0);t.layoutFixed&&!e.hasPX("width")&&e.css("width",ct.formatPX(e.bounds.width),!0)}let _=0;t.layoutType=(()=>{if(b.length>1){if(_=b.reduce((e,t)=>e+(ct.isPercent(t)?parseFloat(t):0),0),t.layoutFixed&&b.reduce((e,t)=>e+(ct.isLength(t)?parseFloat(t):0),0)>=e.actualWidth)return 4;if(b.length>1&&b.some(e=>ct.isPercent(e))||b.every(e=>ct.isLength(e)&&"0px"!==e))return 3;if(b.every(e=>e===b[0])){if(e.cascadeSome(e=>e.hasHeight))return t.expand=!0,3;if("auto"===b[0]){if(e.hasWidth)return 3;{const t=e.cascade(e=>"TD"===e.tagName);return t.length&&t.every(e=>ut.withinRange(e.bounds.width,t[0].bounds.width))?0:3}}if(e.hasWidth)return 2}if(b.every(e=>"auto"===e||ct.isLength(e)&&"0px"!==e))return e.hasWidth||(t.expand=!0),1}return 0})();const E=e.find(e=>"CAPTION"===e.tagName);e.clear(),E&&(E.hasWidth||(E.textElement?E.hasPX("maxWidth")||E.css("maxWidth",ct.formatPX(E.bounds.width)):E.bounds.width>dt.maxArray(g)&&l(E)),E.cssInitial("textAlign")||E.css("textAlign","center"),E.data(H.TABLE,"cellData",{colSpan:v}),E.parent=e);const T=e.hasWidth;y=Array(x).fill(0);for(let n=0;n<x;n++){const s=i[n];let o;for(const i of s.duplicate()){const s=i.element,{rowSpan:a,colSpan:c}=s,h={rowSpan:a,colSpan:c};for(let e=0;e<a-1;e++){const t=n+1+e;void 0!==y[t]&&(y[t]+=c)}i.has("verticalAlign")||i.css("verticalAlign","middle");const d=b[y[n]];if(d)switch(t.layoutType){case 0:break;case 3:"auto"===d?_>=1?(l(i),h.exceed=!T,h.downsized=!0):r(i,h):ct.isPercent(d)?S?(h.percent=d,h.expand=!0):l(i):ct.isLength(d)&&parseInt(d)>0?i.bounds.width>=parseInt(d)?(l(i),h.expand=!1,h.downsized=!1):t.layoutFixed?(r(i,h),h.downsized=!0):(l(i),h.expand=!1):(i.hasPX("width")&&!i.percentWidth||l(i),h.expand=!1);break;case 2:i.css("width","0px");break;case 1:"auto"===d?i.css("width","0px"):(t.layoutFixed?h.downsized=!0:l(i),h.expand=!1);break;case 4:ct.isLength(d)||i.hide()}y[n]+=c;for(let e=0;e<a;e++)for(let t=0;t<c;t++)m[n+e].push(i);i.data(H.TABLE,"cellData",h),i.parent=e,o=i}if(o&&y[n]<v){const e=o.data(H.TABLE,"cellData");e&&(e.spaceSpan=v-y[n])}s.hide()}if(t.borderCollapse){const t=e.css("borderTopColor"),i=e.css("borderTopStyle"),n=e.css("borderTopWidth"),s=e.css("borderRightColor"),o=e.css("borderRightStyle"),r=e.css("borderRightWidth"),a=e.css("borderBottomColor"),l=e.css("borderBottomStyle"),c=e.css("borderBottomWidth"),h=e.css("borderLeftColor"),d=e.css("borderLeftStyle"),u=e.css("borderLeftWidth");let f=!1,g=!1,p=!1,b=!1;for(let e=0;e<x;e++)for(let y=0;y<v;y++){const S=m[e][y];if(S&&"visible"===S.css("visibility")){if(0===e&&(S.borderTopWidth<parseInt(n)?S.cssApply({borderTopColor:t,borderTopStyle:i,borderTopWidth:n}):f=!0),e>=0&&e<x-1){const t=m[e+1][y];t&&t!==S&&"visible"===t.css("visibility")&&(S.borderBottomWidth>=t.borderTopWidth?t.css("borderTopWidth","0px",!0):S.css("borderBottomWidth","0px",!0))}if(e===x-1&&(S.borderBottomWidth<parseInt(c)?S.cssApply({borderBottomColor:a,borderBottomStyle:l,borderBottomWidth:c}):p=!0),0===y&&(S.borderLeftWidth<parseInt(u)?S.cssApply({borderLeftColor:h,borderLeftStyle:d,borderLeftWidth:u}):b=!0),y>=0&&y<v-1){const t=m[e][y+1];t&&t!==S&&"visible"===t.css("visibility")&&(S.borderRightWidth>=t.borderLeftWidth?t.css("borderLeftWidth","0px",!0):S.css("borderRightWidth","0px",!0))}y===v-1&&(S.borderRightWidth<parseInt(r)?S.cssApply({borderRightColor:s,borderRightStyle:o,borderRightWidth:r}):g=!0)}}(f||g||p||b)&&e.cssApply({borderTopWidth:"0px",borderRightWidth:"0px",borderBottomWidth:"0px",borderLeftWidth:"0px"},!0)}t.rowCount=x,t.columnCount=v,e.data(H.TABLE,F.EXT_DATA,t)}}const{css:pt,util:mt}=squared.lib;const{css:bt,util:xt}=squared.lib,yt=null!==document.doctype&&"html"===document.doctype.name;function vt(e,t){const i=e.hasPX("minHeight",!1)?e.parseUnit(e.css("minHeight")):0;e.css("minHeight",bt.formatPX(Math.max(t,i)))}function St(e,t,i){let n=0;switch(t){case 2:n=e.actualRect("top")-i;break;case 16:n=e.actualRect("left")-i;break;case 8:n=i-e.actualRect("bottom")}n>0&&(e.renderAs||e.outerWrapper||e).modifyBox(t,n)}function _t(e,t,i){if(Tt(t,i)){let n,s,o,r;if(i?(n="marginTop",s="borderTopWidth",o="paddingTop",r=2):(o="paddingBottom",s="borderBottomWidth",n="marginBottom",r=8),0===e[s])if(0===e[o]){for(;yt&&0===t[n]&&0===t[s]&&0===t[o]&&wt(t);){const e=i?t.firstStaticChild:t.lastStaticChild;if(!Tt(e,i))break;t=e}const a=e[n],l=t[n],c=t.bounds.height;let h=!1;if(!yt&&0===a&&l>0&&""===t.cssInitial(n))h=!0;else{const n=a>=l;0===c&&n&&t.textEmpty&&0===t.extensions.length?t.hide():1!==t.getBox(r)[0]&&(n?h=!0:e.documentBody?(Et(e,r),i&&(e.bounds.top=0,e.unset("box"),e.unset("linear"))):(1!==e.getBox(r)[0]&&(e.modifyBox(r),e.modifyBox(r,l)),h=!0))}h&&(Et(t,r),0===c&&Et(t,i?8:2))}else if(0===t[n]&&0===t[s]&&wt(t)){let r=!0;for(;;){const a=i?t.firstStaticChild:t.lastStaticChild;if(!a||0!==a[n]||0!==a[s])break;if(a[o]>0){a[o]>=e[o]?e.modifyBox(i?32:128):r&&e.modifyBox(i?32:128,-a[o]);break}Tt(a,i)||(r=!1),t=a}}}}function Et(e,t){const i=e[D.get(t)];if(0===e.getBox(t)[0])e.modifyBox(t);else for(const n of e.ascend(void 0,void 0,"outerWrapper"))if(n.getBox(t)[1]>=i){n.modifyBox(t,-i);break}}function Tt(e,t){if(e&&!e.floating&&!e.lineBreak){if(e.blockStatic||"table"===e.display)return!0;if(void 0!==t){if(t){const t=e.firstStaticChild;return Tt(t)&&kt(t)}{const t=e.lastStaticChild;return Tt(t)&&At(t)}}}return!1}const wt=e=>!e.layoutElement&&!e.tableElement&&"FIELDSET"!==e.tagName,kt=e=>!e.hasPX("height")&&0===e.paddingBottom&&0===e.borderBottomWidth&&wt(e),At=e=>!e.hasPX("height")&&0===e.borderTopWidth&&0===e.paddingTop&&wt(e);const Rt={Accessibility:class extends Se{constructor(){super(...arguments),this.options={showLabel:!1}}beforeBaseLayout(){for(const e of this.application.processing.cache)if(e.inputElement&&e.hasProcedure(U.ACCESSIBILITY))switch(e.containerName){case"INPUT_IMAGE":e.extracted=[e];break;case"INPUT_RADIO":case"INPUT_CHECKBOX":const t=e.element;[e.nextSibling,e.previousSibling].some(i=>{if(i&&i.visible&&i.pageFlow&&!i.visibleStyle.backgroundImage){const n="LABEL"===i.documentParent.tagName?i.documentParent:void 0;if(t.id===i.element.htmlFor&&t.id?e.companion=i:i.textElement&&n?(e.companion=i,n.renderAs=e):i.plainText&&(e.companion=i),e.companion)return this.options.showLabel||i.hide(),!0}return!1});break;case"BUTTON":if(e.length){const t=e.filter(e=>!e.textElement);t.length&&(e.extracted=t),e.clear()}}}},CssGrid:Ke,Flexbox:Ze,Grid:it,List:ot,Relative:class extends Se{is(e){return e.positionRelative||0!==e.toFloat("verticalAlign",!0)}condition(){return!0}processNode(){return{include:!0}}postOptimize(e){const t=e.renderParent;if(t){const i=at.convertFloat(e.verticalAlign);let n=e,{top:s,right:o,bottom:r,left:a}=e;if(t.support.container.positionRelative&&t.layoutHorizontal&&0===e.renderChildren.length&&(0!==e.top||0!==e.bottom||0!==i)){const i=this.application;(n=e.clone(this.application.nextId,!0,!0)).baselineAltered=!0,e.hide(!0),i.session.cache.append(n,!1);const s=new ie(t,n,n.containerType,n.alignmentType),o=t.renderChildren.findIndex(t=>t===e);if(-1!==o&&(s.renderIndex=o+1),i.addLayout(s),t.layoutHorizontal&&e.documentParent.toInt("textIndent")<0&&t.renderEach(t=>{t.alignSibling(F.TOP_BOTTOM)===e.documentId?t.alignSibling(F.TOP_BOTTOM,n.documentId):t.alignSibling(F.BOTTOM_TOP)===e.documentId&&t.alignSibling(F.BOTTOM_TOP,n.documentId)}),e.baselineActive&&!e.baselineAltered)for(const i of t.horizontalRows||[t.renderChildren])if(i.includes(e)){const t=at.filterArray(i,t=>t.positionRelative&&t.length>0&&0!==at.convertFloat(e.verticalAlign)),n=t.length;if(n){t.sort((e,t)=>at.withinRange(e.linear.top,t.linear.top)?0:e.linear.top<t.linear.top?-1:1);for(let i=0;i<n;i++){const n=t[i];0===i?e.modifyBox(2,at.convertFloat(n.verticalAlign)):n.modifyBox(2,n.linear.top-t[0].linear.top),n.css("verticalAlign","0px",!0)}}break}}else if(e.naturalElement&&e.positionRelative){const i=e.actualParent;if(i){let n,l=!1;for(const c of i.naturalElements){if(c===e){if(l){if(t.layoutVertical&&(0!==e.top||0!==e.bottom)){const t=rt.assignRect(e.element.getBoundingClientRect(),!0);0!==s&&(s-=t.top-e.bounds.top),0!==r&&(r+=t.bottom-e.bounds.bottom)}if(t.layoutHorizontal&&(0!==e.left||0!==e.right)&&""===e.alignSibling(F.LEFT_RIGHT)){const t=rt.assignRect(e.element.getBoundingClientRect(),!0);0!==a&&(a-=t.left-e.bounds.left),0!==o&&(o+=t.right-e.bounds.right)}}else if(t.layoutVertical)if(0!==s)n&&n.blockStatic&&n.positionRelative&&c.blockStatic&&(s-=n.top);else if(0!==r){1===c.getBox(2)[0]&&(r-=c.marginTop)}break}c.positionRelative&&c.renderParent===t&&(l=!0),n=c}}}0!==s?n.modifyBox(2,s):0!==r&&n.modifyBox(2,-1*r),0!==i&&n.modifyBox(2,-1*i),0!==a?n.autoMargin.left?n.modifyBox(4,-1*a):n.modifyBox(16,a):0!==o&&n.modifyBox(16,-1*o)}}},Sprite:class extends Se{is(){return!0}condition(e){const t=e.backgroundImage;if(""!==t&&e.hasWidth&&e.hasHeight&&0===e.length&&(this.included(e.element)||!e.dataset.use)){const i=this.resource.getRawData(t)||this.resource.getImage(lt.resolveURL(t));if(i){const t=/^0[a-z%]+|left|start|top/,n=e.actualDimension,s=e.css("backgroundPositionX"),o=e.css("backgroundPositionY"),r=lt.getBackgroundPosition(s+" "+o,n,e.fontSize),a=(r.left<0||t.test(s))&&i.width>n.width,l=(r.top<0||t.test(o))&&i.height>n.height;if((a||l)&&(a||0===r.left)&&(l||0===r.top))return e.data(H.SPRITE,F.EXT_DATA,{image:i,position:r}),!0}}return!1}},Table:gt,VerticalAlign:class extends Se{is(){return!0}condition(e){let t=!1,i=0,n=0;for(const s of e)s.inlineVertical&&(n++,0!==mt.convertInt(s.verticalAlign)&&(t=!0)),(s.positionStatic||s.positionRelative&&s.length)&&i++;return t&&n>1&&i===e.length&&ee.linearData(e.children).linearX}processNode(e){return e.each(e=>{(e.inlineVertical&&!e.baseline||e.imageElement)&&(e.baselineAltered=!0)}),{include:!0}}postConstraints(e){if(e.layoutHorizontal)for(const t of e.horizontalRows||[e.renderChildren]){const e=[];let i,n=1/0;for(const s of t){const t=s.linear.top;s.inlineVertical&&t<=n&&(t<n&&(e.length=0),e.push(s),n=t),s.baselineActive&&(i=s)}if(e.length){const n=e[0].linear.top;for(const s of t)if(s!==i){if(s.inlineVertical&&!s.baseline&&!e.includes(s)){let e=!1;switch(s.verticalAlign){case"super":case"sub":e=!0;break;default:(pt.isLength(s.verticalAlign)||void 0===i)&&(e=!0)}e&&s.modifyBox(2,s.linear.top-n)}s.baselineAltered&&s.css("verticalAlign","0px",!0)}i&&(i.modifyBox(2,i.linear.top-n),i.baselineAltered=!0)}}else e.each(e=>e.baselineAltered=!1)}},WhiteSpace:class extends Se{afterBaseLayout(){const e=new Set;for(const t of this.application.processing.cache)if(t.naturalElement&&!t.layoutElement&&!t.tableElement&&t.naturalElements.length&&0!==t.id){let i,n;const s=t.naturalChildren,o=s.length;for(let r=0;r<o;r++){const a=s[r];if(a.pageFlow&&(t.floating||(a.floating?n=void 0:(a.blockStatic||a.bounds.height>0||1===o)&&(void 0===i&&(i=a),n=a)),r>0&&Tt(a,!1))){const i=a.previousSiblings({floating:!1}),n=i.length;if(n){const s=i[n-1];let o=!1;if(Tt(s,!0)){let t=s.marginBottom,i=a.marginTop;if(s.excluded&&!a.excluded){const n=Math.min(t,s.marginTop);if(n<0){a.modifyBox(2,Math.abs(n)>=i?void 0:n),e.add(s.id);continue}}else if(!s.excluded&&a.excluded){const n=Math.min(i,a.marginBottom);if(n<0){s.modifyBox(8,Math.abs(n)>=t?void 0:n),e.add(a.id);continue}}let n=s,r=!1;for(;kt(n);){const e=n.lastStaticChild;if(Tt(e,!0)&&1!==e.getBox(8)[0]){const i=e.marginBottom;if(Et(e,8),i>t)s.setCacheValue("marginBottom",t=i),r=!0;else if(0===i&&0===t){n=e;continue}}break}for(n=a;At(n);){const e=n.firstStaticChild;if(Tt(e,!1)&&1!==e.getBox(2)[0]){const t=e.marginTop;if(Et(e,2),t>i)a.setCacheValue("marginTop",i=t),o=!0;else if(0===t&&0===i){n=e;continue}}break}if(t>0&&(i>0?i<=t?o&&xt.hasBit(a.overflow,64)||(o&&(a.setCacheValue("marginTop",0),o=!1),Et(a,2)):r&&xt.hasBit(s.overflow,64)||(r&&(s.setCacheValue("marginBottom",0),r=!1),Et(s,8)):0===s.bounds.height&&Et(s,8)),o)for(const e of a.registerBox(2))e.setCacheValue("marginTop",i);if(r)for(const e of s.registerBox(8))e.setCacheValue("marginBottom",t)}if(!o&&i.length>1){const e=i[0];if(e.floating&&(t.layoutVertical||a.renderParent&&a.renderParent.layoutVertical)){const t=e.linear.top-a.linear.top;t<0&&a.modifyBox(2,t,!1)}}}}}if(!(xt.hasBit(t.overflow,64)||t.documentParent.layoutElement&&"column"===t.documentParent.css("flexDirection")||"FIELDSET"===t.tagName)&&(i&&_t(t,i,!0),n&&(_t(t,n,!1),n.marginTop<0))){const e=n.bounds.height+n.marginBottom+n.marginTop;e<0&&t.modifyBox(128,e,!1)}}for(const t of this.application.processing.excluded)if(t.lineBreak&&!t.lineBreakTrailing&&!e.has(t.id)){const i=t.previousSiblings({floating:!1}),n=t.nextSiblings({floating:!1});let s=!1;if(i.length&&n.length){let o=i.pop(),r=n.pop();if(o.inlineStatic&&r.inlineStatic&&0===i.length){e.add(t.id);continue}const a=t.actualParent;if(a){let e=0;const t=()=>r.linear.top-o.linear.bottom-e;if(!o.multiline&&o.has("lineHeight")){const t=Math.floor((o.lineHeight-o.bounds.height)/2);t>0&&(e+=t)}if(!r.multiline&&r.has("lineHeight")){const t=Math.round((r.lineHeight-r.bounds.height)/2);t>0&&(e+=t)}let i=o.renderParent,n=r.renderParent;if(i&&n){for(;i&&i!==a;)i=(o=i).renderParent;for(;n&&n!==a;)n=(r=n).renderParent;if(n===i){const e=t();0!==e&&(r.visible?(r.modifyBox(2,e),s=!0):o.visible&&(o.modifyBox(8,e),s=!0))}}else{const e=t();0!==e&&(r.lineBreak||r.excluded?(a.modifyBox(128,e),s=!0):(o.lineBreak||o.excluded)&&(a.modifyBox(32,e),s=!0))}}}else{const e=t.actualParent;if(e&&e.visible){if(!e.documentRoot&&0===e.ascend(e=>e.documentRoot,void 0,"outerWrapper").length&&i.length){const t=i[i.length-1],n=0===t.bounds.height&&t.length?ee.outerRegion(t):t.linear,s=e.box.bottom-(t.lineBreak||t.excluded?n.top:n.bottom);0!==s&&(t.rendered||e.visibleStyle.background?e.modifyBox(128,s):e.hasHeight||vt(e,s))}else if(n.length){const t=n[n.length-1],i=(t.lineBreak||t.excluded?t.linear.bottom:t.linear.top)-e.box.top;0!==i&&(t.rendered||e.visibleStyle.background?e.modifyBox(32,i):e.hasHeight||vt(e,i))}s=!0}}if(s){for(const t of i)e.add(t.id);for(const t of n)e.add(t.id)}}}afterConstraints(){const e=this.application.processing.cache;for(const t of e)if(t.pageFlow){const e=t.renderParent;if(e&&t.styleElement&&t.inlineVertical&&!t.positioned&&!t.documentParent.layoutElement&&!e.tableElement){if(t.blockDimension&&!t.floating)if(e.layoutVertical){const i=e.renderChildren,n=i.findIndex(e=>e===t);if(-1!==n){if(!t.lineBreakLeading){const e=i[n-1];e&&e.pageFlow&&St(t,2,e.actualRect("bottom"))}if(!t.lineBreakTrailing){const e=i[n+1];e&&e.pageFlow&&e.styleElement&&!e.inlineVertical&&St(t,8,e.actualRect("top"))}}}else{let i;if(e.horizontalRows)e:{const n=e.horizontalRows;let s=-1/0;const o=n.length;for(let e=0;e<o;e++){const o=n[e],r=o.length;for(let n=0;n<r;n++)if(t===o[n]){e>0?St(t,2,s):i=o;break e}for(const e of o)if(e.blockDimension&&!e.floating){const t=e.actualRect("bottom");t>s&&(s=t)}if(s===-1/0)break}}else e.layoutHorizontal&&(i=e.renderChildren);if(i){const e=t.actualParent;if(e){const n=t.actualRect("top");let s=-1/0;for(const t of e.naturalChildren){if(i.includes(t))break;if(t.lineBreak)s=-1/0;else if(t.blockDimension&&!t.floating){const e=t.actualRect("bottom");e>s&&(s=e)}}s!==-1/0&&n>s&&St(t,2,s)}}}if(e.layoutHorizontal&&!t.alignParent("left")){const i=t.alignSibling("leftRight");if(""!==i){const n=e.renderChildren.find(e=>e.documentId===i);n&&n.inlineVertical&&St(t,16,n.actualRect("right"))}else{let e=t;for(;;){const i=e.siblingsLeading;if(i.length&&!i.some(e=>e.lineBreak||e.excluded&&e.blockStatic)){const n=i[0];if(n.inlineVertical)St(t,16,n.actualRect("right"));else if(n.floating){e=n;continue}}break}}}}}}}},Ct={constant:V,enumeration:G};e.Application=E,e.ApplicationUI=de,e.Controller=T,e.ControllerUI=class extends T{constructor(){super(...arguments),this._requireFormat=!1,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}reset(){this._requireFormat=!1,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}preventNodeCascade(e){return this.localSettings.unsupported.cascade.has(e.tagName)}applyDefaultStyles(e){const t=this.sessionId;let i;if(ge.isTextNode(e))i={position:"static",display:"inline",verticalAlign:"baseline",float:"none",clear:"none"};else{i=pe.getElementCache(e,"styleMap",t)||{};const n=()=>{if(void 0===i.border&&function(e){for(let t=0;t<4;t++)if(i[fe.BOX_BORDER[t][e]])return!1;return!0}(0)){const e=this.localSettings.style.inputBorderColor;i.border="outset 1px "+e;for(let t=0;t<4;t++)i[fe.BOX_BORDER[t][0]]="outset",i[fe.BOX_BORDER[t][1]]="1px",i[fe.BOX_BORDER[t][2]]=e;return!0}return!1},s=e=>{!e||void 0!==i.backgroundColor&&"initial"!==i.backgroundColor||(i.backgroundColor=this.localSettings.style.inputBackgroundColor),void 0===i.textAlign&&(i.textAlign="center"),void 0!==i.padding||fe.BOX_PADDING.some(e=>!!i[e])||(i.paddingTop="2px",i.paddingRight="6px",i.paddingBottom="3px",i.paddingLeft="6px")};if(ue.isUserAgent(8))switch(e.tagName){case"INPUT":case"SELECT":case"BUTTON":case"TEXTAREA":void 0===i.display&&(i.display="inline-block");break;case"FIELDSET":void 0===i.display&&(i.display="block")}switch(e.tagName){case"INPUT":{const t=e.type;switch(t){case"radio":case"checkbox":break;case"week":case"month":case"time":case"date":case"datetime-local":i.paddingTop=fe.formatPX(me.convertFloat(i.paddingTop)+1),i.paddingRight=fe.formatPX(me.convertFloat(i.paddingRight)+1),i.paddingBottom=fe.formatPX(me.convertFloat(i.paddingBottom)+1),i.paddingLeft=fe.formatPX(me.convertFloat(i.paddingLeft)+1);break;case"image":void 0===i.verticalAlign&&(i.verticalAlign="text-bottom");break;default:const e=n();switch(t){case"file":case"reset":case"submit":case"button":s(e)}}break}case"BUTTON":s(n());break;case"TEXTAREA":case"SELECT":n();break;case"BODY":void 0!==i.backgroundColor&&"initial"!==i.backgroundColor||(i.backgroundColor="rgb(255, 255, 255)");break;case"FORM":void 0===i.marginTop&&(i.marginTop="0px");break;case"LI":if(void 0===i.listStyleImage){const t=fe.getStyle(e);i.listStyleImage=t.getPropertyValue("list-style-image")}break;case"IFRAME":void 0===i.display&&(i.display="block");case"IMG":const t=(t,n)=>{if(void 0===i[t]||"auto"===i[t]){const s=RegExp(`\\s+${t}="([^"]+)"`).exec(e.outerHTML);if(s)fe.isLength(s[1])?i[t]=s[1]+"px":fe.isPercent(s[1])&&(i[t]=s[1]);else if("IFRAME"===e.tagName)"width"===t?i.width="300px":i.height="150px";else if(i[n]&&fe.isLength(i[n])){const s="max"+me.capitalize(t);if(void 0===i[s]||!fe.isPercent(s)){const s=this.application.resourceHandler.getImage(e.src);s&&s.width>0&&s.height>0&&(i[t]=fe.formatPX(s[t]*parseFloat(i[n])/s[n]))}}}};t("width","height"),t("height","width")}}pe.setElementCache(e,"styleMap",t,i)}addBeforeOutsideTemplate(e,t,i=!0,n=-1){void 0===this._beforeOutside[e]&&(this._beforeOutside[e]=[]),-1!==n&&n<this._beforeOutside[e].length?this._beforeOutside[e].splice(n,0,t):this._beforeOutside[e].push(t),i&&(this._requireFormat=!0)}addBeforeInsideTemplate(e,t,i=!0,n=-1){void 0===this._beforeInside[e]&&(this._beforeInside[e]=[]),-1!==n&&n<this._beforeInside[e].length?this._beforeInside[e].splice(n,0,t):this._beforeInside[e].push(t),i&&(this._requireFormat=!0)}addAfterInsideTemplate(e,t,i=!0,n=-1){void 0===this._afterInside[e]&&(this._afterInside[e]=[]),-1!==n&&n<this._afterInside[e].length?this._afterInside[e].splice(n,0,t):this._afterInside[e].push(t),i&&(this._requireFormat=!0)}addAfterOutsideTemplate(e,t,i=!0,n=-1){void 0===this._afterOutside[e]&&(this._afterOutside[e]=[]),-1!==n&&n<this._afterOutside[e].length?this._afterOutside[e].splice(n,0,t):this._afterOutside[e].push(t),i&&(this._requireFormat=!0)}getBeforeOutsideTemplate(e,t=0){return this._beforeOutside[e]?be.pushIndentArray(this._beforeOutside[e],t):""}getBeforeInsideTemplate(e,t=0){return this._beforeInside[e]?be.pushIndentArray(this._beforeInside[e],t):""}getAfterInsideTemplate(e,t=0){return this._afterInside[e]?be.pushIndentArray(this._afterInside[e],t):""}getAfterOutsideTemplate(e,t=0){return this._afterOutside[e]?be.pushIndentArray(this._afterOutside[e],t):""}hasAppendProcessing(e){return void 0===e?this._requireFormat:void 0!==this._beforeOutside[e]||void 0!==this._beforeInside[e]||void 0!==this._afterInside[e]||void 0!==this._afterOutside[e]}includeElement(e){return!(this.localSettings.unsupported.tagName.has(e.tagName)||"INPUT"===e.tagName&&this.localSettings.unsupported.tagName.has(e.tagName+":"+e.type))||"true"===e.contentEditable}visibleElement(e){const t=pe.actualClientRect(e,this.sessionId);if(xe(t)){const i=fe.getStyle(e);if(t.width>0&&t.height>0){if("visible"===i.getPropertyValue("visibility"))return!0;const e=i.getPropertyValue("position");return"absolute"!==e&&"fixed"!==e}return"IMG"===e.tagName&&"none"!==i.getPropertyValue("display")||t.width>0&&"none"!==i.getPropertyValue("float")||"none"!==i.getPropertyValue("clear")||"block"===i.getPropertyValue("display")&&(0!==parseInt(i.getPropertyValue("margin-top"))||0!==parseInt(i.getPropertyValue("margin-bottom")))||"__squared.pseudo"===e.className}return!1}evaluateNonStatic(e,t){const i=new Set;for(const n of t)if(!n.documentRoot){const t=n.parent,s=n.absoluteParent;let o;switch(n.css("position")){case"relative":if(n===t.lastChild){let i=!1;if(n.outsideX(t.box)){if(!t.hasPX("width")||"hidden"===t.css("overflowX"))continue;i=!0}if(n.outsideY(t.box)){if(!t.hasHeight&&!t.hasPX("height")||"hidden"===t.css("overflowY"))continue;i=!0}if(i){o=t.actualParent;do{if(n.withinX(o.box)&&n.withinY(o.box)||"hidden"===o.css("overflow"))break;o=t.actualParent}while(o&&o!==e);o&&(n.css("position","absolute",!0),n.setBounds(!1))}}break;case"fixed":if(!n.positionAuto){o=e;break}case"absolute":if(s)if(o=s,n.positionAuto)n.siblingsLeading.some(e=>e.multiline||e.excluded&&!e.blockStatic)?n.positionAuto=!1:n.cssApply({display:"inline-block",verticalAlign:"top"},!0),o=t;else if(this.userSettings.supportNegativeLeftTop){const t=o.box;let i=!1;for(;o&&o!==e;){if(i){if(o.layoutElement){o=s;break}if(n.withinX(t)&&n.withinY(t))break}else{const e="hidden"===o.css("overflowX"),s="hidden"===o.css("overflowY");if(e&&s||"0px"===n.cssInitial("top")||"0px"===n.cssInitial("right")||"0px"===n.cssInitial("bottom")||"0px"===n.cssInitial("left"))break;{const r=!e&&n.outsideX(t),a=!s&&n.outsideY(t);if(!s&&n.linear.top<Math.floor(t.top)&&(n.top<0||n.marginTop<0))i=!0;else if(r&&!n.hasPX("left")&&n.right>0||a&&!n.hasPX("top")&&0!==n.bottom)i=!0;else if(r&&a&&(!o.pageFlow||o.actualParent&&o.actualParent.documentBody)&&(n.top>0||n.left>0))i=!0;else if(!e&&n.outsideX(o.linear)&&!n.pseudoElement&&(n.left<0||n.marginLeft<0||!n.hasPX("left")&&n.right<0&&n.linear.left>=o.linear.right))i=!0;else{if(e||s||n.intersectX(t)||n.intersectY(t))break;i=!0}}}o=o.actualParent}}}if(void 0===o&&(o=n.pageFlow?t:e),o!==t){if(s&&s.positionRelative&&o!==s){const{left:e,right:t,top:i,bottom:o}=s,r=n.bounds;0!==e?(r.left+=e,r.right+=e):s.hasPX("left")||0===t||(r.left-=t,r.right-=t),0!==i?(r.top+=i,r.bottom+=i):s.hasPX("top")||0===o||(r.top-=o,r.bottom-=o),n.unset("box"),n.unset("linear")}let e=n.toFloat("opacity",!1,1),r=t;for(;r&&r!==o;)e*=r.toFloat("opacity",!1,1),r=r.actualParent;n.css("opacity",""+e),n.parent=o,n.containerIndex=1/0,i.add(o)}n.documentParent=o}for(const e of i){const t=[];let i=-1;e.each(n=>{if(n.containerIndex===1/0)for(const i of e.children){let e=i.naturalElements.includes(n);if(!e){const t=i.cascade();e=n.ascend(e=>t.includes(e)).length>0}if(e){const e=i.containerIndex+(n.zIndex>=0||i!==n.actualParent?1:0);void 0===t[e]&&(t[e]=[]),t[e].push(n);break}}else n.containerIndex>i&&(i=n.containerIndex)});const n=t.length;if(n){const s=e.children;for(let e=0,o=0,r=1;e<n;e++,o++){const n=t[e];if(n){n.sort((e,t)=>e.parent===t.parent?e.zIndex===t.zIndex?e.id<t.id?-1:1:e.zIndex<t.zIndex?-1:1:0);for(const e of n)e.containerIndex=i+r++;for(let e=0;e<s.length;e++)n.includes(s[e])&&(s[e]=void 0);s.splice(o,0,...n),o+=n.length}}e.retain(me.flatArray(s))}}}sortInitialCache(e){e.sort((e,t)=>{if(e.depth!==t.depth)return e.depth<t.depth?-1:1;{const i=e.documentParent,n=t.documentParent;if(i!==n)return i.depth!=i.depth?i.depth<i.depth?-1:1:i.actualParent===n.actualParent?i.childIndex<n.childIndex?-1:1:i.id<n.id?-1:1}return 0})}cascadeDocument(e,t){const i=t>0?"\t".repeat(t):"",n=this.userSettings.showAttributes;let s="";for(const o of e)if(o){const e=o.node;switch(o.type){case 1:{const{controlName:r,attributes:a}=o,{id:l,renderTemplates:c}=e,h=t+1,d=this.getBeforeInsideTemplate(l,h),u=this.getAfterInsideTemplate(l,h);let f=i+`<${r+(0===t?"{#0}":"")+(n?a?be.pushIndent(a,h):e.extractAttributes(h):"")}`;f+=c||""!==d||""!==u?">\n"+d+(c?this.cascadeDocument(this.sortRenderPosition(e,c),h):"")+u+i+`</${r}>\n`:" />\n",s+=this.getBeforeOutsideTemplate(l,t)+f+this.getAfterOutsideTemplate(l,t);break}case 2:{const e=o.content;e&&(s+=be.pushIndent(e,t));break}}}return s}getEnclosingXmlTag(e,t,i){return"<"+e+(t||"")+(i?">\n"+i+"</"+e+">\n":" />\n")}get generateSessionId(){return""+(new Date).getTime()}},e.Extension=w,e.ExtensionManager=class{constructor(e){this.application=e}include(e){const t=this.application,i=t.extensions.findIndex(t=>t.name===e.name);if(-1!==i)return t.extensions[i]=e,!0;{const i=e.framework;if(i>0)for(const i of e.dependencies)if(i.preload&&null===this.retrieve(i.name)){const e=t.builtInExtensions[i.name];e&&this.include(e)}if((0===i||k.hasBit(i,t.framework))&&e.dependencies.every(e=>!!this.retrieve(e.name)))return e.application=t,t.extensions.push(e),!0}return!1}exclude(e){const t=this.application.extensions;for(let i=0;i<t.length;i++)if(t[i]===e)return t.splice(i,1),!0;return!1}retrieve(e){for(const t of this.application.extensions)if(t.name===e)return t;return null}optionValue(e,t){const i=this.retrieve(e);if(i&&"object"==typeof i.options)return i.options[t]}optionValueAsObject(e,t){const i=this.optionValue(e,t);return"object"==typeof i?i:null}optionValueAsString(e,t){const i=this.optionValue(e,t);return"string"==typeof i?i:""}optionValueAsNumber(e,t){const i=this.optionValue(e,t);return"number"==typeof i?i:0}optionValueAsBoolean(e,t){const i=this.optionValue(e,t);return"boolean"==typeof i&&i}},e.ExtensionUI=Se,e.File=R,e.FileUI=class extends R{get directory(){return this.resource.controllerSettings.directory}},e.LayoutUI=ie,e.Node=W,e.NodeGroupUI=class extends ee{init(){if(this.length){for(const e of this.children)e.parent=this;this.setBounds(),this.saveAsInitial(),this.actualParent&&(this.dir=this.actualParent.dir)}}setBounds(){if(this.length){const e=ee.outerRegion(this);e.width=e.right-e.left,e.height=e.bottom-e.top,this._bounds=e}}previousSiblings(e){const t=this._initial.children[0];return t?t.previousSiblings(e):[]}nextSiblings(e){const t=this._initial.children,i=t[t.length-1];return i?i.nextSiblings(e):[]}get block(){return void 0===this._cached.block&&(this._cached.block=this.some(e=>e.block)),this._cached.block}get blockStatic(){if(void 0===this._cached.blockStatic){const e=this.naturalChildren.length&&this.naturalChildren[0].blockStatic||this.actualWidth===this.documentParent.actualWidth&&!this.some(e=>e.plainText||e.naturalElement&&e.rightAligned)||this.layoutVertical&&this.some(e=>e.blockStatic||e.rightAligned)||this.documentParent.blockStatic&&this.hasAlign(256);(e||0!==this.containerType)&&(this._cached.blockStatic=e)}return this._cached.blockStatic||this.hasAlign(64)}get blockDimension(){return void 0===this._cached.blockDimension&&(this._cached.blockDimension=this.some(e=>e.blockDimension)),this._cached.blockDimension}get inline(){return void 0===this._cached.inline&&(this._cached.inline=this.every(e=>e.inline)),this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.every(e=>e.inlineStatic)),this._cached.inlineStatic}get inlineVertical(){return void 0===this._cached.inlineVertical&&(this._cached.inlineVertical=this.every(e=>e.inlineVertical)),this._cached.inlineVertical}get inlineFlow(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inlineStatic||this.hasAlign(128)),this._cached.inlineStatic}get pageFlow(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=!this.cssAny("position","absolute","fixed")),this._cached.pageFlow}set baseline(e){this._cached.baseline=e}get baseline(){if(void 0===this._cached.baseline){const e=this.cssInitial("verticalAlign",!0);this._cached.baseline=""!==e?"baseline"===e:this.layoutHorizontal&&this.every(e=>e.baseline)}return this._cached.baseline}get float(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.hasAlign(2048)?"right":"left":"none"),this._cached.float}get floating(){return void 0===this._cached.floating&&(this._cached.floating=this.every(e=>e.floating)),this._cached.floating}get display(){return super.display||this.some(e=>e.blockStatic)?"block":this.blockDimension?"inline-block":"inline"}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}get tagName(){return""}get plainText(){return!1}get styleText(){return!1}get multiline(){return!1}get nodeGroup(){return!0}get naturalChild(){return!1}get naturalElement(){return!1}get pseudoElement(){return!1}get previousSibling(){return null}get nextSibling(){return null}get previousElementSibling(){return null}get nextElementSibling(){return null}},e.NodeList=t,e.NodeUI=ee,e.Resource=s,e.ResourceUI=Fe,e.extensions=Rt,e.lib=Ct,Object.defineProperty(e,"__esModule",{value:!0})}));
