!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e=e||self).squared=e.squared||{},e.squared.base={}))}(this,function(e){"use strict";const t=squared.lib.constant,i=squared.lib.css,s=squared.lib.util;class n extends squared.lib.base.Container{constructor(e){super(e),this._currentId=0}static outerRegion(e){let i=e.item(0),s=i,n=i,o=i;return e.each((e,a)=>{a>0&&(e.actualRect(t.CSS.TOP)<i.actualRect(t.CSS.TOP)&&(i=e),e.actualRect(t.CSS.RIGHT)>s.actualRect(t.CSS.RIGHT)&&(s=e),e.actualRect(t.CSS.BOTTOM)>n.actualRect(t.CSS.BOTTOM)&&(n=e),e.actualRect(t.CSS.LEFT)<o.actualRect(t.CSS.LEFT)&&(o=e))}),{top:i.linear.top,right:s.linear.right,bottom:n.linear.bottom,left:o.linear.left}}static actualParent(e){for(const t of e)if(t.naturalElement){if(t.actualParent)return t.actualParent}else{const e=t.innerWrapped;if(e&&e.naturalElement&&e.actualParent)return e.actualParent;if(t.groupParent){const e=n.actualParent(t.actualChildren);if(e)return e}}return null}static baseline(e,t=!1){const n=s.filterArray(e,e=>(e.baseline||i.isLength(e.verticalAlign))&&!e.floating&&!e.baselineAltered&&(e.naturalElement&&0===e.length||e.every(e=>e.baseline&&!e.multiline)));if(!n.length)return n;if(e=n,t&&s.spliceArray(e,e=>!((e.textElement||e.inputElement)&&e.naturalElement)),e.length>1){let t=0,i=0;for(let s=0;s<e.length;s++){const n=e[s];if(n.layoutVertical&&n.length>1||n.plainText&&n.multiline)e.splice(s--,1);else{let e;n.htmlElement&&n.multiline&&n.cssTry("whiteSpace","nowrap")?(e=n.element.getBoundingClientRect().height,n.cssFinally("whiteSpace")):e=n.bounds.height,t=Math.max(t,e),i=Math.max(i,n.lineHeight)}}s.spliceArray(e,e=>i>t?e.lineHeight!==i:e.bounds.height<t),e.sort((e,t)=>{if(e.groupParent||e.length||!e.baseline&&t.baseline)return 1;if(t.groupParent||t.length||e.baseline&&!t.baseline)return-1;if(!e.imageElement||!t.imageElement){if(e.textElement&&t.textElement)return e.fontSize===t.fontSize?e.htmlElement&&!t.htmlElement?-1:!e.htmlElement&&t.htmlElement?1:e.siblingIndex<t.siblingIndex?-1:1:e.fontSize>t.fontSize?-1:1;if(e.containerType!==t.containerType)return e.textElement?-1:t.textElement?1:e.imageElement?-1:t.imageElement?1:e.containerType<t.containerType?-1:1}const i=Math.max(e.actualHeight,e.lineHeight),s=Math.max(t.actualHeight,t.lineHeight);return i!==s?i>s?-1:1:e.linear.bottom>t.linear.bottom?-1:e.linear.bottom<t.linear.bottom?1:0})}return e}static linearData(e,i=!1){const n=new Set,o=new Map;let a=!1,r=!1;if(e.length>1){const l=[],c=new Set,h={};for(const i of e)if(i.pageFlow){if(c.size){const e=[],s=i.css("clear");switch(s){case t.CSS.LEFT:e.push(h.left);break;case t.CSS.RIGHT:e.push(h.right);break;case"both":e.push(h.left,h.right)}for(const t of e)t&&c.has(t.float)&&!i.floating&&i.linear.top>=t.linear.bottom&&(c.delete(t.float),h[t.float]=void 0);"both"===s?(o.set(i,2===c.size?"both":c.values().next().value),c.clear(),h.left=void 0,h.right=void 0):c.has(s)&&(o.set(i,s),c.delete(s),h[s]=void 0)}i.floating&&(c.add(i.float),n.add(i.float),h[i.float]=i),l.push(i)}else i.positionAuto&&l.push(i);if(l.length&&!i){const e=[l[0]];let i=1,c=1;for(let t=1;t<l.length;t++)l[t].alignedVertically(l[t].previousSiblings(),e,o)?c++:i++,e.push(l[t]);if(r=c===l.length,(a=i===l.length)&&n.size){let e=1/0,i=-1/0,n=-1/0,o=1/0;for(const s of l)e=Math.min(e,s.linear.left),i=Math.max(i,s.linear.right),s.floating&&(s.float===t.CSS.LEFT?n=Math.max(n,s.linear.right):o=Math.min(o,s.linear.left));for(let t=0,r=0,c=0,h=0,d=0;t<l.length;t++){const u=l[t];if(Math.floor(u.linear.left)<=e&&r++,Math.ceil(u.linear.right)>=i&&c++,u.floating||(u.linear.left===n&&h++,u.linear.right===o&&d++),0===t)continue;if(2===r||2===c||2===h||2===d){a=!1;break}const g=l[t-1];if(g.floating&&u.linear.top>=g.linear.bottom||s.withinRange(u.linear.left,g.linear.left)){a=!1;break}}}}}else e.length&&(a=!(r=e[0].blockStatic));return{linearX:a,linearY:r,cleared:o,floated:n}}static partitionRows(e){const t=this.actualParent(e),i=t?t.actualChildren:e,n=this.linearData(e,!0).cleared,o=s.filterArray(e,e=>e.groupParent),a=[];let r=[];function l(t){if(e.includes(t))return t;let i=t.outerWrapper;for(;i;){if(e.includes(i))return i;i=i.outerWrapper}}for(let e=0;e<i.length;e++){let t=i[e],s=!1;for(let e=0;e<o.length;e++){const i=o[e];if(i.contains(t)||i===t){r.length&&a.push(r),a.push([i]),r=[],o.splice(e,1),s=!0;break}}if(s)continue;const c=t.previousSiblings();0===e||0===c.length?(t=l(t))&&r.push(t):t.alignedVertically(c,r,n)?(r.length&&a.push(r),r=(t=l(t))?[t]:[]):(t=l(t))&&r.push(t),e===i.length-1&&r.length&&a.push(r)}return a}static siblingIndex(e,t){return e.siblingIndex<t.siblingIndex?-1:1}append(e,t=!0){return super.append(e),t&&this.afterAppend&&this.afterAppend.call(this,e),this}reset(){return this._currentId=0,this.clear(),this}get nextId(){return++this._currentId}}const o=squared.lib.util;class a extends squared.lib.base.Container{constructor(e,t,i=0,s=0,n){super(n),this.parent=e,this.node=t,this.containerType=i,this.alignmentType=s,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,n&&this.init()}init(){const e=this.children.length;if(e){if(e>1){const e=n.linearData(this.children);this._floated=e.floated,this._cleared=e.cleared,this._linearX=e.linearX,this._linearY=e.linearY}else this._linearY=this.item(0).blockStatic,this._linearX=!this._linearY;let t=0,i=0;for(let s=0;s<e;s++){const e=this.item(s);e.floating&&t++,e.rightAligned&&i++}(t===e||this._floated&&2===this._floated.size)&&(this.add(512),this.some(e=>e.blockStatic)&&this.add(64)),i===e&&this.add(1024),this.itemCount=e}}reset(e,t){this.containerType=0,this.alignmentType=0,this.rowCount=0,this.columnCount=0,this.renderType=0,this.renderIndex=-1,this.itemCount=0,this._linearX=void 0,this._linearY=void 0,this._floated=void 0,this._cleared=void 0,e&&(this.parent=e),t&&(this.node=t),this.clear()}setType(e,...t){this.containerType=e;for(const e of t)this.add(e)}hasAlign(e){return o.hasBit(this.alignmentType,e)}add(e){return o.hasBit(this.alignmentType,e)||(this.alignmentType|=e),this.alignmentType}delete(e){return o.hasBit(this.alignmentType,e)&&(this.alignmentType^=e),this.alignmentType}retain(e){return super.retain(e),this.init(),this}get linearX(){return void 0===this._linearX||this._linearX}get linearY(){return void 0!==this._linearY&&this._linearY}get floated(){return this._floated||new Set}get cleared(){return this._cleared||new Map}get singleRowAligned(){if(void 0===this._singleRow){let e=1/0;this._singleRow=!0;for(const t of this.children){if(t.multiline){this._singleRow=!1;break}{const i=o.convertFloat(t.verticalAlign);if(t.linear.top-i>=e){this._singleRow=!1;break}e=t.linear.bottom+i}}}return this._singleRow}get visible(){return this.filter(e=>e.visible)}}var r,l,c;!function(e){e[e.DOM_TRAVERSE=2]="DOM_TRAVERSE",e[e.EXTENSION=4]="EXTENSION",e[e.RENDER=8]="RENDER",e[e.ALL=14]="ALL"}(r||(r={})),function(e){e[e.BOX_STYLE=2]="BOX_STYLE",e[e.BOX_SPACING=4]="BOX_SPACING",e[e.FONT_STYLE=8]="FONT_STYLE",e[e.VALUE_STRING=16]="VALUE_STRING",e[e.IMAGE_SOURCE=32]="IMAGE_SOURCE",e[e.ASSET=56]="ASSET",e[e.ALL=126]="ALL"}(l||(l={})),function(e){e[e.CONSTRAINT=2]="CONSTRAINT",e[e.LAYOUT=4]="LAYOUT",e[e.ALIGNMENT=8]="ALIGNMENT",e[e.ACCESSIBILITY=16]="ACCESSIBILITY",e[e.LOCALIZATION=32]="LOCALIZATION",e[e.CUSTOMIZATION=64]="CUSTOMIZATION",e[e.ALL=126]="ALL"}(c||(c={}));var h=Object.freeze({get APP_SECTION(){return r},get NODE_RESOURCE(){return l},get NODE_PROCEDURE(){return c}});const d=squared.lib.constant,u=squared.lib.css,g=squared.lib.dom,f=squared.lib.regex,p=squared.lib.session,m=squared.lib.util,b=squared.lib.xml,S="(?:data:([^;]+);([^,]+),)?(.*?)",y={};let T;function x(e,t){if(e.dataset.use){const i=e.dataset.use.split(f.XML.SEPARATOR),s=[],n=[];for(const e of t){const t=i.indexOf(e.name);-1!==t?s[t]=e:n.push(e)}if(s.length)return m.concatArray(m.spliceArray(s,e=>void 0===e),n)}return t}function _(e,t){const i=RegExp(`^@${e}([^{]+)`).exec(t);return i&&(t=i[1].trim()),t}const C={EXT_DATA:"mainData",TOP_BOTTOM:"topBottom",BOTTOM_TOP:"bottomTop",LEFT_RIGHT:"leftRight",RIGHT_LEFT:"rightLeft"},E=new Map([[2,"marginTop"],[4,"marginRight"],[8,"marginBottom"],[16,"marginLeft"],[32,"paddingTop"],[64,"paddingRight"],[128,"paddingBottom"],[256,"paddingLeft"]]),v=[["borderTopStyle","borderTopWidth","borderTopColor"],["borderRightStyle","borderRightWidth","borderRightColor"],["borderBottomStyle","borderBottomWidth","borderBottomColor"],["borderLeftStyle","borderLeftWidth","borderLeftColor"],["outlineStyle","outlineWidth","outlineColor"]],A={ACCESSIBILITY:"squared.accessibility",CSS_GRID:"squared.css-grid",EXTERNAL:"squared.external",FLEXBOX:"squared.flexbox",GRID:"squared.grid",LIST:"squared.list",RELATIVE:"squared.relative",SPRITE:"squared.sprite",SUBSTITUTE:"squared.substitute",TABLE:"squared.table",VERTICAL_ALIGN:"squared.verticalalign",WHITESPACE:"squared.whitespace"};var I=Object.freeze({STRING_BASE:C,CSS_SPACING:E,CSS_BORDER:v,EXT_NAME:A});const w=squared.lib.color,R=squared.lib.constant,k=squared.lib.client,B=squared.lib.css,P=squared.lib.session,N=squared.lib.util,L=squared.lib.xml,O=e=>!(e.left<0&&e.top<0&&Math.abs(e.left)>=e.width&&Math.abs(e.top)>=e.height);const M=squared.lib.css,H=squared.lib.util;class W{constructor(e,t,i,s){this.name=e,this.framework=t,this.eventOnly=!1,this.preloaded=!1,this.documentBase=!1,this.options={},this.dependencies=[],this.subscribers=new Set,this.tagNames=Array.isArray(i)?H.replaceMap(i,e=>e.trim().toUpperCase()):[],s&&Object.assign(this.options,s)}static findNestedElement(e,t){if(M.hasComputedStyle(e))for(let i=0;i<e.children.length;i++){const s=e.children[i];if(H.includes(s.dataset.use,t))return s}return null}is(e){return!!e.styleElement&&(0===this.tagNames.length||this.tagNames.includes(e.element.tagName))}require(e,t=!1){this.dependencies.push({name:e,preload:t})}included(e){return H.includes(e.dataset.use,this.name)}beforeInit(e,t=!1){if(!t&&this.included(e))for(const t of this.dependencies)if(t.preload){const i=this.application.extensionManager.retrieve(t.name);i&&!i.preloaded&&(i.beforeInit(e,!0),i.preloaded=!0)}}init(e){return!1}afterInit(e,t=!1){if(!t&&this.included(e))for(const t of this.dependencies)if(t.preload){const i=this.application.extensionManager.retrieve(t.name);i&&i.preloaded&&(i.afterInit(e,!0),i.preloaded=!1)}}condition(e,t){return!!M.hasComputedStyle(e.element)&&(e.dataset.use?this.included(e.element):this.tagNames.length>0)}processNode(e,t){}processChild(e,t){}addDescendant(e){const t=this.application.session.extensionMap.get(e.id)||[];t.includes(this)||t.push(this),this.application.session.extensionMap.set(e.id,t)}postBaseLayout(e){}postConstraints(e){}postParseDocument(e){}postOptimize(e){}postBoxSpacing(e){}beforeParseDocument(){}afterBaseLayout(){}afterConstraints(){}afterResources(){}afterParseDocument(){}beforeCascade(){}afterFinalize(){}get installed(){return!!this.application&&this.application.extensions.includes(this)}}const F=squared.lib.util;const D=squared.lib.constant,G=squared.lib.util;class X{constructor(e){this.resource=e,this.appName="",this.assets=[],e.fileHandler=this}static downloadToDisk(e,t,i){const s=new Blob([e],{type:i||"application/octet-stream"}),n=window.URL.createObjectURL(s),o=document.createElement("a");o.style.setProperty("display",D.CSS.NONE),o.setAttribute("href",n),o.setAttribute("download",t),o.download||o.setAttribute("target","_blank"),document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>window.URL.revokeObjectURL(n),1)}addAsset(e){if(e.content||e.uri||e.base64){const t=this.assets.findIndex(t=>t.pathname===e.pathname&&t.filename===e.filename);-1!==t?Object.assign(this.assets[t],e):this.assets.push(e)}}reset(){this.assets.length=0}saveToDisk(e,t){if(location.protocol.startsWith("http")){if(e.length){const i=this.userSettings;G.concatArray(e,this.assets),fetch("/api/savetodisk"+`?directory=${encodeURIComponent(G.trimString(i.outputDirectory,"/"))}`+(t?`&appname=${encodeURIComponent(t.trim())}`:"")+`&format=${i.outputArchiveFormat.toLowerCase()}`+`&timeout=${(""+i.outputArchiveTimeout).trim()}`,{method:"POST",headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e&&(e.zipname?fetch(`/api/downloadtobrowser?filename=${encodeURIComponent(e.zipname)}`).then(e=>e.blob()).then(t=>X.downloadToDisk(t,G.fromLastIndexOf(e.zipname,"/"))):e.system&&this.userSettings.showErrorMessages&&alert(`${e.application}\n\n${e.system}`))}).catch(e=>{this.userSettings.showErrorMessages&&alert(`ERROR: ${e}`)})}}else this.userSettings.showErrorMessages&&alert("SERVER (required): See README for instructions")}get stored(){return this.resource.stored}}const U=squared.lib.constant,q=squared.lib.css,z=squared.lib.dom,V=squared.lib.session,$=squared.lib.util,j=["position","display","verticalAlign","float","clear","zIndex"],Y=Array.from(E.keys()),K=/\s*(url\(.+?\))\s*/;class Z extends squared.lib.base.Container{constructor(e,t="0",i){super(),this.id=e,this.sessionId=t,this.alignmentType=0,this.depth=-1,this.siblingIndex=1/0,this.documentRoot=!1,this.visible=!0,this.excluded=!1,this.rendered=!1,this.baselineActive=!1,this.baselineAltered=!1,this.lineBreakLeading=!1,this.lineBreakTrailing=!1,this.positioned=!1,this.controlId="",this._initial={iteration:-1,children:[],styleMap:{}},this._data={},this._excludeSection=0,this._excludeProcedure=0,this._excludeResource=0,this._inlineText=!1,this._element=null,i?(this._element=i,this.init()):(this._styleMap={},this.style={})}cloneBase(e){Object.assign(e.localSettings,this.localSettings),e.tagName=this.tagName,e.alignmentType=this.alignmentType,e.depth=this.depth,e.visible=this.visible,e.excluded=this.excluded,e.rendered=this.rendered,e.siblingIndex=this.siblingIndex,this.inlineText&&e.setInlineText(!0,!0),e.lineBreakLeading=this.lineBreakLeading,e.lineBreakTrailing=this.lineBreakTrailing,e.renderParent=this.renderParent,e.documentParent=this.documentParent,e.documentRoot=this.documentRoot,this.length&&e.retain(this.duplicate()),e.inherit(this,"initial","base","alignment","styleMap","textStyle"),Object.assign(e.unsafe("cached"),this._cached)}init(){const e=this._element;if(e&&("0"!==this.sessionId&&V.setElementCache(e,"node",this.sessionId,this),this.style=V.getElementCache(e,"style","0")||q.getStyle(e,void 0,!1),this._styleMap=Object.assign({},V.getElementCache(e,"styleMap",this.sessionId)),q.hasComputedStyle(e)&&!this.pseudoElement&&"0"!==this.sessionId)){const t=parseFloat(this.style.getPropertyValue("font-size"));for(let i of Array.from(e.style)){let s=e.style.getPropertyValue(i);i=$.convertCamelCase(i),(s=q.checkStyleValue(e,i,s,this.style,1e3,t))&&(this._styleMap[i]=s)}}}saveAsInitial(e=!1){(-1===this._initial.iteration||e)&&(this._initial.children=this.duplicate(),this._initial.styleMap=Object.assign({},this._styleMap)),this._bounds&&(this._initial.bounds=z.assignRect(this._bounds),this._initial.linear=z.assignRect(this.linear),this._initial.box=z.assignRect(this.box)),this._initial.iteration++}is(e){return this.containerType===e}of(e,...t){return this.containerType===e&&t.some(e=>this.hasAlign(e))}unsafe(e,t=!1){if(!t)return this[`_${e}`];delete this[`_${e}`]}attr(e,t,i,s=!0){let n=this[`__${e}`];return i?(void 0===n&&(this._namespaces.includes(e)||this._namespaces.push(e),this[`__${e}`]=n={}),!s&&n[t]?"":(n[t]=""+i,n[t])):n&&n[t]||""}namespace(e){return this[`__${e}`]||{}}delete(e,...t){const i=this[`__${e}`];if(i)for(const e of t)if(-1!==e.indexOf("*"))for(const[t]of $.searchObject(i,e))delete i[t];else delete i[e]}apply(e){for(const t in e){const i=e[t];if("object"==typeof i){for(const e in i)this.attr(t,e,i[e]);delete e[t]}}}render(e){this.renderParent=e,this.rendered=!0}renderEach(e){for(let t=0;t<this.renderChildren.length;t++)this.renderChildren[t].visible&&e(this.renderChildren[t],t,this.renderChildren);return this}renderFilter(e){return $.filterArray(this.renderChildren,e)}hide(e){this.rendered=!0,this.visible=!1}data(e,t,i,s=!0){return $.hasValue(i)?("object"!=typeof this._data[e]&&(this._data[e]={}),(s||void 0===this._data[e][t])&&(this._data[e][t]=i)):null===i&&delete this._data[e],void 0===this._data[e]||void 0===this._data[e][t]?void 0:this._data[e][t]}unsetCache(...e){if(e.length)for(const t of e){switch(t){case"position":return void(this._cached={});case"width":this._cached.actualWidth=void 0;case"minWidth":this._cached.width=void 0;break;case"height":this._cached.actualHeight=void 0;case"minHeight":this._cached.height=void 0;break;case"verticalAlign":this._cached.baseline=void 0;break;case"display":this._cached.inline=void 0,this._cached.inlineVertical=void 0,this._cached.inlineFlow=void 0,this._cached.block=void 0,this._cached.blockDimension=void 0,this._cached.blockStatic=void 0,this._cached.autoMargin=void 0;break;case"backgroundColor":case"backgroundImage":this._cached.visibleStyle=void 0;break;case"pageFlow":this._cached.positionAuto=void 0,this._cached.blockStatic=void 0,this._cached.baseline=void 0,this._cached.floating=void 0,this._cached.autoMargin=void 0,this._cached.rightAligned=void 0,this._cached.bottomAligned=void 0;break;case"float":this._cached.floating=void 0;break;default:t.startsWith("margin")&&(this._cached.autoMargin=void 0),(t.startsWith("padding")||t.startsWith("border"))&&(this._cached.contentBoxWidth=void 0,this._cached.contentBoxHeight=void 0)}this._cached[t]=void 0}else this._cached={}}ascend(e=!1,t,i){const s=[],n=e?this.renderParent?"renderParent":"parent":"actualParent";let o=this[n];for(;o&&0!==o.id&&o!==i;){if(t){if(t(o))return[o]}else s.push(o);o=o[n]}return s}ascendOuter(e,t){const i=[];let s=this.outerWrapper;for(;s&&s!==t;){if(e){if(e(s))return[s]}else i.push(s);s=s.outerWrapper}return i}inherit(e,...t){const i=e.unsafe("initial");for(const s of t)switch(s){case"initial":$.cloneObject(i,this._initial);break;case"base":this._documentParent=e.documentParent,this._bounds=z.assignRect(e.bounds),this._linear=z.assignRect(e.linear),this._box=z.assignRect(e.box),e.actualParent&&(this.dir=e.actualParent.dir);break;case"alignment":this.positionAuto=e.positionAuto;for(const t of j)this._styleMap[t]=e.css(t),this._initial.styleMap[t]=i.styleMap[t];if(!this.positionStatic)for(const t of q.BOX_POSITION)e.has(t)&&(this._styleMap[t]=e.css(t)),this._initial.styleMap[t]=i.styleMap[t];if(e.autoMargin.horizontal||e.autoMargin.vertical)for(const t of q.BOX_MARGIN)e.cssInitial(t)===U.CSS.AUTO&&(this._styleMap[t]=U.CSS.AUTO,this._initial.styleMap[t]=U.CSS.AUTO);break;case"styleMap":$.assignEmptyProperty(this._styleMap,e.unsafe("styleMap"));break;case"textStyle":this.cssApply({fontFamily:e.css("fontFamily"),fontSize:e.css("fontSize"),fontWeight:e.css("fontWeight"),fontStyle:e.css("fontStyle"),color:e.css("color"),whiteSpace:e.css("whiteSpace"),textDecoration:e.css("textDecoration"),textTransform:e.css("textTransform"),wordSpacing:e.css("wordSpacing"),opacity:e.css("opacity")})}}alignedVertically(e,t,i,s){if(this.lineBreak)return 2;if(this.pageFlow||this.positionAuto){const n=e=>$.aboveRange(this.linear.top,e.linear.bottom)&&(this.blockVertical||this.float!==e.float||e.blockVertical||this.has(U.CSS.WIDTH,32));if($.isArray(t)){if(i&&i.has(this))return 5;{const e=t[t.length-1];if(this.floating&&e.floating){if($.aboveRange(this.linear.top,e.linear.bottom))return 4;if(this.float===e.float)return 0}else{if(this.floating&&!1===s&&e.blockStatic)return 0;if(void 0!==s)if(this.display.startsWith("inline-")){if(e.floating)return s?6:0}else{const{top:e,bottom:n}=this.linear;if(this.textElement&&i&&i.size&&t.some((e,t)=>t>0&&i.has(e))&&t.some(t=>e<t.linear.top&&n>t.linear.bottom))return 7;if(s){if(t.length>1&&t[0].float===U.CSS.RIGHT){let i,s=1/0,o=-1/0;for(const e of t)e.float===U.CSS.RIGHT&&(e.linear.top<s&&(s=e.linear.top),e.linear.bottom>o&&(o=e.linear.bottom));if(this.multiline){if(i=n,this.textElement&&!this.plainText){const e=V.getRangeClientRect(this._element,this.sessionId);e.bottom>n&&(i=e.bottom)}}else i=e;return $.belowRange(i,o)?0:6}}else if($.sameArray(t,(e,t)=>e.floating?e.float:t))return 6}}if(this.blockDimension&&n(e))return 3}}if(this.blockDimension&&this.css(U.CSS.WIDTH)===U.CSS.PERCENT_100&&!this.has("maxWidth"))return 1;const o=this.actualParent||this.documentParent,a=this.blockStatic||"table"===this.display;for(const s of e){if(s.lineBreak)return 2;if(i&&"both"===i.get(s)&&(!$.isArray(t)||t[0]!==s))return 5;if(a&&(!s.floating||!s.rightAligned&&$.withinRange(s.linear.right,o.box.right)||i&&i.has(s))||s.blockStatic||s.autoMargin.leftRight||s.float===U.CSS.LEFT&&this.autoMargin.right||s.float===U.CSS.RIGHT&&this.autoMargin.left)return 1;if(this.blockDimension&&n(s))return 3}}return 0}intersectX(e,t="linear"){const i=this[t];return $.aboveRange(e.left,i.left)&&Math.ceil(e.left)<i.right||e.right>Math.ceil(i.left)&&$.belowRange(e.right,i.right)||$.aboveRange(i.left,e.left)&&$.belowRange(i.right,e.right)||$.aboveRange(e.left,i.left)&&$.belowRange(e.right,i.right)}intersectY(e,t="linear"){const i=this[t];return $.aboveRange(e.top,i.top)&&Math.ceil(e.top)<i.bottom||e.bottom>Math.ceil(i.top)&&$.belowRange(e.bottom,i.bottom)||$.aboveRange(i.top,e.top)&&$.belowRange(i.bottom,e.bottom)||$.aboveRange(e.top,i.top)&&$.belowRange(e.bottom,i.bottom)}withinX(e,t="linear"){const i=this[t];return $.aboveRange(i.left,e.left)&&$.belowRange(i.right,e.right)}withinY(e,t="linear"){const i=this[t];return $.aboveRange(i.top,e.top)&&$.belowRange(i.bottom,e.bottom)}outsideX(e,t="linear"){const i=this[t];return i.left<Math.floor(e.left)||Math.floor(i.right)>e.right}outsideY(e,t="linear"){const i=this[t];return i.top<Math.floor(e.top)||Math.floor(i.bottom)>e.bottom}css(e,t,i=!1){return arguments.length>=2&&(t?this._styleMap[e]=t:delete this._styleMap[e],i&&this.unsetCache(e)),this._styleMap[e]||this.style[e]||""}cssApply(e,t=!1){if(Object.assign(this._styleMap,e),t)for(const t in e)this.unsetCache(t);return this}cssInitial(e,t=!1,i=!1){-1!==this._initial.iteration||t||(i=!0);let s=t?this._styleMap[e]:this._initial.styleMap[e];return i&&!s&&(s=this.style[e]),s||""}cssAny(e,...t){for(const i of t)if(this.css(e)===i)return!0;return!1}cssInitialAny(e,...t){for(const i of t)if(this.cssInitial(e)===i)return!0;return!1}cssAscend(e,t=!1,i=!1){let s="",n=t?this:this.actualParent;for(;n;){if(""!==(s=n.cssInitial(e))){if(!i||n.visible)break;s=""}if(n.documentBody)break;n=n.actualParent}return s}cssSort(e,t=!0,i=!1){const s=i?this.duplicate():this.children;return s.sort((i,s)=>{const n=i.toFloat(e),o=s.toFloat(e);return n===o?0:t?n<o?-1:1:n>o?-1:1}),s}cssPX(e,t,i=!1,s=!1){const n=this._styleMap[e];if(n&&q.isLength(n)){t+=q.parseUnit(n,this.fontSize),!i&&t<0&&(t=0);const o=q.formatPX(t);return this.css(e,o),s&&this.unsetCache(e),o}return""}cssSpecificity(e){if(this.styleElement){const t=this._element,i=this.pseudoElement?V.getElementCache(t,"pseudoType",this.sessionId):"",s=V.getElementCache(t,`styleSpecificity${i?"::"+i:""}`,this.sessionId);if(s)return s[e]||0}return 0}cssTry(e,t){if(this.styleElement){const i=this._element;let s=this.css(e);if(t===s&&(s=i.style[e]),i.style[e]=t,i.style[e]===t)return V.setElementCache(i,e,this.sessionId,s),!0}return!1}cssFinally(e){if(this.styleElement){const t=this._element,i=V.getElementCache(t,e,this.sessionId);if(i)return t.style[e]=i,V.deleteElementCache(t,e,this.sessionId),!0}return!1}toInt(e,t=!1,i=0){const s=parseInt((t?this._initial.styleMap:this._styleMap)[e]);return isNaN(s)?i:s}toFloat(e,t=!1,i=0){const s=parseFloat((t?this._initial.styleMap:this._styleMap)[e]);return isNaN(s)?i:s}parseUnit(e,t=U.CSS.WIDTH,i=!0){if(e){if(q.isPercent(e)){let s=parseFloat(e)/100;if(i){const e=this.absoluteParent;if(e)return s*=e.has(t,2)?e.toFloat(t):e.box[t]}return s*(this.has(t,2)?this.toFloat(t):this.bounds[t])}return q.parseUnit(e,this.fontSize)}return 0}convertPX(e,t=U.CSS.WIDTH,i=!0){return e.endsWith("px")?e:`${Math.round(this.parseUnit(e,t,i))}px`}has(e,t=0,i){const s=(i&&"initial"===i.map?this._initial.styleMap:this._styleMap)[e];if(s)switch(s){case U.CSS.PX_0:if($.hasBit(t,64))return!0;switch(e){case U.CSS.TOP:case U.CSS.RIGHT:case U.CSS.BOTTOM:case U.CSS.LEFT:return!0}case U.CSS.LEFT:if($.hasBit(t,8))return!0;case"baseline":if($.hasBit(t,16))return!0;case"auto":if($.hasBit(t,4))return!0;case"none":case"initial":case"unset":case"normal":case"transparent":case"rgba(0, 0, 0, 0)":return!1;default:if(i){if(i.not){if(s===i.not)return!1;if(Array.isArray(i.not))for(const e of i.not)if(s===e)return!1}if(i.all)return!0}if(t>0){if($.hasBit(t,2)&&q.isLength(s))return!0;if($.hasBit(t,32)&&q.isPercent(s))return!0}return 0===t}return!1}hasAlign(e){return $.hasBit(this.alignmentType,e)}hasResource(e){return!$.hasBit(this.excludeResource,e)}hasProcedure(e){return!$.hasBit(this.excludeProcedure,e)}hasSection(e){return!$.hasBit(this.excludeSection,e)}exclude(e=0,t=0,i=0){e>0&&!$.hasBit(this._excludeResource,e)&&(this._excludeResource|=e),t>0&&!$.hasBit(this._excludeProcedure,t)&&(this._excludeProcedure|=t),i>0&&!$.hasBit(this._excludeSection,i)&&(this._excludeSection|=i)}setExclusions(){if(this.styleElement){const e=this.actualParent,t=(t,i)=>{let s=this.dataset[`exclude${t}`]||"",n=0;if(e&&e.dataset[`exclude${t}Child`]&&(s+=(""!==s?"|":"")+e.dataset[`exclude${t}Child`]),""!==s)for(let e of s.split("|"))i[e=e.trim().toUpperCase()]&&!$.hasBit(n,i[e])&&(n|=i[e]);return n};this.exclude(t("Resource",l),t("Procedure",c),t("Section",r))}}setBounds(e=!0){if(this.styleElement)this._bounds=z.assignRect(V.getClientRect(this._element,this.sessionId,e),!0),this.documentBody&&0===this.marginTop&&(this._bounds.top=0);else if(this.plainText){const t=V.getRangeClientRect(this._element,this.sessionId,e);this._bounds=z.assignRect(t,!0),this._cached.multiline=t.numberOfLines>0}e||(this._linear=void 0,this._box=void 0)}setInlineText(e,t=!1){if(t)this._inlineText=e;else if(this.htmlElement){switch(this._element.tagName){case"INPUT":case"IMG":case"SELECT":case"TEXTAREA":case"HR":case"SVG":break;case"BUTTON":this._inlineText=!0;break;default:this._inlineText=e}}}appendTry(e,t,i=!0){let s=!1;for(let i=0;i<this.length;i++)if(this.item(i)===e){this.item(i,t),t.parent=this,t.innerWrapped=e,s=!0;break}return i&&(t.parent=this,s=!0),s}modifyBox(e,t,i=!0){if(0!==t){const s=E.get(e);s&&(void 0===t?this._boxReset[s]=1:i?this._boxAdjustment[s]+=t:this[s]+this._boxAdjustment[s]+t<=0?(this._boxReset[s]=1,this._boxAdjustment[s]=0):this._boxAdjustment[s]+=t)}}getBox(e){const t=E.get(e);return t?[this._boxReset[t],this._boxAdjustment[t]]:[0,0]}resetBox(e,t,i=!1){const s=(e,s)=>{for(let n=0;n<e.length;n++)if(1!==this._boxReset[e[n]]){this._boxReset[e[n]]=1;const o=E.get(Y[n+s]),a=this[o];t&&0!==a&&(t.naturalElement||0!==t[o]?t.modifyBox(Y[n+(i?0:4)],a):t.css(o,q.formatPX(a),!0))}};$.hasBit(e,30)&&s(q.BOX_MARGIN,0),$.hasBit(e,480)&&s(q.BOX_PADDING,4)}transferBox(e,t){const i=(e,i)=>{for(let s=0;s<e.length;s++){const n=this._boxAdjustment[e[s]];n>0&&(t.modifyBox(Y[s+i],n,!1),this._boxAdjustment[e[s]]=0)}};$.hasBit(e,30)&&i(q.BOX_MARGIN,0),$.hasBit(e,480)&&i(q.BOX_PADDING,4)}previousSiblings(e={}){const t=e.floating,i=e.pageFlow,s=e.lineBreak,n=e.excluded,o=[];let a=null;if(this._element)if(this.naturalElement)a=this._element.previousSibling;else{let e=this.innerWrapped;for(;e;){if(e.naturalElement){a=e.element.previousSibling;break}e=e.innerWrapped}}else{const e=this.firstChild;e&&(a=e.element.previousSibling)}for(;a;){const e=V.getElementAsNode(a,this.sessionId);if(e)if(!1!==s&&e.lineBreak||!1!==n&&e.excluded)o.push(e);else if(!e.excluded&&e.pageFlow){if(!1===i)break;if(o.push(e),!1!==t||!e.floating&&(e.visible||e.rendered))break}a=a.previousSibling}return o}nextSiblings(e={}){const t=e.floating,i=e.pageFlow,s=e.lineBreak,n=e.excluded,o=[];let a=null;if(this._element)if(this.naturalElement)a=this._element.nextSibling;else{let e=this.innerWrapped;for(;e;){if(e.naturalElement){a=e.element.nextSibling;break}e=e.innerWrapped}}else{const e=this.lastChild;e&&(a=e.element.nextSibling)}for(;a;){const e=V.getElementAsNode(a,this.sessionId);if(e)if(!1!==s&&e.lineBreak||!1!==n&&e.excluded)o.push(e);else if(!e.excluded&&e.pageFlow){if(!1===i)break;if(o.push(e),!1!==t||!e.floating&&(e.visible||e.rendered))break}a=a.nextSibling}return o}getFirstChildElement(e={}){const t=e.lineBreak,i=e.excluded;if(this.htmlElement)for(const e of this.actualChildren)if(!e.pseudoElement&&(!e.excluded||!1!==t&&e.lineBreak||!1!==i&&e.excluded))return e.element;return null}getLastChildElement(e={}){const t=e.lineBreak,i=e.excluded;if(this.htmlElement){const e=this.actualChildren;for(let s=e.length-1;s>=0;s--){const n=e[s];if(!n.pseudoElement&&(!n.excluded||!1!==t&&n.lineBreak||!1!==i&&n.excluded))return n.element}}return null}actualRect(e,t="linear"){let i;switch(e){case U.CSS.TOP:case U.CSS.LEFT:i=this.companion&&!this.companion.visible&&this.companion[t][e]<this[t][e]?this.companion:this;break;case U.CSS.RIGHT:case U.CSS.BOTTOM:i=this.companion&&!this.companion.visible&&this.companion[t][e]>this[t][e]?this.companion:this;break;default:return NaN}return i[t][e]}setDimension(e){const t=this.parseUnit(this._styleMap[e],e);let i=Math.max(t,this.parseUnit(this._styleMap[`min${$.capitalize(e)}`],e));if(0===i&&this.naturalElement&&this.styleElement)switch(this.tagName){case"IMG":case"INPUT_IMAGE":case"TD":case"TH":case"SVG":case"IFRAME":case"VIDEO":case"CANVAS":case"OBJECT":case"EMBED":const t=z.getNamedItem(this._element,e);""!==t&&(i=this.parseUnit(t,e))>0&&this.css(e,q.isPercent(t)?t:q.formatPX(t))}let s=0;if(t>0&&!this.imageElement){const i=`max${$.capitalize(e)}`;(s=this.parseUnit(this._styleMap[i],e))>0&&s<=t&&q.isLength(this._styleMap[e])&&(s=0,this._styleMap[e]=this._styleMap[i],delete this._styleMap[i])}return s>0?Math.min(i,s):i}setBoxModel(e){const t=this.unsafe(e);if(t){if(t.width=this.bounds.width,this.plainText)t.height=t.bottom-t.top;else switch(t.height=this.bounds.height,e){case"box":t.width-=this.contentBoxWidth,t.height-=this.contentBoxHeight;break;case"linear":t.width+=(this.marginLeft>0?this.marginLeft:0)+this.marginRight,t.height+=(this.marginTop>0?this.marginTop:0)+this.marginBottom}void 0===this._initial[e]&&(this._initial[e]=z.assignRect(t))}}convertPosition(e){let t=0;if(!this.positionStatic){const i=this.cssInitial(e,!0);(q.isLength(i)||q.isPercent(i))&&(t=$.convertFloat(this.convertLength(e,i,e===U.CSS.LEFT||e===U.CSS.RIGHT?U.CSS.WIDTH:U.CSS.HEIGHT)))}return t}convertBorderWidth(e){if(this.styleElement){if(this.css(v[e][0])!==U.CSS.NONE)return Math.round($.convertFloat(this.css(v[e][1])))}return 0}convertBox(e,t,i){switch(this.display){case"table":if(!i&&"collapse"===this.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if(i)return 0}const s=$.convertFloat(this.convertLength(e,this.css(e),t));if(!i){let t=this.toFloat("paddingInlineStart"),i=this.toFloat("paddingInlineEnd");if(t>0||i>0)return"vertical-rl"===this.css("writingMode")?"ltr"===this.dir?("paddingTop"!==e&&(t=0),"paddingBottom"!==e&&(i=0)):("paddingBottom"!==e&&(t=0),"paddingTop"!==e&&(i=0)):"ltr"===this.dir?("paddingLeft"!==e&&(t=0),"paddingRight"!==e&&(i=0)):("paddingRight"!==e&&(t=0),"paddingLeft"!==e&&(i=0)),t+s+i}return s}convertLength(e,t,i,s=!0){return q.isPercent(t)?q.isLength(this.style[e])?this.style[e]:this.convertPX(t,i,s):t}set parent(e){e&&(e!==this._parent&&(this._parent&&this._parent.remove(this),this._parent=e),e.contains(this)||e.append(this),-1===this.depth&&(this.depth=e.depth+1))}get parent(){return this._parent}set tagName(e){this._cached.tagName=e.toUpperCase()}get tagName(){if(void 0===this._cached.tagName){const e=this._element;let t="";e&&(t="#text"===e.nodeName?"PLAINTEXT":"INPUT"===e.tagName?`INPUT_${e.type}`:e.tagName),this._cached.tagName=t.toUpperCase()}return this._cached.tagName}get element(){if(!this.naturalElement&&this.innerWrapped){const e=this.innerWrapped.unsafe("element");if(e)return e}return this._element}get elementId(){return this._element?this._element.id:""}get htmlElement(){return void 0===this._cached.htmlElement&&(this._cached.htmlElement=null!==this._element&&!this.plainText&&!this.svgElement),this._cached.htmlElement}get svgElement(){return null!==this._element&&"svg"===this._element.tagName}get styleElement(){return this.htmlElement||this.svgElement}get naturalElement(){return null!==this._element&&"__squared.placeholder"!==this._element.className}get pseudoElement(){return null!==this._element&&"__squared.pseudo"===this._element.className}get imageElement(){return"IMG"===this.tagName}get flexElement(){return"flex"===this.display||"inline-flex"===this.display}get gridElement(){return"grid"===this.display||"inline-grid"===this.display}get textElement(){return this.plainText||this.inlineText&&!this.inputElement}get tableElement(){return"TABLE"===this.tagName||"table"===this.display}get inputElement(){if(void 0===this._cached.inputElement){const e=this.tagName;this._cached.inputElement=null!==this._element&&"INPUT"===this._element.tagName||"BUTTON"===e||"SELECT"===e||"TEXTAREA"===e}return this._cached.inputElement}get layoutElement(){return this.flexElement||this.gridElement}get groupParent(){return!1}get plainText(){return"PLAINTEXT"===this.tagName}get lineBreak(){return"BR"===this.tagName}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||z.newBoxRectDimension()}get linear(){if(void 0===this._linear&&this._bounds){if(this._element){const e=this._bounds;this._linear={top:e.top-(this.marginTop>0?this.marginTop:0),right:e.right+this.marginRight,bottom:e.bottom+this.marginBottom,left:e.left-(this.marginLeft>0?this.marginLeft:0),width:0,height:0}}else this._linear=z.assignRect(this._bounds);this.setBoxModel("linear")}return this._linear||z.newBoxRectDimension()}get box(){if(void 0===this._box&&this._bounds){if(this._element){const e=this._bounds;this._box={top:e.top+(this.paddingTop+this.borderTopWidth),right:e.right-(this.paddingRight+this.borderRightWidth),bottom:e.bottom-(this.paddingBottom+this.borderBottomWidth),left:e.left+(this.paddingLeft+this.borderLeftWidth),width:0,height:0}}else this._box=z.assignRect(this._bounds);this.setBoxModel("box")}return this._box||z.newBoxRectDimension()}set renderAs(e){this.rendered||!e||e.rendered||(this._renderAs=e)}get renderAs(){return this._renderAs}get dataset(){return this.htmlElement?this._element.dataset:{}}get excludeSection(){return this._excludeSection}get excludeProcedure(){return this._excludeProcedure}get excludeResource(){return this._excludeResource}get extensions(){return void 0===this._cached.extensions&&(this._cached.extensions=this.dataset.use?$.spliceArray(this.dataset.use.split(/\s*,\s*/),e=>""===e):[]),this._cached.extensions}set flexbox(e){this._cached.flexbox=e}get flexbox(){if(void 0===this._cached.flexbox){const e=this.actualParent,t=this.css("alignSelf"),i=this.css("justifySelf"),s=(t,i,n)=>{const o=(n||this).css(t);return $.isNumber(o)?parseFloat(o):"inherit"===o&&e&&void 0===n?s(t,i,e):i};this._cached.flexbox={alignSelf:t===U.CSS.AUTO&&e&&e.has("alignItems",16,{all:!0})?e.css("alignItems"):t,justifySelf:i===U.CSS.AUTO&&e&&e.has("justifyItems")?e.css("justifyItems"):i,basis:this.css("flexBasis"),grow:s("flexGrow",0),shrink:s("flexShrink",1),order:this.toInt("order")}}return this._cached.flexbox}get width(){return void 0===this._cached.width&&(this._cached.width=this.setDimension(U.CSS.WIDTH)),this._cached.width}get height(){return void 0===this._cached.height&&(this._cached.height=this.setDimension(U.CSS.HEIGHT)),this._cached.height}get hasWidth(){return this.width>0}get hasHeight(){const e=this.css(U.CSS.HEIGHT);if(q.isPercent(e)){if(this.pageFlow){const t=this.actualParent;if(t&&t.hasHeight)return parseFloat(e)>0}return!1}return this.height>0}get lineHeight(){if(void 0===this._cached.lineHeight)if(this.imageElement||this.svgElement)this._cached.lineHeight=0;else{let e=this.has("lineHeight"),t=0;if(e)t=this.toFloat("lineHeight");else if(this.naturalElement&&(t=$.convertFloat(this.cssAscend("lineHeight",!0)),!this.plainText)){const i=V.getElementCache(this.styleElement?this._element:this.documentParent.element,"fontSize",""+this.cssSpecificity("fontSize"));if(i&&i.endsWith("em")){const s=parseFloat(i);s<1&&(this.css("lineHeight",q.formatPX(t*=s)),e=!0)}}this._cached.lineHeight=e||t>this.actualHeight||this.multiline||this.block&&this.actualChildren.some(e=>e.textElement)?t:0}return this._cached.lineHeight}get display(){return this.css("display")}set positionStatic(e){this._cached.positionStatic=e,this.unsetCache("pageFlow")}get positionStatic(){if(void 0===this._cached.positionStatic)switch(this.css("position")){case"fixed":case"absolute":this._cached.positionStatic=!1;break;case"sticky":case"relative":this._cached.positionStatic=!(this.has(U.CSS.TOP)||this.has(U.CSS.RIGHT)||this.has(U.CSS.BOTTOM)||this.has(U.CSS.LEFT)),this._cached.positionStatic&&(this._cached.positionRelative=!1);break;case"inherit":const e=this._element?q.getInheritedStyle(this._element.parentElement,"position"):"";this._cached.positionStatic=""!==e&&!("absolute"===e||"fixed"===e);break;default:this._cached.positionStatic=!0}return this._cached.positionStatic}get positionRelative(){if(void 0===this._cached.positionRelative){const e=this.css("position");this._cached.positionRelative="relative"===e||"sticky"===e}return this._cached.positionRelative}set positionAuto(e){this._cached.positionAuto=e}get positionAuto(){if(void 0===this._cached.positionAuto){const e=-1===this._initial.iteration?this._styleMap:this._initial.styleMap;this._cached.positionAuto=!(this.pageFlow||e.top&&e.top!==U.CSS.AUTO||e.right&&e.right!==U.CSS.AUTO||e.bottom&&e.bottom!==U.CSS.AUTO||e.left&&e.left!==U.CSS.AUTO)}return this._cached.positionAuto}get top(){return void 0===this._cached.top&&(this._cached.top=this.convertPosition(U.CSS.TOP)),this._cached.top}get right(){return void 0===this._cached.right&&(this._cached.right=this.convertPosition(U.CSS.RIGHT)),this._cached.right}get bottom(){return void 0===this._cached.bottom&&(this._cached.bottom=this.convertPosition(U.CSS.BOTTOM)),this._cached.bottom}get left(){return void 0===this._cached.left&&(this._cached.left=this.convertPosition(U.CSS.LEFT)),this._cached.left}get marginTop(){return void 0===this._cached.marginTop&&(this._cached.marginTop=this.inlineStatic?0:this.convertBox("marginTop",U.CSS.HEIGHT,!0)),this._cached.marginTop}get marginRight(){return void 0===this._cached.marginRight&&(this._cached.marginRight=this.convertBox("marginRight",U.CSS.WIDTH,!0)),this._cached.marginRight}get marginBottom(){if(void 0===this._cached.marginBottom)if(this.inlineStatic)this._cached.marginBottom=0;else{const e=this.convertBox("marginBottom",U.CSS.HEIGHT,!0);this._cached.marginBottom=0===this.bounds.height&&!this.overflowY&&e>0?0:e}return this._cached.marginBottom}get marginLeft(){return void 0===this._cached.marginLeft&&(this._cached.marginLeft=this.convertBox("marginLeft",U.CSS.WIDTH,!0)),this._cached.marginLeft}get borderTopWidth(){return void 0===this._cached.borderTopWidth&&(this._cached.borderTopWidth=this.convertBorderWidth(0)),this._cached.borderTopWidth}get borderRightWidth(){return void 0===this._cached.borderRightWidth&&(this._cached.borderRightWidth=this.convertBorderWidth(1)),this._cached.borderRightWidth}get borderBottomWidth(){return void 0===this._cached.borderBottomWidth&&(this._cached.borderBottomWidth=this.convertBorderWidth(2)),this._cached.borderBottomWidth}get borderLeftWidth(){return void 0===this._cached.borderLeftWidth&&(this._cached.borderLeftWidth=this.convertBorderWidth(3)),this._cached.borderLeftWidth}get paddingTop(){if(void 0===this._cached.paddingTop){const e=this.convertBox("paddingTop",U.CSS.HEIGHT,!1);if(this.length&&e>0&&!this.layoutElement){let t=0;for(const e of this.children){if(!e.inline||e.has("lineHeight")){t=0;break}t=Math.max(t,e.paddingTop)}this._cached.paddingTop=Math.max(0,e-t)}else this._cached.paddingTop=this.inlineStatic&&!this.visibleStyle.background?0:e}return this._cached.paddingTop}get paddingRight(){return void 0===this._cached.paddingRight&&(this._cached.paddingRight=this.convertBox("paddingRight",U.CSS.WIDTH,!1)),this._cached.paddingRight}get paddingBottom(){if(void 0===this._cached.paddingBottom){const e=this.convertBox("paddingBottom",U.CSS.HEIGHT,!1);if(this.length&&e>0&&!this.layoutElement){let t=0;for(const e of this.children){if(!e.inline||e.has("lineHeight")){t=0;break}t=Math.max(t,e.paddingBottom)}this._cached.paddingBottom=Math.max(0,e-t)}else this._cached.paddingBottom=this.inlineStatic&&!this.visibleStyle.background?0:e}return this._cached.paddingBottom}get paddingLeft(){return void 0===this._cached.paddingLeft&&(this._cached.paddingLeft=this.convertBox("paddingLeft",U.CSS.WIDTH,!1)),this._cached.paddingLeft}get contentBox(){return"border-box"!==this.css("boxSizing")}set contentBoxWidth(e){this._cached.contentBoxWidth=e}get contentBoxWidth(){return void 0===this._cached.contentBoxWidth&&(this._cached.contentBoxWidth=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth),this._cached.contentBoxWidth}set contentBoxHeight(e){this._cached.contentBoxHeight=e}get contentBoxHeight(){return void 0===this._cached.contentBoxHeight&&(this._cached.contentBoxHeight=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth),this._cached.contentBoxHeight}get inline(){if(void 0===this._cached.inline){const e=this.display;this._cached.inline="inline"===e||("initial"===e||"unset"===e)&&!z.ELEMENT_BLOCK.includes(this.tagName)}return this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement),this._cached.inlineStatic}get inlineVertical(){if(void 0===this._cached.inlineVertical){const e=this.display;this._cached.inlineVertical=(e.startsWith("inline")||"table-cell"===e)&&!this.floating&&!this.plainText}return this._cached.inlineVertical}get inlineText(){return this._inlineText}get block(){if(void 0===this._cached.block){switch(this.display){case"inline":this._cached.block=this.svgElement&&!this.hasWidth;break;case"block":case"flex":case"grid":case"list-item":this._cached.block=!0;break;case"initial":this._cached.block=z.ELEMENT_BLOCK.includes(this.tagName);break;default:this._cached.block=!1}}return this._cached.block}get blockStatic(){return void 0===this._cached.blockStatic&&(this._cached.blockStatic=this.pageFlow&&this.block&&(!this.floating||this.cssInitial(U.CSS.WIDTH)===U.CSS.PERCENT_100&&!this.has("maxWidth"))||this.hasAlign(64)),this._cached.blockStatic}get blockDimension(){if(void 0===this._cached.blockDimension){const e=this.display;this._cached.blockDimension=this.block||e.startsWith("inline-")||"table"===e||this.imageElement||this.svgElement}return this._cached.blockDimension}get blockVertical(){return void 0===this._cached.blockVertical&&(this._cached.blockVertical=this.blockDimension&&this.has(U.CSS.HEIGHT)),this._cached.blockVertical}get pageFlow(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=this.positionStatic||this.positionRelative),this._cached.pageFlow}get inlineFlow(){if(void 0===this._cached.inlineFlow){const e=this.display;this._cached.inlineFlow=this.inline||e.startsWith("inline")||"table-cell"===e||this.imageElement||this.floating}return this._cached.inlineFlow}get centerAligned(){return void 0===this._cached.centerAligned&&(this._cached.centerAligned=this.autoMargin.leftRight||this.textElement&&this.blockStatic&&this.cssInitial("textAlign")===U.CSS.CENTER||this.inlineStatic&&this.cssAscend("textAlign",!0)===U.CSS.CENTER),this._cached.centerAligned}get rightAligned(){return void 0===this._cached.rightAligned&&(this._cached.rightAligned=this.float===U.CSS.RIGHT||this.autoMargin.left||!this.pageFlow&&this.has(U.CSS.RIGHT)||this.textElement&&this.blockStatic&&this.cssInitial("textAlign")===U.CSS.RIGHT),this._cached.rightAligned||this.hasAlign(1024)}get bottomAligned(){return void 0===this._cached.bottomAligned&&(this._cached.bottomAligned=!this.pageFlow&&this.has(U.CSS.BOTTOM)&&this.bottom>=0),this._cached.bottomAligned}get horizontalAligned(){return void 0===this._cached.horizontalAligned&&(this._cached.horizontalAligned=!(this.blockStatic||this.autoMargin.horizontal||this.blockDimension&&this.css(U.CSS.WIDTH)===U.CSS.PERCENT_100)),this._cached.horizontalAligned}get autoMargin(){if(void 0===this._cached.autoMargin)if(!this.pageFlow||this.blockStatic||"table"===this.display){const e=-1===this._initial.iteration?this._styleMap:this._initial.styleMap,t=e.marginLeft===U.CSS.AUTO&&(this.pageFlow||this.has(U.CSS.RIGHT)),i=e.marginRight===U.CSS.AUTO&&(this.pageFlow||this.has(U.CSS.LEFT)),s=e.marginTop===U.CSS.AUTO&&(this.pageFlow||this.has(U.CSS.BOTTOM)),n=e.marginBottom===U.CSS.AUTO&&(this.pageFlow||this.has(U.CSS.TOP));this._cached.autoMargin={horizontal:t||i,left:t&&!i,right:!t&&i,leftRight:t&&i,vertical:s||n,top:s&&!n,bottom:!s&&n,topBottom:s&&n}}else this._cached.autoMargin={horizontal:!1,left:!1,right:!1,leftRight:!1,top:!1,bottom:!1,vertical:!1,topBottom:!1};return this._cached.autoMargin}get floating(){return void 0===this._cached.floating&&(this._cached.floating=!!this.pageFlow&&this.cssAny("float",U.CSS.LEFT,U.CSS.RIGHT)),this._cached.floating}get float(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.css("float"):U.CSS.NONE),this._cached.float}get zIndex(){return this.toInt("zIndex")}set textContent(e){this._cached.textContent=e}get textContent(){return void 0===this._cached.textContent&&(this._cached.textContent=(this.htmlElement||this.plainText)&&this._element.textContent||""),this._cached.textContent}get textEmpty(){return this.inlineText&&(""===this.textContent||!this.preserveWhiteSpace&&""===this.textContent.trim())}get src(){return this.imageElement||"INPUT_IMAGE"===this.tagName?this._element.src:""}set overflow(e){0!==e&&16!==e&&8!==e&&24!==e||($.hasBit(this.overflow,64)&&(e|=64),this._cached.overflow=e)}get overflow(){if(void 0===this._cached.overflow){const e=this.css("overflowX"),t=this.css("overflowY");let i=0;if(!this.documentBody){const s=this.htmlElement&&this._element;(this.has(U.CSS.WIDTH)||this.has("maxWidth"))&&("scroll"===e||e===U.CSS.AUTO&&s&&s.clientWidth!==s.scrollWidth)&&(i|=8),this.hasHeight&&(this.has(U.CSS.HEIGHT)||this.has("maxHeight"))&&("scroll"===t||t===U.CSS.AUTO&&s&&s.clientHeight!==s.scrollHeight)&&(i|=16)}e!==U.CSS.AUTO&&"hidden"!==e&&"overlay"!==e&&t!==U.CSS.AUTO&&"hidden"!==t&&"overlay"!==t||(i|=64),this._cached.overflow=i}return this._cached.overflow}get overflowX(){return $.hasBit(this.overflow,8)}get overflowY(){return $.hasBit(this.overflow,16)}set baseline(e){this._cached.baseline=e}get baseline(){return void 0===this._cached.baseline&&(this._cached.baseline=this.pageFlow&&!this.floating&&this.cssAny("verticalAlign","baseline","initial",U.CSS.PX_0,U.CSS.PERCENT_0)),this._cached.baseline}get verticalAlign(){if(void 0===this._cached.verticalAlign){let e=this.css("verticalAlign");q.isPercent(e)&&(e=this.convertPX(e,U.CSS.HEIGHT)),this._cached.verticalAlign=e}return this._cached.verticalAlign}set multiline(e){this._cached.multiline=e}get multiline(){return void 0===this._cached.multiline&&(this._cached.multiline=!!(this.plainText||this.inlineText&&(this.inlineFlow||0===this.length))&&V.getRangeClientRect(this._element,this.sessionId).numberOfLines>0),this._cached.multiline}get positiveAxis(){return void 0===this._cached.positiveAxis&&(this._cached.positiveAxis=(!this.positionRelative||this.positionRelative&&this.top>=0&&this.left>=0&&(this.right<=0||this.has(U.CSS.LEFT))&&(this.bottom<=0||this.has(U.CSS.TOP)))&&this.marginTop>=0&&this.marginLeft>=0&&this.marginRight>=0),this._cached.positiveAxis}get leftTopAxis(){if(void 0===this._cached.leftTopAxis){const e=this.cssInitial("position");this._cached.leftTopAxis="absolute"===e&&this.absoluteParent===this.documentParent||"fixed"===e}return this._cached.leftTopAxis}set renderExclude(e){this._cached.renderExclude=e}get renderExclude(){return void 0===this._cached.renderExclude&&(this._cached.renderExclude=this.pseudoElement&&'""'===this.css("content")&&0===this.contentBoxWidth&&0===this.contentBoxHeight||0===this.bounds.height&&(this.marginTop<0||this.marginBottom<0)),this._cached.renderExclude}get backgroundColor(){if(void 0===this._cached.backgroundColor){let e=this.css("backgroundColor");if(""!==e&&this.pageFlow&&(-1===this._initial.iteration||this.cssInitial("backgroundColor")===e)){let t=this.actualParent;for(;t&&0!==t.id;){const i=t.cssInitial("backgroundColor",!0);if(""!==i){i===e&&(e="");break}t=t.actualParent}}this._cached.backgroundColor="rgba(0, 0, 0, 0)"!==e?e:""}return this._cached.backgroundColor}get backgroundImage(){if(void 0===this._cached.backgroundImage){const e=this.css("backgroundImage");if(""!==e&&e!==U.CSS.NONE)this._cached.backgroundImage=e;else{const e=K.exec(this.css("background"));this._cached.backgroundImage=e?e[1]:""}}return this._cached.backgroundImage}get visibleStyle(){if(void 0===this._cached.visibleStyle){const e=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,t=""!==this.backgroundColor,i=""!==this.backgroundImage;this._cached.visibleStyle={background:e||i||t,borderWidth:e,backgroundImage:i,backgroundColor:t,backgroundRepeat:"no-repeat"!==this.css("backgroundRepeat")}}return this._cached.visibleStyle}get preserveWhiteSpace(){return void 0===this._cached.preserveWhiteSpace&&(this._cached.preserveWhiteSpace=this.cssAny("whiteSpace","pre","pre-wrap")),this._cached.preserveWhiteSpace}get layoutHorizontal(){return this.hasAlign(8)}get layoutVertical(){return this.hasAlign(16)}set controlName(e){this.rendered&&void 0!==this._controlName||(this._controlName=e)}get controlName(){return this._controlName||""}set documentParent(e){this._documentParent=e}get documentParent(){return this._documentParent||this.absoluteParent||this.actualParent||this.parent||this}get absoluteParent(){if(void 0===this._cached.absoluteParent){let e=this.actualParent;if(!this.pageFlow)for(;e&&0!==e.id;){const t=e.cssInitial("position",!1,!0);if(e.documentBody||"static"!==t&&"initial"!==t&&"unset"!==t)break;e=e.actualParent}this._cached.absoluteParent=e||null}return this._cached.absoluteParent}get actualParent(){return void 0===this._cached.actualParent&&(this._cached.actualParent=this._element&&this._element.parentElement&&V.getElementAsNode(this._element.parentElement,this.sessionId)||null),this._cached.actualParent}set actualChildren(e){this._cached.actualChildren=e}get actualChildren(){if(void 0===this._cached.actualChildren)if(this.htmlElement&&this.naturalElement){const e=[];this._element.childNodes.forEach(t=>{const i=V.getElementAsNode(t,this.sessionId);i&&e.push(i)}),this._cached.actualChildren=e}else-1===this._initial.iteration&&this.saveAsInitial(),this._cached.actualChildren=this._initial.children;return this._cached.actualChildren}get actualWidth(){if(void 0===this._cached.actualWidth){if(this.plainText)this._cached.actualWidth=this.bounds.right-this.bounds.left;else if(!this.documentParent.flexElement&&"table-cell"!==this.display){let e=this.parseUnit(this.cssInitial(U.CSS.WIDTH,!0));if(e>0){const t=this.parseUnit(this.css("maxWidth"));return t>0&&(e=Math.min(e,t)),this.contentBox&&!this.tableElement&&(e+=this.contentBoxWidth),this._cached.actualWidth=e,e}}this._cached.actualWidth=this.bounds.width}return this._cached.actualWidth}get actualHeight(){if(void 0===this._cached.actualHeight){if(!this.plainText&&!this.documentParent.flexElement&&"table-cell"!==this.display){let e=this.parseUnit(this.cssInitial(U.CSS.HEIGHT,!0),U.CSS.HEIGHT);if(e>0){const t=this.parseUnit(this.css("maxHeight"));return t>0&&(e=Math.min(e,t)),this.contentBox&&!this.tableElement&&(e+=this.contentBoxHeight),this._cached.actualHeight=e,e}}this._cached.actualHeight=this.bounds.height}return this._cached.actualHeight}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}get firstChild(){for(const e of this.actualChildren)if(e.naturalElement)return e;return null}get lastChild(){for(let e=this.actualChildren.length-1;e>=0;e--){const t=this.actualChildren[e];if(t.naturalElement)return t}return null}get singleChild(){return this.renderParent?1===this.renderParent.length:!(!this.parent||0===this.parent.id)&&1===this.parent.length}get previousSibling(){if(void 0===this._cached.previousSibling){if(this.naturalElement){let e=this._element.previousSibling;for(;e;){const t=V.getElementAsNode(e,this.sessionId);if(t&&(!t.excluded||t.lineBreak))return this._cached.previousSibling=t,t;e=e.previousSibling}}this._cached.previousSibling=null}return this._cached.previousSibling}get nextSibling(){if(void 0===this._cached.nextSibling){if(this.naturalElement){let e=this._element.nextSibling;for(;e;){const t=V.getElementAsNode(e,this.sessionId);if(t&&(!t.excluded||t.lineBreak))return this._cached.nextSibling=t,t;e=e.nextSibling}}this._cached.nextSibling=null}return this._cached.nextSibling}set dir(e){this._cached.dir=e}get dir(){if(void 0===this._cached.dir){let e=this.naturalElement&&this.styleElement&&!this.pseudoElement?this._element.dir:"";switch(e){case"ltr":case"rtl":break;default:let t=this.actualParent;for(;t;){if(e=t.dir){this._cached.dir=e;break}t=t.actualParent}}this._cached.dir=e||document.body.dir}return this._cached.dir}get center(){return{x:(this.bounds.left+this.bounds.right)/2,y:(this.bounds.top+this.bounds.bottom)/2}}}const Q=squared.lib.constant;const J=squared.lib.client,ee=squared.lib.color,te=squared.lib.constant,ie=squared.lib.css,se=squared.lib.math,ne=squared.lib.regex,oe=squared.lib.session,ae=squared.lib.util,re="&#160;",le=`(rgba?\\(\\d+, \\d+, \\d+(?:, [\\d.]+)?\\)|#[A-Za-z\\d]{3,8}|[a-z]+)\\s*(${ne.STRING.LENGTH_PERCENTAGE}|${ne.STRING.CSS_ANGLE}|(?:${ne.STRING.CSS_CALC}(?=,)|${ne.STRING.CSS_CALC}))?,?\\s*`,ce=/\u00A0/g,he=/\n/g,de=RegExp(`(?:initial|url\\([^)]+\\)|(repeating)?-?(linear|radial|conic)-gradient\\(((?:to [a-z ]+|(?:from )?-?[\\d.]+(?:deg|rad|turn|grad)|(?:circle|ellipse)?\\s*(?:closest-side|closest-corner|farthest-side|farthest-corner)?)?(?:\\s*at [\\w %]+)?),?\\s*((?:${le})+)\\))`,"g");function ue(e,t,i,s){const n=t,o=n.horizontal?te.CSS.WIDTH:te.CSS.HEIGHT,a=!0===n.repeating,r=a&&"radial"===t.type?n.radiusExtent/n.radius:1,l=RegExp(le,"g"),c=[];let h,d=0;for(;null!==(h=l.exec(i));){const i=ee.parseColor(h[1],s,!0);if(i){let s=-1;if("conic"===t.type)h[3]&&h[4]&&(s=ie.convertAngle(h[3],h[4])/360);else if(h[2]){if(ie.isPercent(h[2]))s=parseFloat(h[2])/100;else if(a){const i="radial"===t.type?n.radius:t.dimension[o];ie.isLength(h[2])?s=e.parseUnit(h[2],o,!1)/i:ie.isCalc(h[2])&&(s=ie.calculate(h[6],i,e.fontSize)/i)}a&&-1!==s&&(s*=r)}0===c.length&&(-1===s?s=0:s>0&&c.push({color:i,offset:0})),-1!==s&&(d=s=Math.max(d,s)),c.push({color:i,offset:s})}}const u=c[c.length-1];-1===u.offset&&(u.offset=1);let g=0;for(let e=0;e<c.length;e++){const t=c[e];if(-1===t.offset)if(0===e)t.offset=0;else{for(let i=e+1,s=2;i<c.length-1;i++,s++)if(-1!==c[i].offset){t.offset=(g+c[i].offset)/s;break}-1===t.offset&&(t.offset=g+u.offset/(c.length-1))}g=t.offset}if(a){if(g<100){const e=c.slice(0);e:{let t=g;for(;g<100;){for(let i=0;i<e.length;i++)if(c.push(Object.assign({},e[i],{offset:g=Math.min(t+e[i].offset,1)})),1===g)break e;t=g}}}}else g<1&&c.push(Object.assign({},c[c.length-1],{offset:1}));return c}function ge(e){if(e){let t=ie.parseAngle(e.trim());return t<0&&(t+=360),t}return 0}function fe(e,t,i,s){switch(s=s.replace(ce,re),t.css("whiteSpace")){case"nowrap":s=s.replace(he," ");break;case"pre":case"pre-wrap":e.layoutVertical||(s=s.replace(/^\s*?\n/,"")),s=s.replace(he,"\\n").replace(/\s/g,re);break;case"pre-line":s=s.replace(he,"\\n").replace(/\s+/g," ");break;default:return(i.previousSibling&&oe.causesLineBreak(i.previousSibling,t.sessionId)||t.singleChild&&t.htmlElement)&&(s=s.replace(ne.CHAR.LEADINGSPACE,"")),(i.nextSibling&&oe.causesLineBreak(i.nextSibling,t.sessionId)||t.singleChild&&t.htmlElement)&&(s=s.replace(ne.CHAR.TRAILINGSPACE,"")),[s,!1]}return[s,!0]}function pe(e,t,i){if(i){const s=i.split(ne.XML.SEPARATOR);return be.getBackgroundSize(e,s[t%s.length])}}const me=e=>e?/(.+?)?\s*at (.+?)$/.exec(e):null;class be{constructor(e,t){this.application=e,this.cache=t}static generateId(e,t,i=1){const s=t;let n=i;1===i&&(t+=`_${""+n}`);const o=this.ASSETS.ids.get(e)||[];for(;;){if(!o.includes(t)){o.push(t);break}t=`${s}_${""+ ++n}`}return this.ASSETS.ids.set(e,o),t}static insertStoredAsset(e,t,i){const s=be.STORED[e];if(s&&ae.hasValue(i)){let n=this.getStoredName(e,i);if(""===n){ae.isNumber(t)&&(t=`__${t}`);let e=0;do{n=t,e>0&&(n+=`_${e}`),s.has(n)||s.set(n,i),e++}while(s.has(n)&&s.get(n)!==i)}return n}return""}static getOptionArray(e){const t=[];let i=!0;for(let s=0;s<e.children.length;s++){const n=e.children[s].text.trim();""!==n&&(i&&!ae.isNumber(n)&&(i=!1),t.push(n))}return i?[void 0,t]:[t]}static isBackgroundVisible(e){return!(void 0===e||!e.backgroundImage&&!e.borderTop&&!e.borderRight&&!e.borderBottom&&!e.borderLeft)}static getBackgroundSize(e,t){let i=0,s=0;switch(t){case"":case"cover":case"contain":case"100% 100%":case"auto":case"auto auto":case"initial":return;default:const n=t.split(" ");1===n.length&&(n[1]=n[0]);for(let t=0;t<n.length;t++)n[t]===te.CSS.AUTO&&(n[t]=te.CSS.PERCENT_100),0===t?i=e.parseUnit(n[t],te.CSS.WIDTH,!1):s=e.parseUnit(n[t],te.CSS.HEIGHT,!1)}return i>0&&s>0?{width:Math.round(i),height:Math.round(s)}:void 0}static isInheritedStyle(e,t){if(e.styleElement){const i=e.actualParent;if(i&&!e.cssInitial(t))return e.style[t]===i.style[t]}return!1}static hasLineBreak(e,t=!1,i=!1){if(e.actualChildren.length)return e.actualChildren.some(e=>e.lineBreak);if(!t&&e.naturalElement){const t=e.element;let s=t.textContent;if(i&&(s=s.trim()),/\n/.test(s))return!(!e.plainText||!ie.isParentStyle(t,"whiteSpace","pre","pre-wrap"))||e.css("whiteSpace").startsWith("pre")}return!1}static getStoredName(e,t){if(be.STORED[e])for(const[i,s]of be.STORED[e].entries())if(ae.isEqual(t,s))return i;return""}finalize(e){}reset(){for(const e in be.ASSETS)be.ASSETS[e].clear();for(const e in be.STORED)be.STORED[e].clear();this.fileHandler&&this.fileHandler.reset()}addImage(e){if(e&&e.complete){const t=e.src.trim();""!==t&&be.ASSETS.images.set(t,{width:e.naturalWidth,height:e.naturalHeight,uri:t})}}getImage(e){return be.ASSETS.images.get(e)}addFont(e){const t=be.ASSETS.fonts.get(e.fontFamily)||[];t.push(e),be.ASSETS.fonts.set(e.fontFamily,t)}getFont(e,t="normal",i){const s=be.ASSETS.fonts.get(e);if(s){const e=this.application.controllerHandler.localSettings.supported.fontFormat;return s.find(s=>s.fontStyle===t&&(void 0===i||s.fontWeight===parseInt(i))&&e.includes(s.srcFormat))}}addRawData(e,t,i,s,n=0,o=0){i=i.toLowerCase();const a=this.application.controllerHandler.localSettings;let r;"base64"===i?(r=s,"image/svg+xml"===t&&(s=window.atob(s))):s=s.replace(/\\"/g,'"');for(const i of a.supported.imageFormat)if(-1!==t.indexOf(i)){let a;return a=e.endsWith(`.${i}`)?ae.fromLastIndexOf(e,"/"):`${ae.buildAlphaString(5).toLowerCase()}_${(new Date).getTime()}.${i}`,be.ASSETS.rawData.set(e,{pathname:"",filename:a,content:s,base64:r,mimeType:t,width:n,height:o}),a}return""}getRawData(e){if(e.startsWith("url(")){const t=ne.CSS.URL.exec(e);t&&(e=t[1])}return be.ASSETS.rawData.get(e)}writeRawImage(e,t){this.fileHandler&&this.fileHandler.addAsset({pathname:this.application.controllerHandler.localSettings.directory.image,filename:e,base64:t})}setBoxStyle(e){if(e.visible&&e.styleElement){const i={backgroundSize:"",backgroundRepeat:"",backgroundPositionX:"",backgroundPositionY:"",borderRadius:void 0,outline:void 0,backgroundClip:void 0};e.css("border").startsWith("0px none")||(i.borderTop=void 0,i.borderRight=void 0,i.borderBottom=void 0,i.borderLeft=void 0);const s=e.css("opacity");function t(t,n){const o=e.css(v[n][0])||te.CSS.NONE;let a=ie.convertPX(e.css(v[n][1]),e.fontSize)||te.CSS.PX_0,r=e.css(v[n][2])||"initial";switch(r){case"initial":r="rgb(0, 0, 0)";break;case"inherit":case"currentColor":r=ie.getInheritedStyle(e.element,v[n][2])}if(o!==te.CSS.NONE&&a!==te.CSS.PX_0){"2px"!==a||"inset"!==o&&"outset"!==o||(a="1px");const e=ee.parseColor(r,s,!0);e&&(i[t]={width:a,style:o,color:e})}}for(const s in i){const n=e.css(s);switch(s){case"backgroundSize":case"backgroundRepeat":case"backgroundPositionX":case"backgroundPositionY":i[s]=n;break;case"backgroundClip":switch(n){case"content-box":i.backgroundClip={top:e.borderTopWidth+e.paddingTop,right:e.borderRightWidth+e.paddingRight,bottom:e.borderBottomWidth+e.paddingBottom,left:e.borderLeftWidth+e.paddingLeft};break;case"padding-box":i.backgroundClip={top:e.borderTopWidth,right:e.borderRightWidth,bottom:e.borderBottomWidth,left:e.borderLeftWidth}}break;case"borderTop":t(s,0);break;case"borderRight":t(s,1);break;case"borderBottom":t(s,2);break;case"borderLeft":t(s,3);break;case"outline":t(s,4);break;case"borderRadius":if(n!==te.CSS.PX_0){const[t,s]=e.css("borderTopLeftRadius").split(" "),[n,o]=e.css("borderTopRightRadius").split(" "),[a,r]=e.css("borderBottomRightRadius").split(" "),[l,c]=e.css("borderBottomLeftRadius").split(" "),h=s||o||r||c?[t,s||t,n,o||n,a,r||a,l,c||l]:[t,n,a,l],d=e.actualWidth>=e.actualHeight;if(h.every(e=>e===h[0])){if(h[0]===te.CSS.PX_0||""===h[0])continue;h.length=1}for(let t=0;t<h.length;t++)h[t]=e.convertPX(h[t],d?te.CSS.WIDTH:te.CSS.HEIGHT,!1);i.borderRadius=h}}}if(e.hasResource(l.IMAGE_SOURCE)){const t=[];let n,o=0;for(;null!==(n=de.exec(e.backgroundImage));){if("initial"===n[0]||n[0].startsWith("url"))t.push(n[0]);else{const a="repeating"===n[1],r=n[2],l=n[3],c=pe(e,o,i.backgroundSize)||e.actualDimension;let h;switch(r){case"conic":{const t=me(l),i={type:r,dimension:c,angle:ge(l)};i.center=ie.getBackgroundPosition(t&&t[2]||te.CSS.CENTER,c,e.fontSize),i.colorStops=ue(e,i,n[4],s),h=i;break}case"radial":{const t=me(l),i={type:r,repeating:a,horizontal:e.actualWidth<=e.actualHeight,dimension:c,shape:t&&t[1]&&t[1].startsWith("circle")?"circle":"ellipse"};i.center=ie.getBackgroundPosition(t&&t[2]||te.CSS.CENTER,c,e.fontSize),i.closestCorner=1/0,i.farthestCorner=-1/0;for(const e of[[0,0],[c.width,0],[c.width,c.height],[0,c.height]]){const t=Math.round(Math.sqrt(Math.pow(Math.abs(e[0]-i.center.left),2)+Math.pow(Math.abs(e[1]-i.center.top),2)));t<i.closestCorner&&(i.closestCorner=t),t>i.farthestCorner&&(i.farthestCorner=t)}i.closestSide=i.center.top,i.farthestSide=i.center.top;for(const e of[c.width-i.center.left,c.height-i.center.top,i.center.left])e<i.closestSide&&(i.closestSide=e),e>i.farthestSide&&(i.farthestSide=e);i.radius=i.farthestCorner;const o=t&&t[1]?t[1].split(" ").pop():"";switch(o){case"closest-corner":case"closest-side":case"farthest-side":const e=i[ae.convertCamelCase(o)];a?i.radiusExtent=e:i.radius=e;break;default:i.radiusExtent=i.farthestCorner}i.colorStops=ue(e,i,n[4],s),h=i;break}case"linear":{let t=180;switch(l){case"to top":t=0;break;case"to right top":t=45;break;case"to right":t=90;break;case"to right bottom":t=135;break;case"to bottom":break;case"to left bottom":t=225;break;case"to left":t=270;break;case"to left top":t=315;break;default:l&&(t=ge(l))}const i={type:r,repeating:a,horizontal:t>=45&&t<=135||t>=225&&t<=315,dimension:c,angle:t};i.colorStops=ue(e,i,n[4],s);const o=c.width,d=c.height;let u=se.truncateFraction(se.offsetAngleX(t,o)),g=se.truncateFraction(se.offsetAngleY(t,d));if(u!==o&&g!==d&&!se.isEqual(Math.abs(u),Math.abs(g))){let e;e=t<=90?se.relativeAngle({x:0,y:d},{x:o,y:0}):t<=180?se.relativeAngle({x:0,y:0},{x:o,y:d}):t<=270?se.relativeAngle({x:0,y:0},{x:-o,y:d}):se.relativeAngle({x:0,y:d},{x:-o,y:0});let i=Math.abs(e-t),s=90-i;const n=se.triangulateASA(i,s,Math.sqrt(Math.pow(o,2)+Math.pow(d,2)));u=se.truncateFraction(se.offsetAngleX(t,n[1]));const a=se.triangulateASA(i=90,s=90-t,u);g=se.truncateFraction(se.offsetAngleY(t,a[0]))}i.angleExtent={x:u,y:g},h=i;break}}t.push(h||"initial")}o++}t.length&&(i.backgroundImage=t)}{const t=e.documentParent.visible?e.backgroundColor:e.css("backgroundColor");if(""!==t){const e=ee.parseColor(t,s);i.backgroundColor=e?e.valueAsRGBA:""}}if(i.borderTop&&i.borderRight&&i.borderBottom&&i.borderLeft){let e=!0;for(const t in i.borderTop){const s=i.borderTop[t];if(s!==i.borderRight[t]||s!==i.borderBottom[t]||s!==i.borderLeft[t]){e=!1;break}}e&&(i.border=i.borderTop)}e.data(be.KEY_NAME,"boxStyle",i)}}setFontStyle(e){if(!(null===e.element||e.renderChildren.length||e.imageElement||e.svgElement||"HR"===e.tagName||e.textEmpty&&!e.visibleStyle.background)){const t=ee.parseColor(e.css("color"),e.css("opacity"));let i=e.css("fontSize"),s=e.css("fontWeight");if(0===ae.convertInt(i))switch(i){case"xx-small":i="8px";break;case"x-small":i="10px";break;case"small":i="13px";break;case"medium":i="16px";break;case"large":i="18px";break;case"x-large":i="24px";break;case"xx-large":i="32px"}if(!ae.isNumber(s))switch(s){case"lighter":s="200";break;case"bold":s="700";break;case"bolder":s="900";break;default:s="400"}e.data(be.KEY_NAME,"fontStyle",{fontFamily:e.css("fontFamily").trim(),fontStyle:e.css("fontStyle"),fontSize:i,fontWeight:s,color:t?t.valueAsRGBA:""})}}setValueString(e){if(e.visible&&!e.svgElement){const t=e.element,i=e.renderParent;if(t&&i){let s="",n="",o=!1,a=!1;switch(t.tagName){case"INPUT":switch(n=t.value,t.type){case"radio":case"checkbox":e.companion&&!e.companion.visible&&(n=e.companion.textContent);break;case"submit":""!==n||e.visibleStyle.backgroundImage||(n="Submit");break;case"time":""===n&&(n="--:-- --");break;case"date":case"datetime-local":if(""===n){switch((new Intl.DateTimeFormat).resolvedOptions().locale){case"en-US":n="mm/dd/yyyy";break;default:n="dd/mm/yyyy"}"datetime-local"===t.type&&(n+=" --:-- --")}break;case"week":""===n&&(n="Week: --, ----");break;case"month":""===n&&(n="--------- ----");break;case"url":case"email":case"search":case"number":case"tel":""===n&&(n=t.placeholder);break;case"file":n=J.isUserAgent(8)?"Browse...":"Choose File"}break;case"TEXTAREA":n=t.value;break;case"IFRAME":n=t.src;break;default:e.plainText?(s=e.textContent.trim(),[n]=fe(i,e,t,e.textContent),a=!0,o=!0):e.inlineText?(s=e.textContent.trim(),[n,a]=fe(i,e,t,function(e,t,i){let s=t[i];const n=e.actualChildren.length;for(let t=0;t<n;t++){const o=e.actualChildren[t];(!o.textElement||!o.pageFlow||o.positioned||o.pseudoElement||o.excluded||o.dataset.target)&&(o.htmlElement&&"innerHTML"===i?s=s.replace(o.element.outerHTML,o.lineBreak?"\\n":o.pageFlow&&o.textContent?re:""):ae.isString(o[i])?s=s.replace(o[i],""):0===t?s=ae.trimStart(s," "):t===n-1&&(s=ae.trimEnd(s," ")))}return"innerHTML"===i&&(s=s.replace(ne.ESCAPE.ENTITY,(e,t)=>String.fromCharCode(parseInt(t)))),s}(e,t,t.children.length||"CODE"===t.tagName?"innerHTML":"textContent")),o=!0):""===e.textContent.trim()&&be.isBackgroundVisible(e.data(be.KEY_NAME,"boxStyle"))&&(n=e.textContent)}if(""!==n){if(o){const t=e.previousSiblings().pop();let i=!1;if(n.length>1&&(void 0===t||t.multiline||t.lineBreak||t.plainText&&ne.CHAR.TRAILINGSPACE.test(t.textContent)?n=n.replace(ne.CHAR.LEADINGSPACE,""):t.element&&(i=ne.CHAR.TRAILINGSPACE.test(t.textContent))),a){const s=n;if(n=n.trim(),!t||t.block||t.lineBreak||i||!ne.CHAR.LEADINGSPACE.test(s)||(n=re+n),!e.lineBreakTrailing&&ne.CHAR.TRAILINGSPACE.test(s)){const t=e.nextSiblings().pop();t&&!t.blockStatic&&(n+=re)}}else if(""!==n.trim())n=(n=n.replace(ne.CHAR.LEADINGSPACE,t&&(t.block||t.lineBreak||i&&t.htmlElement&&t.textContent.length>1||e.multiline&&be.hasLineBreak(e))?"":re)).replace(ne.CHAR.TRAILINGSPACE,"table-cell"===e.display||e.lineBreakTrailing||e.blockStatic?"":re);else if(!e.inlineText)return}""!==n&&e.data(be.KEY_NAME,"valueString",{name:s,value:n})}}}}get assets(){return be.ASSETS}get stored(){return be.STORED}}be.KEY_NAME="squared.resource",be.ASSETS={ids:new Map,images:new Map,fonts:new Map,rawData:new Map},be.STORED={strings:new Map,arrays:new Map,fonts:new Map,colors:new Map,images:new Map};const Se=squared.lib.constant,ye=squared.lib.css,Te=squared.lib.regex,xe=squared.lib.util,_e="[\\d.]+[a-z%]+|auto|max-content|min-content",Ce="minmax\\(([^,]+), ([^)]+)\\)",Ee="fit-content\\(([\\d.]+[a-z%]+)\\)",ve="\\[([\\w\\-\\s]+)\\]",Ae={UNIT:RegExp(`^(${_e})$`),NAMED:`\\s*(repeat\\((auto-fit|auto-fill|\\d+), (.+)\\)|${ve}|${Ce}|${Ee}|${_e})\\s*`,REPEAT:`\\s*(${ve}|${Ce}|${Ee}|${_e})\\s*`,STARTEND:/^([\w\-]+)-(start|end)$/};function Ie(e,t){const i=[],s=[];for(let n=0;n<t.length;n++)e.repeat[n]?s.push(t[n]):i.push(t[n]);const n=e.count-i.length,o=[];for(let t=0;t<e.count;t++){if(e.repeat[t]){for(let e=0,i=0;e<n;t++,e++,i++)i===s.length&&(i=0),o[t]=s[i];break}i.length&&(o[t]=i.shift())}return o}function we(e){let t=0;for(const i of e)i&&t++;return t}const Re=(e,t)=>ye.isLength(t)?e.convertPX(t):t;class ke extends W{static createDataAttribute(){return{children:new Set,rowData:[],rowHeight:[],rowWeight:[],rowSpanMultiple:[],templateAreas:{},row:ke.createDataRowAttribute(),column:ke.createDataRowAttribute(),emptyRows:[],alignItems:"",alignContent:"",justifyItems:"",justifyContent:""}}static createDataRowAttribute(){return{count:0,gap:0,unit:[],unitMin:[],unitTotal:[],repeat:[],auto:[],autoFill:!1,autoFit:!1,name:{},normal:!0}}condition(e){return e.gridElement&&e.length>0}processNode(e){const t=Object.assign({},ke.createDataAttribute(),{alignItems:e.css("alignItems"),alignContent:e.css("alignContent"),justifyItems:e.css("justifyItems"),justifyContent:e.css("justifyContent")}),i=e.css("gridAutoFlow"),s=-1===i.indexOf("column"),n=-1!==i.indexOf("dense"),o=[],a=[],r=[];let l={};if(t.row.gap=e.parseUnit(e.css("rowGap"),Se.CSS.HEIGHT,!1),t.column.gap=e.parseUnit(e.css("columnGap"),Se.CSS.WIDTH,!1),[e.cssInitial("gridTemplateRows",!0),e.cssInitial("gridTemplateColumns",!0),e.css("gridAutoRows"),e.css("gridAutoColumns")].forEach((i,s)=>{if(i&&i!==Se.CSS.NONE&&i!==Se.CSS.AUTO){const n=RegExp(Ae.NAMED,"g");let o,a=1;for(;null!==(o=n.exec(i));)if(s<2){const i=t[0===s?"row":"column"];if(o[1].startsWith("repeat")){let t=1;switch(o[2]){case"auto-fit":i.autoFit=!0;break;case"auto-fill":i.autoFill=!0;break;default:t=xe.convertInt(o[2])}if(t>0){const s=[],n=RegExp(Ae.REPEAT,"g");let r;for(;null!==(r=n.exec(o[3]));){let t;null!==(t=RegExp(ve).exec(r[1]))?(void 0===i.name[t[1]]&&(i.name[t[1]]=[]),s.push({name:t[1]})):null!==(t=RegExp(Ce).exec(r[1]))?s.push({unit:Re(e,t[2]),unitMin:Re(e,t[1])}):null!==(t=RegExp(Ee).exec(r[1]))?s.push({unit:Re(e,t[1]),unitMin:Se.CSS.PX_0}):null!==(t=RegExp(_e).exec(r[1]))&&s.push({unit:Re(e,t[0])})}if(s.length)for(let e=0;e<t;e++)for(const e of s)e.name?i.name[e.name].push(a):e.unit&&(i.unit.push(e.unit),i.unitMin.push(e.unitMin||""),i.repeat.push(!0),a++)}}else"["===o[1].charAt(0)?(void 0===i.name[o[4]]&&(i.name[o[4]]=[]),i.name[o[4]].push(a)):o[1].startsWith("minmax")?(i.unit.push(Re(e,o[6])),i.unitMin.push(Re(e,o[5])),i.repeat.push(!1),a++):o[1].startsWith("fit-content")?(i.unit.push(Re(e,o[7])),i.unitMin.push(Se.CSS.PX_0),i.repeat.push(!1),a++):Ae.UNIT.test(o[1])&&(i.unit.push(o[1]===Se.CSS.AUTO?Se.CSS.AUTO:Re(e,o[1])),i.unitMin.push(""),i.repeat.push(!1),a++)}else t[2===s?"row":"column"].auto.push(e.convertPX(o[1]))}}),e.sort(s?(e,t)=>xe.withinRange(e.linear.top,t.linear.top)?xe.withinRange(e.linear.left,t.linear.left)?0:e.linear.left<t.linear.left?-1:1:e.linear.top<t.linear.top?-1:1:(e,t)=>xe.withinRange(e.linear.left,t.linear.left)?xe.withinRange(e.linear.top,t.linear.top)?0:e.linear.top<t.linear.top?-1:1:e.linear.left<t.linear.left?-1:1),!e.has("gridTemplateAreas")&&e.every(e=>e.css("gridRowStart")===Se.CSS.AUTO&&e.css("gridColumnStart")===Se.CSS.AUTO)){let i,n,o,a,l;s?(i=Se.CSS.TOP,n=Se.CSS.BOTTOM,o=2,a=1,l=3):(i=Se.CSS.LEFT,n=Se.CSS.RIGHT,o=3,a=0,l=2);let c,h=0,d=0,u=0;e.each((e,g)=>{(void 0===c||e.linear[i]>=c.linear[n]||d>0&&d===u)&&(u=Math.max(d,u),h++,d=1);const f=e.css("gridRowEnd"),p=e.css("gridColumnEnd");let m=1,b=1;if(f.startsWith("span")?m=parseInt(f.split(" ")[1]):xe.isNumber(f)&&(m=parseInt(f)-h),p.startsWith("span")?b=parseInt(p.split(" ")[1]):xe.isNumber(p)&&(b=parseInt(p)-d),1===d&&u>0){let e=!1;do{const i=[].fill(1);for(const e of r){const t=e.placement;if(t[o]>h)for(let e=t[a];e<t[l];e++)i[e-1]=0}for(let t=0,s=0,n=0;t<i.length;t++)if(i[t]){if(0===s&&(n=t),++s===b){d=n+1,e=!0;break}}else s=0;e||(t.emptyRows[h-1]=i,h++)}while(!e)}r[g]={placement:s?[h,d,h+m,d+b]:[d,h,d+b,h+m],rowSpan:m,columnSpan:b},d+=b,c=e})}else e.css("gridTemplateAreas").split(/"[\s\n]+"/).forEach((e,i)=>{if(e!==Se.CSS.NONE){const s=t.templateAreas;xe.trimString(e.trim(),'"').split(Te.CHAR.SPACE).forEach((e,t)=>{"."!==e.charAt(0)&&(s[e]?(s[e].rowSpan=i-s[e].rowStart+1,s[e].columnSpan=t-s[e].columnStart+1):s[e]={rowStart:i,rowSpan:1,columnStart:t,columnSpan:1})})}}),e.each((e,i)=>{const s=[e.css("gridRowStart"),e.css("gridColumnStart"),e.css("gridRowEnd"),e.css("gridColumnEnd")],n=[];let o=1,a=1;if(Object.keys(t.templateAreas).length)for(let e=0;e<s.length;e++){const i=s[e];let o=t.templateAreas[i];if(o)switch(e){case 0:n[0]=o.rowStart+1;break;case 1:n[1]=o.columnStart+1;break;case 2:n[2]=o.rowStart+o.rowSpan+1;break;case 3:n[3]=o.columnStart+o.columnSpan+1}else{const s=Ae.STARTEND.exec(i);if(s&&(o=t.templateAreas[s[1]]))if(s[2]===Se.CSS.START)switch(e){case 0:case 2:n[e]=o.rowStart+1;break;case 1:case 3:n[e]=o.columnStart+1}else switch(e){case 0:case 2:n[e]=o.rowStart+o.rowSpan+1;break;case 1:case 3:n[e]=o.columnStart+o.columnSpan+1}}}if(!(n[0]&&n[1]&&n[2]&&n[3])){function l(e,t){if(xe.isNumber(e))return n[t]=parseInt(e),!0;if(e.startsWith("span")){const i=parseInt(e.split(" ")[1]);return n[t-2]?n[t]=n[t-2]+i:t%2==0?o=i:a=i,!0}return!1}let e,i;for(let r=0;r<s.length;r++){const c=s[r];if(c!==Se.CSS.AUTO&&!n[r]&&!l(c,r)){const l=t[r%2==0?"row":"column"],h=c.split(" ");1===h.length?(h[1]=h[0],h[0]="1"):xe.isNumber(h[0])&&(r%2==0?e?o=parseInt(h[0])-parseInt(e[0]):e=h:i?a=parseInt(h[0])-parseInt(i[0]):i=h);const d=l.name[h[1]];if(d){const e=parseInt(h[0]);e<=d.length&&(n[r]=d[e-1]+(h[1]===s[r-2]?1:0))}}n[r]||l(c,r)}}r[i]={placement:n,rowSpan:o,columnSpan:a}});{const e=t[s?"column":"row"];e.count=Math.max(1,e.unit.length);for(const t of r)t&&(e.count=Math.max(e.count,s?t.columnSpan:t.rowSpan,t.placement[s?1:0]||0,(t.placement[s?3:2]||0)-1));(e.autoFill||e.autoFit)&&(0===e.unit.length&&(e.unit.push(Se.CSS.AUTO),e.unitMin.push(""),e.repeat.push(!0)),e.unit=Ie(e,e.unit),e.unitMin=Ie(e,e.unitMin));let i=1,n=0;for(const t of e.unit)ye.isPercent(t)?i-=parseFloat(t)/100:t.endsWith("fr")&&(n+=parseFloat(t));if(i>0&&n>0)for(let t=0;t<e.unit.length;t++)e.unit[t].endsWith("fr")&&(e.unit[t]=i*(parseFloat(e.unit[t])/n)+"fr");const o=t.row.unit.length+1,a=t.column.unit.length+1;for(const e of r){const t=e.placement;t[2]<0&&(o>1?t[2]+=o+1:t[2]=void 0),t[3]<0&&(a>1?t[3]+=a+1:t[3]=void 0)}}if(e.each((e,i)=>{const c=r[i],h=c.placement;let d,u,g,f,p,m,b;for(s?(d=c.rowSpan,u=c.columnSpan,g=t.column.count,f=0,p=1,m=2,b=3):(d=c.columnSpan,u=c.rowSpan,g=t.row.count,f=1,p=0,m=3,b=2);!h[0]||!h[1];){const e=h.slice(0);if(!e[f]){let t=o.length;for(let i=0,s=0,n=-1;i<t;i++)if(!l[i])if(void 0===a[i]||a[i]<g){if(0===s&&(n=i,t=Math.max(t,i+d)),++s===d){e[f]=n+1;break}}else s=0,n=-1,t=o.length}if(e[f]){if(!e[p]){e[m]||(e[m]=e[f]+d);const t=[],i=e[f]-1,s=e[m]-1;for(let e=i;e<s;e++)if(void 0===o[e])t.push([[0,-1]]);else{if(!(we(o[e])+u<=g))break;{const i=[];let s=0;for(let t=0,n=-1;t<g;t++)void 0===o[e][t]&&(-1===n&&(n=t),s++),(o[e][t]||t===g-1)&&(s>=u&&i.push([n,n+s]),n=-1,s=0);if(!i.length)break;t.push(i)}}if(t.length)if(-1===t[0][0][1])e[p]=1;else if(t.length===s-i)if(t.length>1)e:for(const i of t[0])for(let s=i[0];s<i[1];s++)for(let i=1;i<t.length;i++)for(let n=0;n<t[i].length;n++){const o=t[i][n];if(s>=o[0]&&(-1===o[1]||s+u<=o[1])){e[p]=s+1;break e}}else e[p]=t[0][0][0]+1}}else h[f]=o.length+1,h[p]||(h[p]=1);e[f]&&e[p]?(h[f]=e[f],h[p]=e[p]):e[f]&&(l[e[f]-1]=!0)}if(h[m]||(h[m]=h[f]+d),h[b]||(h[b]=h[p]+u),function(e,t){if(t.every(e=>e>0)){for(let i=t[s?0:1]-1;i<t[s?2:3]-1;i++){void 0===o[i]&&(o[i]=[]);for(let n=t[s?1:0]-1;n<t[s?3:2]-1;n++)void 0===a[i]&&(a[i]=0),void 0===o[i][n]&&(o[i][n]=[],a[i]++),o[i][n].push(e)}return!0}return!1}(e,h)){const i=h[0]-1,s=h[2]-h[0];if(s>1)for(let e=i;e<i+s;e++)t.rowSpanMultiple[e]=!0;e.data(A.CSS_GRID,"cellData",{rowStart:i,rowSpan:s,columnStart:h[1]-1,columnSpan:h[3]-h[1]}),n&&(l={})}}),o.length){if(s)t.rowData=o;else for(let e=0;e<o.length;e++)for(let i=0;i<o[e].length;i++)void 0===t.rowData[i]&&(t.rowData[i]=[]),t.rowData[i][e]=o[e][i];const i=t[s?"row":"column"].unitTotal;let n=0;for(const e of t.rowData){n=Math.max(e.length,n);for(let n=0;n<e.length;n++){const o=e[n];if(void 0===i[n]&&(i[n]=0),o){let e=0;for(let i=0;i<o.length;i++){const n=o[i];t.children.has(n)||(e=Math.max(e,s?n.bounds.height:n.bounds.width)),t.children.add(n)}i[n]+=e}}}if(t.children.size===e.length){t.row.count=t.rowData.length,t.column.count=n;const i=new Set;for(let e=0;e<t.row.count;e++){t.rowHeight.push(0);for(let s=0;s<n;s++){const o=t.rowData[e][s];if(o)for(const a of o)if(!i.has(a)){const o=a.data(A.CSS_GRID,"cellData"),r=e+o.rowSpan-1;s+o.columnSpan-1<n-1&&a.modifyBox(4,t.column.gap),r<t.row.count-1&&a.modifyBox(8,t.row.gap),1===o.rowSpan&&(t.rowHeight[e]=Math.max(t.rowHeight[e],a.bounds.height)),i.add(a)}}}for(let i=0;i<t.rowHeight.length;i++)t.rowWeight[i]=t.rowHeight[i]/e.actualHeight;e.retain(Array.from(t.children)),e.cssSort("zIndex"),e.cssTry("display","block")&&(e.each(e=>{const t=e.initial.bounds;if(t){const i=e.element.getBoundingClientRect();t.width=i.width,t.height=i.height}}),e.cssFinally("display")),e.data(A.CSS_GRID,C.EXT_DATA,t)}}}}const Be=squared.lib.css,Pe=squared.lib.session;const Ne=squared.lib.constant,Le=squared.lib.util;class Oe extends W{static createDataAttribute(e,t){const i=e.css("flexWrap"),s=e.css("flexDirection");return{directionRow:s.startsWith("row"),directionColumn:s.startsWith("column"),directionReverse:s.endsWith("reverse"),wrap:i.startsWith("wrap"),wrapReverse:"wrap-reverse"===i,alignContent:e.css("alignContent"),justifyContent:e.css("justifyContent"),rowCount:0,columnCount:0,children:t}}condition(e){return e.flexElement&&e.length>0}processNode(e){const t=this.application.controllerHandler,i=e.filter(e=>e.pageFlow&&e.pseudoElement&&0===e.contentBoxWidth&&'""'===e.css("content")?(e.hide(),!1):e.pageFlow),s=Oe.createDataAttribute(e,i);if(e.cssTry("alignItems",Ne.CSS.START)){if(e.cssTry("justifyItems",Ne.CSS.START)){for(const e of i){const t=e.initial.bounds;if(t&&e.cssTry("alignSelf",Ne.CSS.START)){if(e.cssTry("justifySelf",Ne.CSS.START)){if(e.cssTry("flexGrow","0")){if(e.cssTry("flexShrink","1")){const i=e.element.getBoundingClientRect();t.width=i.width,t.height=i.height,e.cssFinally("flexShrink")}e.cssFinally("flexGrow")}e.cssFinally("justifySelf")}e.cssFinally("alignSelf")}}e.cssFinally("justifyItems")}e.cssFinally("alignItems")}if(s.wrap){let o,a,r,l;s.directionRow?(o=Ne.CSS.TOP,a=Ne.CSS.LEFT,r=Ne.CSS.RIGHT,l="intersectY"):(o=Ne.CSS.LEFT,a=Ne.CSS.TOP,r=Ne.CSS.BOTTOM,l="intersectX"),i.sort((e,t)=>e[l](t.bounds,"bounds")?Le.withinRange(e.linear[a],t.linear[a])?0:e.linear[a]<t.linear[a]?-1:1:e.linear[o]<t.linear[o]?-1:1);let c=[i[0]],h=i[0];const d=[c];for(let e=1;e<i.length;e++){const t=i[e];h[l](t.bounds,"bounds")?c.push(t):(h=t,d.push(c=[t]))}e.clear();let u=0;if(d.length>1)for(let i=0;i<d.length;i++){const s=d[i],o=t.createNodeGroup(s[0],s,e);o.siblingIndex=i,e.sort(n.siblingIndex);const a=o.unsafe("box");a&&(a[r]=e.box[r]),o.alignmentType|=128,u=Math.max(s.length,u)}else u=d[0].length,e.retain(d[0]);s.directionRow?(s.rowCount=d.length,s.columnCount=u):(s.rowCount=u,s.columnCount=d.length)}else{if(i.some(e=>0!==e.flexbox.order)){const e=s.directionReverse?-1:1,t=s.directionReverse?1:-1;i.sort((i,s)=>i.flexbox.order===s.flexbox.order?0:i.flexbox.order>s.flexbox.order?e:t)}s.directionRow?(s.rowCount=1,s.columnCount=e.length):(s.rowCount=e.length,s.columnCount=1)}e.data(A.FLEXBOX,C.EXT_DATA,s)}}const Me=squared.lib.constant,He=squared.lib.css,We=squared.lib.util;function Fe(e,t){for(const i of e){const e=i.findIndex(e=>We.withinRange(t.linear.top,e.linear.top)||t.linear.top>e.linear.top&&t.linear.top<e.linear.bottom);if(-1!==e)return e}return-1}class De extends W{static createDataAttribute(){return{paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,columnCount:0}}static createDataCellAttribute(){return{rowSpan:0,columnSpan:0,index:-1,cellStart:!1,cellEnd:!1,rowEnd:!1,rowStart:!1,block:!1}}condition(e){if(e.length>1&&!e.layoutElement&&!e.has("listStyle")){if("table"===e.display)return e.every(e=>"table-row"===e.display&&e.every(e=>"table-cell"===e.display));{let t=0,i=0;for(const s of e){if(!s.pageFlow||s.visibleStyle.background||!s.blockStatic||s.autoMargin.leftRight||s.autoMargin.left)return!1;s.length>1&&t++,"list-item"!==s.display||s.has("listStyleType")||i++}if(i===e.length)return!0;if(t>0)return e.every(e=>e.length>0&&n.linearData(e.children).linearX)}}return!1}processNode(e){const t=[],i=[],s={};for(const t of e)for(const e of t){const t=Math.floor(e.linear.left);void 0===s[t]&&(s[t]=[]),s[t].push(e)}const n=Object.keys(s);if(n.length){let o=-1;for(let e=0;e<n.length;e++){const t=s[n[e]];if(0===e)o=t.length;else if(o!==t.length){o=-1;break}}if(-1!==o)for(let e=0;e<n.length;e++)i.push(s[n[e]]);else{const o=[];for(let e=0;e<n.length;e++){const t=s[n[e]];if(0===e&&0===t.length)return;o[e]=0===e?0:o[e-1];for(let s=0;s<t.length;s++){const n=t[s];if(0===e||We.aboveRange(n.linear.left,o[e-1]))if(void 0===i[e]&&(i[e]=[]),0===e||i[0].length===t.length)i[e][s]=n;else{const t=Fe(i,n);if(-1===t)return;i[e][t]=n}else{const e=i.length-1;if(i[e]){let t=1/0,s=-1/0;if(i[e].forEach(e=>{t=Math.min(t,e.linear.left),s=Math.max(s,e.linear.right)}),Math.floor(n.linear.left)>Math.ceil(t)&&Math.floor(n.linear.right)>Math.ceil(s)){const t=Fe(i,n);if(-1!==t)for(let s=i.length-1;s>=0;s--)if(i[s]){void 0===i[s][t]&&(i[e].length=0);break}}}}o[e]=Math.max(n.linear.right,o[e])}}for(let e=0,t=-1;e<o.length;e++)void 0===i[e]?-1===t?t=e-1:e===o.length-1&&(o[t]=o[e]):-1!==t&&(o[t]=o[e-1],t=-1);for(let e=0;e<i.length;e++)i[e]&&i[e].length?t.push(o[e]):i.splice(e--,1);const a=i.reduce((e,t)=>Math.max(e,t.length),0);for(let e=0;e<a;e++)for(let t=0;t<i.length;t++)void 0===i[t][e]&&(i[t][e]={spacer:1});t.push(e.box.right)}}if(i.length>1&&i[0].length===e.length){const s=Object.assign({},De.createDataAttribute(),{columnCount:i.length}),n=[],o=new Set;for(let e=0,s=0;e<i.length;e++){let a=0;for(let r=0,l=0;r<i[e].length;r++){const c=i[e][r];if(void 0===n[r]&&(n[r]=[]),c.spacer)1===c.spacer&&a++;else{const h=Object.assign(De.createDataCellAttribute(),c.data(A.GRID,"cellData"));let d=1,u=1+a;for(let t=e+1;t<i.length&&1===i[t][r].spacer;t++)u++,i[t][r].spacer=2;if(1===u)for(let t=r+1;t<i[e].length&&1===i[e][t].spacer;t++)d++,i[e][t].spacer=2;if(t.length){const i=Math.min(e+(u-1),t.length-1);for(const e of c.documentParent.actualChildren)!o.has(e)&&e.visible&&!e.rendered&&We.aboveRange(e.linear.left,c.linear.right)&&We.belowRange(e.linear.right,t[i])&&(void 0===h.siblings&&(h.siblings=[]),h.siblings.push(e))}h.rowSpan=d,h.columnSpan=u,h.rowStart=0==l++,h.rowEnd=u+e===i.length,h.cellStart=0===s,h.cellEnd=h.rowEnd&&r===i[e].length-1,h.index=e,a=0,c.data(A.GRID,"cellData",h),n[r].push(c),o.add(c)}}}for(const t of e)t.hide();e.clear();for(const t of n){let i=!0,n=!1;for(const e of t){const t=e.css(Me.CSS.WIDTH);if(He.isPercent(t))n=!0;else if(!He.isLength(t)){i=!1;break}}if(i&&n&&t.length>1){const e=t[0].data(A.GRID,"cellData");if(e&&1===e.rowSpan){const i=e.siblings?e.siblings.slice(0):[];for(let e=1;e<t.length;e++){const s=t[e].data(A.GRID,"cellData");if(!s||1!==s.rowSpan){i.length=0;break}i.push(t[e]),s.sibling&&We.concatArray(i,s.sibling)}i.length&&(e.block=!0,e.columnSpan=s.columnCount,e.siblings=i,t.length=1)}}for(const s of t)s.parent=e,!i&&s.has(Me.CSS.WIDTH,32)&&s.css(Me.CSS.WIDTH,He.formatPX(s.bounds.width))}e.tableElement&&"collapse"===e.css("borderCollapse")&&(e.modifyBox(32),e.modifyBox(64),e.modifyBox(128),e.modifyBox(256)),e.data(A.GRID,C.EXT_DATA,s)}}}const Ge=squared.lib.constant,Xe=squared.lib.css,Ue=e=>e.visibleStyle.backgroundImage&&!e.visibleStyle.backgroundRepeat;class qe extends W{static createDataAttribute(){return{ordinal:"",imageSrc:"",imagePosition:""}}condition(e){if(super.condition(e)){const t=e.length;if(t){const i=new Set;let s=0,n=0,o=0,a=0,r=0,l=0;for(let c=0;c<t;c++){const h=e.item(c),d=h.css("listStyleType")!==Ge.CSS.NONE;"list-item"===h.display?(d||h.innerBefore||Ue(h))&&l++:Ue(h)&&!d&&h.marginLeft<0&&r++,h.blockStatic&&s++,h.inlineVertical&&n++,h.floating?(i.add(h.float),o++):(0===c||c===t-1||h.blockStatic||e.item(c-1).blockStatic&&e.item(c+1).blockStatic)&&a++}return(r>0||l>0)&&(s===t||n===t||o===t&&1===i.size||a===t)}}return!1}processNode(e){let t=1;e.each(e=>{const i=qe.createDataAttribute(),s=e.css("listStyleType");if("list-item"===e.display||s&&s!==Ge.CSS.NONE||Ue(e)){if(e.has("listStyleImage"))i.imageSrc=e.css("listStyleImage");else if(i.ordinal=Xe.convertListStyle(s,t),""===i.ordinal)switch(s){case"disc":i.ordinal="●";break;case"square":i.ordinal="■";break;case"none":let t="",n="";e.visibleStyle.backgroundRepeat||(t=e.backgroundImage,n=e.css("backgroundPosition")),t&&t!==Ge.CSS.NONE&&(i.imageSrc=t,i.imagePosition=n,e.exclude(l.IMAGE_SOURCE));break;default:i.ordinal="○"}else i.ordinal+=".";t++}e.data(A.LIST,C.EXT_DATA,i)})}}const ze=squared.lib.constant,Ve=squared.lib.dom,$e=squared.lib.util;const je=squared.lib.css;const Ye=squared.lib.css;const Ke=squared.lib.constant,Ze=squared.lib.css,Qe=squared.lib.dom,Je=squared.lib.math,et=squared.lib.util,tt=/none|\s0px|rgba\(0, 0, 0, 0\)|transparent/,it=/rgba\(0, 0, 0, 0\)|transparent/,st=/^([\d.]+[a-z]+) ([a-z]+) (.+)$/;class nt extends W{static createDataAttribute(e){return{layoutType:0,rowCount:0,columnCount:0,layoutFixed:"fixed"===e.css("tableLayout"),borderCollapse:"collapse"===e.css("borderCollapse"),expand:!1}}processNode(e){const t=nt.createDataAttribute(e),i=[];function s(t){t.data(A.TABLE,"percent",`${Math.round(t.bounds.width/e.box.width*100)}%`),t.data(A.TABLE,"expand",!0)}function n(e){if(e.length){for(const t of e[0].cascade())"TH"!==t.tagName&&"TD"!==t.tagName||(t.inherit(e[0],"styleMap"),t.unsetCache("visibleStyle"));et.concatArray(i,e[0].children);for(const t of e)t.hide()}}const o=e=>e.css(Ke.CSS.WIDTH,Ze.formatPX(e.bounds.width),!0),a=[],r=[],l=[];e.each(e=>{switch(e.tagName){case"THEAD":a.push(e);break;case"TBODY":r.push(e);break;case"TFOOT":l.push(e)}}),n(a);for(const e of r)et.concatArray(i,e.children),e.hide();n(l);const[c,h]=t.borderCollapse?[0,0]:et.replaceMap(e.css("borderSpacing").split(" "),e=>parseFloat(e)),d=c>1?Math.round(c/2):c,u=h>1?Math.round(h/2):h,g=e.element.querySelector("COLGROUP"),f=[],p=[],m=[],b=[],S=i.length;let y=[].fill(0),T=0;for(let s=0;s<S;s++){const n=i[s];f[s]=c,m[s]=[],n.each((n,o)=>{const a=n.element;for(let e=0;e<a.rowSpan-1;e++){const t=s+e+1;void 0!==y[t]&&(y[t]+=a.colSpan)}if(!n.hasWidth){const t=Qe.getNamedItem(a,Ke.CSS.WIDTH);Ze.isPercent(t)?n.css(Ke.CSS.WIDTH,e.convertPX(t,Ke.CSS.WIDTH,!1)):et.isNumber(t)&&n.css(Ke.CSS.WIDTH,Ze.formatPX(t))}if(!n.hasHeight){const t=Qe.getNamedItem(a,Ke.CSS.HEIGHT);Ze.isPercent(t)?n.css(Ke.CSS.HEIGHT,e.convertPX(t,Ke.CSS.HEIGHT,!1)):et.isNumber(t)&&n.css(Ke.CSS.HEIGHT,Ze.formatPX(t))}if(!n.visibleStyle.backgroundImage&&!n.visibleStyle.backgroundColor)if(g){const e=Ze.getStyle(g.children[y[s]]);e.backgroundImage&&e.backgroundImage!==Ke.CSS.NONE&&n.css("backgroundImage",e.backgroundImage,!0),e.backgroundColor&&!it.test(e.backgroundColor)&&n.css("backgroundColor",e.backgroundColor,!0)}else{let e=Ze.getInheritedStyle(a,"backgroundImage",/none/,"TABLE");""!==e&&n.css("backgroundImage",e,!0),""!==(e=Ze.getInheritedStyle(a,"backgroundColor",it,"TABLE"))&&n.css("backgroundColor",e,!0)}switch(n.tagName){case"TH":{function r(e){const t=Ze.getInheritedStyle(a,e,tt,"TABLE");if(""!==t){const i=st.exec(t);i&&(n.css(`${e}Style`,i[2]),n.css(`${e}Color`,i[3]),n.css(`${e}Width`,i[1],!0),n.has("border")||n.css("border","inherit"))}}n.cssInitial("textAlign")||n.css("textAlign",n.css("textAlign")),0===n.borderTopWidth&&r("borderTop"),0===n.borderRightWidth&&r("borderRight"),0===n.borderBottomWidth&&r("borderBottom"),0===n.borderLeftWidth&&r("borderLeft")}case"TD":n.cssInitial("verticalAlign")||n.css("verticalAlign",Ke.CSS.MIDDLE,!0)}const l=n.cssInitial(Ke.CSS.WIDTH),m=y[s],S=void 0===b[m]||b[m]===Ke.CSS.AUTO;if(0===s||S||!t.layoutFixed)if(""===l||l===Ke.CSS.AUTO)void 0===b[m]?(b[m]=l||Ke.CSS.PX_0,p[m]=0):s===i.length-1&&S&&0===p[m]&&(p[m]=n.bounds.width);else{const e=Ze.isLength(b[m]),t=Ze.isPercent(l);(S||n.bounds.width<p[m]||n.bounds.width===p[m]&&(e&&t||t&&Ze.isPercent(b[m])&&et.convertFloat(l)>et.convertFloat(b[m])||e&&Ze.isLength(l)&&et.convertFloat(l)>et.convertFloat(b[m])))&&(b[m]=l),(S||1===a.colSpan)&&(p[m]=n.bounds.width)}(n.length||n.inlineText)&&(f[s]+=n.bounds.width+c),d>0&&(n.modifyBox(16,0===y[s]?c:d),n.modifyBox(4,0===o?d:c)),u>0&&(n.modifyBox(2,0===s?h:u),n.modifyBox(8,s+a.rowSpan<i.length?u:h)),y[s]+=a.colSpan}),T=Math.max(T,y[s])}if(e.has(Ke.CSS.WIDTH,2)&&b.some(e=>Ze.isPercent(e))&&et.replaceMap(b,(e,t)=>e===Ke.CSS.AUTO&&p[t]>0?Ze.formatPX(p[t]):e),b.every(e=>Ze.isPercent(e))&&b.reduce((e,t)=>e+parseFloat(t),0)>1){let e=100;et.replaceMap(b,t=>{const i=parseFloat(t);return e<=0?t=Ke.CSS.PX_0:e-i<0&&(t=Ze.formatPercent(e/100)),e-=i,t})}else if(b.every(e=>Ze.isLength(e))){const i=b.reduce((e,t)=>e+parseFloat(t),0);if(e.hasWidth)if(i<e.width)et.replaceMap(b,e=>e!==Ke.CSS.PX_0?`${parseFloat(e)/i*100}%`:e);else if(i>e.width&&(e.css(Ke.CSS.WIDTH,Ke.CSS.AUTO,!0),!t.layoutFixed))for(const t of e.cascade())t.css(Ke.CSS.WIDTH,Ke.CSS.AUTO,!0);t.layoutFixed&&!e.has(Ke.CSS.WIDTH)&&e.css(Ke.CSS.WIDTH,Ze.formatPX(e.bounds.width),!0)}const x=b.reduce((e,t)=>e+(Ze.isPercent(t)?parseFloat(t):0),0);t.layoutType=(()=>{if(t.layoutFixed&&b.reduce((e,t)=>e+(Ze.isLength(t)?parseFloat(t):0),0)>=e.actualWidth)return 4;if(b.some(e=>Ze.isPercent(e))||b.every(e=>Ze.isLength(e)&&e!==Ke.CSS.PX_0))return 3;if(b.every(e=>e===b[0])){if(e.cascadeSome(e=>e.hasHeight))return t.expand=!0,3;if(b[0]===Ke.CSS.AUTO){if(e.hasWidth)return 3;{const t=e.cascade(e=>"TD"===e.tagName);return t.length&&t.every(e=>et.withinRange(e.bounds.width,t[0].bounds.width))?0:3}}if(e.hasWidth)return 2}return b.every(e=>e===Ke.CSS.AUTO||Ze.isLength(e)&&e!==Ke.CSS.PX_0)?(e.hasWidth||(t.expand=!0),1):0})();const _=e.find(e=>"CAPTION"===e.tagName);e.clear(),_&&(_.hasWidth||(_.textElement?_.has("maxWidth")||_.css("maxWidth",Ze.formatPX(_.bounds.width)):_.bounds.width>Je.maxArray(f)&&o(_)),_.cssInitial("textAlign")||_.css("textAlign",Ke.CSS.CENTER),_.data(A.TABLE,"colSpan",T),_.parent=e),y=[].fill(0);const E=e.hasWidth;for(let n=0;n<i.length;n++){const a=i[n],r=a.duplicate();for(let i=0;i<r.length;i++){const a=r[i],l=a.element,c=l.rowSpan,h=l.colSpan;for(let e=0;e<c-1;e++){const t=n+1+e;void 0!==y[t]&&(y[t]+=h)}c>1&&a.data(A.TABLE,"rowSpan",c),h>1&&a.data(A.TABLE,"colSpan",h),a.has("verticalAlign")||a.css("verticalAlign",Ke.CSS.MIDDLE);const d=b[y[n]];if(void 0!==d)switch(t.layoutType){case 3:d===Ke.CSS.AUTO?x>=1?(o(a),a.data(A.TABLE,"exceed",!E),a.data(A.TABLE,"downsized",!0)):s(a):Ze.isPercent(d)?(a.data(A.TABLE,"percent",d),a.data(A.TABLE,"expand",!0)):Ze.isLength(d)&&parseInt(d)>0?a.bounds.width>=parseInt(d)?(o(a),a.data(A.TABLE,"expand",!1),a.data(A.TABLE,"downsized",!1)):t.layoutFixed?(s(a),a.data(A.TABLE,"downsized",!0)):(o(a),a.data(A.TABLE,"expand",!1)):(a.has(Ke.CSS.WIDTH)&&!a.has(Ke.CSS.WIDTH,32)||o(a),a.data(A.TABLE,"expand",!1));break;case 2:a.css(Ke.CSS.WIDTH,Ke.CSS.PX_0);break;case 1:d===Ke.CSS.AUTO?a.css(Ke.CSS.WIDTH,Ke.CSS.PX_0):(t.layoutFixed?a.data(A.TABLE,"downsized",!0):o(a),a.data(A.TABLE,"expand",!1));break;case 4:Ze.isLength(d)||a.hide()}y[n]+=h;for(let e=0;e<c;e++)for(let t=0;t<h;t++)m[n+e].push(a);a.parent=e}if(y[n]<T){r[r.length-1].data(A.TABLE,"spaceSpan",T-y[n])}a.hide()}if(t.borderCollapse){const t=e.css("borderTopColor"),i=e.css("borderTopStyle"),s=e.css("borderTopWidth"),n=e.css("borderRightColor"),o=e.css("borderRightStyle"),a=e.css("borderRightWidth"),r=e.css("borderBottomColor"),l=e.css("borderBottomStyle"),c=e.css("borderBottomWidth"),h=e.css("borderLeftColor"),d=e.css("borderLeftStyle"),u=e.css("borderLeftWidth");let g=!1,f=!1,p=!1,b=!1;for(let e=0;e<S;e++)for(let y=0;y<T;y++){const x=m[e][y];if(x&&"visible"===x.css("visibility")){if(0===e&&(x.borderTopWidth<parseInt(s)?x.cssApply({borderTopColor:t,borderTopStyle:i,borderTopWidth:s}):g=!0),e>=0&&e<S-1){const t=m[e+1][y];t&&t!==x&&"visible"===t.css("visibility")&&(x.borderBottomWidth>=t.borderTopWidth?t.css("borderTopWidth",Ke.CSS.PX_0,!0):x.css("borderBottomWidth",Ke.CSS.PX_0,!0))}if(e===S-1&&(x.borderBottomWidth<parseInt(c)?x.cssApply({borderBottomColor:r,borderBottomStyle:l,borderBottomWidth:c}):p=!0),0===y&&(x.borderLeftWidth<parseInt(u)?x.cssApply({borderLeftColor:h,borderLeftStyle:d,borderLeftWidth:u}):b=!0),y>=0&&y<T-1){const t=m[e][y+1];t&&t!==x&&"visible"===t.css("visibility")&&(x.borderRightWidth>=t.borderLeftWidth?t.css("borderLeftWidth",Ke.CSS.PX_0,!0):x.css("borderRightWidth",Ke.CSS.PX_0,!0))}y===T-1&&(x.borderRightWidth<parseInt(a)?x.cssApply({borderRightColor:n,borderRightStyle:o,borderRightWidth:a}):f=!0)}}(g||f||p||b)&&e.cssApply({borderTopWidth:Ke.CSS.PX_0,borderRightWidth:Ke.CSS.PX_0,borderBottomWidth:Ke.CSS.PX_0,borderLeftWidth:Ke.CSS.PX_0},!0)}t.rowCount=S,t.columnCount=T,e.data(A.TABLE,C.EXT_DATA,t)}}const ot=squared.lib.constant,at=squared.lib.css,rt=squared.lib.util;const lt=squared.lib.constant,ct=squared.lib.css,ht=squared.lib.session,dt=squared.lib.util,ut=null!==document.doctype&&"html"===document.doctype.name;function gt(e,t){const i=e.has("minHeight",2)?e.toFloat("minHeight"):0;e.css("minHeight",ct.formatPX(Math.max(t,i)))}function ft(e){return!!e&&((e.blockStatic||"table"===e.display)&&!e.lineBreak)}function pt(e,t){const i=e[E.get(t)];let s=!1;if(0===e.getBox(t)[0])e.modifyBox(t),s=!0;else for(const n of e.ascendOuter())if(n.getBox(t)[1]>=i){n.modifyBox(t,-i),s=!0;break}e.companion&&s&&e.companion.modifyBox(t,-i,!1)}function mt(e,t,i){if(ft(t)){let s,n,o,a;if(i?(s="marginTop",n="borderTopWidth",o="paddingTop",a=2):(o="paddingBottom",n="borderBottomWidth",s="marginBottom",a=8),0===e[n])if(0===e[o]){for(;ut&&0===t[s]&&0===t[n]&&0===t[o];){const e=i?t.firstChild:t.lastChild;if(!ft(e))break;t=e}let r=!1;if(!ut&&0===e[s]&&t[s]>0&&""===t.cssInitial(s))r=!0;else{const n=e[s]>=t[s];0===t.bounds.height&&n&&t.textElement&&""===t.textContent&&0===t.extensions.length?t.hide():1!==t.getBox(a)[0]&&(e.documentBody?n?r=!0:(pt(e,a),i&&(e.bounds.top=0,e.unsafe("box",!0),e.unsafe("linear",!0))):(n||1===e.getBox(a)[0]||(e.modifyBox(a),e.modifyBox(a,t[s])),r=!0))}r&&(pt(t,a),0===t.bounds.height&&pt(t,i?8:2))}else if(0===t[s]&&0===t[n]){let a=!0;for(;;){const r=i?t.firstChild:t.lastChild;if(!r||0!==r[s]||0!==r[n])break;if(r[o]>0){r[o]>=e[o]?e.modifyBox(i?32:128):a&&e.modifyBox(i?32:128,-r[o]);break}ft(r)||(a=!1),t=r}}}}const bt={Accessibility:class extends W{constructor(){super(...arguments),this.options={showLabel:!1}}afterInit(){for(const e of this.application.processing.cache)if(e.hasProcedure(c.ACCESSIBILITY))switch(e.tagName){case"INPUT_IMAGE":e.extracted=[e];break;case"INPUT_RADIO":case"INPUT_CHECKBOX":const t=e.element;[e.nextSibling,e.previousSibling].some(i=>{if(i&&i.visible&&i.pageFlow&&!i.visibleStyle.backgroundImage){const s=i.element,n="LABEL"===i.documentParent.tagName?i.documentParent:void 0;if(t.id&&t.id===s.htmlFor?e.companion=i:i.textElement&&n?(e.companion=i,n.renderAs=e):i.plainText&&(e.companion=i),e.companion)return this.options.showLabel||i.hide(),!0}return!1});break;case"BUTTON":if(e.length){const t=e.filter(e=>!e.textElement);t.length&&(e.extracted=t),e.clear()}}}},CssGrid:ke,External:class extends W{beforeInit(e,t=!1){if((t||this.included(e))&&!Pe.getElementCache(e,"squaredExternalDisplay",this.application.processing.sessionId)){const t=[];let i=e;for(;i;)t.push(Be.getStyle(i).getPropertyValue("display")),i.style.setProperty("display","block"),i=i.parentElement;Pe.setElementCache(e,"squaredExternalDisplay",this.application.processing.sessionId,t)}}init(e){return this.included(e)&&this.application.rootElements.add(e),!1}afterInit(e,t=!1){if(t||this.included(e)){const t=Pe.getElementCache(e,"squaredExternalDisplay",this.application.processing.sessionId);if(Array.isArray(t)){let i=e,s=0;for(;i;)i.style.setProperty("display",t[s]),i=i.parentElement,s++;Pe.deleteElementCache(e,"squaredExternalDisplay",this.application.processing.sessionId)}}}},Flexbox:Oe,Grid:De,List:qe,Relative:class extends W{condition(e){return e.positionRelative||0!==e.toFloat("verticalAlign",!0)}processNode(){return{include:!0}}postOptimize(e){const t=e.renderParent;if(t){const i=$e.convertFloat(e.verticalAlign);let s=e,n=e.top,o=e.right,r=e.bottom,l=e.left;if(t.support.container.positionRelative&&t.layoutHorizontal&&0===e.renderChildren.length&&(0!==e.top||0!==e.bottom||0!==i)){(s=e.clone(this.application.nextId,!0,!0)).baselineAltered=!0,e.hide(!0),this.application.session.cache.append(s,!1);const i=new a(t,s,s.containerType,s.alignmentType),n=t.renderChildren.findIndex(t=>t===e);if(-1!==n&&(i.renderIndex=n+1),this.application.addLayout(i),t.layoutHorizontal&&e.documentParent.toInt("textIndent")<0&&t.renderEach(t=>{t.alignSibling(C.TOP_BOTTOM)===e.documentId?t.alignSibling(C.TOP_BOTTOM,s.documentId):t.alignSibling(C.BOTTOM_TOP)===e.documentId&&t.alignSibling(C.BOTTOM_TOP,s.documentId)}),e.baselineActive&&!e.baselineAltered)for(const i of t.horizontalRows||[t.renderChildren])if(i.includes(e)){const t=$e.filterArray(i,t=>t.positionRelative&&t.length>0&&0!==$e.convertFloat(e.verticalAlign));if(t.length){t.sort((e,t)=>$e.withinRange(e.linear.top,t.linear.top)?0:e.linear.top<t.linear.top?-1:1);for(let i=0;i<t.length;i++){const s=t[i];0===i?e.modifyBox(2,$e.convertFloat(s.verticalAlign)):s.modifyBox(2,s.linear.top-t[0].linear.top),s.css("verticalAlign",ze.CSS.PX_0,!0)}}break}}else if(e.naturalElement&&e.positionRelative){const i=e.actualParent;if(i){let s=!1;for(const a of i.actualChildren){if(a===e){if(s){if(t.layoutVertical&&(0!==e.top||0!==e.bottom)){const t=Ve.assignRect(e.element.getBoundingClientRect(),!0);0!==n&&(n-=t.top-e.bounds.top),0!==r&&(r+=t.bottom-e.bounds.bottom)}if(t.layoutHorizontal&&(0!==e.left||0!==e.right)&&""===e.alignSibling(C.LEFT_RIGHT)){const t=Ve.assignRect(e.element.getBoundingClientRect(),!0);0!==l&&(l-=t.left-e.bounds.left),0!==o&&(o+=t.right-e.bounds.right)}}else t.layoutVertical&&0!==r&&1===a.getBox(2)[0]&&(r-=a.marginTop);break}a.positionRelative&&a.renderParent===t&&(s=!0)}}}0!==n?s.modifyBox(2,n):0!==r&&s.modifyBox(2,-1*r),0!==i&&s.modifyBox(2,-1*i),0!==l?s.autoMargin.left?s.modifyBox(4,-1*l):s.modifyBox(16,l):0!==o&&s.modifyBox(16,-1*o)}}},Sprite:class extends W{condition(e){let t=!1;if(e.hasWidth&&e.hasHeight&&0===e.length&&""!==e.backgroundImage&&(this.included(e.element)||!e.dataset.use)){const i=this.application.resourceHandler.getRawData(e.backgroundImage)||this.application.resourceHandler.getImage(je.resolveURL(e.backgroundImage));if(i){const s=e.actualDimension,n=je.getBackgroundPosition(`${e.css("backgroundPositionX")} ${e.css("backgroundPositionY")}`,s,e.fontSize);n.left<=0&&n.top<=0&&i.width>s.width&&i.height>s.height&&(e.data(A.SPRITE,C.EXT_DATA,{image:i,position:n}),t=!0)}}return t}},Substitute:class extends W{constructor(e,t,i,s){super(e,t,i,s),this.require(A.EXTERNAL,!0)}processNode(e,t){const i=Ye.getDataSet(e.element,this.name);if(i.tagChild&&e.each(e=>{e.styleElement&&(e.dataset.use=this.name,e.dataset.squaredSubstituteTag=i.tagChild)}),i.tag)return e.setControlType(i.tag),e.render(t),{output:{type:1,node:e,controlName:i.tag}}}},Table:nt,VerticalAlign:class extends W{condition(e){let t=!1,i=0,s=0;for(const n of e)n.inlineVertical&&(s++,0!==rt.convertInt(n.verticalAlign)&&(t=!0)),(n.positionStatic||n.positionRelative&&n.length)&&i++;return t&&s>1&&i===e.length&&n.linearData(e.children).linearX}processNode(e){return e.each(e=>{(e.inlineVertical&&!e.baseline||e.imageElement)&&(e.baselineAltered=!0)}),{include:!0}}postConstraints(e){if(e.layoutHorizontal)for(const t of e.horizontalRows||[e.renderChildren]){const e=[];let i,s=1/0;for(const n of t)n.inlineVertical&&n.linear.top<=s&&(n.linear.top<s&&(e.length=0),e.push(n),s=n.linear.top),n.baselineActive&&(i=n);if(e.length){const s=e[0].linear.top;for(const n of t)if(n!==i){if(n.inlineVertical&&!n.baseline&&!e.includes(n)){let e=!1;switch(n.verticalAlign){case"super":case"sub":e=!0;break;default:(at.isLength(n.verticalAlign)||void 0===i)&&(e=!0)}e&&n.modifyBox(2,n.linear.top-s)}n.baselineAltered&&n.css("verticalAlign",ot.CSS.PX_0,!0)}i&&(i.modifyBox(2,i.linear.top-s),i.baselineAltered=!0)}}else e.each(e=>e.baselineAltered=!1)}},WhiteSpace:class extends W{afterBaseLayout(){const e=new Set;for(const t of this.application.processing.cache)if(t.naturalElement&&!t.layoutElement&&t.actualChildren.length){const i=t.actualChildren;let s,n;for(let o=0;o<i.length;o++){const a=i[o];if(a.pageFlow&&(t.blockStatic&&(a.floating?n=void 0:(void 0===s&&(s=a),n=a)),0!==o&&ft(a))){const t=a.previousSiblings({floating:!1});if(t.length){const i=t.find(e=>!e.floating);if(i)if(ft(i)){let t=!1,s=!1,n=dt.convertFloat(i.cssInitial("marginBottom",!1,!0));0===n&&i.marginBottom>0&&(n=i.marginBottom,t=!0);let o=dt.convertFloat(a.cssInitial("marginTop",!1,!0));if(0===o&&a.marginTop>0&&(o=i.marginTop,s=!0),i.excluded&&!a.excluded){const t=Math.min(n,i.marginTop);if(t<0){const s=Math.abs(t)>=o?void 0:t;a.modifyBox(2,s),a.companion&&a.companion.modifyBox(2,s),e.add(i)}}else if(!i.excluded&&a.excluded){const t=Math.min(o,dt.convertFloat(a.cssInitial("marginBottom",!1,!0)));t<0&&(i.modifyBox(8,Math.abs(t)>=n?void 0:t),e.add(a))}else{if(0===i.paddingBottom&&0===i.borderBottomWidth){const e=i.lastChild;if(ft(e)&&1!==e.getBox(8)[0]){const s=dt.convertFloat(e.cssInitial("marginBottom",!1,!0));s>n&&(n=s,i.css("marginBottom",ct.formatPX(s),!0),t=!0),pt(e,8)}}if(0===a.borderTopWidth&&0===a.paddingTop){const e=a.firstChild;if(ft(e)&&1!==e.getBox(2)[0]){const t=dt.convertFloat(e.cssInitial("marginTop",!1,!0));t>o&&(o=t,a.css("marginTop",ct.formatPX(t),!0),s=!0),pt(e,2)}}n>0&&(o>0?s&&t&&(dt.hasBit(a.overflow,64)||dt.hasBit(i.overflow,64))||(o<=n?s?a.css("marginTop",lt.CSS.PX_0,!0):pt(a,2):t?a.css("marginBottom",lt.CSS.PX_0,!0):pt(i,8)):0===i.bounds.height&&pt(i,8))}}else if(i.blockDimension&&!i.block&&0===a.length){const e=a.linear.top-i.linear.bottom;Math.floor(e)>0&&0===a.ascend(!1,e=>e.has(lt.CSS.HEIGHT)).length&&a.modifyBox(2,e)}}}}if(!dt.hasBit(t.overflow,64)&&(s&&mt(t,s,!0),n&&(mt(t,n,!1),n.marginTop<0))){const e=n.bounds.height+n.marginBottom+n.marginTop;e<0&&t.modifyBox(128,e,!1)}}for(const t of this.application.processing.excluded)if(!e.has(t)&&t.lineBreak&&!t.lineBreakTrailing){const i=t.previousSiblings({floating:!1}),s=t.nextSiblings({floating:!1});let n=!1;if(i.length&&s.length){let o=i.pop();const a=s.pop();if(o.inlineStatic&&a.inlineStatic){if(0===i.length){e.add(t);continue}{const e=i.pop();e.lineBreak&&(e.setBounds(),e.linear.bottom>o.linear.bottom&&(o=e))}}let r;if(a.lineHeight>0&&a.element&&a.cssTry("lineHeight","normal")?(r=ht.getClientRect(a.element,a.sessionId).top-a.marginTop,a.cssFinally("lineHeight")):r=a.linear.top,o.lineHeight>0&&o.element&&o.cssTry("lineHeight","normal")?(r-=ht.getClientRect(o.element,o.sessionId).bottom+o.marginBottom,o.cssFinally("lineHeight")):r-=o.linear.bottom,n=!0,0!==r){const e=o.visible&&o.renderParent,i=a.visible&&a.renderParent;if(i&&i.groupParent&&i.firstChild===a)i.modifyBox(2,r);else if(e&&e.groupParent&&e.lastChild===o)e.modifyBox(8,r);else if(i&&i.layoutVertical&&a.visible)a.modifyBox(2,r);else if(e&&e.layoutVertical&&o.visible)o.modifyBox(8,r);else{const s=t.actualParent;!i&&!e&&s&&s.visible?a.lineBreak||a.excluded?s.modifyBox(128,r):o.lineBreak||o.excluded?s.modifyBox(32,r):n=!1:n=!1}}}else{const e=t.actualParent;if(e&&e.visible){if(!e.documentRoot&&0===e.ascendOuter(e=>e.documentRoot).length&&i.length){const t=i[i.length-1],s=e.box.bottom-t.linear[t.lineBreak||t.excluded?lt.CSS.TOP:lt.CSS.BOTTOM];0!==s&&(t.rendered||e.visibleStyle.background?e.modifyBox(128,s):e.hasHeight||gt(e,s))}else if(s.length){const t=s[s.length-1],i=t.linear[t.lineBreak||t.excluded?lt.CSS.BOTTOM:lt.CSS.TOP]-e.box.top;0!==i&&(t.rendered||e.visibleStyle.background?e.modifyBox(32,i):e.hasHeight||gt(e,i))}n=!0}}if(n){for(const t of i)e.add(t);for(const t of s)e.add(t)}}}afterConstraints(){const e=[];for(const i of this.application.processing.cache){const s=i.renderAs?i.renderAs.renderParent:i.renderParent;if(s&&i.pageFlow&&i.styleElement&&i.inlineVertical&&!i.positioned&&!i.documentParent.layoutElement&&!s.tableElement&&!e.includes(i.id)){function t(t,s){let n=0;switch(t){case 16:n=i.actualRect(lt.CSS.LEFT)-s;break;case 2:n=i.actualRect(lt.CSS.TOP)-s;break;case 8:n=s-i.actualRect(lt.CSS.BOTTOM)}n>0&&((i.outerWrapper||i).modifyBox(t,n),e.push(i.id))}if(s.layoutVertical){if(i.blockDimension){const e=s.renderChildren.findIndex(e=>e===i);if(-1!==e){if(!i.lineBreakLeading){const i=s.renderChildren[e-1];i&&t(2,i.linear.bottom)}if(!i.lineBreakTrailing){const i=s.renderChildren[e+1];i&&t(8,i.linear.top)}}}}else if(i.alignParent(lt.CSS.LEFT)){if(s.horizontalRows&&i.blockDimension&&!i.floating)e:{let e=0;for(let n=0;n<s.horizontalRows.length;n++){const o=s.horizontalRows[n];for(let s=0;s<o.length;s++)if(i===o[s]){n>0&&t(2,e);break e}let a=!1;for(const t of o)t.blockDimension&&!t.floating&&t.linear.bottom>e&&(e=t.linear.bottom,a=!0);if(!a)break}}}else{let e=i;for(;;){const i=e.previousSiblings();if(i.length&&!i.some(e=>e.lineBreak||e.excluded&&e.blockStatic)){const s=i.pop();if(s.inlineVertical)t(16,s.actualRect(lt.CSS.RIGHT));else if(s.floating){e=s;continue}}break}}}}}}},St={constant:I,enumeration:h};e.Application=class{constructor(e,t,i,s,o){this.framework=e,this.initialized=!1,this.closed=!1,this.builtInExtensions={},this.extensions=[],this.rootElements=new Set,this.session={cache:new n,documentRoot:[],targetQueue:new Map,excluded:new n,active:[],extensionMap:new Map},this.processing={cache:new n,node:void 0,excluded:new n,sessionId:""},this._layouts=[],T=t,this.controllerHandler=new i(this,this.processing.cache),this.resourceHandler=new s(this,this.processing.cache),this.extensionManager=new o(this,this.processing.cache)}registerController(e){e.application=this,e.cache=this.processing.cache,this.controllerHandler=e}registerResource(e){e.application=this,e.cache=this.processing.cache,this.resourceHandler=e}finalize(){const e=this.controllerHandler;for(const[e,t]of this.session.targetQueue.entries())if(e.dataset.target){const i=this.resolveTarget(e.dataset.target);i?(e.render(i),this.addLayoutTemplate(i,e,t)):void 0===e.renderParent&&this.session.cache.remove(e)}const t=this.rendered;for(const e of t)e.hasProcedure(c.LAYOUT)&&e.setLayout(),e.hasProcedure(c.ALIGNMENT)&&e.setAlignment();e.optimize(t);for(const e of this.extensions)for(const t of e.subscribers)e.postOptimize(t);for(const e of this.rendered)e.hasResource(l.BOX_SPACING)&&e.setBoxSpacing();for(const e of this.extensions){for(const t of e.subscribers)e.postBoxSpacing(t);e.beforeCascade()}for(const t of this.session.documentRoot){const i=t.node;if(i.documentRoot&&0===i.renderChildren.length&&!i.inlineText&&i.actualChildren.every(e=>e.documentRoot))continue;const s=i.renderParent;s&&s.renderTemplates&&this.saveDocument(t.layoutName,e.localSettings.layout.baseTemplate+e.cascadeDocument(s.renderTemplates,0),i.dataset.pathname,i.renderExtension&&i.renderExtension.some(e=>e.documentBase)?0:void 0)}this.resourceHandler.finalize(this._layouts),e.finalize(this._layouts);for(const e of this.extensions)e.afterFinalize();g.removeElementsByClassName("__squared.placeholder"),g.removeElementsByClassName("__squared.pseudo"),this.closed=!0}saveAllToDisk(){this.resourceHandler.fileHandler&&this.resourceHandler.fileHandler.saveAllToDisk(this.layouts)}reset(){for(const e of this.session.active)this.session.cache.each(t=>{if(t.naturalElement&&!t.pseudoElement){const i=t.element;p.deleteElementCache(i,"node",e),p.deleteElementCache(i,"styleMap",e)}});for(const e of this.rootElements)e.dataset.iteration="";this.session.documentRoot.length=0,this.session.active.length=0,this.session.targetQueue.clear(),this.session.cache.reset(),this.session.excluded.reset(),this.session.extensionMap.clear(),this.processing.cache.reset(),this.controllerHandler.reset(),this.resourceHandler.reset(),this._layouts.length=0;for(const e of this.extensions)e.subscribers.clear();this.closed=!1}parseDocument(...e){let t;this.rootElements.clear(),this.initialized=!1,this.processing.sessionId=this.controllerHandler.generateSessionId,this.session.active.push(this.processing.sessionId),this.setStyleMap(),0===e.length&&e.push(document.body);for(const t of e){const e="string"==typeof t?document.getElementById(t):t;u.hasComputedStyle(e)&&this.rootElements.add(e)}const i=this.resourceHandler.assets,s=this.rootElements.values().next().value,n=[],o=()=>{this.initialized=!1;for(const e of n)e.parentElement&&s.removeChild(e);n.length=0;for(const e of this.extensions)e.beforeParseDocument();for(const e of this.rootElements){const t=(e.dataset.iteration?m.convertInt(e.dataset.iteration):-1)+1;if(e.dataset.iteration=""+t,this.createCache(e)){const i=e.dataset.filename&&e.dataset.filename.replace(RegExp(`.${this.controllerHandler.localSettings.layout.fileExtension}$`),"")||e.id||`document_${this.length}`;e.dataset.layoutName=m.convertWord(t>1?`${i}_${t}`:i,!0),this.setBaseLayout(e.dataset.layoutName),this.setConstraints(),this.setResources()}}for(const e of this.extensions){for(const t of e.subscribers)e.postParseDocument(t);e.afterParseDocument()}"function"==typeof t&&t.call(this)},a=[];if(this.userSettings.preloadImages){for(const e of this.rootElements)e.querySelectorAll("input[type=image]").forEach(e=>{const t=e.src;""!==t&&i.images.set(t,{width:e.width,height:e.height,uri:t})}),e.querySelectorAll("svg image").forEach(e=>{const t=m.resolvePath(e.href.baseVal);""!==t&&i.images.set(t,{width:e.width.baseVal.value,height:e.height.baseVal.value,uri:t})});for(const e of i.images.values())if(e.uri)if(e.uri.toLowerCase().endsWith(".svg"))a.push(e.uri);else if(0===e.width&&0===e.height){const t=document.createElement("img");t.src=e.uri,t.complete&&t.naturalWidth>0&&t.naturalHeight>0?(e.width=t.naturalWidth,e.height=t.naturalHeight):(s.appendChild(t),n.push(t))}}for(const[e,t]of i.rawData.entries())if(t.mimeType&&t.mimeType.startsWith("image/")&&!t.mimeType.endsWith("svg+xml")){const s=document.createElement("img");s.src=t.base64?`data:${t.mimeType};base64,${t.base64}`:`data:${t.mimeType};${t.content}`,s.complete&&s.naturalWidth>0&&s.naturalHeight>0&&(t.width=s.naturalWidth,t.height=s.naturalHeight,i.images.set(e,{width:t.width,height:t.height,uri:t.filename}))}for(const e of this.rootElements)e.querySelectorAll("img").forEach(e=>{if("IMG"===e.tagName)if(e.src.toLowerCase().endsWith(".svg"))this.userSettings.preloadImages&&a.push(e.src);else if(e.complete)if(e.src.startsWith("data:image/")){void 0===y.DATAURI&&(y.DATAURI=RegExp(`^${S}$`));const t=y.DATAURI.exec(e.src);t&&t[1]&&t[2]&&this.resourceHandler.addRawData(e.src,t[1],t[2],t[3],e.naturalWidth,e.naturalHeight)}else this.resourceHandler.addImage(e);else this.userSettings.preloadImages&&a.push(e)});return a.length?(this.initialized=!0,Promise.all(m.objectMap(a,e=>new Promise((t,i)=>{"string"==typeof e?t(function(e){return __awaiter(this,void 0,void 0,function*(){const t=yield fetch(e,{method:"GET",headers:new Headers({Accept:"application/xhtml+xml, image/svg+xml","Content-Type":"image/svg+xml"})});return yield t.text()})}(e)):(e.onload=(()=>{t(e)}),e.onerror=(()=>{i(e)}))}))).then(e=>{for(let t=0;t<e.length;t++){const i=e[t];"string"==typeof i?"string"==typeof a[t]&&this.resourceHandler.addRawData(a[t],"image/svg+xml","utf8",i):this.resourceHandler.addImage(i)}o()}).catch(e=>{const t=e.target?e.target.src:e.message;this.userSettings.showErrorMessages&&m.isString(t)&&!confirm(`FAIL: ${t}`)||o()})):o(),{then:e=>{this.initialized?t=e:e()}}}saveDocument(e,t,i,s){if(m.isString(t)){const n={pathname:i?m.trimString(i,"/"):this.controllerHandler.localSettings.layout.pathName,filename:e,content:t,index:s};void 0!==s&&s>=0&&s<this._layouts.length?this._layouts.splice(s,0,n):this._layouts.push(n)}}renderNode(e){return 0===e.itemCount?this.controllerHandler.renderNode(e):this.controllerHandler.renderNodeGroup(e)}addLayout(e){if(m.hasBit(e.renderType,512)&&(m.hasBit(e.renderType,8)?e=this.processFloatHorizontal(e):m.hasBit(e.renderType,16)&&(e=this.processFloatVertical(e))),0!==e.containerType){const t=this.renderNode(e);if(t)return this.addLayoutTemplate(t.parent||e.parent,e.node,t,e.renderIndex)}return!1}addLayoutTemplate(e,t,i,s=-1){return!!i&&(t.renderExclude?(t.hide(),t.excluded=!0):t.renderParent?(void 0===e.renderTemplates&&(e.renderTemplates=[]),s>=0&&s<e.renderChildren.length?(e.renderChildren.splice(s,0,t),e.renderTemplates.splice(s,0,i)):(e.renderChildren.push(t),e.renderTemplates.push(i))):this.session.targetQueue.set(t,i),!0)}createNode(e,t=!0,i,s){const n=new T(this.nextId,this.processing.sessionId,e,this.controllerHandler.afterInsertNode);if(i&&(n.depth=i.depth+1),s)for(const e of s)e.parent=n;return t&&this.processing.cache.append(n,void 0!==s),n}resolveTarget(e){for(const t of this.processing.cache)if(t.elementId===e||t.controlId===e)return t;for(const t of this.session.cache)if(t.elementId===e||t.controlId===e)return t}toString(){return this._layouts.length?this._layouts[0].content:""}createCache(e){this.processing.node=void 0,this.processing.cache.afterAppend=void 0,this.processing.cache.clear(),this.processing.excluded.clear();for(const t of this.extensions)t.beforeInit(e);const t=this.cascadeParentNode(e);if(!t)return!1;t.parent=new T(0,this.processing.sessionId,e.parentElement||document.body,this.controllerHandler.afterInsertNode),t.siblingIndex=0,t.documentRoot=!0,t.documentParent=t.parent,this.processing.node=t;const i={},s=new Set;function n(e,t,s,n,o){void 0===i[t]&&(i[t]={}),i[t][s]=o,e.style[s]=n}let o=!1;const a=this.processing.cache;for(const e of a)if(e.styleElement){const t=e.element;if(e.length){const i=e.cssInitial("textAlign");switch(i){case d.CSS.CENTER:case d.CSS.RIGHT:case d.CSS.END:n(t,e.id,"textAlign",d.CSS.LEFT,i)}}if(e.positionRelative)for(const i of u.BOX_POSITION)e.has(i)&&(n(t,e.id,i,d.CSS.AUTO,e.css(i)),o=!0);"rtl"===e.dir&&(t.dir="ltr",s.add(t))}const r=new Set;t.parent.setBounds();for(const e of a)e.pseudoElement?r.add(e.parent):e.setBounds(!o&&void 0===i[e.id]&&0===s.size);for(const e of r)[e.innerBefore,e.innerAfter].forEach((t,i)=>{if(t){const s=e.element,n=s.id;let o;t.pageFlow&&(s.id=`id_${Math.round(Math.random()*(new Date).getTime())}`,o=u.insertStyleSheetRule(`#${s.id}::${0===i?"before":"after"} { display: none !important; }`)),t.cssTry("display",t.display)&&(t.setBounds(!1),t.cssFinally("display")),o&&document.head.removeChild(o),s.id=n}});for(const e of this.processing.excluded)e.lineBreak||(e.setBounds(),e.saveAsInitial());for(const e of a){if(e.styleElement){const t=e.element,n=i[e.id];if(n)for(const e in n)t.style[e]=n[e];s.has(t)&&(t.dir="rtl")}e.saveAsInitial()}this.controllerHandler.evaluateNonStatic(t,a),a.sort((e,t)=>e.depth!==t.depth?e.depth<t.depth?-1:1:e.documentParent!==t.documentParent?e.documentParent.siblingIndex<t.documentParent.siblingIndex?-1:1:e.siblingIndex<t.siblingIndex?-1:1);for(const t of this.extensions)t.afterInit(e);return!0}cascadeParentNode(e,t=0){const i=this.insertNode(e);if(i){switch(i.depth=t,0===t&&this.processing.cache.append(i),i.tagName){case"SELECT":case"SVG":return i}const s=this.createPseduoElement(e,"before"),n=this.createPseduoElement(e,"after"),o=[];let a=!1;for(let r=0;r<e.childNodes.length;r++){const l=e.childNodes[r];if(l===s){const e=this.insertNode(s);e&&(i.innerBefore=e,e.setInlineText(!0),o.push(e),a=!0)}else if(l===n){const e=this.insertNode(n);e&&(i.innerAfter=e,e.setInlineText(!0),o.push(e),a=!0)}else if("#"===l.nodeName.charAt(0)){if("#text"===l.nodeName){const e=this.insertNode(l,i);e&&o.push(e)}}else if(this.controllerHandler.includeElement(l))if(x(l,this.extensions).some(e=>e.init(l)),this.rootElements.has(l)){const e=this.insertNode(l);e&&(e.documentRoot=!0,e.visible=!1,e.excluded=!0,o.push(e)),a=!0}else{const e=this.cascadeParentNode(l,t+1);e&&(o.push(e),e.excluded||(a=!0))}}for(let e=0;e<o.length;e++){const t=o[e];t.lineBreak&&(e>0&&(o[e-1].lineBreakTrailing=!0),e<o.length-1&&(o[e+1].lineBreakLeading=!0)),t.excluded?this.processing.excluded.append(t):!a&&t.plainText||(t.parent=i,this.processing.cache.append(t)),t.siblingIndex=e}i.setInlineText(!a),i.actualChildren=o}return i}setBaseLayout(e){const t=this.processing.cache,i=this.processing.node,s=m.filterArray(this.extensions,e=>!e.eventOnly),o=new Map;function l(e,t,i){const s=o.get(e)||new Map;o.set(e,s.set(t,i))}function c(e){for(const t of o.values())for(const i of t.values())if(i.id===e)return void t.delete(i.id)}l(-1,0,i.parent);let h=0;for(const e of t)e.visible&&(l(e.depth,e.id,e),h=Math.max(e.depth,h));for(let e=0;e<h;e++)o.set(-1*e-2,new Map);t.afterAppend=(e=>{c(e.id),l(-1*e.depth-2,e.id,e);for(const t of e.cascade())c(t.id),l(-1*t.depth-2,t.id,t)});for(const e of o.values())for(const t of e.values()){if(0===t.length)continue;const e=t.duplicate(),i=e.length;let o,l=!1;i>1&&(l=t.some(e=>e.floating))&&(o=n.linearData(t.actualChildren,!0).cleared);for(let n=0;n<i;n++){let c=e[n];if(!c.visible||c.rendered||c.naturalElement&&!c.documentRoot&&this.rootElements.has(c.element))continue;let h=c.parent;if(i>1&&n<i-1&&c.pageFlow&&(0===h.alignmentType||h.hasAlign(2)||c.hasAlign(4096))&&!h.hasAlign(4)&&c.hasSection(r.DOM_TRAVERSE)){const t=[],s=[];let r=!1;function u(e){return!s.length&&!r&&(t.push(e),!0)}function g(e){return!t.length&&(s.push(e),!0)}let f,p,b=n,S=0;c.hasAlign(4096)&&h.layoutVertical&&(t.push(c),b++,S++);e:{let n,a,c;for(l&&(n=new Set,a=new Set,c=new Set);b<i;b++,S++){const i=e[b];if(i.pageFlow){if(l){const e=o.get(i);e&&("both"===e?(a.clear(),c.add(d.CSS.LEFT),c.add(d.CSS.RIGHT)):(a.delete(e),c.add(e))),i.floating&&(n.add(i.float),a.add(i.float))}if(0===S){const e=i.nextSiblings().shift();if(e){!i.horizontalAligned||e.alignedVertically([i],[i])?s.push(i):t.push(i);continue}}const e=i.previousSiblings();if(!e[e.length-1])break e;if(l){const n=i.alignedVertically(e,t.length?t:s,o,t.length>0);if(n>0){if(t.length){if(7!==n&&6!==n&&a.size&&"both"!==o.get(i)&&!e.some(e=>e.lineBreak&&!o.has(e))){let e=-1/0;if(m.captureMap(t,e=>e.floating,t=>e=Math.max(e,t.linear.bottom)),!i.floating||i.linear.top<e){if(o.has(i)){if(!i.floating){i.alignmentType|=4096,t.push(i),r=!0;continue}break e}if(!i.floating&&m.belowRange(i.linear.top,e)||i.floating&&a.has(i.float)){if(t.push(i),!i.floating&&m.aboveRange(i.linear.bottom,e))break e;continue}}}break e}if(!g(i))break e}else if(!u(i))break e}else if(i.alignedVertically(e)){if(!g(i))break e}else if(!u(i))break e}else if(i.positionAuto){if(s.length){s[s.length-1].blockStatic&&s.push(i);break}t.push(i)}}}t.length>1?(f=this.controllerHandler.processTraverseHorizontal(new a(h,c,0,0,t),e),p=t[t.length-1]):s.length>1&&(f=this.controllerHandler.processTraverseVertical(new a(h,c,0,0,s),e),(p=s[s.length-1]).horizontalAligned&&p!==e[i-1]&&(p.alignmentType|=4096)),h.hasAlign(2)&&p===e[i-1]&&(h.alignmentType^=2),f&&this.addLayout(f.layout)&&(h=c.parent)}if(c.hasAlign(4096)&&(c.alignmentType^=4096),n===i-1&&h.hasAlign(2)&&(h.alignmentType^=2),c.renderAs&&h.appendTry(c,c.renderAs,!1)&&(c.hide(),(c=c.renderAs).positioned&&(h=c.parent)),!c.rendered&&c.hasSection(r.EXTENSION)){const e=this.session.extensionMap.get(c.id);let i=t.renderExtension&&t.renderExtension.slice(0);if(e&&(i?m.concatArray(i,e):i=e.slice(0)),i){let e=!1;for(const t of i){const i=t.processChild(c,h);if(i&&(i.output&&this.addLayoutTemplate(i.parentAs||h,c,i.output),i.renderAs&&i.outputAs&&this.addLayoutTemplate(h,i.renderAs,i.outputAs),i.parent&&(h=i.parent),e=!0===i.next,i.complete||e))break}if(e)continue}if(c.styleElement){let t=!1;if(x(c.element,s).some(i=>{if(i.is(c)&&i.condition(c,h)&&(void 0===e||!e.includes(i))){const e=i.processNode(c,h);if(e&&(e.output&&this.addLayoutTemplate(e.parentAs||h,c,e.output),e.renderAs&&e.outputAs&&this.addLayoutTemplate(h,e.renderAs,e.outputAs),e.parent&&(h=e.parent),(e.output&&!1!==e.include||!0===e.include)&&(void 0===c.renderExtension&&(c.renderExtension=[]),c.renderExtension.push(i),i.subscribers.add(c)),t=!0===e.next,e.complete||t))return!0}return!1}),t)continue}}if(!c.rendered&&c.hasSection(r.RENDER)){let e=this.createLayoutControl(h,c);if(0===e.containerType){const t=c.length?this.controllerHandler.processUnknownParent(e):this.controllerHandler.processUnknownChild(e);if(!0===t.next)continue;e=t.layout}this.addLayout(e)}}}for(const s of t)s.documentRoot&&s.rendered&&this.session.documentRoot.push({node:s,layoutName:s===i?e:""});t.sort((e,t)=>e.depth===t.depth?e.groupParent&&(0===t.length||t.naturalElement)?-1:t.groupParent&&(0===e.length||e.naturalElement)?1:0:e.depth<t.depth?-1:1),this.session.cache.concat(t.children),this.session.excluded.concat(this.processing.excluded.children);for(const e of this.extensions){for(const t of e.subscribers)e.postBaseLayout(t);e.afterBaseLayout()}}setConstraints(){this.controllerHandler.setConstraints();for(const e of this.extensions){for(const t of e.subscribers)e.postConstraints(t);e.afterConstraints()}}setResources(){for(const e of this.processing.cache)this.resourceHandler.setBoxStyle(e),this.resourceHandler.setFontStyle(e),this.resourceHandler.setValueString(e);for(const e of this.extensions)e.afterResources()}processFloatHorizontal(e){const t=this.controllerHandler,i=[],s=[],o=[],r=[],l=[],c=e=>e.textElement&&(e.blockStatic||e.multiline);let h,u,f,b,S=0;e.each((t,i)=>{if(i>0){const i=e.cleared.get(t);if(i)switch(i){case d.CSS.LEFT:m.hasBit(S,2)||(S|=2);break;case d.CSS.RIGHT:m.hasBit(S,4)||(S|=4);break;default:S=6}}if(0===S)if(t.float===d.CSS.RIGHT)l.push(t);else if(t.float===d.CSS.LEFT)r.push(t);else if(r.length||l.length){let e=t.linear.top;if(t.textElement&&!t.plainText){const i=p.getRangeClientRect(t.element,t.sessionId);i.top>e&&(e=i.top)}r.some(t=>e>=t.linear.bottom)||l.some(t=>e>=t.linear.bottom)?o.push(t):s.push(t)}else s.push(t);else t.float===d.CSS.RIGHT?4===S||6===S?(void 0===u&&(u=[]),u.push(t)):l.push(t):t.float===d.CSS.LEFT?2===S||6===S?(void 0===h&&(h=[]),h.push(t)):r.push(t):6===S?o.push(t):s.push(t)}),r.length&&h?f=[r,h]:r.length&&(f=r),l.length&&u?b=[l,u]:l.length&&(b=l);const y=t.containerTypeVertical,T=t.containerTypeVerticalMargin,x=l.length+(u?u.length:0)===e.length?1024:0;if(o.length){o.length>1&&(o[0].alignmentType|=4096),o.unshift(e.node);const t=this.createNode(g.createElement(e.node.actualParent&&e.node.actualParent.element),!0,e.parent,o);this.addLayout(new a(e.parent,t,y.containerType,y.alignmentType|(e.parent.blockStatic?64:0),o)),e.reset(t)}let _;e.add(x),s.length&&i.push(s),f&&i.push(f),b&&i.push(b),e.itemCount=i.length,e.setType(T.containerType,T.alignmentType),e.hasAlign(1024)&&e.add(64);for(const o of i){let i;if(Array.isArray(o[0])){i=o;const s=[];for(const e of i)m.concatArray(s,e);if(s.sort(n.siblingIndex),e.node.layoutVertical)_=e.node;else{_=t.createNodeGroup(s[0],s,e.node);const n=new a(e.node,_,y.containerType,y.alignmentType|(i.some(e=>e===b||e===l)?1024:0));n.itemCount=i.length,this.addLayout(n)}}else i=[o],_=void 0;for(const n of i){const i=!_||n!==s&&n!==r&&n!==h&&n!==l&&n!==u?e.node:_,o=t.createNodeGroup(n[0],n,i),g=new a(i,o,0,128,n);if(n.some(e=>e.blockStatic||e.multiline&&i.blockStatic||e.has(d.CSS.WIDTH,32))&&g.add(64),1===n.length)if(o.innerWrapped=n[0],n[0].outerWrapper=o,n[0].has(d.CSS.WIDTH,32)){const e=this.controllerHandler.containerTypePercent;g.setType(e.containerType,e.alignmentType)}else g.setType(y.containerType,y.alignmentType);else g.linearY?g.setType(y.containerType,y.alignmentType):t.processLayoutHorizontal(g);if(this.addLayout(g),n===s&&s.some(e=>c(e)||e.blockStatic&&e.cascadeSome(e=>c(e)))){if(r.length){let e=-1/0,n=0,a=!1;for(const t of r){const i=t.linear.right+(t.marginLeft<0?t.marginLeft:0);i>e&&(e=i,a=t.marginRight>0)}for(const t of s)t.blockStatic&&t.bounds.left>e&&n++;if(n<s.length){const s=e-i.box.left;s>0&&o.modifyBox(256,s+(!a&&o.cascadeSome(e=>e.multiline)?t.localSettings.deviations.textMarginBoundarySize:0))}}if(l.length){let e=1/0,n=0,a=!1;for(const t of l){const i=t.linear.left+(t.marginRight<0?t.marginRight:0);i<e&&(e=i,a=t.marginLeft>0)}for(const t of s)t.blockStatic&&t.bounds.right<e&&n++;if(n<s.length){const s=i.box.right-e;s>0&&o.modifyBox(64,s+(!a&&o.cascadeSome(e=>e.multiline)?t.localSettings.deviations.textMarginBoundarySize:0))}}}}}return e}processFloatVertical(e){const t=this.controllerHandler,i=t.containerTypeVertical;if(0!==e.containerType){const s=t.createNodeGroup(e.node,[e.node],e.parent);this.addLayout(new a(s,e.node,i.containerType,i.alignmentType,s.children)),e.node=s}else e.containerType=i.containerType,e.add(i.alignmentType);const s=[],n=[],o=[],r=[];let l=!1,c=!1,h=!0;for(const t of e)t.blockStatic&&0===r.length?(o.push(t),c=!0):(e.cleared.has(t)&&(t.floating?l=!0:(t.modifyBox(2),s.push(o.slice(0)),n.push(r.slice(0)),o.length=0,r.length=0)),t.floating?(c&&(s.push(o.slice(0)),n.push(null),o.length=0,r.length=0,c=!1),r.push(t)):(l&&!e.cleared.has(t)&&(h=!1),o.push(t)));if(r.length&&n.push(r),o.length&&s.push(o),!h)for(let o=0;o<Math.max(n.length,s.length);o++){const r=s[o]||[];if(null===n[o]&&r.length){const i=t.containerTypeVertical;i.alignmentType|=192,this.addLayout(new a(e.node,t.createNodeGroup(r[0],r,e.node),i.containerType,i.alignmentType,r))}else{const s=n[o]||[];if(r.length||s.length){const n=t.createNodeGroup(s[0]||r[0],[],e.node),o=t.containerTypeVerticalMargin,l=new a(e.node,n,o.containerType,o.alignmentType),c=[];let h;s.length>1?(h=t.createNodeGroup(s[0],s,n),l.add(512),0===r.length&&s.every(e=>e.float===d.CSS.RIGHT)&&l.add(1024)):s.length&&((h=s[0]).parent=n),h&&(c.push(h),h=void 0),r.length>1?h=t.createNodeGroup(r[0],r,n):r.length&&((h=r[0]).parent=n),h&&c.push(h),n.init(),l.itemCount=c.length,this.addLayout(l);for(let e of c)e.groupParent||(e=t.createNodeGroup(e,[e],n)),this.addLayout(new a(n,e,i.containerType,192|i.alignmentType,e.children))}}}return e}insertNode(e,t){if("#text"!==e.nodeName){if(this.conditionElement(e)){this.controllerHandler.applyDefaultStyles(e);const t=this.createNode(e,!1);return this.userSettings.exclusionsDisabled||t.setExclusions(),t}{const t=this.createNode(e,!1);return t.visible=!1,t.excluded=!0,t}}if(b.isPlainText(e.textContent)||u.isParentStyle(e,"whiteSpace","pre","pre-wrap")){this.controllerHandler.applyDefaultStyles(e);const i=this.createNode(e,!1);return t&&(i.inherit(t,"textStyle"),i.pageFlow||i.css("backgroundColor",t.css("backgroundColor"))),i}}conditionElement(e){if(!this.controllerHandler.localSettings.unsupported.excluded.has(e.tagName)){if(this.controllerHandler.visibleElement(e)||e.dataset.use&&e.dataset.use.split(f.XML.SEPARATOR).some(e=>!!this.extensionManager.retrieve(e.trim())))return!0;{let t=e.parentElement,i=!0;for(;t;){if(u.getStyle(t).display===d.CSS.NONE){i=!1;break}t=t.parentElement}if(i)for(let t=0;t<e.children.length;t++)if(this.controllerHandler.visibleElement(e.children[t]))return!0;return!1}}return!1}createPseduoElement(e,t){const i=p.getElementCache(e,`styleMap::${t}`,this.processing.sessionId);if(i&&i.content){if(""===m.trimString(i.content,'"').trim()&&0===m.convertFloat(i.width)&&0===m.convertFloat(i.height)&&("absolute"===i.position||"fixed"===i.position||i.clear&&i.clear!==d.CSS.NONE)){let e=!0;for(const t in i)if(/(Width|Height)$/.test(t)&&u.isLength(i[t],!0)&&0!==m.convertFloat(i[t])){e=!1;break}if(e)return}let a=i.content;if("inherit"===a){let i=e.parentElement;for(;i&&"inherit"===(a=u.getStyle(i,t).getPropertyValue("content"));)i=i.parentElement}const r=u.getStyle(e);void 0===i.fontFamily&&(i.fontFamily=r.getPropertyValue("font-family")),i.fontSize=i.fontSize?u.convertPX(i.fontSize,u.getFontSize(document.body)):r.getPropertyValue("font-size"),void 0===i.fontWeight&&(i.fontWeight=r.getPropertyValue("font-weight")),void 0===i.color&&(i.color=r.getPropertyValue("color")),void 0===i.display&&(i.display="inline");let l=i.display.startsWith("inline")?"span":"div",c="";switch(a){case"normal":case"none":case"initial":case"inherit":case"no-open-quote":case"no-close-quote":case'""':break;case"open-quote":"before"===t&&(c="&quot;");break;case"close-quote":"after"===t&&(c="&quot;");break;default:if(a.startsWith("url(")){c=u.resolveURL(a);const e=m.fromLastIndexOf(c,".").toLowerCase();this.controllerHandler.localSettings.supported.imageFormat.includes(e)?l="img":c=""}else{void 0===y.COUNTERS&&(y.COUNTERS=/\s*(?:attr\(([^)]+)\)|(counter)\(([^,)]+)(?:, ([a-z\-]+))?\)|(counters)\(([^,]+), "([^"]*)"(?:, ([a-z\-]+))?\)|"([^"]+)")\s*/g);let i,l=!1;for(;null!==(i=y.COUNTERS.exec(a));){if(i[1])c+=g.getNamedItem(e,i[1].trim());else if(i[2]||i[5]){const a="counter"===i[2];let l,h;function s(e){if(e!==d.CSS.NONE){const t=/\s*([^\-\d][^\-\d]?[^ ]*) (-?\d+)\s*/g;let i;for(;null!==(i=t.exec(e));)if(i[1]===l)return parseInt(i[2])}}a?(l=i[3],h=i[4]||"decimal"):(l=i[6],h=i[8]||"decimal");const g=e=>{const i=p.getElementCache(e,`styleMap::${t}`,this.processing.sessionId);if(i&&i.counterIncrement)return s(i.counterIncrement)},f=(g(e)||0)+(s(r.getPropertyValue("counter-reset"))||0),m=[];let b,S=e,y=f,T=!1;function n(e,t=!1){0===m.length?y+=e:(T||t)&&(m[m.length-1]+=e)}function o(e){if(void 0===s(u.getStyle(e).getPropertyValue("counter-reset")))for(let t=0;t<e.children.length;t++){const i=e.children[t];if("__squared.pseudo"!==i.className){let e=g(i);e&&n(e,!0);const t=u.getStyle(i);if((e=s(t.getPropertyValue("counter-increment")))&&n(e),void 0!==(e=s(t.getPropertyValue("counter-reset"))))return;o(i)}}}for(;;){if(T=!1,S.previousElementSibling)o(S=S.previousElementSibling);else{if(!S.parentElement)break;S=S.parentElement,T=!0}if("__squared.pseudo"!==S.className){const e=g(S);e&&n(e,!0);const t=u.getStyle(S),i=s(t.getPropertyValue("counter-increment"))||0;i&&n(i);const o=s(t.getPropertyValue("counter-reset"));if(void 0!==o){if(void 0===b&&(y+=o),b=S,a)break;T&&m.push((e||0)+o)}}}if(b){if(!a&&m.length>1){m.reverse(),m.splice(1,1);for(const e of m)c+=u.convertListStyle(h,e,!0)+i[7]}}else y=f;c+=u.convertListStyle(h,y,!0)}else i[9]&&(c+=i[9]);l=!0}l||(c=a)}}if(c||'""'===a){const s=g.createElement(e,l,!1,"before"===t?0:-1);"img"===l?s.src=c:'""'!==a&&(s.innerText=c);for(const e in i)"display"!==e&&(s.style[e]=i[e]);return p.setElementCache(s,"pseudoType",this.processing.sessionId,t),p.setElementCache(s,"styleMap",this.processing.sessionId,i),s}}}setStyleMap(){let e=!1;const t=i=>{try{if(i.cssRules)for(let e=0;e<i.cssRules.length;e++){const s=i.cssRules[e];switch(s.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(s);break;case CSSRule.IMPORT_RULE:t(s.styleSheet);break;case CSSRule.MEDIA_RULE:u.validMediaRule(s.conditionText||_("media",s.cssText))&&this.applyCSSRuleList(s.cssRules);break;case CSSRule.SUPPORTS_RULE:CSS.supports&&CSS.supports(s.conditionText||_("supports",s.cssText))&&this.applyCSSRuleList(s.cssRules)}}}catch(t){this.userSettings.showErrorMessages&&!e&&(alert("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+`${i.href}\n\n${t}`),e=!0)}};for(let e=0;e<document.styleSheets.length;e++)t(document.styleSheets[e])}applyCSSRuleList(e){for(let t=0;t<e.length;t++)this.applyStyleRule(e[t])}applyStyleRule(e){switch(e.type){case CSSRule.STYLE_RULE:{const t=[];for(const i of Array.from(e.style))t.push(m.convertCamelCase(i));for(const i of e.selectorText.split(f.XML.SEPARATOR)){const s=u.getSpecificity(i),[n,o]=i.split("::"),a=o?"::"+o:"";document.querySelectorAll(n||"*").forEach(i=>{const n=u.getStyle(i,a),o=u.parseUnit(n.getPropertyValue("font-size")),r={};for(const a of t){const t=u.checkStyleValue(i,a,e.style[a],n,s,o);t&&(r[a]=t)}[r.backgroundImage,r.listStyleImage,r.content].forEach(e=>{if(e){const t=RegExp(`url\\("(${S})"\\),?\\s*`,"g");let i;for(;null!==(i=t.exec(e));)if(i[2]&&i[3])this.resourceHandler.addRawData(i[1],i[2],i[3],i[4]);else if(this.userSettings.preloadImages){const e=m.resolvePath(i[4]);""!==e&&void 0===this.resourceHandler.getImage(e)&&this.resourceHandler.assets.images.set(e,{width:0,height:0,uri:e})}}});const l=`styleMap${a}`,c=`styleSpecificity${a}`,h=p.getElementCache(i,l,this.processing.sessionId);if(h){const e=p.getElementCache(i,c,this.processing.sessionId)||{};for(const t in r)(void 0===h[t]||void 0===e[t]||s>=e[t])&&(h[t]=r[t],e[t]=s)}else{const e={};for(const t in r)e[t]=s;p.setElementCache(i,`style${a}`,"0",n),p.setElementCache(i,"sessionId","0",this.processing.sessionId),p.setElementCache(i,l,this.processing.sessionId,r),p.setElementCache(i,c,this.processing.sessionId,e)}})}break}case CSSRule.FONT_FACE_RULE:{void 0===y.FONT_FACE&&(y.FONT_FACE=/\s*@font-face\s*{([^}]+)}\s*/,y.FONT_FAMILY=/\s*font-family:[^\w]*([^'";]+)/,y.FONT_SRC=/\s*src:\s*([^;]+);/,y.FONT_STYLE=/\s*font-style:\s*(\w+)\s*;/,y.FONT_WEIGHT=/\s*font-weight:\s*(\d+)\s*;/,y.URL=/\s*(url|local)\(['"]([^'")]+)['"]\)\s*format\(['"](\w+)['"]\)\s*/);const t=y.FONT_FACE.exec(e.cssText);if(t){const e=y.FONT_FAMILY.exec(t[1]),i=y.FONT_SRC.exec(t[1]);if(e&&i){const s=y.FONT_STYLE.exec(t[1]),n=y.FONT_WEIGHT.exec(t[1]),o=e[1].trim(),a=s?s[1].toLowerCase():"normal",r=n?parseInt(n[1]):400;for(const e of i[1].split(f.XML.SEPARATOR)){const t=y.URL.exec(e);if(t){let e,i;"url"===t[1]?e=m.resolvePath(t[2].trim()):i=t[2].trim(),this.resourceHandler.addFont({fontFamily:o,fontWeight:r,fontStyle:a,srcUrl:e,srcLocal:i,srcFormat:t[3].toLowerCase().trim()})}}}}break}}}createLayoutControl(e,t){return new a(e,t,t.containerType,t.alignmentType,t.children)}set userSettings(e){this._userSettings=e}get userSettings(){return this._userSettings||{}}get layouts(){return this._layouts.sort((e,t)=>{if(e.index!==t.index){if(0===e.index||void 0!==e.index&&e.index!==1/0&&void 0===t.index||t.index===1/0)return-1;if(0===t.index||void 0!==t.index&&t.index!==1/0&&void 0===e.index||e.index===1/0)return 1;if(void 0!==e.index&&void 0!==t.index)return e.index<t.index?-1:1}return 0})}get rendered(){return this.session.cache.filter(e=>e.visible&&e.rendered)}get nextId(){return this.processing.cache.nextId}get length(){return this.session.documentRoot.length}},e.Controller=class{constructor(e,t){this.application=e,this.cache=t,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}reset(){this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}applyDefaultStyles(e){let t;if("#text"===e.nodeName)t={position:"static",display:"inline",verticalAlign:"baseline",float:R.CSS.NONE,clear:R.CSS.NONE};else{if(t=P.getElementCache(e,"styleMap",this.application.processing.sessionId)||{},k.isUserAgent(8))switch(e.tagName){case"INPUT":case"SELECT":case"BUTTON":case"TEXTAREA":void 0===t.display&&(t.display="inline-block");break;case"FIELDSET":void 0===t.display&&(t.display="block")}switch(e.tagName){case"INPUT":{const i=B.getStyle(e);switch(e.type){case"file":case"reset":case"submit":case"button":void 0===w.parseColor(i.getPropertyValue("background-color"))&&(t.backgroundColor="rgb(221, 221, 221)"),void 0===t.textAlign&&(t.textAlign=R.CSS.CENTER)}if(i.getPropertyValue("border-style")===R.CSS.NONE)for(let e=0;e<4;e++)t[v[e][0]]="outset",t[v[e][1]]="2px",t[v[e][2]]="rgb(221, 221, 221)";break}case"BUTTON":void 0===t.textAlign&&(t.textAlign=R.CSS.CENTER);break;case"TEXTAREA":case"SELECT":void 0===t.verticalAlign&&("SELECT"!==e.tagName||e.size>1)&&(t.verticalAlign="text-bottom");break;case"FORM":void 0===t.marginTop&&(t.marginTop=R.CSS.PX_0);break;case"LI":if(void 0===t.listStyleImage){const i=B.getStyle(e);t.listStyleImage=i.getPropertyValue("list-style-image")}break;case"IFRAME":void 0===t.display&&(t.display="block");case"IMG":const i=(i,s)=>{if(void 0===t[i]||t[i]===R.CSS.AUTO){const n=RegExp(`\\s+${i}="([^"]+)"`).exec(e.outerHTML);if(n)B.isLength(n[1])?t[i]=B.formatPX(n[1]):B.isPercent(n[1])&&(t[i]=n[1]);else if("IFRAME"===e.tagName)i===R.CSS.WIDTH?t.width="300px":t.height="150px";else if(t[s]&&B.isLength(t[s])){const n=`max${N.capitalize(i)}`;if(void 0===t[n]||!B.isPercent(n)){const n=this.application.resourceHandler.getImage(e.src);n&&n.width>0&&n.height>0&&(t[i]=B.formatPX(n[i]*parseFloat(t[s])/n[s]))}}}};i(R.CSS.WIDTH,R.CSS.HEIGHT),i(R.CSS.HEIGHT,R.CSS.WIDTH)}}P.setElementCache(e,"styleMap",this.application.processing.sessionId,t)}addBeforeOutsideTemplate(e,t,i=-1){void 0===this._beforeOutside[e]&&(this._beforeOutside[e]=[]),-1!==i&&i<this._beforeOutside[e].length?this._beforeOutside[e].splice(i,0,t):this._beforeOutside[e].push(t)}addBeforeInsideTemplate(e,t,i=-1){void 0===this._beforeInside[e]&&(this._beforeInside[e]=[]),-1!==i&&i<this._beforeInside[e].length?this._beforeInside[e].splice(i,0,t):this._beforeInside[e].push(t)}addAfterInsideTemplate(e,t,i=-1){void 0===this._afterInside[e]&&(this._afterInside[e]=[]),-1!==i&&i<this._afterInside[e].length?this._afterInside[e].splice(i,0,t):this._afterInside[e].push(t)}addAfterOutsideTemplate(e,t,i=-1){void 0===this._afterOutside[e]&&(this._afterOutside[e]=[]),-1!==i&&i<this._afterOutside[e].length?this._afterOutside[e].splice(i,0,t):this._afterOutside[e].push(t)}getBeforeOutsideTemplate(e,t=0){return this._beforeOutside[e]?L.pushIndentArray(this._beforeOutside[e],t):""}getBeforeInsideTemplate(e,t=0){return this._beforeInside[e]?L.pushIndentArray(this._beforeInside[e],t):""}getAfterInsideTemplate(e,t=0){return this._afterInside[e]?L.pushIndentArray(this._afterInside[e],t):""}getAfterOutsideTemplate(e,t=0){return this._afterOutside[e]?L.pushIndentArray(this._afterOutside[e],t):""}hasAppendProcessing(e){return void 0===e?Object.keys(this._beforeOutside).length>0||Object.keys(this._beforeInside).length>0||Object.keys(this._afterInside).length>0||Object.keys(this._afterOutside).length>0:void 0!==this._beforeOutside[e]||void 0!==this._beforeInside[e]||void 0!==this._afterInside[e]||void 0!==this._afterOutside[e]}includeElement(e){return!this.localSettings.unsupported.tagName.has(e.tagName)||"INPUT"===e.tagName&&!this.localSettings.unsupported.tagName.has(`${e.tagName}:${e.type}`)||"true"===e.contentEditable}visibleElement(e){if("__squared.pseudo"===e.className)return!0;const t=P.getClientRect(e,this.application.processing.sessionId);if(O(t)){if(t.width>0&&t.height>0)return!0;const i=B.getStyle(e);return t.width>0&&i.getPropertyValue("float")!==R.CSS.NONE||"block"===i.getPropertyValue("display")&&(0!==parseInt(i.getPropertyValue("margin-top"))||0!==parseInt(i.getPropertyValue("margin-bottom")))||i.getPropertyValue("clear")!==R.CSS.NONE}return!1}evaluateNonStatic(e,t){const i=new Set;for(const s of t)if(!s.documentRoot){const t=s.parent,n=s.absoluteParent;let o;switch(s.css("position")){case"relative":if(s===t.lastChild){let i=!1;if(s.outsideX(t.box)){if(!t.has(R.CSS.WIDTH)||"hidden"===t.css("overflowX"))continue;i=!0}if(s.outsideY(t.box)){if(!t.hasHeight&&!t.has(R.CSS.HEIGHT)||"hidden"===t.css("overflowY"))continue;i=!0}if(i){o=t.actualParent;do{if(s.withinX(o.box)&&s.withinY(o.box)||"hidden"===o.css("overflow"))break;o=t.actualParent}while(o&&o!==e);o&&(s.css("position","absolute",!0),s.setBounds(!1))}}break;case"fixed":if(!s.positionAuto){o=e;break}case"absolute":if(n)if(o=n,s.positionAuto)s.previousSiblings().some(e=>e.multiline||e.excluded&&!e.blockStatic)?s.positionAuto=!1:s.cssApply({display:"inline-block",verticalAlign:R.CSS.TOP},!0),o=t;else if(this.userSettings.supportNegativeLeftTop){let t=!1;for(;o&&o!==e;){if(t){if(o.layoutElement){o=n;break}if(s.withinX(o.box)&&s.withinY(o.box))break}else{const e="hidden"===o.css("overflowX"),i="hidden"===o.css("overflowY");if(e&&i||s.cssInitial(R.CSS.TOP)===R.CSS.PX_0||s.cssInitial(R.CSS.RIGHT)===R.CSS.PX_0||s.cssInitial(R.CSS.BOTTOM)===R.CSS.PX_0||s.cssInitial(R.CSS.LEFT)===R.CSS.PX_0)break;{const n=!e&&s.outsideX(o.box),a=!i&&s.outsideY(o.box);if(!i&&s.linear.top<Math.floor(o.box.top)&&(s.top<0||s.marginTop<0))t=!0;else if(n&&!s.has(R.CSS.LEFT)&&s.right>0||a&&!s.has(R.CSS.TOP)&&0!==s.bottom)t=!0;else if(n&&a&&(!o.pageFlow||o.actualParent&&o.actualParent.documentBody)&&(s.top>0||s.left>0))t=!0;else if(!e&&s.outsideX(o.linear)&&!s.pseudoElement&&(s.left<0||s.marginLeft<0||!s.has(R.CSS.LEFT)&&s.right<0&&s.linear.left>=o.linear.right))t=!0;else{if(e||i||s.intersectX(o.box)||s.intersectY(o.box))break;t=!0}}}o=o.actualParent}}}if(void 0===o&&(o=s.pageFlow?t:e),o!==t){if(n&&n.positionRelative&&o!==n){const e=s.bounds;0!==n.left?(e.left+=n.left,e.right+=n.left):n.has(R.CSS.LEFT)||0===n.right||(e.left-=n.right,e.right-=n.right),0!==n.top?(e.top+=n.top,e.bottom+=n.top):n.has(R.CSS.TOP)||0===n.bottom||(e.top-=n.bottom,e.bottom-=n.bottom),s.unsafe("box",!0),s.unsafe("linear",!0)}let e=s.toFloat("opacity",!1,1),a=t;for(;a&&a!==o;)e*=a.toFloat("opacity",!1,1),a=a.actualParent;s.css("opacity",""+e),s.parent=o,s.siblingIndex=1/0,i.add(o)}s.documentParent=o}for(const e of t)if(i.has(e)){const t=[];let i=-1;if(e.each(s=>{if(s.siblingIndex===1/0)for(const i of e.children){let e=i.actualChildren.includes(s);if(!e){const t=i.cascade();e=s.ascend(!1,e=>t.includes(e)).length>0}if(e){const e=i.siblingIndex+(s.zIndex>=0||i!==s.actualParent?1:0);void 0===t[e]&&(t[e]=[]),t[e].push(s);break}}else s.siblingIndex>i&&(i=s.siblingIndex)}),t.length){const s=e.children;for(let e=0,n=0,o=1;e<t.length;e++,n++){const a=t[e];if(a){a.sort((e,t)=>e.parent===t.parent?e.zIndex===t.zIndex?e.id<t.id?-1:1:e.zIndex<t.zIndex?-1:1:0);for(const e of a)e.siblingIndex=i+o++;for(let e=0;e<s.length;e++)a.includes(s[e])&&(s[e]=void 0);s.splice(n,0,...a),n+=a.length}}e.retain(N.flatArray(s))}}}cascadeDocument(e,t){const i=t>0?"\t".repeat(t):"";let s="";for(const n of e)if(n){const e=n.node;switch(n.type){case 1:{const o=n.controlName,a=n.attributes,r=t+1,l=this.getBeforeInsideTemplate(e.id,r),c=this.getAfterInsideTemplate(e.id,r);let h=i+`<${o+(0===t?"{#0}":"")+(this.userSettings.showAttributes?a?L.pushIndent(a,r):e.extractAttributes(r):"")}`;h+=e.renderTemplates||""!==l||""!==c?">\n"+l+(e.renderTemplates?this.cascadeDocument(this.sortRenderPosition(e,e.renderTemplates),r):"")+c+i+`</${o}>\n`:" />\n",s+=this.getBeforeOutsideTemplate(e.id,t)+h+this.getAfterOutsideTemplate(e.id,t);break}case 2:{const e=n.content;e&&(s+=L.pushIndent(e,t));break}}}return s}getEnclosingXmlTag(e,t,i){return"<"+e+(t||"")+(i?">\n"+i+"</"+e+">\n":" />\n")}get generateSessionId(){return""+(new Date).getTime()}},e.Extension=W,e.ExtensionManager=class{constructor(e){this.application=e}include(e){const t=this.retrieve(e.name);return t?(Array.isArray(e.tagNames)&&(t.tagNames=e.tagNames),Object.assign(t.options,e.options),!0):!(0!==e.framework&&!F.hasBit(e.framework,this.application.framework)||!e.dependencies.every(e=>!!this.retrieve(e.name))||(e.application=this.application,this.application.extensions.includes(e)||this.application.extensions.push(e),0))}exclude(e){for(let t=0;t<this.application.extensions.length;t++)if(this.application.extensions[t]===e)return this.application.extensions.splice(t,1),!0;return!1}retrieve(e){for(const t of this.application.extensions)if(t.name===e)return t;return null}optionValue(e,t){const i=this.retrieve(e);if(i&&"object"==typeof i.options)return i.options[t]}optionValueAsObject(e,t){const i=this.optionValue(e,t);return"object"==typeof i?i:null}optionValueAsString(e,t){const i=this.optionValue(e,t);return"string"==typeof i?i:""}optionValueAsNumber(e,t){const i=this.optionValue(e,t);return"number"==typeof i?i:0}optionValueAsBoolean(e,t){const i=this.optionValue(e,t);return"boolean"==typeof i&&i}},e.File=X,e.Layout=a,e.Node=Z,e.NodeGroup=class extends Z{init(){if(this.length){let e=1/0;for(const t of this.children)e=Math.min(e,t.siblingIndex),t.parent=this;this.siblingIndex===1/0&&(this.siblingIndex=e),this.parent&&this.parent.sort(n.siblingIndex),this.setBounds(),this.saveAsInitial(),this.actualParent&&(this.dir=this.actualParent.dir)}}setBounds(){if(this.length){const e=n.outerRegion(this);this._bounds=Object.assign({},e,{width:e.right-e.left,height:e.bottom-e.top})}}previousSiblings(e={}){const t=this.item(0);return t?t.previousSiblings(e):[]}nextSiblings(e={}){const t=this.item();return t?t.nextSiblings(e):[]}get block(){return void 0===this._cached.block&&(this._cached.block=this.some(e=>e.block)),this._cached.block}get blockStatic(){if(void 0===this._cached.blockStatic){const e=this.actualChildren.length&&this.actualChildren[0].blockStatic||this.actualWidth===this.documentParent.actualWidth&&!this.some(e=>e.plainText||e.naturalElement&&e.rightAligned)||this.layoutVertical&&this.some(e=>e.naturalElement&&e.blockStatic)||this.documentParent.blockStatic&&this.hasAlign(256);(e||0!==this.containerType)&&(this._cached.blockStatic=e)}return this._cached.blockStatic||this.hasAlign(64)}get blockDimension(){return void 0===this._cached.blockDimension&&(this._cached.blockDimension=this.some(e=>e.blockDimension)),this._cached.blockDimension}get inline(){return void 0===this._cached.inline&&(this._cached.inline=this.every(e=>e.inline)),this._cached.inline}get inlineStatic(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.every(e=>e.inlineStatic)),this._cached.inlineStatic}get inlineVertical(){return void 0===this._cached.inlineVertical&&(this._cached.inlineVertical=this.every(e=>e.inlineVertical)),this._cached.inlineVertical}get inlineFlow(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inlineStatic||this.hasAlign(128)),this._cached.inlineStatic}get pageFlow(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=!this.cssAny("position","absolute","fixed")),this._cached.pageFlow}set baseline(e){super.baseline=e}get baseline(){if(void 0===this._cached.baseline){const e=this.cssInitial("verticalAlign",!0);this._cached.baseline=""!==e?"baseline"===e:this.layoutHorizontal&&this.every(e=>e.baseline)}return this._cached.baseline}get float(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.hasAlign(1024)?Q.CSS.RIGHT:Q.CSS.LEFT:Q.CSS.NONE),this._cached.float}get floating(){return void 0===this._cached.floating&&(this._cached.floating=this.every(e=>e.naturalElement&&e.floating)),this._cached.floating}get display(){return this.css("display")||this.some(e=>e.blockStatic)?"block":this.some(e=>e.blockDimension||e.inlineVertical)?"inline-block":"inline"}get actualParent(){return void 0===this._cached.actualParent&&(this._cached.actualParent=n.actualParent(this._initial.children)),this._cached.actualParent}get groupParent(){return!0}get multiline(){return!1}},e.NodeList=n,e.Resource=be,e.extensions=bt,e.lib=St,Object.defineProperty(e,"__esModule",{value:!0})});
