!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).vdom=t()}(this,(function(){"use strict";class NodeList extends squared.lib.base.Container{constructor(e){super(e)}add(e,t=false,i=false){var s;if(super.add(e),t)null===(s=this.afterAdd)||void 0===s||s.call(this,e,i);return this}reset(){return this.clear(),this}}const{CSS_PROPERTIES:e,checkMediaRule:t,getSpecificity:i,hasComputedStyle:s,insertStyleSheetRule:n,parseSelectorText:a}=squared.lib.css,{FILE:l,STRING:r}=squared.lib.regex,{frameworkNotInstalled:o,getElementCache:h,setElementCache:c}=squared.lib.session,{capitalize:d,convertCamelCase:u,isString:f,parseMimeType:g,plainMap:m,promisify:p,resolvePath:v,trimBoth:b}=squared.lib.util,_=new RegExp(`url\\("?(${r.DATAURI})"?\\),?\\s*`,"g"),y=["backgroundImage","listStyleImage","content"];function E(e,t,i=0,s=0){if(f(t))if(i>0&&s>0||!e.getImage(t))e.addUnsafeData("image",t,{width:i,height:s,uri:t})}function x(e,t){if(f(t))for(const i of t.split(","))E(e,v(i.trim().split(" ")[0]))}const S=e=>l.SVG.test(e),w=(e,t)=>{var i;return(null===(i=new RegExp(`\\s*@${e}([^{]+)`).exec(t))||void 0===i?void 0:i[1].trim())||t};class Application{constructor(e,t,i,s,n){if(this.framework=e,this.builtInExtensions={},this.extensions=[],this.closed=false,this.session={active:new Map,unusedStyles:new Set},this._nextId=0,this._controllerHandler=new i(this),s)this._resourceHandler=new s(this);if(n)this._extensionManager=new n(this);this._afterInsertNode=this._controllerHandler.afterInsertNode,this.Node=t}createNode(e,t){return new this.Node(this.nextId,e,t.element)}copyToDisk(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.copyToDisk(e,t))||o()}appendToArchive(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.appendToArchive(e,t))||o()}saveToArchive(e,t){var i;const s=this._resourceHandler;return s&&(null===(i=s.fileHandler)||void 0===i?void 0:i.saveToArchive(e||s.userSettings.outputArchiveName,t))||o()}createFrom(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.createFrom(e,t))||o()}appendFromArchive(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.appendFromArchive(e,t))||o()}finalize(){return this.closed}reset(){var e;this._nextId=0,this.session.active.clear(),this.session.unusedStyles.clear(),this.controllerHandler.reset(),null===(e=this.resourceHandler)||void 0===e||e.reset(),this.extensions.forEach(e=>e.subscribers.clear()),this.closed=false}parseDocument(...e){const t=this._resourceHandler,i=true===(null==t?void 0:t.userSettings.preloadImages),a=this._controllerHandler.generateSessionId,l=new Set,r=[],o={cache:new NodeList,excluded:new NodeList,rootElements:l,initializing:false};let h,c;this.session.active.set(a,o),this._controllerHandler.init(),this.setStyleMap(a);const d=n("html > body { overflow: hidden !important; }");if(0===e.length)h=this.mainElement,l.add(h);else{let t=0;while(t<e.length){let i=e[t++];if("string"==typeof i)i=document.getElementById(i);if(i&&s(i)){if(!h)h=i;l.add(i)}}}if(!h)return Promise.reject(new Error("Document root not found."));if(t)for(const e of l)e.querySelectorAll("picture > source").forEach(e=>x(t,e.srcset)),e.querySelectorAll("video").forEach(e=>E(t,e.poster)),e.querySelectorAll("input[type=image]").forEach(e=>E(t,e.src,e.width,e.height)),e.querySelectorAll("object, embed").forEach(e=>{const i=e.data||e.src;if(i&&(e.type.startsWith("image/")||g(i).startsWith("image/")))E(t,i.trim())}),e.querySelectorAll("svg use").forEach(e=>{const i=e.href.baseVal||e.getAttributeNS("xlink","href");if(i&&i.indexOf("#")>0){const e=v(i.split("#")[0]);if(S(e))E(t,e)}});const u=()=>{const t=this.extensions;let i,s;if(o.initializing=false,c){s=c.length,i=0;while(i<s){const e=c[i++];if(e.parentElement)h.removeChild(e)}}s=t.length,i=0;while(i<s)t[i++].beforeParseDocument(a);const n=[];for(const e of l){const t=this.createCache(e,a);if(t)this.afterCreateCache(t),n.push(t)}i=0;while(i<s)t[i++].afterParseDocument(a);try{document.head.removeChild(d)}catch(e){}return e.length>1?n:n[0]};if(i){const{image:e,rawData:i}=t.mapOfAssets;c=[];for(const t of e.values()){const e=t.uri;if(S(e))r.push(e);else if(0===t.width||0===t.height){const i=document.createElement("img");if(i.src=e,i.naturalWidth>0&&i.naturalHeight>0)t.width=i.naturalWidth,t.height=i.naturalHeight;else h.appendChild(i),c.push(i)}}for(const[t,s]of i.entries()){const i=s.mimeType;if((null==i?void 0:i.startsWith("image/"))&&!i.endsWith("svg+xml")){const n=document.createElement("img");n.src=`data:${i};${s.base64?"base64,"+s.base64:s.content}`;const{naturalWidth:a,naturalHeight:l}=n;if(a>0&&l>0)s.width=a,s.height=l,e.set(t,{width:a,height:l,uri:s.filename});else document.body.appendChild(n),c.push(n)}}}if(t)for(const e of l)e.querySelectorAll("img").forEach(e=>{if(x(t,e.srcset),!i)t.addImage(e);else if(S(e.src))r.push(e.src);else if(e.complete)t.addImage(e);else r.push(e)});if(r.length>0)return o.initializing=true,Promise.all(m(r,e=>new Promise((t,i)=>{if("string"==typeof e)(async()=>{const i=await fetch(e,{method:"GET",headers:new Headers({Accept:"application/xhtml+xml, image/svg+xml","Content-Type":"image/svg+xml"})});t(await i.text())})();else e.addEventListener("load",()=>t(e)),e.addEventListener("error",()=>i(e))}))).then(e=>{const i=e.length;for(let s=0;s<i;++s){const i=e[s];if("string"==typeof i){const e=r[s];if("string"==typeof e)t.addRawData(e,"image/svg+xml",i,{encoding:"utf8"})}else t.addImage(i)}return u()}).catch(e=>{let t=e;if(e instanceof Event)t=e.target;const i=t instanceof HTMLImageElement?t.src:"";return!f(i)||!this.userSettings.showErrorMessages||confirm("FAIL: "+i)?u():Promise.reject(i)});else return p(u)()}createCache(e,t){const i=this.createRootNode(e,t);if(i)this.controllerHandler.sortInitialCache(this.getProcessingCache(t));return i}setStyleMap(e){const i=document.styleSheets,s=i.length;let n=0;while(n<s){const s=i[n++];let a;try{a=s.media.mediaText}catch(e){}if(!f(a)||t(a))this.applyStyleSheet(s,e)}}getProcessing(e){return this.session.active.get(e)}getProcessingCache(e){var t;return(null===(t=this.session.active.get(e))||void 0===t?void 0:t.cache)||new NodeList}getDatasetName(e,t){return t.dataset[e+d(this.systemName)]||t.dataset[e]}setDatasetName(e,t,i){t.dataset[e+d(this.systemName)]=i}toString(){return this.systemName}createRootNode(e,t){const i=this.getProcessing(t),s=this.extensionsCascade,n=this.cascadeParentNode(i.cache,i.excluded,i.rootElements,e,t,0,s.length>0?s:void 0);if(n){const s=new this.Node(0,t,e.parentElement);if(this._afterInsertNode(s),n.parent=s,n.actualParent=s,"HTML"===n.tagName)i.documentElement=n;else if("HTML"===s.tagName)i.documentElement=s;n.depth=0,n.childIndex=0,n.documentRoot=true,i.node=n}return n}cascadeParentNode(e,t,i,s,n,a,l){const r=this.insertNode(s,n);if(r){const o=this.controllerHandler;if(0===a)e.add(r);if(o.preventNodeCascade(r))return r;const h=a+1,c=s.childNodes,d=c.length,u=new Array(d),f=new Array(s.childElementCount);let g=true,m=0,p=0,v=0;while(m<d){const s=c[m++];let a;if("#"===s.nodeName.charAt(0)){if("#text"===s.nodeName)a=this.insertNode(s,n),null==a||a.cssApply(r.textStyle)}else if(o.includeElement(s)){if(a=this.cascadeParentNode(e,t,i,s,n,h,l),a)f[v++]=a,g=false}else if(a=this.insertNode(s,n),a)t.add(a),g=false;if(a)a.$parent=r,a.childIndex=p,a.actualParent=r,a.depth=h,u[p++]=a,e.add(a)}if(u.length=p,f.length=v,r.naturalChildren=u,r.naturalElements=f,r.inlineText=g,r.retainAs(u),v>0&&this.userSettings.createQuerySelectorMap)r.queryMap=this.createQueryMap(f,v)}return r}createQueryMap(e,t){var i;const s=[e];let n=0;while(n<t){const t=e[n++].queryMap;if(t){const e=t.length;for(let n=0;n<e;++n){const e=n+1;s[e]=(null===(i=s[e])||void 0===i?void 0:i.concat(t[n]))||t[n]}}}return s}applyStyleRule(t,s){var n,l,r,o,d,f,g,m;const p=this.resourceHandler,x=(null===(n=t.parentStyleSheet)||void 0===n?void 0:n.href)||location.href,S=t.cssText;switch(t.type){case CSSRule.SUPPORTS_RULE:this.applyCSSRuleList(t.cssRules,s);break;case CSSRule.STYLE_RULE:{const n=this.session.unusedStyles,r={},o={};{const i=t.style,s=Array.from(i),n=s.length;let a=0;while(a<n){const e=s[a++];r[u(e)]=i[e]}const h=/\s*([a-z-]+):[^!;]+!important;/g;let c;while(c=h.exec(S)){const t=u(c[1]),i=null===(l=e[t])||void 0===l?void 0:l.value;if(Array.isArray(i)){a=0;while(a<i.length)o[i[a++]]=true}else o[t]=true}a=0;while(a<3){const e=y[a++],t=r[e];if(t&&"initial"!==t){let i;while(c=_.exec(t))if(c[2]){if(p){const[e,t]=c[2].trim().split(/\s*;\s*/);p.addRawData(c[1],e,c[3],{encoding:t})}}else{const e=v(c[3],x);if(""!==e){if(p)E(p,e);i=(i||t).replace(c[0],`url("${e}")`)}}if(i)r[e]=i;_.lastIndex=0}}}for(const e of a(t.selectorText,true)){const t=i(e),[a,l]=e.split("::"),d=l?"::"+l:"",u=document.querySelectorAll(a||"*"),f=u.length;if(0===f){n.add(e);continue}let g=0;while(g<f){const e=u[g++],i="styleMap"+d,n="styleSpecificity"+d,a=h(e,i,s);if(a){const i=h(e,n,s)||{};for(const e in r){const s=i[e],n=t+(o[e]?1e3:0);if(void 0===s||n>=s)a[e]=r[e],i[e]=n}}else{const a=Object.assign({},r),l={};for(const e in a)l[e]=t+(o[e]?1e3:0);c(e,"sessionId","0",s),c(e,i,s,a),c(e,n,s,l)}}}break}case CSSRule.FONT_FACE_RULE:if(p){const e=null===(r=/\s*@font-face\s*{([^}]+)}\s*/.exec(S))||void 0===r?void 0:r[1];if(e){const t=b(((null===(o=/\s*font-family:([^;]+);/.exec(e))||void 0===o?void 0:o[1])||"").trim(),'"');if(""!==t){const i=((null===(d=/\s*src:\s*([^;]+);/.exec(e))||void 0===d?void 0:d[1])||"").split(","),s=i.length;if(s>0){const n=(null===(f=/\s*font-style:\s*(\w+)\s*;/.exec(e))||void 0===f?void 0:f[1].toLowerCase())||"normal",a=parseInt((null===(g=/\s*font-weight:\s*(\d+)\s*;/.exec(e))||void 0===g?void 0:g[1])||"400");let l=0;while(l<s){const e=/\s*(url|local)\((?:"((?:[^"]|\\")+)"|([^)]+))\)(?:\s*format\("?([\w-]+)"?\))?\s*/.exec(i[l++]);if(e){const i={fontFamily:t,fontWeight:a,fontStyle:n,srcFormat:(null===(m=e[4])||void 0===m?void 0:m.toLowerCase().trim())||"truetype"},s=(e[2]||e[3]).trim();if("url"===e[1])i.srcUrl=v(s,x);else i.srcLocal=s;p.addFont(i)}}}}}}break}}applyStyleSheet(e,i){var s,n;try{const a=e.cssRules;if(a){const e=a.length;let l=0;while(l<e){const e=a[l++];switch(e.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(e,i);break;case CSSRule.IMPORT_RULE:{const t=v(e.href,(null===(s=e.parentStyleSheet)||void 0===s?void 0:s.href)||location.href);if(""!==t)null===(n=this.resourceHandler)||void 0===n||n.addRawData(t,"text/css",void 0,{encoding:"utf8"});this.applyStyleSheet(e.styleSheet,i);break}case CSSRule.MEDIA_RULE:if(t(e.conditionText||w("media",e.cssText)))this.applyCSSRuleList(e.cssRules,i);break;case CSSRule.SUPPORTS_RULE:if(CSS.supports&&CSS.supports(e.conditionText||w("supports",e.cssText)))this.applyCSSRuleList(e.cssRules,i);break}}}}catch(t){(this.userSettings.showErrorMessages?alert:console.log)("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+e.href+"\n\n"+t)}}applyCSSRuleList(e,t){const i=e.length;let s=0;while(s<i)this.applyStyleRule(e[s++],t)}get mainElement(){return document.documentElement}get initializing(){for(const e of this.session.active.values())if(e.initializing)return true;return false}get controllerHandler(){return this._controllerHandler}get resourceHandler(){return this._resourceHandler}get extensionManager(){return this._extensionManager}get extensionsCascade(){return[]}get childrenAll(){const e=this.session.active;if(1===e.size)return e.values().next().value.cache.children;let t=[];for(const i of e.values())t=t.concat(i.cache.children);return t}get nextId(){return++this._nextId}get length(){return this.session.active.size}}Application.KEY_NAME="squared.application";class Application$1 extends Application{constructor(e,t,i){super(e,t,i),this.systemName="vdom"}insertNode(e,t){return"#text"!==e.nodeName?new this.Node(this.nextId,t,e):void 0}afterCreateCache(){}}class Controller{constructor(e){this.application=e,this.localSettings={mimeType:{font:"*",image:"*",audio:"*",video:"*"}}}init(){}sortInitialCache(e){}applyDefaultStyles(e,t){}reset(){}includeElement(e){return true}preventNodeCascade(e){return false}get generateSessionId(){return Date.now().toString()+"-"+this.application.session.active.size}get afterInsertNode(){return e=>{}}get userSettings(){return this.application.userSettings}}const{USER_AGENT:k,isUserAgent:T}=squared.lib.client,{CSS_PROPERTIES:C,CSS_TRAITS:I,CSS_UNIT:N,checkStyleValue:P,checkWritingMode:A,formatPX:R,getInheritedStyle:M,getStyle:L,hasComputedStyle:B,isAngle:W,isLength:H,isPercent:F,isTime:O,isPx:U,parseSelectorText:z,parseUnit:X}=squared.lib.css,{ELEMENT_BLOCK:q,assignRect:D,getNamedItem:j,getRangeClientRect:$,newBoxRectDimension:V}=squared.lib.dom,{CSS:G,FILE:Y}=squared.lib.regex,{actualClientRect:Q,actualTextRangeRect:K,deleteElementCache:J,getElementAsNode:Z,getElementCache:ee,getPseudoElt:te,setElementCache:ie}=squared.lib.session,{aboveRange:se,belowRange:ne,convertCamelCase:ae,convertFloat:le,convertInt:re,hasBit:oe,hasValue:he,isNumber:ce,isObject:de,iterateArray:ue,spliceString:fe,splitEnclosing:ge}=squared.lib.util,{SELECTOR_ATTR:me,SELECTOR_G:pe,SELECTOR_LABEL:ve,SELECTOR_PSEUDO_CLASS:be}=G,_e=C.borderTop.value,ye=C.borderRight.value,Ee=C.borderBottom.value,xe=C.borderLeft.value;function Se(e,t,i,s,n){if(n!==s)if(e.style.setProperty(t,s),ke(s,e.style.getPropertyValue(t)))ie(e,t,i,"auto"!==s?n:"");else return false;return true}function we(e,t,i){const s=ee(e,t,i);if(void 0!==s)e.style.setProperty(t,s),J(e,t,i)}const ke=(e,t)=>e===t||H(e,true)&&U(t),Te=(e,t)=>e.id<t.id?-1:1,Ce=e=>parseFloat(e.getPropertyValue("font-size")),Ie=e=>/\dem$/.test(e),Ne=e=>/^(inline|table-cell)/.test(e);function Pe(e,t,i,s){const n=(s||e).css(t);if(ce(n))return parseFloat(n);else if("inherit"===n&&!s)return Pe(e,t,i,e.actualParent);return i}function Ae(e,...t){const i=e.cssAscend("textAlign",{startSelf:e.textElement&&e.blockStatic&&!e.hasPX("width",{initial:true})});return""!==i&&t.includes(i)&&(e.blockStatic?e.textElement&&!e.hasPX("width",{initial:true})&&!e.hasPX("maxWidth",{initial:true}):e.display.startsWith("inline"))}function Re(e,t,i,s,n){const a={dimension:i},l=t[i],r=l?e.parseUnit(l,a):0;let o=Math.max(r,t[s]?e.parseUnit(t[s],a):0);if(0===o&&e.styleElement){const t=e.element;switch(t.tagName){case"IMG":case"INPUT":if("image"!==t.type)break;case"TD":case"TH":case"SVG":case"IFRAME":case"VIDEO":case"AUDIO":case"CANVAS":case"OBJECT":case"EMBED":{const s=j(t,i);if(""!==s)if(o=ce(s)?parseFloat(s):e.parseUnit(s,a),o>0)e.css(i,F(s)?s:s+"px");break}}}let h=0;if(r>0&&!e.imageElement){const s=t[n];if(s)if(l===s)delete t[n];else if(h=e.parseUnit(s,{dimension:i}),h>0&&h<=r&&l&&H(l))h=0,t[i]=s,delete t[n]}return h>0?Math.min(o,h):o}function Me(e,t,i){if(!e.plainText){switch(e.css(i[1])){case"none":case"initial":case"hidden":return 0}const s=e.css(i[0]),n=H(s,true)?e.parseUnit(s,{dimension:t}):le(e.style[i[0]]);if(n>0)return Math.max(Math.round(n),1)}return 0}function Le(e,t,i){var s;switch(e.display){case"table":if(!i&&"collapse"===e.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if(i){switch(e.tagName){case"TD":case"TH":return 0;default:{const i=e.ascend({condition:e=>"TABLE"===e.tagName})[0];if(i){const[s,n]=i.css("borderSpacing").split(" ");switch(t){case"marginTop":case"marginBottom":return n?e.parseUnit(n,{dimension:"height",parent:false}):e.parseUnit(s,{parent:false});case"marginRight":if(e.actualParent.lastChild!==e)return e.parseUnit(s,{parent:false});case"marginLeft":return 0}}break}}return 0}break}return e.parseUnit(e.css(t),{parent:!(true===(null===(s=e.actualParent)||void 0===s?void 0:s.gridElement))})}function Be(e,t){if(!e.positionStatic){const i=Oe.call(e,t,{modified:true});if(H(i))return e.parseUnit(i,{dimension:"left"===t||"right"===t?"width":"height"});else if(F(i)&&e.styleElement)return le(e.style[t])}return 0}function We(e,t,i,s,n,a){var l;if(i.all)return true;let r=i.tagName;if(r&&r!==t.tagName.toUpperCase())return false;if(i.id&&i.id!==t.elementId)return false;const{attrList:o,classList:h,notList:c,pseudoList:d}=i;if(d){const i=t.actualParent;r=t.tagName;let s=0;while(s<d.length){const o=d[s++];switch(o){case":first-child":case":nth-child(1)":if(t!==i.firstChild)return false;break;case":last-child":case":nth-last-child(1)":if(t!==i.lastChild)return false;break;case":only-child":if(i.naturalElements.length>1)return false;break;case":only-of-type":{const e=i.naturalElements,t=e.length;let s=0,n=0;while(s<t)if(e[s++].tagName===r&&++n>1)return false;break}case":first-of-type":{const e=i.naturalElements,s=e.length;let n=0;while(n<s){const i=e[n++];if(i.tagName===r){if(i!==t)return false;break}}break}case":nth-child(n)":case":nth-last-child(n)":break;case":empty":if(t.element.childNodes.length>0)return false;break;case":checked":switch(r){case"INPUT":if(!t.toElementBoolean("checked"))return false;break;case"OPTION":if(!t.toElementBoolean("selected"))return false;break;default:return false}break;case":enabled":if(!t.inputElement||t.toElementBoolean("disabled"))return false;break;case":disabled":if(!t.inputElement||!t.toElementBoolean("disabled"))return false;break;case":read-only":{const e=t.element;if(e.isContentEditable||("INPUT"===r||"TEXTAREA"===r)&&!e.readOnly)return false;break}case":read-write":{const e=t.element;if(!e.isContentEditable||("INPUT"===r||"TEXTAREA"===r)&&e.readOnly)return false;break}case":required":if(!t.inputElement||"BUTTON"===r||!t.toElementBoolean("required"))return false;break;case":optional":if(!t.inputElement||"BUTTON"===r||t.toElementBoolean("required"))return false;break;case":placeholder-shown":if(!(("INPUT"===r||"TEXTAREA"===r)&&""!==t.toElementString("placeholder")))return false;break;case":default":switch(r){case"INPUT":{const e=t.element;switch(e.type){case"radio":case"checkbox":if(!e.checked)return false;break;default:return false}break}case"OPTION":if(void 0===t.element.attributes.selected)return false;break;case"BUTTON":{const e=t.ascend({condition:e=>"FORM"===e.tagName})[0];if(e){let i=false;const s=t.element;if(ue(e.element.querySelectorAll("*"),e=>{switch(e.tagName){case"BUTTON":return i=s===e,true;case"INPUT":switch(e.type){case"submit":case"image":return i=s===e,true}break}}),!i)return false}break}default:return false}break;case":in-range":case":out-of-range":if("INPUT"===r){const e=t.element,i=parseFloat(e.value);if(!isNaN(i)){const t=parseFloat(e.min),s=parseFloat(e.max);if(i>=t&&i<=s){if(":out-of-range"===o)return false}else if(":in-range"===o)return false}else if(":in-range"===o)return false}else return false;break;case":indeterminate":if("INPUT"===r){const e=t.element;switch(e.type){case"checkbox":if(!e.indeterminate)return false;break;case"radio":if(e.checked)return false;else if(e.name)if(ue(((null===(l=t.ascend({condition:e=>"FORM"===e.tagName})[0])||void 0===l?void 0:l.element)||document).querySelectorAll(`input[type=radio][name="${e.name}"`),e=>e.checked)===1/0)return false;break;default:return false}}else if("PROGRESS"===r){if(-1!==t.toElementInt("value",-1))return false}else return false;break;case":target":if(""===location.hash)return false;else if(!(location.hash==="#"+t.elementId||"A"===r&&location.hash==="#"+t.toElementString("name")))return false;break;case":scope":if(!n||">"===a&&t!==e)return false;break;case":root":if(!n&&"HTML"!==e.tagName)return false;break;case":link":case":visited":case":any-link":case":hover":case":focus":case":focus-within":case":valid":case":invalid":{const e=t.element;if(ue(i.element.querySelectorAll(":scope > "+o),t=>t===e)!==1/0)return false;break}default:{let e=/^:nth(-last)?-(child|of-type)\((.+)\)$/.exec(o);if(e){const s=e[3].trim();let n=i.naturalElements;if(e[1])n=n.slice(0).reverse();const a="child"===e[2]?n.indexOf(t)+1:n.filter(e=>e.tagName===r).indexOf(t)+1;if(a>0){if(ce(s)){if(parseInt(s)!==a)return false}else switch(s){case"even":if(a%2!=0)return false;break;case"odd":if(a%2==0)return false;break;default:{const e=/^(-)?(\d+)?n\s*([+-]\d+)?$/.exec(s);if(e){const t=re(e[3]);if(e[2]){if(e[1])return false;const i=parseInt(e[2]);if(0!==i){if(a!==t)for(let e=i;;e+=i){const e=i+t;if(e===a)break;else if(e>a)return false}}else if(a!==t)return false}else if(e[3])if(t>0){if(e[1]){if(a>t)return false}else if(a<t)return false}else return false}break}}continue}}else if(t.attributes.lang)if(e=/^:lang\((.+)\)$/.exec(o),e)if(t.attributes.lang.trim().toLowerCase()===e[1].trim().toLowerCase())continue;return false}}}}if(c){let i=0;while(i<c.length){const a=c[i++],l={};switch(a.charAt(0)){case".":l.classList=[a];break;case"#":l.id=a.substring(1);break;case":":l.pseudoList=[a];break;case"[":{const e=me.exec(a);if(e){const t="i"===e[6];let i=e[3]||e[4]||e[5]||"";if(t)i=i.toLowerCase();l.attrList=[{key:e[1],symbol:e[2],value:i,caseInsensitive:t}],me.lastIndex=0}else continue;break}default:if(/^[a-z\d+#.-]+$/i.test(a))l.tagName=a;else return false;break}if(We(e,t,l,s,n))return false}}if(h){const e=t.element.classList;let i=0;while(i<h.length)if(!e.contains(h[i++]))return false}if(o){const e=t.attributes;let i=0;while(i<o.length){const t=o[i++];let s;if(t.endsWith){const i=new RegExp(`^(.+:)?${t.key}$`);for(const t in e)if(i.test(t)){s=e[t];break}}else s=e[t.key];if(void 0===s)return false;else{const e=t.value;if(e){if(t.caseInsensitive)s=s.toLowerCase();if(t.symbol)switch(t.symbol){case"~":if(!s.split(/\s+/).includes(e))return false;break;case"^":if(!s.startsWith(e))return false;break;case"$":if(!s.endsWith(e))return false;break;case"*":if(!s.includes(e))return false;break;case"|":if(s!==e&&!s.startsWith(e+"-"))return false;break}else if(s!==e)return false}}}}return true}function He(e,t,i,s,n,a){const l=e.depth,r=t[s],o=t.length,h=s===o-1,c=[],d=a.length;let u=0;while(u<d){const t=a[u++];if(n){const s=t.actualParent;if(">"===n){if(We(e,s,r,i,h,n))c.push(s)}else{const a=s.naturalElements;switch(n){case"+":{const s=a.indexOf(t)-1;if(s>=0){const t=a[s];if(We(e,t,r,i,h,n))c.push(t)}break}case"~":{const s=a.length;let l=0;while(l<s){const s=a[l++];if(s===t)break;else if(We(e,s,r,i,h,n))c.push(s)}break}}}}else if(t.depth-l>=o-s){let s=t.actualParent;do{if(We(e,s,r,i,h))c.push(s);s=s.actualParent}while(s)}}return c.length?++s===o?true:He(e,t,i,s,r.adjacent,c):false}const Fe=e=>e.naturalChild&&(0===e.length||Ne(e.display))&&!e.floating&&true!==e.autoMargin.horizontal;function Oe(e,t){return!this._preferInitial&&this._styleMap[e]||this.cssInitial(e,t)}class Node extends squared.lib.base.Container{constructor(e,t="0",i){if(super(),this.id=e,this.sessionId=t,this.documentRoot=false,this.depth=-1,this.childIndex=1/0,this._preferInitial=false,this._element=null,this._data={},this._inlineText=false,this._parent=null,i)this._element=i,this.style=!this.pseudoElement?L(i):L(i.parentElement,te(i,t));else this.style={},this._styleMap={}}init(){const e=this._element;if(e){const t=this.sessionId;if(!this.syncWith(t))this._styleMap={};if("0"!==t)ie(e,"node",t,this)}}syncWith(e,t){const i=this._element;if(i){if(!e)if((e=ee(i,"sessionId","0"))===this.sessionId)return true;const s=ee(i,"styleMap",e);if(s){if(this.styleElement){const e=this.style,t={},n=e.writingMode;if(!this.pseudoElement){const e=Array.from(i.style),t=e.length;if(t>0){let n=0;while(n<t){const t=e[n++];s[ae(t)]=i.style.getPropertyValue(t)}}}for(let a in s){const l=s[a],r=A(a,n);if(""!==r)if(!s[r])a=r;else continue;const o=P(i,a,l,e);if(""!==o)t[a]=o}this._styleMap=t}else this._styleMap=s;if(this._cssStyle=s,t)this._cached={};return true}}return false}saveAsInitial(){this._initial={styleMap:Object.assign({},this._styleMap),children:this.length>0?this.duplicate():void 0,bounds:this._bounds}}data(e,t,i,s=true){const n=this._data;if(null===i){if(n[e])delete n[e][t];return}else if(void 0!==i){let a=n[e];if(!de(a))a={},n[e]=a;if(s||void 0===a[t])a[t]=i}const a=n[e];return de(a)?a[t]:void 0}unsetCache(...e){const t=e.length;if(t>0){const i=this._cached;let s=0;while(s<t){const t=e[s++];switch(t){case"position":if(!this._preferInitial)this.cascade(e=>!e.pageFlow&&e.unsetCache("absoluteParent"));case"display":case"float":case"tagName":return void(this._cached={});case"width":i.actualWidth=void 0,i.percentWidth=void 0;case"minWidth":i.width=void 0;break;case"height":i.actualHeight=void 0,i.percentHeight=void 0;case"minHeight":if(i.height=void 0,!this._preferInitial)this.unsetCache("blockVertical"),this.each(e=>e.unsetCache("height","actualHeight","blockVertical","overflow","bottomAligned"));break;case"verticalAlign":i.baseline=void 0;break;case"left":case"right":case"textAlign":i.rightAligned=void 0,i.centerAligned=void 0;break;case"top":case"bottom":i.bottomAligned=void 0;break;default:if(t.startsWith("margin"))i.autoMargin=void 0,i.rightAligned=void 0,i.centerAligned=void 0;else if(t.startsWith("padding"))i.contentBoxWidth=void 0,i.contentBoxHeight=void 0;else if(t.startsWith("border"))i.visibleStyle=void 0,i.contentBoxWidth=void 0,i.contentBoxHeight=void 0;else if(t.startsWith("background"))i.visibleStyle=void 0;else if(Node.TEXT_STYLE.includes(t))i.lineHeight=void 0,this._textStyle=void 0;break}if(t in i)i[t]=void 0}}else this._cached={},this._textStyle=void 0;if(!this._preferInitial){let t;if(e.some(e=>oe(C[e].trait,8)))t=this.pageFlow&&this.ascend({condition:e=>e.documentRoot})[0]||this;else if(e.some(e=>oe(C[e].trait,16)))t=this;if(t){t.resetBounds();const e=t.queryMap;if(e){const t=e.length;let i,s=0;while(s<t){const t=e[s++],n=t.length;i=0;while(i<n)t[i++].resetBounds()}}else this.cascade(e=>e.resetBounds())}}}ascend(e){let t=e.attr;if(!t)t="actualParent";else if(!/[pP]arent$/.test(t))return[];const{condition:i,including:s,error:n,every:a,excluding:l}=e,r=[];let o=e.startSelf?this:this[t];while(o&&o!==l){if(n&&n(o))break;if(i){if(i(o))if(r.push(o),!a)break}else r.push(o);if(o===s)break;o=o[t]}return r}intersectX(e,t="linear"){if(e.width>0){const{left:i,right:s}=this[t],{left:n,right:a}=e;return Math.ceil(i)>=n&&i<Math.floor(a)||Math.floor(s)>n&&s<=Math.ceil(a)||Math.ceil(n)>=i&&n<Math.floor(s)||Math.floor(a)>i&&a<=Math.ceil(s)}return false}intersectY(e,t="linear"){if(e.height>0){const{top:i,bottom:s}=this[t],{top:n,bottom:a}=e;return Math.ceil(i)>=n&&i<Math.floor(a)||Math.floor(s)>n&&s<=Math.ceil(a)||Math.ceil(n)>=i&&n<Math.floor(s)||Math.floor(a)>i&&a<=Math.ceil(s)}return false}withinX(e,t="linear"){if(this.pageFlow||e.width>0){const{left:i,right:s}=this[t];return se(i,e.left)&&ne(s,e.right)}return true}withinY(e,t="linear"){if(this.pageFlow||e.height>0){const{top:i,bottom:s}=this[t];return Math.ceil(i)>=e.top&&Math.floor(s)<=e.bottom}return true}outsideX(e,t="linear"){if(this.pageFlow||e.width>0){const{left:i,right:s}=this[t];return i<Math.floor(e.left)||s>Math.ceil(e.right)}return false}outsideY(e,t="linear"){if(this.pageFlow||e.height>0){const{top:i,bottom:s}=this[t];return i<Math.floor(e.top)||s>Math.ceil(e.bottom)}return false}css(e,t,i=true){if(t&&this.styleElement)if(this.style[e]=t,ke(t,this.style[e])){if(this._styleMap[e]=t,i)this.unsetCache(e);return t}return this._styleMap[e]||this.styleElement&&this.style[e]||""}cssApply(e,t=true){for(const i in e){const s=e[i];if(this.css(i,s,t)===s&&t)this.unsetCache(i)}return this}cssParent(e,t,i=false){var s;return(null===(s=this.actualParent)||void 0===s?void 0:s.css(e,t,i))||""}cssInitial(e,t){var i;return((null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e]||(null==t?void 0:t.modified)&&this._styleMap[e]||(null==t?void 0:t.computed)&&this.style[e]||""}cssAscend(e,t){let i,s;if(t)({startSelf:i,initial:s}=t);let n,a=i?this:this.actualParent;while(a){if(n=s?a.cssInitial(e):a.css(e),""!==n)return n;if(a.documentBody)break;a=a.actualParent}return""}cssAny(e,t){const i=t.initial?this.cssInitial(e,t):this.css(e);return""!==i&&t.values.includes(i)}cssSort(e,t={}){const i=false!==t.ascending,s=true===t.byFloat,n=!s&&true===t.byInt;return(t.duplicate?this.duplicate():this.children).sort((t,a)=>{let l,r;if(s)l=t.toFloat(e,t.childIndex),r=a.toFloat(e,a.childIndex);else if(n)l=t.toInt(e,t.childIndex),r=a.toInt(e,a.childIndex);else l=t.css(e),r=a.css(e);if(l===r)return 0;else if(i)return l<r?-1:1;return l>r?-1:1})}cssPX(e,t,i,s){const n=this._styleMap[e];if(n&&H(n)){if((t+=X(n,this.fontSize))<0&&true!==(null==s?void 0:s.negative))t=0;const a=R(t);if(this.css(e,a),i)this.unsetCache(e);return a}return""}cssSpecificity(e){var t,i;let s;if(this.styleElement){const n=this._element;s=this.pseudoElement?null===(t=ee(n.parentElement,"styleSpecificity"+te(n,this.sessionId),this.sessionId))||void 0===t?void 0:t[e]:null===(i=ee(n,"styleSpecificity",this.sessionId))||void 0===i?void 0:i[e]}return s||0}cssTry(e,t){if(this.styleElement){const i=this._element;return Se(i,e,this.sessionId,t,L(i).getPropertyValue(e))}return false}cssFinally(e){if(this.styleElement){const t=this._element;if("string"==typeof e)we(t,e,this.sessionId);else for(const i in e)we(t,i,this.sessionId)}}cssTryAll(e){if(this.styleElement){const t=[],i=this._element,s=L(i);for(const n in e)if(Se(i,n,this.sessionId,e[n],s.getPropertyValue(n)))t.push(n);else{let e=0;while(e<t.length)this.cssFinally(t[e++]);return}return e}}cssCopy(e,...t){const i=this._styleMap;let s=0;while(s<t.length){const n=t[s++];i[n]=e.css(n)}}cssCopyIfEmpty(e,...t){const i=this._styleMap;let s=0;while(s<t.length){const n=t[s++];if(!he(i[n]))i[n]=e.css(n)}}cssAsTuple(...e){const t=e.length,i=new Array(t);let s=0;while(s<t)i[s]=this.css(e[s++]);return i}cssAsObject(...e){const t={};let i=0;while(i<e.length){const s=e[i++];t[s]=this.css(s)}return t}toInt(e,t=NaN,i=false){var s;const n=parseInt((i&&(null===(s=this._initial)||void 0===s?void 0:s.styleMap)||this._styleMap)[e]);return!isNaN(n)?n:t}toFloat(e,t=NaN,i=false){var s;const n=parseFloat((i&&(null===(s=this._initial)||void 0===s?void 0:s.styleMap)||this._styleMap)[e]);return!isNaN(n)?n:t}toElementInt(e,t=NaN){var i;const s=parseInt(null===(i=this._element)||void 0===i?void 0:i[e]);return!isNaN(s)?s:t}toElementFloat(e,t=NaN){var i;const s=parseFloat(null===(i=this._element)||void 0===i?void 0:i[e]);return!isNaN(s)?s:t}toElementBoolean(e,t=false){var i;const s=null===(i=this._element)||void 0===i?void 0:i[e];return"boolean"==typeof s?s:t}toElementString(e,t=""){var i,s;return(null!==(s=null===(i=this._element)||void 0===i?void 0:i[e])&&void 0!==s?s:t).toString()}parseUnit(e,t){var i;if(F(e)){const s=false!==(null==t?void 0:t.parent)&&(null===(i=this.absoluteParent)||void 0===i?void 0:i.box)||this.bounds;let n=parseFloat(e)/100;switch(null==t?void 0:t.dimension){case"height":n*=s.height;break;default:n*=s.width;break}return n}return X(e,this.fontSize,null==t?void 0:t.screenDimension)}has(e,t){var i,s;const n=("initial"===(null==t?void 0:t.map)&&(null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e];if(n){if("initial"===n||n===(null===(s=C[e])||void 0===s?void 0:s.value))return false;let i,a;if(t)({not:i,type:a}=t);if(i)if(n===i)return false;else if(Array.isArray(i)){let e=0;while(e<i.length)if(n===i[e++])return false}if(a)return oe(a,2)&&H(n)||oe(a,4)&&F(n)||oe(a,8)&&O(n)||oe(a,16)&&W(n);else return true}return false}hasPX(e,t){var i;let s,n;if(t)({initial:s,percent:n}=t);const a=(s&&(null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e];return!!a&&H(a,false!==n)}setBounds(e=true){let t;if(this.styleElement){if(!e)J(this._element,"clientRect",this.sessionId);t=D(Q(this._element,this.sessionId)),this._bounds=t}else if(this.plainText){const e=$(this._element);t=D(e);const i=e.numberOfLines;t.numberOfLines=i,this._bounds=t,this._textBounds=t,this._cached.multiline=i>1}if(!e&&t)this._box=void 0,this._linear=void 0;return t}resetBounds(){this._bounds=void 0,this._box=void 0,this._linear=void 0,this._textBounds=void 0,this._cached.multiline=void 0}querySelector(e){return this.querySelectorAll(e,1)[0]||null}querySelectorAll(e,t=-1){let i=[];const s=this.queryMap;if(s&&0!==t){const n=z(e);let a=n.length,l=0;while(l<a){const e=n[l++],r=[];let o=-1;if("*"===e)r.push({all:true}),++o;else{e:{let t,i;while(i=pe.exec(e)){let e=i[1],s=false;if(1===e.length){const i=e.charAt(0);switch(i){case"+":case"~":--o;case">":if(t||0===r.length){r.length=0;break e}t=i;continue;case"*":s=true;break}}else if(e.startsWith("*|*")){if(e.length>3){r.length=0;break e}s=true}else if(e.startsWith("*|"))e=e.substring(2);else if(e.startsWith("::")){r.length=0;break e}if(s)r.push({all:true});else{let i,s,n,a,l,o,h;while(h=me.exec(e)){if(!a)a=[];let t=h[1].replace("\\:",":"),i=false;switch(t.indexOf("|")){case-1:break;case 1:if("*"===t.charAt(0)){i=true,t=t.substring(2);break}default:r.length=0;break e}const s="i"===h[6];let n=h[3]||h[4]||h[5]||"";if(s)n=n.toLowerCase();a.push({key:t,symbol:h[2],value:n,endsWith:i,caseInsensitive:s}),e=fe(e,h.index,h[0].length)}if(e.includes("::")){r.length=0;break e}while(h=be.exec(e)){const t=h[0];if(t.startsWith(":not(")){if(h[1]){if(!o)o=[];o.push(h[1])}}else{if(!l)l=[];l.push(t)}e=fe(e,h.index,t.length)}while(h=ve.exec(e)){const t=h[0];switch(t.charAt(0)){case"#":s=t.substring(1);break;case".":if(!n)n=[];n.push(t.substring(1));break;default:i=t.toUpperCase();break}e=fe(e,h.index,t.length)}r.push({tagName:i,id:s,adjacent:t,classList:n,pseudoList:l,notList:o,attrList:a})}++o,t=void 0}}pe.lastIndex=0}if(a=s.length,r.length>0&&-1!==o&&o<a){const e=r.pop(),h=0===r.length,c=i.length;let d;if(e.all&&a-o==1)d=s[o];else{d=[];let t=o;while(t<a){const n=s[t++];if(e.all)d=d.concat(n);else{const t=n.length;let s=0;while(s<t){const t=n[s++];if((0===c||!i.includes(t))&&We(this,t,e,l,h))d.push(t)}}}}if(r.length>0){r.reverse();let s=c;const n=d.length;let a=0;while(a<n){const n=d[a++];if((0===c||!i.includes(n))&&He(this,r,l,0,e.adjacent,[n]))if(i.push(n),++s===t)return i.sort(Te)}}else if(0===c)if(l===n.length-1||t>0&&t<=d.length){if(t>0&&d.length>t)d.length=t;return d.sort(Te)}else i=d;else{const e=d.length;if(t>0){let s=c,n=0;while(n<e){const e=d[n++];if(!i.includes(e))if(i.push(e),++s===t)return i.sort(Te)}}else{let t=0;while(t<e){const e=d[t++];if(!i.includes(e))i.push(e)}}}}}}return i.sort(Te)}set $parent(e){this._parent=e}set parent(e){if(e){const t=this._parent;if(e!==t)null==t||t.remove(this),this._parent=e,e.add(this);else if(!e.contains(this))e.add(this);if(-1===this.depth)this.depth=e.depth+1}}get parent(){return this._parent}get tagName(){let e=this._cached.tagName;if(void 0===e){const t=this._element;if(t){const i=t.nodeName;e="#"===i.charAt(0)?i:t.tagName}else e="";this._cached.tagName=e}return e}get element(){return this._element}get elementId(){var e;return((null===(e=this._element)||void 0===e?void 0:e.id)||"").trim()}get htmlElement(){let e=this._cached.htmlElement;if(void 0===e)e=!this.plainText&&this._element instanceof HTMLElement,this._cached.htmlElement=e;return e}get svgElement(){let e=this._cached.svgElement;if(void 0===e)e=!this.htmlElement&&!this.plainText&&this._element instanceof SVGElement||this.imageElement&&Y.SVG.test(this.toElementString("src")),this._cached.svgElement=e;return e}get styleElement(){return this.htmlElement||this.svgElement}get naturalChild(){return true}get naturalElement(){let e=this._cached.naturalElement;if(void 0===e)e=this.naturalChild&&this.styleElement&&!this.pseudoElement,this._cached.naturalElement=e;return e}get parentElement(){var e,t;return(null===(e=this._element)||void 0===e?void 0:e.parentElement)||(null===(t=this.actualParent)||void 0===t?void 0:t.element)||null}get textElement(){return this.plainText||this.inlineText&&"BUTTON"!==this.tagName}get pseudoElement(){return false}get imageElement(){return"IMG"===this.tagName}get flexElement(){return this.display.endsWith("flex")}get gridElement(){return this.display.endsWith("grid")}get tableElement(){return"TABLE"===this.tagName||"table"===this.display}get inputElement(){switch(this.tagName){case"INPUT":case"BUTTON":case"SELECT":case"TEXTAREA":return true;default:return false}}get plainText(){return"#text"===this.tagName}get styleText(){return this.naturalElement&&this.inlineText}get lineBreak(){return"BR"===this.tagName}get display(){return this.css("display")}get positionRelative(){return"relative"===this.css("position")}get floating(){return"none"!==this.float}get float(){return this.pageFlow&&this.css("float")||"none"}get zIndex(){return this.toInt("zIndex",0)}get textContent(){return this.naturalChild&&!this.svgElement?this._element.textContent:""}get dataset(){if(this.styleElement)return this._element.dataset;else{let e=this._dataset;if(void 0===e)e={},this._dataset=e;return e}}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||this.setBounds(false)||D(this.boundingClientRect)}get linear(){if(void 0===this._linear){const e=this.bounds;if(e)if(this.styleElement){const{marginBottom:t,marginRight:i}=this,s=Math.max(this.marginTop,0),n=Math.max(this.marginLeft,0);this._linear={top:e.top-s,right:e.right+i,bottom:e.bottom+t,left:e.left-n,width:e.width+n+i,height:e.height+s+t}}else this._linear=e;else return V()}return this._linear}get box(){if(void 0===this._box){const e=this.bounds;if(e)if(this.styleElement&&this.naturalChildren.length>0)this._box={top:e.top+(this.paddingTop+this.borderTopWidth),right:e.right-(this.paddingRight+this.borderRightWidth),bottom:e.bottom-(this.paddingBottom+this.borderBottomWidth),left:e.left+(this.paddingLeft+this.borderLeftWidth),width:e.width-this.contentBoxWidth,height:e.height-this.contentBoxHeight};else this._box=e;else return V()}return this._box}get flexdata(){let e=this._cached.flexdata;if(void 0===e){if(this.flexElement){const{flexWrap:t,flexDirection:i,alignContent:s,justifyContent:n}=this.cssAsObject("flexWrap","flexDirection","alignContent","justifyContent"),a=i.startsWith("row");e={row:a,column:!a,reverse:i.endsWith("reverse"),wrap:t.startsWith("wrap"),wrapReverse:"wrap-reverse"===t,alignContent:s,justifyContent:n}}else e={};this._cached.flexdata=e}return e}get flexbox(){let e=this._cached.flexbox;if(void 0===e){if(this.styleElement&&this.actualParent.flexElement){const[t,i,s]=this.cssAsTuple("alignSelf","justifySelf","flexBasis");e={alignSelf:"auto"===t?this.cssParent("alignItems"):t,justifySelf:"auto"===i?this.cssParent("justifyItems"):i,basis:s,grow:Pe(this,"flexGrow",0),shrink:Pe(this,"flexShrink",1),order:this.toInt("order",0)}}else e={};this._cached.flexbox=e}return e}get width(){let e=this._cached.width;if(void 0===e)e=Re(this,this._styleMap,"width","minWidth","maxWidth"),this._cached.width=e;return e}get height(){let e=this._cached.height;if(void 0===e)e=Re(this,this._styleMap,"height","minHeight","maxHeight"),this._cached.height=e;return e}get hasWidth(){let e=this._cached.hasWidth;if(void 0===e)e=this.width>0,this._cached.hasWidth=e;return e}get hasHeight(){var e;let t=this._cached.hasHeight;if(void 0===t){const i=this.css("height");if(F(i))t=this.pageFlow?(null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)||this.documentBody:"fixed"===this.css("position")||this.hasPX("top")||this.hasPX("bottom");else t=this.height>0||this.hasPX("height",{percent:false});this._cached.hasHeight=t}return t}get lineHeight(){var e;let t=this._cached.lineHeight;if(void 0===t){if(t=0,!this.imageElement&&!this.svgElement){let i=this.has("lineHeight"),s=0;if(i){const t=this.css("lineHeight");if(F(t))s=le(this.style.lineHeight);else if(ce(t))s=parseFloat(t)*this.fontSize;else if(s=X(t,this.fontSize),U(t)&&"inherit"!==(null===(e=this._cssStyle)||void 0===e?void 0:e.lineHeight)){const e=Oe.call(this,"fontSize");if(Ie(e))s*=parseFloat(e)}}else{let e=this.ascend({condition:e=>e.has("lineHeight")})[0];if(e){const t=e.css("lineHeight");if(ce(t))s=parseFloat(t)*this.fontSize,i=true}if(0===s)if(e=this.ascend({condition:e=>e.lineHeight>0})[0],e)s=e.lineHeight;if(this.styleElement){const e=Oe.call(this,"fontSize");if(Ie(e)){const t=parseFloat(e);if(1!==t)s*=t,this.css("lineHeight",R(s)),i=true}}}if(i||s>this.height||this.multiline||this.block&&this.naturalChildren.some(e=>e.textElement))t=s}this._cached.lineHeight=t}return t}get positionStatic(){var e;let t=this._cached.positionStatic;if(void 0===t){switch(this.css("position")){case"absolute":case"fixed":t=false;break;case"relative":t=!this.documentBody&&0===this.toFloat("top",0)&&0===this.toFloat("right",0)&&0===this.toFloat("bottom",0)&&0===this.toFloat("left",0),this._cached.positionRelative=!t;break;case"inherit":{const i=null===(e=this._element)||void 0===e?void 0:e.parentElement;if(i){const e=M(i,"position");t="static"===e||"initial"===e}else t=true;break}default:t=true;break}this._cached.positionStatic=t}return t}get top(){let e=this._cached.top;if(void 0===e)e=Be(this,"top"),this._cached.top=e;return e}get right(){let e=this._cached.right;if(void 0===e)e=Be(this,"right"),this._cached.right=e;return e}get bottom(){let e=this._cached.bottom;if(void 0===e)e=Be(this,"bottom"),this._cached.bottom=e;return e}get left(){let e=this._cached.left;if(void 0===e)e=Be(this,"left"),this._cached.left=e;return e}get marginTop(){let e=this._cached.marginTop;if(void 0===e)e=this.inlineStatic?0:Le(this,"marginTop",true),this._cached.marginTop=e;return e}get marginRight(){let e=this._cached.marginRight;if(void 0===e)e=Le(this,"marginRight",true),this._cached.marginRight=e;return e}get marginBottom(){let e=this._cached.marginBottom;if(void 0===e)e=this.inlineStatic?0:Le(this,"marginBottom",true),this._cached.marginBottom=e;return e}get marginLeft(){let e=this._cached.marginLeft;if(void 0===e)e=Le(this,"marginLeft",true),this._cached.marginLeft=e;return e}get borderTopWidth(){let e=this._cached.borderTopWidth;if(void 0===e)e=Me(this,"height",_e),this._cached.borderTopWidth=e;return e}get borderRightWidth(){let e=this._cached.borderRightWidth;if(void 0===e)e=Me(this,"height",ye),this._cached.borderRightWidth=e;return e}get borderBottomWidth(){let e=this._cached.borderBottomWidth;if(void 0===e)e=Me(this,"width",Ee),this._cached.borderBottomWidth=e;return e}get borderLeftWidth(){let e=this._cached.borderLeftWidth;if(void 0===e)e=Me(this,"width",xe),this._cached.borderLeftWidth=e;return e}get paddingTop(){let e=this._cached.paddingTop;if(void 0===e)e=Le(this,"paddingTop",false),this._cached.paddingTop=e;return e}get paddingRight(){let e=this._cached.paddingRight;if(void 0===e)e=Le(this,"paddingRight",false),this._cached.paddingRight=e;return e}get paddingBottom(){let e=this._cached.paddingBottom;if(void 0===e)e=Le(this,"paddingBottom",false),this._cached.paddingBottom=e;return e}get paddingLeft(){let e=this._cached.paddingLeft;if(void 0===e)e=Le(this,"paddingLeft",false),this._cached.paddingLeft=e;return e}get contentBox(){return"border-box"!==this.css("boxSizing")||this.tableElement&&T(8)}get contentBoxWidth(){let e=this._cached.contentBoxWidth;if(void 0===e)e=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth,this._cached.contentBoxWidth=e;return e}get contentBoxHeight(){let e=this._cached.contentBoxHeight;if(void 0===e)e=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth,this._cached.contentBoxHeight=e;return e}get inline(){let e=this._cached.inline;if(void 0===e){const t=this.display;e="inline"===t||"initial"===t&&!q.includes(this.tagName),this._cached.inline=e}return e}get inlineStatic(){let e=this._cached.inlineStatic;if(void 0===e)e=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement,this._cached.inlineStatic=e;return e}set inlineText(e){switch(this.tagName){case"IMG":case"INPUT":case"SELECT":case"TEXTAREA":case"SVG":case"BR":case"HR":case"PROGRESS":case"METER":case"CANVAS":this._inlineText=false;break;case"BUTTON":this._inlineText=""!==this.textContent.trim();break;default:this._inlineText=e;break}}get inlineText(){return this._inlineText}get block(){let e=this._cached.block;if(void 0===e){switch(this.display){case"block":case"flex":case"grid":case"list-item":e=true;break;case"initial":e=q.includes(this.tagName);break;case"inline":if("svg"===this.tagName&&this.actualParent.htmlElement){e=!this.hasPX("width")&&0===le(j(this._element,"width"));break}default:e=false;break}this._cached.block=e}return e}get blockStatic(){let e=this._cached.blockStatic;if(void 0===e){e=false;const t=this.pageFlow;if(t&&(this.block&&!this.floating||this.lineBreak))e=true;else if(!t||!this.inline&&!this.display.startsWith("table-")&&!this.hasPX("maxWidth")){const t=Oe.call(this,"width"),i=Oe.call(this,"minWidth");let s=0;if(F(t))s=parseFloat(t);if(F(i))s=Math.max(parseFloat(i),s);if(s>0){const t=Oe.call(this,"marginLeft"),i=Oe.call(this,"marginRight");e=s+(F(t)?parseFloat(t):0)+(F(i)?parseFloat(i):0)>=100}}this._cached.blockStatic=e}return e}get pageFlow(){let e=this._cached.pageFlow;if(void 0===e)e=this.positionStatic||this.positionRelative,this._cached.pageFlow=e;return e}get centerAligned(){let e=this._cached.centerAligned;if(void 0===e)e=!this.pageFlow?this.hasPX("left")&&this.hasPX("right"):this.autoMargin.leftRight||Fe(this)&&Ae(this,"center"),this._cached.centerAligned=e;return e}get rightAligned(){let e=this._cached.rightAligned;if(void 0===e)e=!this.pageFlow?this.hasPX("right")&&!this.hasPX("left"):"right"===this.float||this.autoMargin.left||Fe(this)&&Ae(this,"right","end"),this._cached.rightAligned=e;return e}get bottomAligned(){var e;let t=this._cached.bottomAligned;if(void 0===t)t=!this.pageFlow?this.hasPX("bottom")&&!this.hasPX("top"):true===(null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)&&true===this.autoMargin.top,this._cached.bottomAligned=t;return t}get autoMargin(){let e=this._cached.autoMargin;if(void 0===e){if(!this.pageFlow||this.blockStatic||"table"===this.display){const t=this._styleMap,i="auto"===t.marginLeft&&(this.pageFlow||this.hasPX("right")),s="auto"===t.marginRight&&(this.pageFlow||this.hasPX("left")),n="auto"===t.marginTop&&(this.pageFlow||this.hasPX("bottom")),a="auto"===t.marginBottom&&(this.pageFlow||this.hasPX("top"));e={horizontal:i||s,left:i&&!s,right:!i&&s,leftRight:i&&s,vertical:n||a,top:n&&!a,bottom:!n&&a,topBottom:n&&a}}else e={};this._cached.autoMargin=e}return e}get baseline(){let e=this._cached.baseline;if(void 0===e){if(this.pageFlow&&!this.floating){const t=this.css("verticalAlign");e="baseline"===t||"initial"===t||0===this.naturalElements.length&&H(t,true)}else e=false;this._cached.baseline=e}return e}get verticalAlign(){let e=this._cached.verticalAlign;if(void 0===e){if(this.pageFlow){if(e=this.css("verticalAlign"),H(e,true))e=this.parseUnit(e,{dimension:"height"})+"px"}else e="0px";this._cached.verticalAlign=e}return e}set textBounds(e){this._textBounds=e}get textBounds(){let e=this._textBounds;if(void 0===e){if(e=null,this.naturalChild)if(this.textElement)e=K(this._element,this.sessionId);else{const t=this.naturalChildren,i=t.length;if(i>0){let s=1/0,n=-1/0,a=-1/0,l=1/0,r=0,o=0;while(o<i){const e=t[o++];if(e.textElement){const t=K(e.element,e.sessionId);s=Math.min(t.top,s),n=Math.max(t.right,n),l=Math.min(t.left,l),a=Math.max(t.bottom,a),r+=t.numberOfLines||0}}if(r>0)e={top:s,right:n,left:l,bottom:a,width:n-l,height:a-s,numberOfLines:r}}}this._textBounds=e}return e}get multiline(){var e;let t=this._cached.multiline;if(void 0===t){if(this.styleText)t=(this.inline||0===this.naturalElements.length||Ne(this.display)||this.floating)&&(null===(e=this.textBounds)||void 0===e?void 0:e.numberOfLines)>1;else t=this.plainText&&Math.floor($(this._element).width)>this.actualParent.box.width;this._cached.multiline=t}return t}get backgroundColor(){let e=this._cached.backgroundColor;if(void 0===e){if(!this.plainText)switch(e=this.css("backgroundColor"),e){case"initial":case"transparent":case"rgba(0, 0, 0, 0)":if(e="",this.inputElement)if("BUTTON"===this.tagName)e="rgba(0, 0, 0, 0)";else switch(this.toElementString("type")){case"button":case"submit":case"reset":case"image":e="rgba(0, 0, 0, 0)";break}break;default:if(""!==e&&this.styleElement&&!this.inputElement&&(!this._initial||Oe.call(this,"backgroundColor")===e)){let t=this.actualParent;while(t){const i=Oe.call(t,"backgroundColor",{modified:true});if(""!==i){if(i===e&&""===t.backgroundColor)e="";break}t=t.actualParent}}break}else e="";this._cached.backgroundColor=e}return e}get backgroundImage(){let e=this._cached.backgroundImage;if(void 0===e){if(!this.plainText){let t=this.css("backgroundImage");if(""!==t&&"none"!==t&&"initial"!==t)e=t;else{e="";const i=/\s*(url|[a-z-]+gradient)/;if(t=this.css("background"),i.test(t)){const s=ge(t),n=s.length;for(let t=1;t<n;++t){const n=s[t-1].trim();if(i.test(n))e+=(""!==e?", ":"")+n+s[t]}}}}else e="";this._cached.backgroundImage=e}return e}get percentWidth(){let e=this._cached.percentWidth;if(void 0===e){const t=Oe.call(this,"width");e=F(t)?parseFloat(t)/100:0,this._cached.percentWidth=e}return e}get percentHeight(){var e;let t=this._cached.percentHeight;if(void 0===t){const i=Oe.call(this,"height");t=F(i)&&((null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)||"fixed"===this.css("position"))?parseFloat(i)/100:0,this._cached.percentHeight=t}return t}get visibleStyle(){let e=this._cached.visibleStyle;if(void 0===e){if(!this.plainText){const t=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,i=""!==this.backgroundColor,s=""!==this.backgroundImage;let n=false,a=false;if(s)for(const e of this.css("backgroundRepeat").split(",")){const[t,i]=e.trim().split(" ");if(!n)n="repeat"===t||"repeat-x"===t;if(!a)a="repeat"===t||"repeat-y"===t||"repeat"===i}e={background:t||s||i,borderWidth:t,backgroundImage:s,backgroundColor:i,backgroundRepeat:n||a,backgroundRepeatX:n,backgroundRepeatY:a}}else e={};this._cached.visibleStyle=e}return e}get absoluteParent(){let e=this._cached.absoluteParent;if(void 0===e){if(e=this.actualParent,!this.pageFlow&&!this.documentBody)while(e&&!e.documentBody){switch(Oe.call(e,"position",{computed:true})){case"static":case"initial":case"unset":e=e.actualParent;continue}break}this._cached.absoluteParent=e}return e}set actualParent(e){this._cached.actualParent=e}get actualParent(){var e;let t=this._cached.actualParent;if(void 0===t){const i=null===(e=this._element)||void 0===e?void 0:e.parentElement;t=i&&Z(i,this.sessionId)||null,this._cached.actualParent=t}return t}get actualWidth(){var e;let t=this._cached.actualWidth;if(void 0===t){if(this.plainText){const e=this.bounds;switch(e.numberOfLines||1){case 1:t=e.width;break;case 2:t=Math.min(e.width,this.actualParent.box.width);break;default:t=Math.min(e.right-e.left,this.actualParent.box.width);break}}else if(this.inlineStatic||"table-cell"===this.display||true===(null===(e=this.actualParent)||void 0===e?void 0:e.flexdata.row))t=this.bounds.width;else if(t=this.width,t>0){if(this.contentBox&&!this.tableElement)t+=this.contentBoxWidth}else t=this.bounds.width;this._cached.actualWidth=t}return t}get actualHeight(){var e;let t=this._cached.actualHeight;if(void 0===t){if(this.inlineStatic||"table-cell"===this.display||true===(null===(e=this.actualParent)||void 0===e?void 0:e.flexdata.column))t=this.bounds.height;else if(t=this.height,t>0){if(this.contentBox&&!this.tableElement)t+=this.contentBoxHeight}else t=this.bounds.height;this._cached.actualHeight=t}return t}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}set naturalChildren(e){this._naturalChildren=e}get naturalChildren(){return this._naturalChildren||function(e){var t;let i;if(e.naturalElement){i=[];const t=e.sessionId;let s=0;e.element.childNodes.forEach(e=>{const n=Z(e,t);if(n)n.childIndex=s++,i.push(n)})}else i=((null===(t=e.initial)||void 0===t?void 0:t.children)||e.children).slice(0);return e.naturalChildren=i,i}(this)}set naturalElements(e){this._naturalElements=e}get naturalElements(){return this._naturalElements||function(e){const t=e.naturalChildren.filter(e=>e.naturalElement);return e.naturalElements=t,t}(this)}get firstChild(){return this.naturalElements[0]||null}get lastChild(){const e=this.naturalElements,t=e.length;return t?e[t-1]:null}get previousSibling(){var e;return(null===(e=this.actualParent)||void 0===e?void 0:e.naturalChildren[this.childIndex-1])||null}get nextSibling(){var e;return(null===(e=this.actualParent)||void 0===e?void 0:e.naturalChildren[this.childIndex+1])||null}get previousElementSibling(){var e;const t=null===(e=this.actualParent)||void 0===e?void 0:e.naturalElements;if(t){const e=t.indexOf(this);if(e>0)return t[e-1]}return null}get nextElementSibling(){var e;const t=null===(e=this.actualParent)||void 0===e?void 0:e.naturalElements;if(t){const e=t.indexOf(this);if(-1!==e)return t[e+1]||null}return null}get attributes(){let e=this._cached.attributes;if(void 0===e){if(e={},this.styleElement){const t=this._element.attributes,i=t.length;let s=0;while(s<i){const i=t.item(s++);e[i.name]=i.value}}this._cached.attributes=e}return e}get boundingClientRect(){var e;return this.naturalElement&&(null===(e=this._element)||void 0===e?void 0:e.getBoundingClientRect())||this._bounds||V()}get fontSize(){var e,t,i,s;let n=this._fontSize;if(void 0===n){if(this.naturalChild&&this.styleElement){const i=Oe.call(this,"fontSize");if(U(i))n=parseFloat(i);else if(F(i)&&this._element!==document.documentElement)n=(null!==(t=null===(e=this.actualParent)||void 0===e?void 0:e.fontSize)&&void 0!==t?t:Ce(L(this._element.parentElement||document.documentElement)))*parseFloat(i)/100;else n=Ce(this.style)}else n=X(this.css("fontSize"));if(0===n&&!this.naturalChild){const e=this.element;n=e&&B(e)?(null===(i=Z(e,this.sessionId))||void 0===i?void 0:i.fontSize)||Ce(L(e)):(null===(s=this.ascend({condition:e=>e.fontSize>0})[0])||void 0===s?void 0:s.fontSize)||Ce(L(document.documentElement))}this._fontSize=n}return n}get cssStyle(){return Object.assign({},this._cssStyle)}get textStyle(){let e=this._textStyle;if(void 0===e)e=this.cssAsObject(...Node.TEXT_STYLE),e.fontSize=this.fontSize+"px",this._textStyle=e;return e}set dir(e){this._cached.dir=e}get dir(){let e=this._cached.dir;if(void 0===e){if(e=this.naturalElement?this._element.dir:"",""===e){let t=this.actualParent;while(t){if(e=t.dir,""!==e)break;t=t.actualParent}}this._cached.dir=e}return e}get center(){const e=this.bounds;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}}Node.BOX_POSITION=["top","right","bottom","left"],Node.TEXT_STYLE=["fontFamily","fontWeight","fontStyle","fontVariant","fontStretch","color","whiteSpace","textDecoration","textTransform","letterSpacing","wordSpacing"];class NodeElement extends Node{constructor(e,t,i){super(e,t,i),this._cached={},this.init()}}const Ue={builtInExtensions:[],createQuerySelectorMap:true,showErrorMessages:false};let ze,Xe=false;const qe={base:{Application:Application$1},lib:{},extensions:{},system:{},create:()=>(ze=new Application$1(1,NodeElement,Controller),Xe=true,{application:ze,framework:1,userSettings:Object.assign({},Ue)}),cached(){if(Xe)return{application:ze,framework:1,userSettings:ze.userSettings};else return qe.create()}};return qe}));
