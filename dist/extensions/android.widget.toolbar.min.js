this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=squared.lib,t=android.lib,{formatPX:a}=e.css,{getElementAsNode:o}=e.session,{assignEmptyValue:r,safeNestedMap:n,includes:d,isString:i,iterateArray:s}=e.util,{NODE_PROCEDURE:l,NODE_RESOURCE:c}=squared.base.lib.enumeration,{CONTAINER_ANDROID:p,EXT_ANDROID:u,SUPPORT_ANDROID:m,SUPPORT_ANDROID_X:h}=t.constant,{CONTAINER_NODE:g}=t.enumeration,{createStyleAttribute:y,createViewAttribute:O,getDocumentId:f}=t.util,A=android.base.Resource;class T extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){s(e.children,e=>{if("NAV"===e.tagName){const t=e.dataset.use;if(!d(t,u.EXTERNAL))return e.dataset.use=(t?t+", ":"")+u.EXTERNAL,!0}});const t=e.dataset.target;if(t){const a=document.getElementById(t);a&&e.parentElement!==a&&!d(a.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(e,t){const d=this.application,y=this.resource,b=d.userSettings,I=e.element,N=e.dataset.target,_=Object.assign({},this.options[I.id]),w=O(_.self),E=O(_.appBar),L=O(_.collapsingToolbar),B=d.extensionManager.optionValueAsBoolean(u.RESOURCE_STRINGS,"numberResourceValue"),R=T.findNestedElement(I,"android.widget.menu"),S=e.has("backgroundImage"),v=[],C=[];let P=n(w,"app");s(I.children,t=>{const a=t.dataset;if("IMG"===t.tagName){if(a.navigationIcon){const e=y.addImageSrc(t,"ic_menu_");""!==e&&r(P,"navigationIcon",`@drawable/${e}`)}if(a.collapseIcon){const e=y.addImageSrc(t,"ic_menu_");""!==e&&r(P,"collapseIcon",`@drawable/${e}`)}}if(!a.target){const r=o(t,e.sessionId);if(r)switch(a.targetModule){case"appBar":v.push(r);break;case"collapsingToolbar":C.push(r)}}});const[D,k,x]=e.api<29?[m.TOOLBAR,m.APPBAR,m.COLLAPSING_TOOLBAR]:[h.TOOLBAR,h.APPBAR,h.COLLAPSING_TOOLBAR],$="collapsingToolbar"in _||C.length>0,M="appBar"in _||v.length>0||$;let U,W,X,q="",V="";if($?r(P,"layout_collapseMode","pin"):(r(P,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),S||r(P,"layout_scrollFlags","scroll|enterAlways")),M){if(R){const e=P.popupTheme;e&&(V=e.replace("@style/","")),P.popupTheme=`@style/${b.manifestThemeName}.PopupOverlay`}}else e.exclude({procedure:l.LAYOUT}),r(w,"android","fitsSystemWindows","true");if(r(w,"android","layout_height",M||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.setControlType(D,g.BLOCK),e.exclude({resource:c.FONT_STYLE}),M){let o=E.android;r(E,"android","id",`@+id/${e.controlId}_appbar`),r(E,"android","layout_height",e.hasHeight?a(e.actualHeight):"wrap_content"),r(E,"android","fitsSystemWindows","true"),R?(o.theme&&(q=o.theme),o.theme=`@style/${b.manifestThemeName}.AppBarOverlay`,e.data("android.widget.toolbar","themeData",{appBarOverlay:q,popupOverlay:V})):r(E,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),U=this.createPlaceholder(e,v,N),U.parent=t;let d=o.id;i(d)&&(U.controlId=f(d),delete o.id),U.setControlType(k,g.BLOCK),$&&(P=n(L,"app"),r(L,"android","id",`@+id/${e.controlId}_collapsingtoolbar`),r(L,"android","fitsSystemWindows","true"),S||r(P,"contentScrim","?attr/colorPrimary"),r(P,"layout_scrollFlags","scroll|exitUntilCollapsed"),r(P,"toolbarId",e.documentId),W=this.createPlaceholder(e,C,N),W&&(W.parent=U,o=L.android,d=o.id,d&&(U.controlId=f(d),delete o.id),W.setControlType(x,g.BLOCK),W.each(e=>e.dataset.target=W.controlId)))}if(U){if(U.setLayoutWidth("match_parent"),U.setLayoutHeight("wrap_content"),U.apply(A.formatOptions(E,B)),U.render(N?d.resolveTarget(N):t),X={type:1,node:U,controlName:k},W){if(e.parent=W,W.apply(A.formatOptions(L,B)),W.render(U),W.setLayoutWidth("match_parent"),W.setLayoutHeight("match_parent"),d.addLayoutTemplate(W.renderParent,W,{type:1,node:W,controlName:x}),S){const t=y.addImageSrc(e.backgroundImage);if(""!==t){const a=this.controller,o=O(_.backgroundImage);let d;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":d="centerCrop";break;case"contain":case"100%":case"100% 100%":d="fitXY";break;case"auto":d="matrix";break;default:d="center"}P=n(o,"app"),r(o,"android","id",`@+id/${e.controlId}_image`),r(o,"android","src",`@drawable/${t}`),r(o,"android","scaleType",d),r(o,"android","fitsSystemWindows","true"),r(P,"layout_collapseMode","parallax"),a.addBeforeOutsideTemplate(e.id,a.renderNodeStatic({controlName:p.IMAGE,width:"match_parent",height:"match_parent"},A.formatOptions(o,B))),e.setCacheValue("backgroundImage","")}}}else e.parent=U,S&&e.data("android.widget.toolbar","background",U);e.data("android.widget.toolbar","outerParent",U.android("id")||U.documentId),e.render(e.parent)}else e.render(N?d.resolveTarget(N):t);e.setLayoutWidth("match_parent"),e.apply(A.formatOptions(w,B));const G={type:1,node:e,controlName:D};return U?{output:G,outerParent:e.parent,renderAs:U,outputAs:X,include:!0}:{output:G,include:!0}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){var t,a;const o=null===(t=T.findNestedElement(e.element,"android.widget.menu"))||void 0===t?void 0:t.dataset.layoutName;if(o){const t=O(null===(a=this.options[e.elementId])||void 0===a?void 0:a.self),d=n(t,"app");r(d,"menu",`@menu/${o}`),e.app("menu",d.menu)}const d=e.data("android.widget.toolbar","themeData");if(d){const e=this.application.userSettings,t=y(this.options.resource),a=y({name:".NoActionBar",output:t.output}),o=y({name:".AppBarOverlay",output:t.output}),n=y({name:".PopupOverlay",output:t.output}),i=a.items;r(t,"name",e.manifestThemeName),r(t,"parent","Theme.AppCompat.Light.DarkActionBar"),r(i,"windowActionBar","false"),r(i,"windowNoTitle","true"),r(o,"parent",d.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),r(n,"parent",d.popupOverlay||"ThemeOverlay.AppCompat.Light"),A.addTheme(t),A.addTheme(a),A.addTheme(o),A.addTheme(n)}const i=e.data("android.widget.toolbar","background");if(i){const t=e.android("background");""!==t&&(i.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const o=t.length>0,r=this.application.createNode({parent:e,children:t,delegate:o,cascade:!0});if(r.inherit(e,"base"),o){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);r.containerIndex=e}return a&&(r.dataset.target=a),r.exclude({resource:c.ALL}),r.positioned=!0,r.renderExclude=!1,r}}const b=new T("android.widget.toolbar",2);return squared&&squared.includeAsync(b),b}();
