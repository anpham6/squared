this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const t=squared.base.lib.constant,a=squared.lib.css,n=squared.lib.dom,r=squared.base.lib.enumeration,o=squared.lib.session,i=squared.lib.util,s=android.lib.constant,d=android.lib.enumeration,l=android.lib.util;class p extends squared.base.Extension{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){for(let a=0;a<e.children.length;a++){const n=e.children[a];if("NAV"===n.tagName&&!i.includes(n.dataset.use,t.EXT_NAME.EXTERNAL)){n.dataset.use=(n.dataset.use?`${n.dataset.use}, `:"")+t.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!i.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(t,n){const u=this.application,c=u.controllerHandler,m=this.application.resourceHandler,g=u.userSettings,h=t.element,y=t.dataset.target,E=Object.assign({},this.options[h.id]),O=l.createViewAttribute(E.self),A=l.createViewAttribute(E.appBar),N=l.createViewAttribute(E.collapsingToolbar),b=u.extensionManager.optionValueAsBoolean(s.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),I=p.findNestedElement(h,"android.widget.menu"),T=t.has("backgroundImage"),_=[],R=[];for(let e=0;e<h.children.length;e++){const a=h.children[e];if("IMG"===a.tagName){if(a.dataset.navigationIcon){const e=m.addImageSrc(a,s.PREFIX_ANDROID.MENU);""!==e&&i.assignEmptyValue(O,"app","navigationIcon",`@drawable/${e}`)}if(a.dataset.collapseIcon){const e=m.addImageSrc(a,s.PREFIX_ANDROID.MENU);""!==e&&i.assignEmptyValue(O,"app","collapseIcon",`@drawable/${e}`)}}if(!a.dataset.target){const e=o.getElementAsNode(a,t.sessionId);if(e)switch(a.dataset.targetModule){case"appBar":_.push(e);break;case"collapsingToolbar":R.push(e)}}}const f="collapsingToolbar"in E||R.length>0,w="appBar"in E||_.length>0||f;let S,V,D,P="",C="";if(f)i.assignEmptyValue(O,"app","layout_collapseMode","pin");else if(i.assignEmptyValue(O,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),T){const e=this.application.resourceHandler.addImageSrc(t.backgroundImage);""!==e&&(i.assignEmptyValue(w?A:O,"android","background",`@drawable/${e}`),t.exclude({resource:r.NODE_RESOURCE.IMAGE_SOURCE}))}else i.assignEmptyValue(O,"app","layout_scrollFlags","scroll|enterAlways");if(w?I&&(O.app.popupTheme&&(C=O.app.popupTheme.replace("@style/","")),O.app.popupTheme=`@style/${g.manifestThemeName}.PopupOverlay`):(t.exclude({procedure:r.NODE_PROCEDURE.LAYOUT}),i.assignEmptyValue(O,"android","fitsSystemWindows","true")),i.assignEmptyValue(O,"android","layout_height",w||!t.has("height")?"?android:attr/actionBarSize":""),t.setControlType(s.SUPPORT_ANDROID.TOOLBAR,d.CONTAINER_NODE.BLOCK),t.exclude({resource:r.NODE_RESOURCE.FONT_STYLE}),w&&(i.assignEmptyValue(A,"android","id",`${t.documentId}_appbar`),i.assignEmptyValue(A,"android","layout_height",t.hasHeight?a.formatPX(t.actualHeight):"wrap_content"),i.assignEmptyValue(A,"android","fitsSystemWindows","true"),I?(A.android.theme&&(P=A.android.theme),A.android.theme=`@style/${g.manifestThemeName}.AppBarOverlay`,t.data("android.widget.toolbar","themeData",{appBarOverlay:P,popupOverlay:C})):i.assignEmptyValue(A,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(S=this.createPlaceholder(t,_,y)).parent=n,S.controlId=l.stripId(A.android.id),S.setControlType(s.SUPPORT_ANDROID.APPBAR,d.CONTAINER_NODE.BLOCK),f&&(i.assignEmptyValue(N,"android","id",`${t.documentId}_collapsingtoolbar`),i.assignEmptyValue(N,"android","fitsSystemWindows","true"),T||i.assignEmptyValue(N,"app","contentScrim","?attr/colorPrimary"),i.assignEmptyValue(N,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),i.assignEmptyValue(N,"app","toolbarId",t.documentId),(V=this.createPlaceholder(t,R,y))&&(V.parent=S,V.each(e=>e.dataset.target=V.controlId),V.setControlType(s.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,d.CONTAINER_NODE.BLOCK)))),S?(S.android("layout_width","match_parent"),S.android("layout_height","wrap_content"),S.apply(e.formatOptions(A,b)),S.render(y?u.resolveTarget(y):n),D={type:1,node:S,controlName:s.SUPPORT_ANDROID.APPBAR},V?(t.parent=V,V.apply(e.formatOptions(N,b)),V.render(S),V.android("layout_width","match_parent"),V.android("layout_height","match_parent"),u.addLayoutTemplate(V.renderParent||n,V,{type:1,node:V,controlName:s.SUPPORT_ANDROID.COLLAPSING_TOOLBAR})):t.parent=S,t.data("android.widget.toolbar","outerParent",S.android("id")||S.documentId),t.render(t.parent)):t.render(y?u.resolveTarget(y):n),T&&f){const a=this.application.resourceHandler.addImageSrc(t.backgroundImage);if(""!==a){const n=l.createViewAttribute(E.backgroundImage);let o="center";switch(t.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":o="centerCrop";break;case"contain":case"100% 100%":o="fitXY";break;case"auto":o="matrix"}i.assignEmptyValue(n,"android","id",`${t.documentId}_image`),i.assignEmptyValue(n,"android","src",`@drawable/${a}`),i.assignEmptyValue(n,"android","scaleType",o),i.assignEmptyValue(n,"android","fitsSystemWindows","true"),i.assignEmptyValue(n,"app","layout_collapseMode","parallax"),c.addBeforeOutsideTemplate(t.id,c.renderNodeStatic(s.CONTAINER_ANDROID.IMAGE,e.formatOptions(n,b),"match_parent","match_parent")),t.exclude({resource:r.NODE_RESOURCE.IMAGE_SOURCE})}}t.android("layout_width","match_parent"),t.apply(e.formatOptions(O,b));const B={type:1,node:t,controlName:s.SUPPORT_ANDROID.TOOLBAR};return S?{output:B,parentAs:t.parent,renderAs:S,outputAs:D}:{output:B}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(t){const a=i.optionalAsString(p.findNestedElement(t.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const e=l.createViewAttribute(this.options[t.elementId]&&this.options[t.elementId].self);i.assignEmptyValue(e,"app","menu",`@menu/${a}`),t.app("menu",e.app.menu)}const n=t.data("android.widget.toolbar","themeData");if(n){const t=this.application.userSettings,a=l.createStyleAttribute(this.options.resource),r=l.createStyleAttribute({name:".NoActionBar",output:a.output}),o=l.createStyleAttribute({name:".AppBarOverlay",output:a.output}),s=l.createStyleAttribute({name:".PopupOverlay",output:a.output});i.assignEmptyValue(a,"name",t.manifestThemeName),i.assignEmptyValue(a,"parent","Theme.AppCompat.Light.DarkActionBar"),i.assignEmptyValue(r.items,"windowActionBar","false"),i.assignEmptyValue(r.items,"windowNoTitle","true"),i.assignEmptyValue(o,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),i.assignEmptyValue(s,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,r,o,s)}}createPlaceholder(e,t,a){let o=1/0;for(const e of t)o=Math.min(o,e.siblingIndex);const i=this.application.createNode(n.createElement(e.actualParent&&e.actualParent.element,e.block?"div":"span"),!0,e,t);return i.siblingIndex=o,a&&(i.dataset.target=a),i.inherit(e,"base"),i.exclude({resource:r.NODE_RESOURCE.ALL}),i.positioned=!0,i}}const u=new p("android.widget.toolbar",2);return squared&&squared.includeAsync(u),u}();
