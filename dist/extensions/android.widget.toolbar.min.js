this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=squared.lib,t=android.lib,{formatPX:a}=e.css,{getElementAsNode:o}=e.session,{assignEmptyValue:r,safeNestedMap:n,includes:i,isString:d,iterateArray:s}=e.util,{NODE_PROCEDURE:l,NODE_RESOURCE:c,NODE_TEMPLATE:p}=squared.base.lib.enumeration,{CONTAINER_ANDROID:u,EXT_ANDROID:m,SUPPORT_ANDROID:h,SUPPORT_ANDROID_X:g}=t.constant,{BUILD_ANDROID:f,CONTAINER_NODE:O}=t.enumeration,{createStyleAttribute:y,createViewAttribute:I,getDocumentId:T}=t.util,b=android.base.Resource;class A extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){s(e.children,e=>{if("NAV"===e.tagName){const t=e.dataset.use;if(!i(t,m.EXTERNAL))return e.dataset.use=(t?t+", ":"")+m.EXTERNAL,true}});const t=e.dataset.target;if(t){const a=document.getElementById(t);if(a&&e.parentElement!==a&&!i(a.dataset.use,"android.widget.coordinator"))this.application.rootElements.add(e)}}return false}processNode(e,t){const i=this.application,p=this.resource,f=i.userSettings,y=e.element,N=e.dataset.target,_=Object.assign({},this.options[y.id]),E=I(_.self),w=I(_.appBar),L=I(_.collapsingToolbar),B=i.extensionManager.optionValueAsBoolean(m.RESOURCE_STRINGS,"numberResourceValue"),R=A.findNestedElement(y,"android.widget.menu"),S=e.has("backgroundImage"),P=[],v=[];let C=n(E,"app");s(y.children,t=>{const a=t.dataset;if("IMG"===t.tagName){if(a.navigationIcon){const e=p.addImageSrc(t,"ic_menu_");if(""!==e)r(C,"navigationIcon","@drawable/"+e)}if(a.collapseIcon){const e=p.addImageSrc(t,"ic_menu_");if(""!==e)r(C,"collapseIcon","@drawable/"+e)}}if(!a.target){const r=o(t,e.sessionId);if(r)switch(a.targetModule){case"appBar":P.push(r);break;case"collapsingToolbar":v.push(r);break}}});const[D,k,x]=e.api<29?[h.TOOLBAR,h.APPBAR,h.COLLAPSING_TOOLBAR]:[g.TOOLBAR,g.APPBAR,g.COLLAPSING_TOOLBAR],M="collapsingToolbar"in _||v.length>0,U="appBar"in _||P.length>0||M;let V,W,X,q="",G="";if(M)r(C,"layout_collapseMode","pin");else if(r(C,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),!S)r(C,"layout_scrollFlags","scroll|enterAlways");if(U){if(R){const e=C.popupTheme;if(e)G=e.replace("@style/","");C.popupTheme=`@style/${f.manifestThemeName}.PopupOverlay`}}else e.exclude({procedure:l.LAYOUT}),r(E,"android","fitsSystemWindows","true");if(r(E,"android","layout_height",U||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.setControlType(D,O.BLOCK),e.exclude({resource:c.FONT_STYLE}),U){let o=w.android;if(r(w,"android","id",`@+id/${e.controlId}_appbar`),r(w,"android","layout_height",e.hasHeight?a(e.actualHeight):"wrap_content"),r(w,"android","fitsSystemWindows","true"),R){if(o.theme)q=o.theme;o.theme=`@style/${f.manifestThemeName}.AppBarOverlay`,e.data("android.widget.toolbar","themeData",{appBarOverlay:q,popupOverlay:G})}else r(w,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar");V=this.createPlaceholder(e,P,N),V.parent=t;let i=o.id;if(d(i))V.controlId=T(i),delete o.id;if(V.setControlType(k,O.BLOCK),M){if(C=n(L,"app"),r(L,"android","id",`@+id/${e.controlId}_collapsingtoolbar`),r(L,"android","fitsSystemWindows","true"),!S)r(C,"contentScrim","?attr/colorPrimary");if(r(C,"layout_scrollFlags","scroll|exitUntilCollapsed"),r(C,"toolbarId",e.documentId),W=this.createPlaceholder(e,v,N),W){if(W.parent=V,o=L.android,i=o.id,i)V.controlId=T(i),delete o.id;W.setControlType(x,O.BLOCK);const e=W.controlId;W.each(t=>t.dataset.target=e)}}}if(V){if(V.setLayoutWidth("match_parent"),V.setLayoutHeight("wrap_content"),V.apply(b.formatOptions(w,B)),V.render(N?i.resolveTarget(N):t),X={type:1,node:V,controlName:k},W){if(e.parent=W,W.apply(b.formatOptions(L,B)),W.render(V),W.setLayoutWidth("match_parent"),W.setLayoutHeight("match_parent"),i.addLayoutTemplate(W.renderParent,W,{type:1,node:W,controlName:x}),S){const t=p.addImageSrc(e.backgroundImage);if(""!==t){const a=this.controller,o=I(_.backgroundImage);let i;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":i="centerCrop";break;case"contain":case"100%":case"100% 100%":i="fitXY";break;case"auto":i="matrix";break;default:i="center";break}C=n(o,"app"),r(o,"android","id",`@+id/${e.controlId}_image`),r(o,"android","src","@drawable/"+t),r(o,"android","scaleType",i),r(o,"android","fitsSystemWindows","true"),r(C,"layout_collapseMode","parallax"),a.addBeforeOutsideTemplate(e.id,a.renderNodeStatic({controlName:u.IMAGE,width:"match_parent",height:"match_parent"},b.formatOptions(o,B))),e.setCacheValue("backgroundImage","")}}}else if(e.parent=V,S)e.data("android.widget.toolbar","background",V);e.data("android.widget.toolbar","outerParent",V.android("id")||V.documentId),e.render(e.parent)}else e.render(N?i.resolveTarget(N):t);e.setLayoutWidth("match_parent"),e.apply(b.formatOptions(E,B));const $={type:1,node:e,controlName:D};if(V)return{output:$,outerParent:e.parent,renderAs:V,outputAs:X,include:true};else return{output:$,include:true}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:true}}postOptimize(e){var t,a;const o=null===(t=A.findNestedElement(e.element,"android.widget.menu"))||void 0===t?void 0:t.dataset.layoutName;if(o){const t=I(null===(a=this.options[e.elementId])||void 0===a?void 0:a.self),i=n(t,"app");r(i,"menu","@menu/"+o),e.app("menu",i.menu)}const i=e.data("android.widget.toolbar","themeData");if(i){const e=this.application.userSettings,t=y(this.options.resource),a=y({name:".NoActionBar",output:t.output}),o=y({name:".AppBarOverlay",output:t.output}),n=y({name:".PopupOverlay",output:t.output}),d=a.items;r(t,"name",e.manifestThemeName),r(t,"parent","Theme.AppCompat.Light.DarkActionBar"),r(d,"windowActionBar","false"),r(d,"windowNoTitle","true"),r(o,"parent",i.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),r(n,"parent",i.popupOverlay||"ThemeOverlay.AppCompat.Light"),b.addTheme(t),b.addTheme(a),b.addTheme(o),b.addTheme(n)}const d=e.data("android.widget.toolbar","background");if(d){const t=e.android("background");if(""!==t)d.android("background",t),e.delete("android","background")}}createPlaceholder(e,t,a){const o=t.length>0,r=this.application.createNode({parent:e,children:t,delegate:o,cascade:true});if(r.inherit(e,"base"),o){let e=Number.POSITIVE_INFINITY;t.forEach(t=>e=Math.min(e,t.containerIndex)),r.containerIndex=e}if(a)r.dataset.target=a;return r.exclude({resource:c.ALL}),r.positioned=true,r.renderExclude=false,r}}const N=new A("android.widget.toolbar",2);if(squared)squared.include(N);return N}();
