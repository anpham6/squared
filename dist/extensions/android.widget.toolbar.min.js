this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const t=squared.base.lib.constant,a=squared.base.lib.enumeration,n=squared.lib.dom,r=squared.lib.util,l=squared.lib.xml,o=android.lib.constant,d=android.lib.enumeration,i=android.lib.util;class s extends squared.base.Extension{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){for(let a=0;a<e.children.length;a++){const n=e.children[a];if("NAV"===n.tagName&&!r.includes(n.dataset.use,t.EXT_NAME.EXTERNAL)){n.dataset.use=(r.hasValue(n.dataset.use)?`${n.dataset.use}, `:"")+t.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!r.includes(t.dataset.use,"android.widget.coordinator")&&this.application.parseElements.add(e)}}return!1}processNode(t,u){const p=this.application,c=p.controllerHandler,h=t.element,m=r.hasValue(t.dataset.target),N=Object.assign({},this.options[h.id]),g=i.createViewAttribute(N.self),O=i.createViewAttribute(N.appBar),A=i.createViewAttribute(N.collapsingToolbar),f=s.findNestedByName(h,"android.widget.menu"),b=t.has("backgroundImage"),E=[],y=[];let I=m?0:u.renderDepth+1,R=t.filter(e=>!e.positioned).length;for(let t=0;t<h.children.length;t++){const a=h.children[t];if("IMG"===a.tagName){if(r.hasValue(a.dataset.navigationIcon)){const t=e.addImageSrcSet(a,o.PREFIX_ANDROID.MENU);""!==t&&(r.defaultWhenNull(toolbar,"app","navigationIcon",`@drawable/${t}`),"none"!==n.getStyle(a).display&&R--)}if(r.hasValue(a.dataset.collapseIcon)){const t=e.addImageSrcSet(a,o.PREFIX_ANDROID.MENU);""!==t&&(r.defaultWhenNull(toolbar,"app","collapseIcon",`@drawable/${t}`),"none"!==n.getStyle(a).display&&R--)}}if(r.hasValue(a.dataset.target))R--;else{const e=n.getElementAsNode(a);if(e)switch(a.dataset.targetModule){case"appBar":E.push(e),R--;break;case"collapsingToolbar":y.push(e),R--}}}const T="collapsingToolbar"in N||y.length,_="appBar"in N||E.length>0||T;let S="",D="";T?r.defaultWhenNull(g,"app","layout_collapseMode","pin"):(_||r.defaultWhenNull(g,"android","fitsSystemWindows","true"),r.defaultWhenNull(g,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),b?(r.defaultWhenNull(E.length?O:g,"android","background",`@drawable/${e.addImageUrl(t.css("backgroundImage"))}`),t.exclude({resource:a.NODE_RESOURCE.IMAGE_SOURCE})):r.defaultWhenNull(g,"app","layout_scrollFlags","scroll|enterAlways")),E.length?r.defaultWhenNull(O,"android","layout_height","?android:attr/actionBarSize"):(r.defaultWhenNull(g,"android","layout_height","?android:attr/actionBarSize"),t.exclude({procedure:a.NODE_PROCEDURE.LAYOUT})),f&&_&&(g.app.popupTheme&&(D=g.app.popupTheme.replace("@style/","")),g.app.popupTheme="@style/AppTheme.PopupOverlay");const w=I+(_?1:0)+(T?1:0),P=p.extensionManager.optionValueAsBoolean(o.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue");t.setControlType(o.SUPPORT_ANDROID.TOOLBAR,d.CONTAINER_NODE.BLOCK);let W=c.renderNodeStatic(o.SUPPORT_ANDROID.TOOLBAR,w,e.formatOptions(g,P),"match_parent","wrap_content",t,R>0);if(T&&b){const n=i.createViewAttribute(N.backgroundImage);let l="center";switch(t.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":l="centerCrop";break;case"contain":case"100% 100%":l="fitXY";break;case"auto":l="matrix"}r.defaultWhenNull(n,"android","id",`${t.documentId}_image`),r.defaultWhenNull(n,"android","src",`@drawable/${e.addImageUrl(t.css("backgroundImage"))}`),r.defaultWhenNull(n,"android","scaleType",l),r.defaultWhenNull(n,"android","fitsSystemWindows","true"),r.defaultWhenNull(n,"app","layout_collapseMode","parallax"),W=c.renderNodeStatic(o.CONTAINER_ANDROID.IMAGE,w,e.formatOptions(n,P),"match_parent","match_parent")+W,t.exclude({resource:a.NODE_RESOURCE.IMAGE_SOURCE})}let C,B,L="";if(_&&(r.defaultWhenNull(O,"android","id",`${t.documentId}_appbar`),r.defaultWhenNull(O,"android","layout_height",t.hasHeight?r.formatPX(t.height):"wrap_content"),r.defaultWhenNull(O,"android","fitsSystemWindows","true"),f?(O.android.theme&&(S=O.android.theme),O.android.theme="@style/AppTheme.AppBarOverlay",t.data("android.widget.toolbar","themeData",{target:m,appBarOverlay:S,popupOverlay:D})):r.defaultWhenNull(O,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(C=this.createPlaceholder(t,E)).parent=t.parent,C.controlId=i.stripId(O.android.id),C.setControlType(o.SUPPORT_ANDROID.APPBAR,d.CONTAINER_NODE.BLOCK),p.processing.cache.append(C,E.length>0),L=c.renderNodeStatic(o.SUPPORT_ANDROID.APPBAR,m?-1:I,e.formatOptions(O,P),"match_parent","wrap_content",C,!0),T&&(I++,r.defaultWhenNull(A,"android","id",`${t.documentId}_collapsingtoolbar`),r.defaultWhenNull(A,"android","fitsSystemWindows","true"),b||r.defaultWhenNull(A,"app","contentScrim","?attr/colorPrimary"),r.defaultWhenNull(A,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),r.defaultWhenNull(A,"app","toolbarId",t.documentId),(B=this.createPlaceholder(t,y)).parent=C,B))){B.each(e=>e.dataset.target=B.controlId),B.setControlType(o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,d.CONTAINER_NODE.BLOCK),p.processing.cache.append(B,y.length>0);const t=c.renderNodeStatic(o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,m&&!_?-1:I,e.formatOptions(A,P),"match_parent","match_parent",B,!0);L=l.replacePlaceholder(L,C.id,t)}return C?(W=l.replacePlaceholder(L,B?B.id:C.id,W),C.render(m?C:u),B?(B.parent=C,B.render(C),t.parent=B):t.parent=C,t.data("android.widget.toolbar","outerParent",C.documentId),t.render(t.parent)):B?(B.render(m?B:u),t.parent=B,t.render(B)):t.render(m?t:u),t.containerType=d.CONTAINER_NODE.BLOCK,t.exclude({resource:a.NODE_RESOURCE.FONT_STYLE}),{output:W}}processChild(e){let t=!1;return e.imageElement&&(r.hasValue(e.dataset.navigationIcon)||r.hasValue(e.dataset.collapseIcon))&&(e.hide(),t=!0),{output:"",next:t}}postProcedure(e){const t=r.optionalAsString(s.findNestedByName(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const a=i.createViewAttribute((e.element&&this.options[e.element.id]||{}).self);r.defaultWhenNull(a,"app","menu",`@menu/${t}`),e.app("menu",a.app.menu)}const a=e.data("android.widget.toolbar","themeData");a&&this.setStyleTheme(a)}setStyleTheme(t){const a=i.createStyleAttribute(Object.assign({},this.options.resource)),n=i.createStyleAttribute({name:".NoActionBar",output:a.output}),l=i.createStyleAttribute({name:".AppBarOverlay",output:a.output}),o=i.createStyleAttribute({name:".PopupOverlay",output:a.output});r.defaultWhenNull(a,"parent","Theme.AppCompat.Light.DarkActionBar"),r.defaultWhenNull(n.items,"windowActionBar","false"),r.defaultWhenNull(n.items,"windowNoTitle","true"),r.defaultWhenNull(l,"parent",t.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),r.defaultWhenNull(o,"parent",t.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,n,l,o)}createPlaceholder(e,t){const r=this.application.createNode(n.createElement(e.actualParent?e.actualParent.element:null,e.block));r.inherit(e,"base"),r.exclude({resource:a.NODE_RESOURCE.ALL}),r.positioned=!0;let l=1/0;for(const e of t)l=Math.min(l,e.siblingIndex),e.parent=r;return r.siblingIndex=l,r}}const u=new s("android.widget.toolbar",2);return squared&&squared.includeAsync(u),u}();
