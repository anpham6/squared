this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{css:e,session:t,util:a}=squared.lib,{constant:n,enumeration:o,util:i}=android.lib,r=android.base.Resource,s=squared.base.lib.enumeration,d="ic_menu_";class l extends squared.base.ExtensionUI{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,o=t.length;for(let e=0;e<o;e++){const o=t[e];if("NAV"===o.tagName&&!a.includes(o.dataset.use,n.EXT_ANDROID.EXTERNAL)){o.dataset.use=(o.dataset.use?o.dataset.use+", ":"")+n.EXT_ANDROID.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!a.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(p,c){const u=this.application,m=this.resource,g=u.userSettings,h=p.element,y=p.dataset.target,E=Object.assign({},this.options[h.id]),O=i.createViewAttribute(E.self),A=i.createViewAttribute(E.appBar),I=i.createViewAttribute(E.collapsingToolbar),b=u.extensionManager.optionValueAsBoolean(n.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),N=l.findNestedElement(h,"android.widget.menu"),T=p.has("backgroundImage"),f=[],_=[],R=h.children,V=R.length;for(let e=0;e<V;e++){const n=R[e],o=n.dataset;if("IMG"===n.tagName){if(o.navigationIcon){const e=m.addImageSrc(n,d);""!==e&&a.assignEmptyValue(O,"app","navigationIcon","@drawable/"+e)}if(o.collapseIcon){const e=m.addImageSrc(n,d);""!==e&&a.assignEmptyValue(O,"app","collapseIcon","@drawable/"+e)}}if(!o.target){const e=t.getElementAsNode(n,p.sessionId);if(e)switch(o.targetModule){case"appBar":f.push(e);break;case"collapsingToolbar":_.push(e)}}}const w="collapsingToolbar"in E||_.length>0,D="appBar"in E||f.length>0||w;let S,P,L,B,C,v,k="",x="";if(w?a.assignEmptyValue(O,"app","layout_collapseMode","pin"):(a.assignEmptyValue(O,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),T||a.assignEmptyValue(O,"app","layout_scrollFlags","scroll|enterAlways")),D){if(N){const e=O.app;e.popupTheme&&(x=e.popupTheme.replace("@style/","")),e.popupTheme="@style/"+g.manifestThemeName+".PopupOverlay"}}else p.exclude(0,s.NODE_PROCEDURE.LAYOUT),a.assignEmptyValue(O,"android","fitsSystemWindows","true");if(a.assignEmptyValue(O,"android","layout_height",D||!p.hasPX("height")?"?android:attr/actionBarSize":""),p.localSettings.targetAPI<29?(S=n.SUPPORT_ANDROID.TOOLBAR,P=n.SUPPORT_ANDROID.APPBAR,L=n.SUPPORT_ANDROID.COLLAPSING_TOOLBAR):(S=n.SUPPORT_ANDROID_X.TOOLBAR,P=n.SUPPORT_ANDROID_X.APPBAR,L=n.SUPPORT_ANDROID_X.COLLAPSING_TOOLBAR),p.setControlType(S,o.CONTAINER_NODE.BLOCK),p.exclude(s.NODE_RESOURCE.FONT_STYLE),D){let t=A.android;a.assignEmptyValue(A,"android","id",p.documentId.replace("@","@+")+"_appbar"),a.assignEmptyValue(A,"android","layout_height",p.hasHeight?e.formatPX(p.actualHeight):"wrap_content"),a.assignEmptyValue(A,"android","fitsSystemWindows","true"),N?(t.theme&&(k=t.theme),t.theme="@style/"+g.manifestThemeName+".AppBarOverlay",p.data("android.widget.toolbar","themeData",{appBarOverlay:k,popupOverlay:x})):a.assignEmptyValue(A,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(B=this.createPlaceholder(p,f,y)).parent=c;let n=t.id;n&&(B.controlId=i.getDocumentId(n),delete t.id),B.setControlType(P,o.CONTAINER_NODE.BLOCK),w&&(a.assignEmptyValue(I,"android","id",p.documentId.replace("@","@+")+"_collapsingtoolbar"),a.assignEmptyValue(I,"android","fitsSystemWindows","true"),T||a.assignEmptyValue(I,"app","contentScrim","?attr/colorPrimary"),a.assignEmptyValue(I,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),a.assignEmptyValue(I,"app","toolbarId",p.documentId),(C=this.createPlaceholder(p,_,y))&&(C.parent=B,(n=(t=I.android).id)&&(B.controlId=i.getDocumentId(n),delete t.id),C.setControlType(L,o.CONTAINER_NODE.BLOCK),C.each(e=>e.dataset.target=C.controlId)))}if(B){if(B.setLayoutWidth("match_parent"),B.setLayoutHeight("wrap_content"),B.apply(r.formatOptions(A,b)),B.render(y?u.resolveTarget(y):c),v={type:1,node:B,controlName:P},C){if(p.parent=C,C.apply(r.formatOptions(I,b)),C.render(B),C.setLayoutWidth("match_parent"),C.setLayoutHeight("match_parent"),u.addLayoutTemplate(C.renderParent||c,C,{type:1,node:C,controlName:L}),T){const e=m.addImageSrc(p.backgroundImage);if(""!==e){const t=this.controller,o=i.createViewAttribute(E.backgroundImage);let s;switch(p.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":s="centerCrop";break;case"contain":case"100% 100%":s="fitXY";break;case"auto":s="matrix";break;default:s="center"}a.assignEmptyValue(o,"android","id",p.documentId.replace("@","@+")+"_image"),a.assignEmptyValue(o,"android","src","@drawable/"+e),a.assignEmptyValue(o,"android","scaleType",s),a.assignEmptyValue(o,"android","fitsSystemWindows","true"),a.assignEmptyValue(o,"app","layout_collapseMode","parallax"),t.addBeforeOutsideTemplate(p.id,t.renderNodeStatic(n.CONTAINER_ANDROID.IMAGE,r.formatOptions(o,b),"match_parent","match_parent")),p.setCacheValue("backgroundImage","")}}}else p.parent=B,T&&p.data("android.widget.toolbar","background",B);p.data("android.widget.toolbar","outerParent",B.android("id")||B.documentId),p.render(p.parent)}else p.render(y?u.resolveTarget(y):c);p.setLayoutWidth("match_parent"),p.apply(r.formatOptions(O,b));const U={type:1,node:p,controlName:S};return B?{output:U,parentAs:p.parent,renderAs:B,outputAs:v}:{output:U}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){const t=a.optionalAsString(l.findNestedElement(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const n=i.createViewAttribute(this.options[e.elementId]&&this.options[e.elementId].self);a.assignEmptyValue(n,"app","menu","@menu/"+t),e.app("menu",n.app.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=this.application.userSettings,t=i.createStyleAttribute(this.options.resource),o=i.createStyleAttribute({name:".NoActionBar",output:t.output}),s=i.createStyleAttribute({name:".AppBarOverlay",output:t.output}),d=i.createStyleAttribute({name:".PopupOverlay",output:t.output});a.assignEmptyValue(t,"name",e.manifestThemeName),a.assignEmptyValue(t,"parent","Theme.AppCompat.Light.DarkActionBar"),a.assignEmptyValue(o.items,"windowActionBar","false"),a.assignEmptyValue(o.items,"windowNoTitle","true"),a.assignEmptyValue(s,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),a.assignEmptyValue(d,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),r.addTheme(t,o,s,d)}const o=e.data("android.widget.toolbar","background");if(o){const t=e.android("background");""!==t&&(o.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const n=this.application.createNode(void 0,!0,e,t);if(t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);n.containerIndex=e}return a&&(n.dataset.target=a),n.inherit(e,"base"),n.exclude(s.NODE_RESOURCE.ALL),n.positioned=!0,n.renderExclude=!1,n}}const p=new l("android.widget.toolbar",2);return squared&&squared.includeAsync(p),p}();
