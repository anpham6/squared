this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{css:e,session:t,util:a}=squared.lib,{constant:n,enumeration:o,util:i}=android.lib,{constant:r,enumeration:s}=squared.base.lib,d=android.base.Resource,p="ic_menu_";class l extends squared.base.ExtensionUI{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,n=t.length;for(let e=0;e<n;e++){const n=t[e];if("NAV"===n.tagName&&!a.includes(n.dataset.use,r.EXT_NAME.EXTERNAL)){n.dataset.use=(n.dataset.use?`${n.dataset.use}, `:"")+r.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!a.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(r,c){const u=this.application,m=this.controller,g=this.resource,h=u.userSettings,y=r.element,E=r.dataset.target,O=Object.assign({},this.options[y.id]),A=i.createViewAttribute(O.self),b=i.createViewAttribute(O.appBar),I=i.createViewAttribute(O.collapsingToolbar),N=u.extensionManager.optionValueAsBoolean(n.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),T=l.findNestedElement(y,"android.widget.menu"),f=r.has("backgroundImage"),_=[],R=[],V=y.children,w=V.length;for(let e=0;e<w;e++){const n=V[e],o=n.dataset;if("IMG"===n.tagName){if(o.navigationIcon){const e=g.addImageSrc(n,p);""!==e&&a.assignEmptyValue(A,"app","navigationIcon",`@drawable/${e}`)}if(o.collapseIcon){const e=g.addImageSrc(n,p);""!==e&&a.assignEmptyValue(A,"app","collapseIcon",`@drawable/${e}`)}}if(!o.target){const e=t.getElementAsNode(n,r.sessionId);if(e)switch(o.targetModule){case"appBar":_.push(e);break;case"collapsingToolbar":R.push(e)}}}const S="collapsingToolbar"in O||R.length>0,D="appBar"in O||_.length>0||S;let P,L,B,C="",v="";if(S?a.assignEmptyValue(A,"app","layout_collapseMode","pin"):(a.assignEmptyValue(A,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),f||a.assignEmptyValue(A,"app","layout_scrollFlags","scroll|enterAlways")),D){if(T){const e=A.app;e.popupTheme&&(v=e.popupTheme.replace("@style/","")),e.popupTheme=`@style/${h.manifestThemeName}.PopupOverlay`}}else r.exclude(0,s.NODE_PROCEDURE.LAYOUT),a.assignEmptyValue(A,"android","fitsSystemWindows","true");if(a.assignEmptyValue(A,"android","layout_height",D||!r.hasPX("height")?"?android:attr/actionBarSize":""),r.setControlType(n.SUPPORT_ANDROID.TOOLBAR,o.CONTAINER_NODE.BLOCK),r.exclude(s.NODE_RESOURCE.FONT_STYLE),D&&(a.assignEmptyValue(b,"android","id",`${r.documentId}_appbar`),a.assignEmptyValue(b,"android","layout_height",r.hasHeight?e.formatPX(r.actualHeight):"wrap_content"),a.assignEmptyValue(b,"android","fitsSystemWindows","true"),T?(b.android.theme&&(C=b.android.theme),b.android.theme=`@style/${h.manifestThemeName}.AppBarOverlay`,r.data("android.widget.toolbar","themeData",{appBarOverlay:C,popupOverlay:v})):a.assignEmptyValue(b,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(P=this.createPlaceholder(r,_,E)).parent=c,b.android.id&&(P.controlId=i.getDocumentId(b.android.id)),P.setControlType(n.SUPPORT_ANDROID.APPBAR,o.CONTAINER_NODE.BLOCK),S&&(a.assignEmptyValue(I,"android","id",`${r.documentId}_collapsingtoolbar`),a.assignEmptyValue(I,"android","fitsSystemWindows","true"),f||a.assignEmptyValue(I,"app","contentScrim","?attr/colorPrimary"),a.assignEmptyValue(I,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),a.assignEmptyValue(I,"app","toolbarId",r.documentId),(L=this.createPlaceholder(r,R,E))&&(L.parent=P,I.android.id&&(P.controlId=i.getDocumentId(I.android.id)),L.setControlType(n.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,o.CONTAINER_NODE.BLOCK),L.each(e=>e.dataset.target=L.controlId)))),P){if(P.setLayoutWidth("match_parent"),P.setLayoutHeight("wrap_content"),P.apply(d.formatOptions(b,N)),P.render(E?u.resolveTarget(E):c),B={type:1,node:P,controlName:n.SUPPORT_ANDROID.APPBAR},L){if(r.parent=L,L.apply(d.formatOptions(I,N)),L.render(P),L.setLayoutWidth("match_parent"),L.setLayoutHeight("match_parent"),u.addLayoutTemplate(L.renderParent||c,L,{type:1,node:L,controlName:n.SUPPORT_ANDROID.COLLAPSING_TOOLBAR}),f){const e=this.resource.addImageSrc(r.backgroundImage);if(""!==e){const t=i.createViewAttribute(O.backgroundImage);let o="center";switch(r.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":o="centerCrop";break;case"contain":case"100% 100%":o="fitXY";break;case"auto":o="matrix"}a.assignEmptyValue(t,"android","id",`${r.documentId}_image`),a.assignEmptyValue(t,"android","src",`@drawable/${e}`),a.assignEmptyValue(t,"android","scaleType",o),a.assignEmptyValue(t,"android","fitsSystemWindows","true"),a.assignEmptyValue(t,"app","layout_collapseMode","parallax"),m.addBeforeOutsideTemplate(r.id,m.renderNodeStatic(n.CONTAINER_ANDROID.IMAGE,d.formatOptions(t,N),"match_parent","match_parent")),r.setCacheValue("backgroundImage","")}}}else r.parent=P,f&&r.data("android.widget.toolbar","background",P);r.data("android.widget.toolbar","outerParent",P.android("id")||P.documentId),r.render(r.parent)}else r.render(E?u.resolveTarget(E):c);r.setLayoutWidth("match_parent"),r.apply(d.formatOptions(A,N));const k={type:1,node:r,controlName:n.SUPPORT_ANDROID.TOOLBAR};return P?{output:k,parentAs:r.parent,renderAs:P,outputAs:B}:{output:k}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){const t=a.optionalAsString(l.findNestedElement(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const n=i.createViewAttribute(this.options[e.elementId]&&this.options[e.elementId].self);a.assignEmptyValue(n,"app","menu",`@menu/${t}`),e.app("menu",n.app.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=this.application.userSettings,t=i.createStyleAttribute(this.options.resource),o=i.createStyleAttribute({name:".NoActionBar",output:t.output}),r=i.createStyleAttribute({name:".AppBarOverlay",output:t.output}),s=i.createStyleAttribute({name:".PopupOverlay",output:t.output});a.assignEmptyValue(t,"name",e.manifestThemeName),a.assignEmptyValue(t,"parent","Theme.AppCompat.Light.DarkActionBar"),a.assignEmptyValue(o.items,"windowActionBar","false"),a.assignEmptyValue(o.items,"windowNoTitle","true"),a.assignEmptyValue(r,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),a.assignEmptyValue(s,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),d.addTheme(t,o,r,s)}const o=e.data("android.widget.toolbar","background");if(o){const t=e.android("background");""!==t&&(o.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const n=this.application.createNode(void 0,!0,e,t);if(t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);n.containerIndex=e}return a&&(n.dataset.target=a),n.inherit(e,"base"),n.exclude(s.NODE_RESOURCE.ALL),n.positioned=!0,n.renderExclude=!1,n}}const c=new l("android.widget.toolbar",2);return squared&&squared.includeAsync(c),c}();
