this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const t=squared.lib,a=android.lib,{formatPX:o}=t.css,{getElementAsNode:r}=t.session,{assignEmptyValue:n,includes:i,isString:d,optionalAsString:s}=t.util,{NODE_PROCEDURE:l,NODE_RESOURCE:c}=squared.base.lib.enumeration,{CONTAINER_ANDROID:p,EXT_ANDROID:u,SUPPORT_ANDROID:m,SUPPORT_ANDROID_X:h}=a.constant,{CONTAINER_NODE:g}=a.enumeration,{createStyleAttribute:y,createViewAttribute:O,getDocumentId:f}=a.util;class A extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,a=t.length;for(let e=0;e<a;e++){const a=t[e];if("NAV"===a.tagName){const e=a.dataset.use;if(!i(e,u.EXTERNAL)){a.dataset.use=(e?e+", ":"")+u.EXTERNAL;break}}}const o=e.dataset.target;if(o){const t=document.getElementById(o);t&&e.parentElement!==t&&!i(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(t,a){const i=this.application,s=this.resource,y=i.userSettings,b=t.element,I=t.dataset.target,T=Object.assign({},this.options[b.id]),N=O(T.self),_=O(T.appBar),w=O(T.collapsingToolbar),E=i.extensionManager.optionValueAsBoolean(u.RESOURCE_STRINGS,"numberResourceValue"),v=A.findNestedElement(b,"android.widget.menu"),L=t.has("backgroundImage"),B=[],R=[],S=b.children,C=S.length;let P=N.app;void 0===P&&(P={},N.app=P);for(let e=0;e<C;e++){const a=S[e],o=a.dataset;if("IMG"===a.tagName){if(o.navigationIcon){const e=s.addImageSrc(a,"ic_menu_");""!==e&&n(P,"navigationIcon","@drawable/"+e)}if(o.collapseIcon){const e=s.addImageSrc(a,"ic_menu_");""!==e&&n(P,"collapseIcon","@drawable/"+e)}}if(!o.target){const e=r(a,t.sessionId);if(e)switch(o.targetModule){case"appBar":B.push(e);break;case"collapsingToolbar":R.push(e)}}}const[k,D,x]=t.api<29?[m.TOOLBAR,m.APPBAR,m.COLLAPSING_TOOLBAR]:[h.TOOLBAR,h.APPBAR,h.COLLAPSING_TOOLBAR],U="collapsingToolbar"in T||R.length>0,M="appBar"in T||B.length>0||U;let W,X,q,V="",G="";if(U?n(P,"layout_collapseMode","pin"):(n(P,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),L||n(P,"layout_scrollFlags","scroll|enterAlways")),M){if(v){const e=P.popupTheme;e&&(G=e.replace("@style/","")),P.popupTheme=`@style/${y.manifestThemeName}.PopupOverlay`}}else t.exclude({procedure:l.LAYOUT}),n(N,"android","fitsSystemWindows","true");if(n(N,"android","layout_height",M||!t.hasPX("height")?"?android:attr/actionBarSize":""),t.setControlType(k,g.BLOCK),t.exclude({resource:c.FONT_STYLE}),M){let e=_.android;n(_,"android","id",t.documentId.replace("@","@+")+"_appbar"),n(_,"android","layout_height",t.hasHeight?o(t.actualHeight):"wrap_content"),n(_,"android","fitsSystemWindows","true"),v?(e.theme&&(V=e.theme),e.theme="@style/"+y.manifestThemeName+".AppBarOverlay",t.data("android.widget.toolbar","themeData",{appBarOverlay:V,popupOverlay:G})):n(_,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),W=this.createPlaceholder(t,B,I),W.parent=a;let r=e.id;d(r)&&(W.controlId=f(r),delete e.id),W.setControlType(D,g.BLOCK),U&&(P=w.app,void 0===P&&(P={},w.app=P),n(w,"android","id",t.documentId.replace("@","@+")+"_collapsingtoolbar"),n(w,"android","fitsSystemWindows","true"),L||n(P,"contentScrim","?attr/colorPrimary"),n(P,"layout_scrollFlags","scroll|exitUntilCollapsed"),n(P,"toolbarId",t.documentId),X=this.createPlaceholder(t,R,I),X&&(X.parent=W,e=w.android,r=e.id,r&&(W.controlId=f(r),delete e.id),X.setControlType(x,g.BLOCK),X.each(e=>e.dataset.target=X.controlId)))}if(W){if(W.setLayoutWidth("match_parent"),W.setLayoutHeight("wrap_content"),W.apply(e.formatOptions(_,E)),W.render(I?i.resolveTarget(I):a),q={type:1,node:W,controlName:D},X){if(t.parent=X,X.apply(e.formatOptions(w,E)),X.render(W),X.setLayoutWidth("match_parent"),X.setLayoutHeight("match_parent"),i.addLayoutTemplate(X.renderParent,X,{type:1,node:X,controlName:x}),L){const a=s.addImageSrc(t.backgroundImage);if(""!==a){const o=this.controller,r=O(T.backgroundImage);let i;switch(t.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":i="centerCrop";break;case"contain":case"100%":case"100% 100%":i="fitXY";break;case"auto":i="matrix";break;default:i="center"}P=r.app,void 0===P&&(P={},r.app=P),n(r,"android","id",t.documentId.replace("@","@+")+"_image"),n(r,"android","src","@drawable/"+a),n(r,"android","scaleType",i),n(r,"android","fitsSystemWindows","true"),n(P,"layout_collapseMode","parallax"),o.addBeforeOutsideTemplate(t.id,o.renderNodeStatic(p.IMAGE,e.formatOptions(r,E),"match_parent","match_parent")),t.setCacheValue("backgroundImage","")}}}else t.parent=W,L&&t.data("android.widget.toolbar","background",W);t.data("android.widget.toolbar","outerParent",W.android("id")||W.documentId),t.render(t.parent)}else t.render(I?i.resolveTarget(I):a);t.setLayoutWidth("match_parent"),t.apply(e.formatOptions(N,E));const H={type:1,node:t,controlName:k};return W?{output:H,outerParent:t.parent,renderAs:W,outputAs:q}:{output:H}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(t){var a;const o=s(A.findNestedElement(t.element,"android.widget.menu"),"dataset.layoutName");if(""!==o){const e=O(null===(a=this.options[t.elementId])||void 0===a?void 0:a.self);let r=e.app;void 0===r&&(r={},e.app=r),n(r,"menu","@menu/"+o),t.app("menu",r.menu)}const r=t.data("android.widget.toolbar","themeData");if(r){const t=this.application.userSettings,a=y(this.options.resource),o=y({name:".NoActionBar",output:a.output}),i=y({name:".AppBarOverlay",output:a.output}),d=y({name:".PopupOverlay",output:a.output}),s=o.items;n(a,"name",t.manifestThemeName),n(a,"parent","Theme.AppCompat.Light.DarkActionBar"),n(s,"windowActionBar","false"),n(s,"windowNoTitle","true"),n(i,"parent",r.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),n(d,"parent",r.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,o,i,d)}const i=t.data("android.widget.toolbar","background");if(i){const e=t.android("background");""!==e&&(i.android("background",e),t.delete("android","background"))}}createPlaceholder(e,t,a){const o=this.application.createNode({parent:e,children:t});if(o.inherit(e,"base"),t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);o.containerIndex=e}return a&&(o.dataset.target=a),o.exclude({resource:c.ALL}),o.positioned=!0,o.renderExclude=!1,o}}const b=new A("android.widget.toolbar",2);return squared&&squared.includeAsync(b),b}();
