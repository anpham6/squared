this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const t=squared.lib.constant,a=squared.lib.css,s=squared.lib.dom,n=squared.lib.session,i=squared.lib.util,o=android.lib.constant,r=android.lib.enumeration,d=android.lib.util,l=squared.base.lib.constant,p=squared.base.lib.enumeration,u="ic_menu_";class c extends squared.base.Extension{constructor(e,t,a,s){super(e,t,a,s),this.require("android.widget.menu")}init(e){if(this.included(e)){for(let t=0;t<e.children.length;t++){const a=e.children[t];if("NAV"===a.tagName&&!i.includes(a.dataset.use,l.EXT_NAME.EXTERNAL)){a.dataset.use=(a.dataset.use?`${a.dataset.use}, `:"")+l.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!i.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(s,l){const N=this.application,R=N.controllerHandler,A=this.application.resourceHandler,I=N.userSettings,m=s.element,D=s.dataset.target,O=Object.assign({},this.options[m.id]),T=d.createViewAttribute(O.self),g=d.createViewAttribute(O.appBar),E=d.createViewAttribute(O.collapsingToolbar),y=N.extensionManager.optionValueAsBoolean(o.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),_=c.findNestedElement(m,"android.widget.menu"),h=s.has("backgroundImage"),S=[],P=[];for(let e=0;e<m.children.length;e++){const t=m.children[e];if("IMG"===t.tagName){if(t.dataset.navigationIcon){const e=A.addImageSrc(t,u);""!==e&&i.assignEmptyValue(T,o.STRING_ANDROID.APP,"navigationIcon",`@drawable/${e}`)}if(t.dataset.collapseIcon){const e=A.addImageSrc(t,u);""!==e&&i.assignEmptyValue(T,o.STRING_ANDROID.APP,"collapseIcon",`@drawable/${e}`)}}if(!t.dataset.target){const e=n.getElementAsNode(t,s.sessionId);if(e)switch(t.dataset.targetModule){case"appBar":S.push(e);break;case"collapsingToolbar":P.push(e)}}}const b="collapsingToolbar"in O||P.length>0,G="appBar"in O||S.length>0||b;let f,C,V,w="",L="";if(b)i.assignEmptyValue(T,o.STRING_ANDROID.APP,"layout_collapseMode","pin");else if(i.assignEmptyValue(T,o.STRING_ANDROID.APP,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),h){const e=this.application.resourceHandler.addImageSrc(s.backgroundImage);""!==e&&(i.assignEmptyValue(G?g:T,o.STRING_ANDROID.ANDROID,"background",`@drawable/${e}`),s.exclude(p.NODE_RESOURCE.IMAGE_SOURCE))}else i.assignEmptyValue(T,o.STRING_ANDROID.APP,"layout_scrollFlags","scroll|enterAlways");if(G?_&&(T.app.popupTheme&&(L=T.app.popupTheme.replace("@style/","")),T.app.popupTheme=`@style/${I.manifestThemeName}.PopupOverlay`):(s.exclude(0,p.NODE_PROCEDURE.LAYOUT),i.assignEmptyValue(T,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true")),i.assignEmptyValue(T,o.STRING_ANDROID.ANDROID,"layout_height",G||!s.has(t.CSS.HEIGHT)?"?android:attr/actionBarSize":""),s.setControlType(o.SUPPORT_ANDROID.TOOLBAR,r.CONTAINER_NODE.BLOCK),s.exclude(p.NODE_RESOURCE.FONT_STYLE),G&&(i.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"id",`${s.documentId}_appbar`),i.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"layout_height",s.hasHeight?a.formatPX(s.actualHeight):o.STRING_ANDROID.WRAP_CONTENT),i.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),_?(g.android.theme&&(w=g.android.theme),g.android.theme=`@style/${I.manifestThemeName}.AppBarOverlay`,s.data("android.widget.toolbar","themeData",{appBarOverlay:w,popupOverlay:L})):i.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(f=this.createPlaceholder(s,S,D)).parent=l,g.android.id&&(f.controlId=d.getDocumentId(g.android.id)),f.setControlType(o.SUPPORT_ANDROID.APPBAR,r.CONTAINER_NODE.BLOCK),b&&(i.assignEmptyValue(E,o.STRING_ANDROID.ANDROID,"id",`${s.documentId}_collapsingtoolbar`),i.assignEmptyValue(E,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),h||i.assignEmptyValue(E,o.STRING_ANDROID.APP,"contentScrim","?attr/colorPrimary"),i.assignEmptyValue(E,o.STRING_ANDROID.APP,"layout_scrollFlags","scroll|exitUntilCollapsed"),i.assignEmptyValue(E,o.STRING_ANDROID.APP,"toolbarId",s.documentId),(C=this.createPlaceholder(s,P,D))&&(C.parent=f,E.android.id&&(f.controlId=d.getDocumentId(E.android.id)),C.setControlType(o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,r.CONTAINER_NODE.BLOCK),C.each(e=>e.dataset.target=C.controlId)))),f?(f.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),f.setLayoutHeight(o.STRING_ANDROID.WRAP_CONTENT),f.apply(e.formatOptions(g,y)),f.render(D?N.resolveTarget(D):l),V={type:1,node:f,controlName:o.SUPPORT_ANDROID.APPBAR},C?(s.parent=C,C.apply(e.formatOptions(E,y)),C.render(f),C.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),C.setLayoutHeight(o.STRING_ANDROID.MATCH_PARENT),N.addLayoutTemplate(C.renderParent||l,C,{type:1,node:C,controlName:o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR})):s.parent=f,s.data("android.widget.toolbar","outerParent",f.android("id")||f.documentId),s.render(s.parent)):s.render(D?N.resolveTarget(D):l),h&&b){const a=this.application.resourceHandler.addImageSrc(s.backgroundImage);if(""!==a){const n=d.createViewAttribute(O.backgroundImage);let r=t.CSS.CENTER;switch(s.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":r="centerCrop";break;case"contain":case"100% 100%":r="fitXY";break;case"auto":r="matrix"}i.assignEmptyValue(n,o.STRING_ANDROID.ANDROID,"id",`${s.documentId}_image`),i.assignEmptyValue(n,o.STRING_ANDROID.ANDROID,"src",`@drawable/${a}`),i.assignEmptyValue(n,o.STRING_ANDROID.ANDROID,"scaleType",r),i.assignEmptyValue(n,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),i.assignEmptyValue(n,o.STRING_ANDROID.APP,"layout_collapseMode","parallax"),R.addBeforeOutsideTemplate(s.id,R.renderNodeStatic(o.CONTAINER_ANDROID.IMAGE,e.formatOptions(n,y),o.STRING_ANDROID.MATCH_PARENT,o.STRING_ANDROID.MATCH_PARENT)),s.exclude(p.NODE_RESOURCE.IMAGE_SOURCE)}}s.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),s.apply(e.formatOptions(T,y));const B={type:1,node:s,controlName:o.SUPPORT_ANDROID.TOOLBAR};return f?{output:B,parentAs:s.parent,renderAs:f,outputAs:V}:{output:B}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(t){const a=i.optionalAsString(c.findNestedElement(t.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const e=d.createViewAttribute(this.options[t.elementId]&&this.options[t.elementId].self);i.assignEmptyValue(e,o.STRING_ANDROID.APP,"menu",`@menu/${a}`),t.app("menu",e.app.menu)}const s=t.data("android.widget.toolbar","themeData");if(s){const t=this.application.userSettings,a=d.createStyleAttribute(this.options.resource),n=d.createStyleAttribute({name:".NoActionBar",output:a.output}),r=d.createStyleAttribute({name:".AppBarOverlay",output:a.output}),l=d.createStyleAttribute({name:".PopupOverlay",output:a.output});i.assignEmptyValue(a,"name",t.manifestThemeName),i.assignEmptyValue(a,o.STRING_ANDROID.PARENT,"Theme.AppCompat.Light.DarkActionBar"),i.assignEmptyValue(n.items,"windowActionBar","false"),i.assignEmptyValue(n.items,"windowNoTitle","true"),i.assignEmptyValue(r,o.STRING_ANDROID.PARENT,s.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),i.assignEmptyValue(l,o.STRING_ANDROID.PARENT,s.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,n,r,l)}}createPlaceholder(e,t,a){let n=1/0;for(const e of t)n=Math.min(n,e.siblingIndex);const i=this.application.createNode(s.createElement(e.actualParent&&e.actualParent.element,e.block?"div":"span"),!0,e,t);return i.siblingIndex=n,a&&(i.dataset.target=a),i.inherit(e,"base"),i.exclude(p.NODE_RESOURCE.ALL),i.positioned=!0,i}}const N=new c("android.widget.toolbar",2);return squared&&squared.includeAsync(N),N}();
