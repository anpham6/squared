this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const t=squared.base.lib.constant,a=squared.lib.css,n=squared.lib.dom,r=squared.base.lib.enumeration,o=squared.lib.session,i=squared.lib.util,s=android.lib.constant,d=android.lib.enumeration,l=android.lib.util;class p extends squared.base.Extension{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){for(let a=0;a<e.children.length;a++){const n=e.children[a];if("NAV"===n.tagName&&!i.includes(n.dataset.use,t.EXT_NAME.EXTERNAL)){n.dataset.use=(n.dataset.use?`${n.dataset.use}, `:"")+t.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!i.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(t,n){const u=this.application,c=u.controllerHandler,m=u.userSettings,g=t.element,h=t.dataset.target,y=Object.assign({},this.options[g.id]),E=l.createViewAttribute(y.self),O=l.createViewAttribute(y.appBar),A=l.createViewAttribute(y.collapsingToolbar),N=u.extensionManager.optionValueAsBoolean(s.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),b=p.findNestedElement(g,"android.widget.menu"),I=t.has("backgroundImage"),R=[],T=[];for(let a=0;a<g.children.length;a++){const n=g.children[a];if("IMG"===n.tagName){if(n.dataset.navigationIcon){const t=e.addImageSrc(n,s.PREFIX_ANDROID.MENU);""!==t&&i.assignEmptyValue(E,"app","navigationIcon",`@drawable/${t}`)}if(n.dataset.collapseIcon){const t=e.addImageSrc(n,s.PREFIX_ANDROID.MENU);""!==t&&i.assignEmptyValue(E,"app","collapseIcon",`@drawable/${t}`)}}if(!n.dataset.target){const e=o.getElementAsNode(n,t.sessionId);if(e)switch(n.dataset.targetModule){case"appBar":R.push(e);break;case"collapsingToolbar":T.push(e)}}}const _="collapsingToolbar"in y||T.length>0,f="appBar"in y||R.length>0||_;let w,V,S,D="",P="";if(_?i.assignEmptyValue(E,"app","layout_collapseMode","pin"):(i.assignEmptyValue(E,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),I?(i.assignEmptyValue(f?O:E,"android","background",`@drawable/${e.addImageURL(t.css("backgroundImage"))}`),t.exclude({resource:r.NODE_RESOURCE.IMAGE_SOURCE})):i.assignEmptyValue(E,"app","layout_scrollFlags","scroll|enterAlways")),f?b&&(E.app.popupTheme&&(P=E.app.popupTheme.replace("@style/","")),E.app.popupTheme=`@style/${m.manifestThemeName}.PopupOverlay`):(t.exclude({procedure:r.NODE_PROCEDURE.LAYOUT}),i.assignEmptyValue(E,"android","fitsSystemWindows","true")),i.assignEmptyValue(E,"android","layout_height",f||!t.has("height")?"?android:attr/actionBarSize":""),t.setControlType(s.SUPPORT_ANDROID.TOOLBAR,d.CONTAINER_NODE.BLOCK),t.exclude({resource:r.NODE_RESOURCE.FONT_STYLE}),f&&(i.assignEmptyValue(O,"android","id",`${t.documentId}_appbar`),i.assignEmptyValue(O,"android","layout_height",t.hasHeight?a.formatPX(t.actualHeight):"wrap_content"),i.assignEmptyValue(O,"android","fitsSystemWindows","true"),b?(O.android.theme&&(D=O.android.theme),O.android.theme=`@style/${m.manifestThemeName}.AppBarOverlay`,t.data("android.widget.toolbar","themeData",{appBarOverlay:D,popupOverlay:P})):i.assignEmptyValue(O,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(w=this.createPlaceholder(t,R,h)).parent=n,w.controlId=l.stripId(O.android.id),w.setControlType(s.SUPPORT_ANDROID.APPBAR,d.CONTAINER_NODE.BLOCK),_&&(i.assignEmptyValue(A,"android","id",`${t.documentId}_collapsingtoolbar`),i.assignEmptyValue(A,"android","fitsSystemWindows","true"),I||i.assignEmptyValue(A,"app","contentScrim","?attr/colorPrimary"),i.assignEmptyValue(A,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),i.assignEmptyValue(A,"app","toolbarId",t.documentId),(V=this.createPlaceholder(t,T,h))&&(V.parent=w,V.each(e=>e.dataset.target=V.controlId),V.setControlType(s.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,d.CONTAINER_NODE.BLOCK)))),w?(w.android("layout_width","match_parent"),w.android("layout_height","wrap_content"),w.apply(e.formatOptions(O,N)),w.render(h?u.resolveTarget(h):n),S={type:1,node:w,controlName:s.SUPPORT_ANDROID.APPBAR},V?(t.parent=V,V.apply(e.formatOptions(A,N)),V.render(w),V.android("layout_width","match_parent"),V.android("layout_height","match_parent"),u.addLayoutTemplate(V.renderParent||n,V,{type:1,node:V,controlName:s.SUPPORT_ANDROID.COLLAPSING_TOOLBAR})):t.parent=w,t.data("android.widget.toolbar","outerParent",w.android("id")||w.documentId),t.render(t.parent)):t.render(h?u.resolveTarget(h):n),I&&_){const a=e.addImageURL(t.css("backgroundImage"));if(""!==a){const n=l.createViewAttribute(y.backgroundImage);let o="center";switch(t.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":o="centerCrop";break;case"contain":case"100% 100%":o="fitXY";break;case"auto":o="matrix"}i.assignEmptyValue(n,"android","id",`${t.documentId}_image`),i.assignEmptyValue(n,"android","src",`@drawable/${a}`),i.assignEmptyValue(n,"android","scaleType",o),i.assignEmptyValue(n,"android","fitsSystemWindows","true"),i.assignEmptyValue(n,"app","layout_collapseMode","parallax"),c.addBeforeOutsideTemplate(t.id,c.renderNodeStatic(s.CONTAINER_ANDROID.IMAGE,e.formatOptions(n,N),"match_parent","match_parent")),t.exclude({resource:r.NODE_RESOURCE.IMAGE_SOURCE})}}t.android("layout_width","match_parent"),t.apply(e.formatOptions(E,N));const C={type:1,node:t,controlName:s.SUPPORT_ANDROID.TOOLBAR};return w?{output:C,parentAs:t.parent,renderAs:w,outputAs:S}:{output:C}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(t){const a=i.optionalAsString(p.findNestedElement(t.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const e=l.createViewAttribute(this.options[t.elementId]&&this.options[t.elementId].self);i.assignEmptyValue(e,"app","menu",`@menu/${a}`),t.app("menu",e.app.menu)}const n=t.data("android.widget.toolbar","themeData");if(n){const t=this.application.userSettings,a=l.createStyleAttribute(this.options.resource),r=l.createStyleAttribute({name:".NoActionBar",output:a.output}),o=l.createStyleAttribute({name:".AppBarOverlay",output:a.output}),s=l.createStyleAttribute({name:".PopupOverlay",output:a.output});i.assignEmptyValue(a,"name",t.manifestThemeName),i.assignEmptyValue(a,"parent","Theme.AppCompat.Light.DarkActionBar"),i.assignEmptyValue(r.items,"windowActionBar","false"),i.assignEmptyValue(r.items,"windowNoTitle","true"),i.assignEmptyValue(o,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),i.assignEmptyValue(s,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,r,o,s)}}createPlaceholder(e,t,a){let o=1/0;for(const e of t)o=Math.min(o,e.siblingIndex);const i=this.application.createNode(n.createElement(e.actualParent&&e.actualParent.element,e.block?"div":"span"),!0,e,t);return i.siblingIndex=o,a&&(i.dataset.target=a),i.inherit(e,"base"),i.exclude({resource:r.NODE_RESOURCE.ALL}),i.positioned=!0,i}}const u=new p("android.widget.toolbar",2);return squared&&squared.includeAsync(u),u}();
