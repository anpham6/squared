this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=squared.lib,t=android.lib,{formatPX:a}=e.css,{getElementAsNode:o}=e.session,{assignEmptyValue:r,safeNestedMap:n,includes:d,isString:i,iterateArray:s}=e.util,{NODE_PROCEDURE:l,NODE_RESOURCE:c,NODE_TEMPLATE:p}=squared.base.lib.enumeration,{CONTAINER_ANDROID:u,EXT_ANDROID:m,SUPPORT_ANDROID:h,SUPPORT_ANDROID_X:g}=t.constant,{BUILD_ANDROID:O,CONTAINER_NODE:y}=t.enumeration,{createStyleAttribute:f,createViewAttribute:I,getDocumentId:T}=t.util,A=android.base.Resource;class b extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){s(e.children,e=>{if("NAV"===e.tagName){const t=e.dataset.use;if(!d(t,m.EXTERNAL))return e.dataset.use=(t?t+", ":"")+m.EXTERNAL,true}});const t=e.dataset.target;if(t){const a=document.getElementById(t);a&&e.parentElement!==a&&!d(a.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return false}processNode(e,t){const d=this.application,p=this.resource,O=d.userSettings,f=e.element,N=e.dataset.target,_=Object.assign({},this.options[f.id]),E=I(_.self),w=I(_.appBar),L=I(_.collapsingToolbar),B=d.extensionManager.optionValueAsBoolean(m.RESOURCE_STRINGS,"numberResourceValue"),R=b.findNestedElement(f,"android.widget.menu"),S=e.has("backgroundImage"),P=[],v=[];let C=n(E,"app");s(f.children,t=>{const a=t.dataset;if("IMG"===t.tagName){if(a.navigationIcon){const e=p.addImageSrc(t,"ic_menu_");""!==e&&r(C,"navigationIcon","@drawable/"+e)}if(a.collapseIcon){const e=p.addImageSrc(t,"ic_menu_");""!==e&&r(C,"collapseIcon","@drawable/"+e)}}if(!a.target){const r=o(t,e.sessionId);if(r)switch(a.targetModule){case"appBar":P.push(r);break;case"collapsingToolbar":v.push(r)}}});const[D,k,x]=e.api<29?[h.TOOLBAR,h.APPBAR,h.COLLAPSING_TOOLBAR]:[g.TOOLBAR,g.APPBAR,g.COLLAPSING_TOOLBAR],M="collapsingToolbar"in _||v.length>0,U="appBar"in _||P.length>0||M;let V,W,X,q="",G="";if(M?r(C,"layout_collapseMode","pin"):(r(C,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),S||r(C,"layout_scrollFlags","scroll|enterAlways")),U){if(R){const e=C.popupTheme;e&&(G=e.replace("@style/","")),C.popupTheme=`@style/${O.manifestThemeName}.PopupOverlay`}}else e.exclude({procedure:l.LAYOUT}),r(E,"android","fitsSystemWindows","true");if(r(E,"android","layout_height",U||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.setControlType(D,y.BLOCK),e.exclude({resource:c.FONT_STYLE}),U){let o=w.android;r(w,"android","id",`@+id/${e.controlId}_appbar`),r(w,"android","layout_height",e.hasHeight?a(e.actualHeight):"wrap_content"),r(w,"android","fitsSystemWindows","true"),R?(o.theme&&(q=o.theme),o.theme=`@style/${O.manifestThemeName}.AppBarOverlay`,e.data("android.widget.toolbar","themeData",{appBarOverlay:q,popupOverlay:G})):r(w,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),V=this.createPlaceholder(e,P,N),V.parent=t;let d=o.id;if(i(d)&&(V.controlId=T(d),delete o.id),V.setControlType(k,y.BLOCK),M&&(C=n(L,"app"),r(L,"android","id",`@+id/${e.controlId}_collapsingtoolbar`),r(L,"android","fitsSystemWindows","true"),S||r(C,"contentScrim","?attr/colorPrimary"),r(C,"layout_scrollFlags","scroll|exitUntilCollapsed"),r(C,"toolbarId",e.documentId),W=this.createPlaceholder(e,v,N),W)){W.parent=V,o=L.android,d=o.id,d&&(V.controlId=T(d),delete o.id),W.setControlType(x,y.BLOCK);const e=W.controlId;W.each(t=>t.dataset.target=e)}}if(V){if(V.setLayoutWidth("match_parent"),V.setLayoutHeight("wrap_content"),V.apply(A.formatOptions(w,B)),V.render(N?d.resolveTarget(N):t),X={type:1,node:V,controlName:k},W){if(e.parent=W,W.apply(A.formatOptions(L,B)),W.render(V),W.setLayoutWidth("match_parent"),W.setLayoutHeight("match_parent"),d.addLayoutTemplate(W.renderParent,W,{type:1,node:W,controlName:x}),S){const t=p.addImageSrc(e.backgroundImage);if(""!==t){const a=this.controller,o=I(_.backgroundImage);let d;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":d="centerCrop";break;case"contain":case"100%":case"100% 100%":d="fitXY";break;case"auto":d="matrix";break;default:d="center"}C=n(o,"app"),r(o,"android","id",`@+id/${e.controlId}_image`),r(o,"android","src","@drawable/"+t),r(o,"android","scaleType",d),r(o,"android","fitsSystemWindows","true"),r(C,"layout_collapseMode","parallax"),a.addBeforeOutsideTemplate(e.id,a.renderNodeStatic({controlName:u.IMAGE,width:"match_parent",height:"match_parent"},A.formatOptions(o,B))),e.setCacheValue("backgroundImage","")}}}else e.parent=V,S&&e.data("android.widget.toolbar","background",V);e.data("android.widget.toolbar","outerParent",V.android("id")||V.documentId),e.render(e.parent)}else e.render(N?d.resolveTarget(N):t);e.setLayoutWidth("match_parent"),e.apply(A.formatOptions(E,B));const $={type:1,node:e,controlName:D};return V?{output:$,outerParent:e.parent,renderAs:V,outputAs:X,include:true}:{output:$,include:true}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:true}}postOptimize(e){var t,a;const o=null===(t=b.findNestedElement(e.element,"android.widget.menu"))||void 0===t?void 0:t.dataset.layoutName;if(o){const t=I(null===(a=this.options[e.elementId])||void 0===a?void 0:a.self),d=n(t,"app");r(d,"menu","@menu/"+o),e.app("menu",d.menu)}const d=e.data("android.widget.toolbar","themeData");if(d){const e=this.application.userSettings,t=f(this.options.resource),a=f({name:".NoActionBar",output:t.output}),o=f({name:".AppBarOverlay",output:t.output}),n=f({name:".PopupOverlay",output:t.output}),i=a.items;r(t,"name",e.manifestThemeName),r(t,"parent","Theme.AppCompat.Light.DarkActionBar"),r(i,"windowActionBar","false"),r(i,"windowNoTitle","true"),r(o,"parent",d.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),r(n,"parent",d.popupOverlay||"ThemeOverlay.AppCompat.Light"),A.addTheme(t),A.addTheme(a),A.addTheme(o),A.addTheme(n)}const i=e.data("android.widget.toolbar","background");if(i){const t=e.android("background");""!==t&&(i.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const o=t.length>0,r=this.application.createNode({parent:e,children:t,delegate:o,cascade:true});if(r.inherit(e,"base"),o){let e=Number.POSITIVE_INFINITY;t.forEach(t=>e=Math.min(e,t.containerIndex)),r.containerIndex=e}return a&&(r.dataset.target=a),r.exclude({resource:c.ALL}),r.positioned=true,r.renderExclude=false,r}}const N=new b("android.widget.toolbar",2);return squared&&squared.include(N),N}();
