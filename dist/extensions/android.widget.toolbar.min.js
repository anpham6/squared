this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=squared.lib,{formatPX:t}=e.css,{getElementAsNode:a}=e.session,{assignEmptyValue:o,includes:n,optionalAsString:r}=e.util,{NODE_PROCEDURE:i,NODE_RESOURCE:d}=squared.base.lib.enumeration,s=android.lib,{CONTAINER_ANDROID:l,EXT_ANDROID:p,SUPPORT_ANDROID:c,SUPPORT_ANDROID_X:u}=s.constant,{CONTAINER_NODE:m}=s.enumeration,{createStyleAttribute:h,createViewAttribute:g,getDocumentId:y}=s.util,{Resource:O}=android.base,f="ic_menu_";class A extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,a=t.length;for(let e=0;e<a;e++){const a=t[e];if("NAV"===a.tagName&&!n(a.dataset.use,p.EXTERNAL)){a.dataset.use=(a.dataset.use?a.dataset.use+", ":"")+p.EXTERNAL;break}}const o=e.dataset.target;if(o){const t=document.getElementById(o);e.parentElement!==t&&t&&!n(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(e,n){const r=this.application,s=this.resource,h=r.userSettings,b=e.element,I=e.dataset.target,T=Object.assign({},this.options[b.id]),N=g(T.self),w=g(T.appBar),_=g(T.collapsingToolbar),E=r.extensionManager.optionValueAsBoolean(p.RESOURCE_STRINGS,"numberResourceValue"),L=A.findNestedElement(b,"android.widget.menu"),B=e.has("backgroundImage"),R=[],S=[],P=b.children,v=P.length;for(let t=0;t<v;t++){const n=P[t],r=n.dataset;if("IMG"===n.tagName){if(r.navigationIcon){const e=s.addImageSrc(n,f);""!==e&&o(N,"app","navigationIcon","@drawable/"+e)}if(r.collapseIcon){const e=s.addImageSrc(n,f);""!==e&&o(N,"app","collapseIcon","@drawable/"+e)}}if(!r.target){const t=a(n,e.sessionId);if(t)switch(r.targetModule){case"appBar":R.push(t);break;case"collapsingToolbar":S.push(t)}}}const C="collapsingToolbar"in T||S.length>0,k="appBar"in T||R.length>0||C;let D,x,U,M,W,X,q="",V="";if(C?o(N,"app","layout_collapseMode","pin"):(o(N,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),B||o(N,"app","layout_scrollFlags","scroll|enterAlways")),k){if(L){const e=N.app;e.popupTheme&&(V=e.popupTheme.replace("@style/","")),e.popupTheme="@style/"+h.manifestThemeName+".PopupOverlay"}}else e.exclude(0,i.LAYOUT),o(N,"android","fitsSystemWindows","true");if(o(N,"android","layout_height",k||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.localSettings.targetAPI<29?(D=c.TOOLBAR,x=c.APPBAR,U=c.COLLAPSING_TOOLBAR):(D=u.TOOLBAR,x=u.APPBAR,U=u.COLLAPSING_TOOLBAR),e.setControlType(D,m.BLOCK),e.exclude(d.FONT_STYLE),k){let a=w.android;o(w,"android","id",e.documentId.replace("@","@+")+"_appbar"),o(w,"android","layout_height",e.hasHeight?t(e.actualHeight):"wrap_content"),o(w,"android","fitsSystemWindows","true"),L?(a.theme&&(q=a.theme),a.theme="@style/"+h.manifestThemeName+".AppBarOverlay",e.data("android.widget.toolbar","themeData",{appBarOverlay:q,popupOverlay:V})):o(w,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),M=this.createPlaceholder(e,R,I),M.parent=n;let r=a.id;r&&(M.controlId=y(r),delete a.id),M.setControlType(x,m.BLOCK),C&&(o(_,"android","id",e.documentId.replace("@","@+")+"_collapsingtoolbar"),o(_,"android","fitsSystemWindows","true"),B||o(_,"app","contentScrim","?attr/colorPrimary"),o(_,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),o(_,"app","toolbarId",e.documentId),W=this.createPlaceholder(e,S,I),W&&(W.parent=M,a=_.android,r=a.id,r&&(M.controlId=y(r),delete a.id),W.setControlType(U,m.BLOCK),W.each(e=>e.dataset.target=W.controlId)))}if(M){if(M.setLayoutWidth("match_parent"),M.setLayoutHeight("wrap_content"),M.apply(O.formatOptions(w,E)),M.render(I?r.resolveTarget(I):n),X={type:1,node:M,controlName:x},W){if(e.parent=W,W.apply(O.formatOptions(_,E)),W.render(M),W.setLayoutWidth("match_parent"),W.setLayoutHeight("match_parent"),r.addLayoutTemplate(W.renderParent||n,W,{type:1,node:W,controlName:U}),B){const t=s.addImageSrc(e.backgroundImage);if(""!==t){const a=this.controller,n=g(T.backgroundImage);let r;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":r="centerCrop";break;case"contain":case"100% 100%":r="fitXY";break;case"auto":r="matrix";break;default:r="center"}o(n,"android","id",e.documentId.replace("@","@+")+"_image"),o(n,"android","src","@drawable/"+t),o(n,"android","scaleType",r),o(n,"android","fitsSystemWindows","true"),o(n,"app","layout_collapseMode","parallax"),a.addBeforeOutsideTemplate(e.id,a.renderNodeStatic(l.IMAGE,O.formatOptions(n,E),"match_parent","match_parent")),e.setCacheValue("backgroundImage","")}}}else e.parent=M,B&&e.data("android.widget.toolbar","background",M);e.data("android.widget.toolbar","outerParent",M.android("id")||M.documentId),e.render(e.parent)}else e.render(I?r.resolveTarget(I):n);e.setLayoutWidth("match_parent"),e.apply(O.formatOptions(N,E));const G={type:1,node:e,controlName:D};return M?{output:G,outerParent:e.parent,renderAs:M,outputAs:X}:{output:G}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){var t;const a=r(A.findNestedElement(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const n=g(null===(t=this.options[e.elementId])||void 0===t?void 0:t.self);o(n,"app","menu","@menu/"+a),e.app("menu",n.app.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=this.application.userSettings,t=h(this.options.resource),a=h({name:".NoActionBar",output:t.output}),r=h({name:".AppBarOverlay",output:t.output}),i=h({name:".PopupOverlay",output:t.output});o(t,"name",e.manifestThemeName),o(t,"parent","Theme.AppCompat.Light.DarkActionBar"),o(a.items,"windowActionBar","false"),o(a.items,"windowNoTitle","true"),o(r,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),o(i,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),O.addTheme(t,a,r,i)}const i=e.data("android.widget.toolbar","background");if(i){const t=e.android("background");""!==t&&(i.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const o=this.application.createNode(void 0,!0,e,t);if(t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);o.containerIndex=e}return a&&(o.dataset.target=a),o.inherit(e,"base"),o.exclude(d.ALL),o.positioned=!0,o.renderExclude=!1,o}}const b=new A("android.widget.toolbar",2);return squared&&squared.includeAsync(b),b}();
