this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{css:e,session:t,util:a}=squared.lib,{constant:n,enumeration:o,util:i}=android.lib,r=android.base.Resource,s=squared.base.lib.enumeration,d="ic_menu_";class p extends squared.base.ExtensionUI{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,o=t.length;for(let e=0;e<o;e++){const o=t[e];if("NAV"===o.tagName&&!a.includes(o.dataset.use,n.EXT_ANDROID.EXTERNAL)){o.dataset.use=(o.dataset.use?`${o.dataset.use}, `:"")+n.EXT_ANDROID.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!a.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(l,c){const u=this.application,m=this.controller,g=this.resource,h=u.userSettings,y=l.element,E=l.dataset.target,O=Object.assign({},this.options[y.id]),A=i.createViewAttribute(O.self),I=i.createViewAttribute(O.appBar),b=i.createViewAttribute(O.collapsingToolbar),N=u.extensionManager.optionValueAsBoolean(n.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),T=p.findNestedElement(y,"android.widget.menu"),f=l.has("backgroundImage"),R=[],_=[],V=y.children,w=V.length;for(let e=0;e<w;e++){const n=V[e],o=n.dataset;if("IMG"===n.tagName){if(o.navigationIcon){const e=g.addImageSrc(n,d);""!==e&&a.assignEmptyValue(A,"app","navigationIcon",`@drawable/${e}`)}if(o.collapseIcon){const e=g.addImageSrc(n,d);""!==e&&a.assignEmptyValue(A,"app","collapseIcon",`@drawable/${e}`)}}if(!o.target){const e=t.getElementAsNode(n,l.sessionId);if(e)switch(o.targetModule){case"appBar":R.push(e);break;case"collapsingToolbar":_.push(e)}}}const D="collapsingToolbar"in O||_.length>0,S="appBar"in O||R.length>0||D;let P,L,B,C="",v="";if(D?a.assignEmptyValue(A,"app","layout_collapseMode","pin"):(a.assignEmptyValue(A,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),f||a.assignEmptyValue(A,"app","layout_scrollFlags","scroll|enterAlways")),S){if(T){const e=A.app;e.popupTheme&&(v=e.popupTheme.replace("@style/","")),e.popupTheme=`@style/${h.manifestThemeName}.PopupOverlay`}}else l.exclude(0,s.NODE_PROCEDURE.LAYOUT),a.assignEmptyValue(A,"android","fitsSystemWindows","true");if(a.assignEmptyValue(A,"android","layout_height",S||!l.hasPX("height")?"?android:attr/actionBarSize":""),l.setControlType(n.SUPPORT_ANDROID.TOOLBAR,o.CONTAINER_NODE.BLOCK),l.exclude(s.NODE_RESOURCE.FONT_STYLE),S&&(a.assignEmptyValue(I,"android","id",`${l.documentId}_appbar`),a.assignEmptyValue(I,"android","layout_height",l.hasHeight?e.formatPX(l.actualHeight):"wrap_content"),a.assignEmptyValue(I,"android","fitsSystemWindows","true"),T?(I.android.theme&&(C=I.android.theme),I.android.theme=`@style/${h.manifestThemeName}.AppBarOverlay`,l.data("android.widget.toolbar","themeData",{appBarOverlay:C,popupOverlay:v})):a.assignEmptyValue(I,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(P=this.createPlaceholder(l,R,E)).parent=c,I.android.id&&(P.controlId=i.getDocumentId(I.android.id)),P.setControlType(n.SUPPORT_ANDROID.APPBAR,o.CONTAINER_NODE.BLOCK),D&&(a.assignEmptyValue(b,"android","id",`${l.documentId}_collapsingtoolbar`),a.assignEmptyValue(b,"android","fitsSystemWindows","true"),f||a.assignEmptyValue(b,"app","contentScrim","?attr/colorPrimary"),a.assignEmptyValue(b,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),a.assignEmptyValue(b,"app","toolbarId",l.documentId),(L=this.createPlaceholder(l,_,E))&&(L.parent=P,b.android.id&&(P.controlId=i.getDocumentId(b.android.id)),L.setControlType(n.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,o.CONTAINER_NODE.BLOCK),L.each(e=>e.dataset.target=L.controlId)))),P){if(P.setLayoutWidth("match_parent"),P.setLayoutHeight("wrap_content"),P.apply(r.formatOptions(I,N)),P.render(E?u.resolveTarget(E):c),B={type:1,node:P,controlName:n.SUPPORT_ANDROID.APPBAR},L){if(l.parent=L,L.apply(r.formatOptions(b,N)),L.render(P),L.setLayoutWidth("match_parent"),L.setLayoutHeight("match_parent"),u.addLayoutTemplate(L.renderParent||c,L,{type:1,node:L,controlName:n.SUPPORT_ANDROID.COLLAPSING_TOOLBAR}),f){const e=this.resource.addImageSrc(l.backgroundImage);if(""!==e){const t=i.createViewAttribute(O.backgroundImage);let o="center";switch(l.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":o="centerCrop";break;case"contain":case"100% 100%":o="fitXY";break;case"auto":o="matrix"}a.assignEmptyValue(t,"android","id",`${l.documentId}_image`),a.assignEmptyValue(t,"android","src",`@drawable/${e}`),a.assignEmptyValue(t,"android","scaleType",o),a.assignEmptyValue(t,"android","fitsSystemWindows","true"),a.assignEmptyValue(t,"app","layout_collapseMode","parallax"),m.addBeforeOutsideTemplate(l.id,m.renderNodeStatic(n.CONTAINER_ANDROID.IMAGE,r.formatOptions(t,N),"match_parent","match_parent")),l.setCacheValue("backgroundImage","")}}}else l.parent=P,f&&l.data("android.widget.toolbar","background",P);l.data("android.widget.toolbar","outerParent",P.android("id")||P.documentId),l.render(l.parent)}else l.render(E?u.resolveTarget(E):c);l.setLayoutWidth("match_parent"),l.apply(r.formatOptions(A,N));const k={type:1,node:l,controlName:n.SUPPORT_ANDROID.TOOLBAR};return P?{output:k,parentAs:l.parent,renderAs:P,outputAs:B}:{output:k}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){const t=a.optionalAsString(p.findNestedElement(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const n=i.createViewAttribute(this.options[e.elementId]&&this.options[e.elementId].self);a.assignEmptyValue(n,"app","menu",`@menu/${t}`),e.app("menu",n.app.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=this.application.userSettings,t=i.createStyleAttribute(this.options.resource),o=i.createStyleAttribute({name:".NoActionBar",output:t.output}),s=i.createStyleAttribute({name:".AppBarOverlay",output:t.output}),d=i.createStyleAttribute({name:".PopupOverlay",output:t.output});a.assignEmptyValue(t,"name",e.manifestThemeName),a.assignEmptyValue(t,"parent","Theme.AppCompat.Light.DarkActionBar"),a.assignEmptyValue(o.items,"windowActionBar","false"),a.assignEmptyValue(o.items,"windowNoTitle","true"),a.assignEmptyValue(s,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),a.assignEmptyValue(d,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),r.addTheme(t,o,s,d)}const o=e.data("android.widget.toolbar","background");if(o){const t=e.android("background");""!==t&&(o.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const n=this.application.createNode(void 0,!0,e,t);if(t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);n.containerIndex=e}return a&&(n.dataset.target=a),n.inherit(e,"base"),n.exclude(s.NODE_RESOURCE.ALL),n.positioned=!0,n.renderExclude=!1,n}}const l=new p("android.widget.toolbar",2);return squared&&squared.includeAsync(l),l}();
