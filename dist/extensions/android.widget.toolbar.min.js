this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const a=squared.base.lib.constant,t=squared.lib.dom,n=squared.base.lib.enumeration,r=squared.lib.session,o=squared.lib.util,i=android.lib.constant,s=android.lib.enumeration,d=android.lib.util;class l extends squared.base.Extension{constructor(e,a,t,n){super(e,a,t,n),this.require("android.widget.menu")}init(e){if(this.included(e)){for(let t=0;t<e.children.length;t++){const n=e.children[t];if("NAV"===n.tagName&&!o.includes(n.dataset.use,a.EXT_NAME.EXTERNAL)){n.dataset.use=(n.dataset.use?`${n.dataset.use}, `:"")+a.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const a=document.getElementById(e.dataset.target);a&&e.parentElement!==a&&!o.includes(a.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(a,t){const p=this.application,u=p.controllerHandler,c=p.userSettings,m=a.element,g=a.dataset.target,h=Object.assign({},this.options[m.id]),E=d.createViewAttribute(h.self),y=d.createViewAttribute(h.appBar),O=d.createViewAttribute(h.collapsingToolbar),A=p.extensionManager.optionValueAsBoolean(i.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),N=l.findNestedElement(m,"android.widget.menu"),b=a.has("backgroundImage"),I=[],R=[];for(let t=0;t<m.children.length;t++){const n=m.children[t];if("IMG"===n.tagName){if(o.hasValue(n.dataset.navigationIcon)){const a=e.addImageSrc(n,i.PREFIX_ANDROID.MENU);""!==a&&o.assignEmptyValue(E,"app","navigationIcon",`@drawable/${a}`)}if(o.hasValue(n.dataset.collapseIcon)){const a=e.addImageSrc(n,i.PREFIX_ANDROID.MENU);""!==a&&o.assignEmptyValue(E,"app","collapseIcon",`@drawable/${a}`)}}if(!n.dataset.target){const e=r.getElementAsNode(n,a.sessionId);if(e)switch(n.dataset.targetModule){case"appBar":I.push(e);break;case"collapsingToolbar":R.push(e)}}}const T="collapsingToolbar"in h||R.length>0,_="appBar"in h||I.length>0||T;let V,f,w,S="",D="";if(T?o.assignEmptyValue(E,"app","layout_collapseMode","pin"):(o.assignEmptyValue(E,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),b?(o.assignEmptyValue(_?y:E,"android","background",`@drawable/${e.addImageUrl(a.css("backgroundImage"))}`),a.exclude({resource:n.NODE_RESOURCE.IMAGE_SOURCE})):o.assignEmptyValue(E,"app","layout_scrollFlags","scroll|enterAlways")),_?N&&(E.app.popupTheme&&(D=E.app.popupTheme.replace("@style/","")),E.app.popupTheme=`@style/${c.manifestThemeName}.PopupOverlay`):(a.exclude({procedure:n.NODE_PROCEDURE.LAYOUT}),o.assignEmptyValue(E,"android","fitsSystemWindows","true")),o.assignEmptyValue(E,"android","layout_height",_||!a.has("height")?"?android:attr/actionBarSize":""),a.setControlType(i.SUPPORT_ANDROID.TOOLBAR,s.CONTAINER_NODE.BLOCK),a.exclude({resource:n.NODE_RESOURCE.FONT_STYLE}),_&&(o.assignEmptyValue(y,"android","id",`${a.documentId}_appbar`),o.assignEmptyValue(y,"android","layout_height",a.hasHeight?o.formatPX(a.height):"wrap_content"),o.assignEmptyValue(y,"android","fitsSystemWindows","true"),N?(y.android.theme&&(S=y.android.theme),y.android.theme=`@style/${c.manifestThemeName}.AppBarOverlay`,a.data("android.widget.toolbar","themeData",{appBarOverlay:S,popupOverlay:D})):o.assignEmptyValue(y,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(V=this.createPlaceholder(a,I,g)).parent=t,V.controlId=d.stripId(y.android.id),V.setControlType(i.SUPPORT_ANDROID.APPBAR,s.CONTAINER_NODE.BLOCK),T&&(o.assignEmptyValue(O,"android","id",`${a.documentId}_collapsingtoolbar`),o.assignEmptyValue(O,"android","fitsSystemWindows","true"),b||o.assignEmptyValue(O,"app","contentScrim","?attr/colorPrimary"),o.assignEmptyValue(O,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),o.assignEmptyValue(O,"app","toolbarId",a.documentId),(f=this.createPlaceholder(a,R,g))&&(f.parent=V,f.each(e=>e.dataset.target=f.controlId),f.setControlType(i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,s.CONTAINER_NODE.BLOCK)))),V?(V.android("layout_width","match_parent"),V.android("layout_height","wrap_content"),V.apply(e.formatOptions(y,A)),V.render(g?p.resolveTarget(g):t),w={type:1,node:V,controlName:i.SUPPORT_ANDROID.APPBAR},f?(a.parent=f,f.apply(e.formatOptions(O,A)),f.render(V),f.android("layout_width","match_parent"),f.android("layout_height","match_parent"),p.addRenderTemplate(f.renderParent||t,f,{type:1,node:f,controlName:i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR})):a.parent=V,a.data("android.widget.toolbar","outerParent",V.android("id")||V.documentId),a.render(a.parent)):a.render(g?p.resolveTarget(g):t),b&&T){const t=e.addImageUrl(a.css("backgroundImage"));if(""!==t){const r=d.createViewAttribute(h.backgroundImage);let s="center";switch(a.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":s="centerCrop";break;case"contain":case"100% 100%":s="fitXY";break;case"auto":s="matrix"}o.assignEmptyValue(r,"android","id",`${a.documentId}_image`),o.assignEmptyValue(r,"android","src",`@drawable/${t}`),o.assignEmptyValue(r,"android","scaleType",s),o.assignEmptyValue(r,"android","fitsSystemWindows","true"),o.assignEmptyValue(r,"app","layout_collapseMode","parallax"),u.addBeforeOutsideTemplate(a.id,u.renderNodeStatic(i.CONTAINER_ANDROID.IMAGE,e.formatOptions(r,A),"match_parent","match_parent")),a.exclude({resource:n.NODE_RESOURCE.IMAGE_SOURCE})}}a.android("layout_width","match_parent"),a.apply(e.formatOptions(E,A));const P={type:1,node:a,controlName:i.SUPPORT_ANDROID.TOOLBAR};return V?{output:P,parentAs:a.parent,renderAs:V,outputAs:w}:{output:P}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postProcedure(a){const t=o.optionalAsString(l.findNestedElement(a.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const e=d.createViewAttribute(this.options[a.elementId]&&this.options[a.elementId].self);o.assignEmptyValue(e,"app","menu",`@menu/${t}`),a.app("menu",e.app.menu)}const n=a.data("android.widget.toolbar","themeData");if(n){const a=this.application.userSettings,t=d.createStyleAttribute(this.options.resource),r=d.createStyleAttribute({name:".NoActionBar",output:t.output}),i=d.createStyleAttribute({name:".AppBarOverlay",output:t.output}),s=d.createStyleAttribute({name:".PopupOverlay",output:t.output});o.assignEmptyValue(t,"name",a.manifestThemeName),o.assignEmptyValue(t,"parent","Theme.AppCompat.Light.DarkActionBar"),o.assignEmptyValue(r.items,"windowActionBar","false"),o.assignEmptyValue(r.items,"windowNoTitle","true"),o.assignEmptyValue(i,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),o.assignEmptyValue(s,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(t,r,i,s)}}createPlaceholder(e,a,r){let o=1/0;for(const e of a)o=Math.min(o,e.siblingIndex);const i=this.application.createNode(t.createElement(e.actualParent?e.actualParent.element:null,e.block?"div":"span"),!0,e,a);return i.siblingIndex=o,r&&(i.dataset.target=r),i.inherit(e,"base"),i.exclude({resource:n.NODE_RESOURCE.ALL}),i.positioned=!0,i}}const p=new l("android.widget.toolbar",2);return squared&&squared.includeAsync(p),p}();
