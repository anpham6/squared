this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{constant:e,css:t,session:a,util:n}=squared.lib,{constant:o,enumeration:s,util:i}=android.lib,{constant:r,enumeration:d}=squared.base.lib,l=android.base.Resource,p="ic_menu_";class u extends squared.base.ExtensionUI{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,a=t.length;for(let e=0;e<a;e++){const a=t[e];if("NAV"===a.tagName&&!n.includes(a.dataset.use,r.EXT_NAME.EXTERNAL)){a.dataset.use=(a.dataset.use?`${a.dataset.use}, `:"")+r.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!n.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(r,c){const N=this.application,R=N.controllerHandler,A=N.resourceHandler,I=N.userSettings,m=r.element,D=r.dataset.target,O=Object.assign({},this.options[m.id]),T=i.createViewAttribute(O.self),g=i.createViewAttribute(O.appBar),E=i.createViewAttribute(O.collapsingToolbar),y=N.extensionManager.optionValueAsBoolean(o.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),_=u.findNestedElement(m,"android.widget.menu"),S=r.has("backgroundImage"),h=[],P=[],b=m.children,G=b.length;for(let e=0;e<G;e++){const t=b[e];if("IMG"===t.tagName){if(t.dataset.navigationIcon){const e=A.addImageSrc(t,p);""!==e&&n.assignEmptyValue(T,o.STRING_ANDROID.APP,"navigationIcon",`@drawable/${e}`)}if(t.dataset.collapseIcon){const e=A.addImageSrc(t,p);""!==e&&n.assignEmptyValue(T,o.STRING_ANDROID.APP,"collapseIcon",`@drawable/${e}`)}}if(!t.dataset.target){const e=a.getElementAsNode(t,r.sessionId);if(e)switch(t.dataset.targetModule){case"appBar":h.push(e);break;case"collapsingToolbar":P.push(e)}}}const f="collapsingToolbar"in O||P.length>0,C="appBar"in O||h.length>0||f;let V,w,L,B="",v="";if(f)n.assignEmptyValue(T,o.STRING_ANDROID.APP,"layout_collapseMode","pin");else if(n.assignEmptyValue(T,o.STRING_ANDROID.APP,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),S){const e=this.application.resourceHandler.addImageSrc(r.backgroundImage);""!==e&&(n.assignEmptyValue(C?g:T,o.STRING_ANDROID.ANDROID,"background",`@drawable/${e}`),r.exclude(d.NODE_RESOURCE.IMAGE_SOURCE))}else n.assignEmptyValue(T,o.STRING_ANDROID.APP,"layout_scrollFlags","scroll|enterAlways");if(C?_&&(T.app.popupTheme&&(v=T.app.popupTheme.replace("@style/","")),T.app.popupTheme=`@style/${I.manifestThemeName}.PopupOverlay`):(r.exclude(0,d.NODE_PROCEDURE.LAYOUT),n.assignEmptyValue(T,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true")),n.assignEmptyValue(T,o.STRING_ANDROID.ANDROID,"layout_height",C||!r.hasPX(e.CSS.HEIGHT)?"?android:attr/actionBarSize":""),r.setControlType(o.SUPPORT_ANDROID.TOOLBAR,s.CONTAINER_NODE.BLOCK),r.exclude(d.NODE_RESOURCE.FONT_STYLE),C&&(n.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"id",`${r.documentId}_appbar`),n.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"layout_height",r.hasHeight?t.formatPX(r.actualHeight):o.STRING_ANDROID.WRAP_CONTENT),n.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),_?(g.android.theme&&(B=g.android.theme),g.android.theme=`@style/${I.manifestThemeName}.AppBarOverlay`,r.data("android.widget.toolbar","themeData",{appBarOverlay:B,popupOverlay:v})):n.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(V=this.createPlaceholder(r,h,D)).parent=c,g.android.id&&(V.controlId=i.getDocumentId(g.android.id)),V.setControlType(o.SUPPORT_ANDROID.APPBAR,s.CONTAINER_NODE.BLOCK),f&&(n.assignEmptyValue(E,o.STRING_ANDROID.ANDROID,"id",`${r.documentId}_collapsingtoolbar`),n.assignEmptyValue(E,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),S||n.assignEmptyValue(E,o.STRING_ANDROID.APP,"contentScrim","?attr/colorPrimary"),n.assignEmptyValue(E,o.STRING_ANDROID.APP,"layout_scrollFlags","scroll|exitUntilCollapsed"),n.assignEmptyValue(E,o.STRING_ANDROID.APP,"toolbarId",r.documentId),(w=this.createPlaceholder(r,P,D))&&(w.parent=V,E.android.id&&(V.controlId=i.getDocumentId(E.android.id)),w.setControlType(o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,s.CONTAINER_NODE.BLOCK),w.each(e=>e.dataset.target=w.controlId)))),V?(V.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),V.setLayoutHeight(o.STRING_ANDROID.WRAP_CONTENT),V.apply(l.formatOptions(g,y)),V.render(D?N.resolveTarget(D):c),L={type:1,node:V,controlName:o.SUPPORT_ANDROID.APPBAR},w?(r.parent=w,w.apply(l.formatOptions(E,y)),w.render(V),w.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),w.setLayoutHeight(o.STRING_ANDROID.MATCH_PARENT),N.addLayoutTemplate(w.renderParent||c,w,{type:1,node:w,controlName:o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR})):r.parent=V,r.data("android.widget.toolbar","outerParent",V.android("id")||V.documentId),r.render(r.parent)):r.render(D?N.resolveTarget(D):c),S&&f){const t=this.application.resourceHandler.addImageSrc(r.backgroundImage);if(""!==t){const a=i.createViewAttribute(O.backgroundImage);let s=e.CSS.CENTER;switch(r.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":s="centerCrop";break;case"contain":case"100% 100%":s="fitXY";break;case"auto":s="matrix"}n.assignEmptyValue(a,o.STRING_ANDROID.ANDROID,"id",`${r.documentId}_image`),n.assignEmptyValue(a,o.STRING_ANDROID.ANDROID,"src",`@drawable/${t}`),n.assignEmptyValue(a,o.STRING_ANDROID.ANDROID,"scaleType",s),n.assignEmptyValue(a,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),n.assignEmptyValue(a,o.STRING_ANDROID.APP,"layout_collapseMode","parallax"),R.addBeforeOutsideTemplate(r.id,R.renderNodeStatic(o.CONTAINER_ANDROID.IMAGE,l.formatOptions(a,y),o.STRING_ANDROID.MATCH_PARENT,o.STRING_ANDROID.MATCH_PARENT)),r.exclude(d.NODE_RESOURCE.IMAGE_SOURCE)}}r.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),r.apply(l.formatOptions(T,y));const M={type:1,node:r,controlName:o.SUPPORT_ANDROID.TOOLBAR};return V?{output:M,parentAs:r.parent,renderAs:V,outputAs:L}:{output:M}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){const t=n.optionalAsString(u.findNestedElement(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const a=i.createViewAttribute(this.options[e.elementId]&&this.options[e.elementId].self);n.assignEmptyValue(a,o.STRING_ANDROID.APP,"menu",`@menu/${t}`),e.app("menu",a.app.menu)}const a=e.data("android.widget.toolbar","themeData");if(a){const e=this.application.userSettings,t=i.createStyleAttribute(this.options.resource),s=i.createStyleAttribute({name:".NoActionBar",output:t.output}),r=i.createStyleAttribute({name:".AppBarOverlay",output:t.output}),d=i.createStyleAttribute({name:".PopupOverlay",output:t.output});n.assignEmptyValue(t,"name",e.manifestThemeName),n.assignEmptyValue(t,o.STRING_ANDROID.PARENT,"Theme.AppCompat.Light.DarkActionBar"),n.assignEmptyValue(s.items,"windowActionBar","false"),n.assignEmptyValue(s.items,"windowNoTitle","true"),n.assignEmptyValue(r,o.STRING_ANDROID.PARENT,a.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),n.assignEmptyValue(d,o.STRING_ANDROID.PARENT,a.popupOverlay||"ThemeOverlay.AppCompat.Light"),l.addTheme(t,s,r,d)}}createPlaceholder(e,t,a){const n=this.application.createNode(void 0,!0,e,t);if(t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);n.containerIndex=e}return a&&(n.dataset.target=a),n.inherit(e,"base"),n.exclude(d.NODE_RESOURCE.ALL),n.positioned=!0,n.renderExclude=!1,n}}const c=new u("android.widget.toolbar",2);return squared&&squared.includeAsync(c),c}();
