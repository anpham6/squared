this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=squared.lib,t=android.lib,{formatPX:a}=e.css,{getElementAsNode:o}=e.session,{assignEmptyValue:r,capitalize:i,includes:n,isString:d,iterateArray:s,safeNestedMap:l}=e.util,{NODE_PROCEDURE:c,NODE_RESOURCE:p,NODE_TEMPLATE:u}=squared.base.lib.enumeration,{CONTAINER_ANDROID:m,EXT_ANDROID:h,SUPPORT_ANDROID:g,SUPPORT_ANDROID_X:f}=t.constant,{BUILD_ANDROID:y,CONTAINER_NODE:O}=t.enumeration,{createStyleAttribute:T,createViewAttribute:b,getDocumentId:A}=t.util,N=android.base.Resource;class Toolbar extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=this.application;s(e.children,e=>{if("NAV"===e.tagName){const a=t.getDatasetName("use",e);if(!n(a,h.EXTERNAL))return t.setDatasetName("use",e,(a?a+", ":"")+h.EXTERNAL),true}});const a=e.dataset.androidTarget;if(a){const o=document.getElementById(a);if(o&&!n(t.getDatasetName("use",o),"android.widget.coordinator"))t.rootElements.add(e)}}return false}processNode(e,t){const i=this.application,n=this.resource,u=i.userSettings,y=e.element,T=Object.assign({},this.options[y.id]),I=b(T.self),_=b(T.appBar),w=b(T.collapsingToolbar),E=i.extensionManager.optionValueAsBoolean(h.RESOURCE_STRINGS,"numberResourceValue"),L=Toolbar.findNestedElement(e,"android.widget.menu"),B=e.has("backgroundImage"),R=[],D=[];let S=l(I,"app");s(y.children,t=>{const a=t.dataset;if("IMG"===t.tagName){if(a.navigationIcon){const e=n.addImageSrc(t,"ic_menu_");if(""!==e)r(S,"navigationIcon","@drawable/"+e)}if(a.collapseIcon){const e=n.addImageSrc(t,"ic_menu_");if(""!==e)r(S,"collapseIcon","@drawable/"+e)}}if(!a.androidTarget){const r=o(t,e.sessionId);if(r)switch(a.androidTargetModule){case"appBar":R.push(r);break;case"collapsingToolbar":D.push(r);break}}});const[P,C,v]=e.api<29?[g.TOOLBAR,g.APPBAR,g.COLLAPSING_TOOLBAR]:[f.TOOLBAR,f.APPBAR,f.COLLAPSING_TOOLBAR],k="collapsingToolbar"in T||D.length>0,x="appBar"in T||R.length>0||k;let M,U,W,X="",q="";if(k)r(S,"layout_collapseMode","pin");else if(r(S,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),!B)r(S,"layout_scrollFlags","scroll|enterAlways");if(x){if(L){const e=S.popupTheme;if(e)q=e.replace("@style/","");S.popupTheme=`@style/${u.manifestThemeName}.PopupOverlay`}}else e.exclude({procedure:c.LAYOUT}),r(I,"android","fitsSystemWindows","true");if(r(I,"android","layout_height",x||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.setControlType(P,O.BLOCK),e.exclude({resource:p.FONT_STYLE}),x){let o=_.android;if(r(_,"android","id",`@+id/${e.controlId}_appbar`),r(_,"android","layout_height",e.hasHeight?a(e.actualHeight):"wrap_content"),r(_,"android","fitsSystemWindows","true"),L){if(o.theme)X=o.theme;o.theme=`@style/${u.manifestThemeName}.AppBarOverlay`,e.data("android.widget.toolbar","themeData",{appBarOverlay:X,popupOverlay:q})}else r(_,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar");M=this.createPlaceholder(e,R,e.target),M.parent=t;let i=o.id;if(d(i))M.controlId=A(i),delete o.id;if(M.setControlType(C,O.BLOCK),k){if(S=l(w,"app"),r(w,"android","id",`@+id/${e.controlId}_collapsingtoolbar`),r(w,"android","fitsSystemWindows","true"),!B)r(S,"contentScrim","?attr/colorPrimary");if(r(S,"layout_scrollFlags","scroll|exitUntilCollapsed"),r(S,"toolbarId",e.documentId),U=this.createPlaceholder(e,D),U){if(U.parent=M,o=w.android,i=o.id,i)M.controlId=A(i),delete o.id;U.setControlType(v,O.BLOCK)}}}if(M){if(M.setLayoutWidth("match_parent"),M.setLayoutHeight("wrap_content"),M.apply(N.formatOptions(_,E)),M.render(t),W={type:1,node:M,controlName:C},U){if(e.parent=U,U.apply(N.formatOptions(w,E)),U.render(M),U.setLayoutWidth("match_parent"),U.setLayoutHeight("match_parent"),i.addLayoutTemplate(U.renderParent,U,{type:1,node:U,controlName:v}),B){const t=n.addImageSrc(e.backgroundImage);if(""!==t){const a=this.controller,o=b(T.backgroundImage);let i;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":i="centerCrop";break;case"contain":case"100%":case"100% 100%":i="fitXY";break;case"auto":i="matrix";break;default:i="center";break}S=l(o,"app"),r(o,"android","id",`@+id/${e.controlId}_image`),r(o,"android","src","@drawable/"+t),r(o,"android","scaleType",i),r(o,"android","fitsSystemWindows","true"),r(S,"layout_collapseMode","parallax"),a.addBeforeOutsideTemplate(e.id,a.renderNodeStatic({controlName:m.IMAGE,width:"match_parent",height:"match_parent"},N.formatOptions(o,E))),e.setCacheValue("backgroundImage","")}}}else if(e.parent=M,B)e.data("android.widget.toolbar","background",M);e.data("android.widget.toolbar","outerParent",M.android("id")||M.documentId),e.render(e.parent)}else e.render(t);e.setLayoutWidth("match_parent"),e.apply(N.formatOptions(I,E));const V={type:1,node:e,controlName:P};if(M)return{output:V,outerParent:e.parent,renderAs:M,outputAs:W,include:true};else return{output:V,include:true}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:true}}postOptimize(e){var t,a;const o=null===(t=Toolbar.findNestedElement(e,"android.widget.menu"))||void 0===t?void 0:t.dataset["layoutName"+i(this.application.systemName)];if(o){const t=b(null===(a=this.options[e.elementId])||void 0===a?void 0:a.self),i=l(t,"app");r(i,"menu","@menu/"+o),e.app("menu",i.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=T(this.options.resource),t=T({name:".NoActionBar",output:e.output}),a=T({name:".AppBarOverlay",output:e.output}),o=T({name:".PopupOverlay",output:e.output});r(e,"name",this.application.userSettings.manifestThemeName),r(e,"parent","Theme.AppCompat.Light.DarkActionBar"),r(t.items,"windowActionBar","false"),r(t.items,"windowNoTitle","true"),r(a,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),r(o,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),N.addTheme(e),N.addTheme(t),N.addTheme(a),N.addTheme(o)}const d=e.data("android.widget.toolbar","background");if(d){const t=e.android("background");if(""!==t)d.android("background",t),e.delete("android","background")}}createPlaceholder(e,t,a){const o=t.length>0,r=this.application.createNode({parent:e,children:t,delegate:o,cascade:true});if(r.inherit(e,"base"),o){let e=1/0;t.forEach(t=>e=Math.min(e,t.containerIndex)),r.containerIndex=e}if(a)r.dataset.androidTarget=a.id,r.innerWrapped=e;return r.exclude({resource:p.ALL}),r.positioned=true,r.renderExclude=false,r}}const I=new Toolbar("android.widget.toolbar",2);if(squared)squared.include(I);return I}();
