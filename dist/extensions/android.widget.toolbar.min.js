this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=squared.lib,t=android.lib,{formatPX:a}=e.css,{getElementAsNode:o}=e.session,{assignEmptyValue:r,capitalize:i,includes:n,isString:d,iterateArray:s,safeNestedMap:l}=e.util,{NODE_PROCEDURE:c,NODE_RESOURCE:p,NODE_TEMPLATE:u}=squared.base.lib.enumeration,{CONTAINER_ANDROID:m,EXT_ANDROID:h,SUPPORT_ANDROID:g,SUPPORT_ANDROID_X:f}=t.constant,{BUILD_ANDROID:y,CONTAINER_NODE:O}=t.enumeration,{createStyleAttribute:T,createViewAttribute:I,getDocumentId:N}=t.util,b=android.base.Resource;class A extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=this.application;s(e.children,e=>{if("NAV"===e.tagName){const a=t.getDatasetName("use",e);if(!n(a,h.EXTERNAL))return t.setDatasetName("use",e,(a?a+", ":"")+h.EXTERNAL),true}});const a=e.dataset.androidTarget;if(a){const o=document.getElementById(a);if(o&&!n(t.getDatasetName("use",o),"android.widget.coordinator"))t.rootElements.add(e)}}return false}processNode(e,t){const i=this.application,n=this.resource,u=i.userSettings,y=e.element,T=Object.assign({},this.options[y.id]),_=I(T.self),w=I(T.appBar),E=I(T.collapsingToolbar),L=i.extensionManager.optionValueAsBoolean(h.RESOURCE_STRINGS,"numberResourceValue"),B=A.findNestedElement(e,"android.widget.menu"),R=e.has("backgroundImage"),D=[],S=[];let P=l(_,"app");s(y.children,t=>{const a=t.dataset;if("IMG"===t.tagName){if(a.navigationIcon){const e=n.addImageSrc(t,"ic_menu_");if(""!==e)r(P,"navigationIcon","@drawable/"+e)}if(a.collapseIcon){const e=n.addImageSrc(t,"ic_menu_");if(""!==e)r(P,"collapseIcon","@drawable/"+e)}}if(!a.androidTarget){const r=o(t,e.sessionId);if(r)switch(a.androidTargetModule){case"appBar":D.push(r);break;case"collapsingToolbar":S.push(r);break}}});const[C,v,k]=e.api<29?[g.TOOLBAR,g.APPBAR,g.COLLAPSING_TOOLBAR]:[f.TOOLBAR,f.APPBAR,f.COLLAPSING_TOOLBAR],x="collapsingToolbar"in T||S.length>0,M="appBar"in T||D.length>0||x;let U,W,V,X="",q="";if(x)r(P,"layout_collapseMode","pin");else if(r(P,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),!R)r(P,"layout_scrollFlags","scroll|enterAlways");if(M){if(B){const e=P.popupTheme;if(e)q=e.replace("@style/","");P.popupTheme=`@style/${u.manifestThemeName}.PopupOverlay`}}else e.exclude({procedure:c.LAYOUT}),r(_,"android","fitsSystemWindows","true");if(r(_,"android","layout_height",M||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.setControlType(C,O.BLOCK),e.exclude({resource:p.FONT_STYLE}),M){let o=w.android;if(r(w,"android","id",`@+id/${e.controlId}_appbar`),r(w,"android","layout_height",e.hasHeight?a(e.actualHeight):"wrap_content"),r(w,"android","fitsSystemWindows","true"),B){if(o.theme)X=o.theme;o.theme=`@style/${u.manifestThemeName}.AppBarOverlay`,e.data("android.widget.toolbar","themeData",{appBarOverlay:X,popupOverlay:q})}else r(w,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar");U=this.createPlaceholder(e,D,e.target),U.parent=t;let i=o.id;if(d(i))U.controlId=N(i),delete o.id;if(U.setControlType(v,O.BLOCK),x){if(P=l(E,"app"),r(E,"android","id",`@+id/${e.controlId}_collapsingtoolbar`),r(E,"android","fitsSystemWindows","true"),!R)r(P,"contentScrim","?attr/colorPrimary");if(r(P,"layout_scrollFlags","scroll|exitUntilCollapsed"),r(P,"toolbarId",e.documentId),W=this.createPlaceholder(e,S),W){if(W.parent=U,o=E.android,i=o.id,i)U.controlId=N(i),delete o.id;W.setControlType(k,O.BLOCK)}}}if(U){if(U.setLayoutWidth("match_parent"),U.setLayoutHeight("wrap_content"),U.apply(b.formatOptions(w,L)),U.render(t),V={type:1,node:U,controlName:v},W){if(e.parent=W,W.apply(b.formatOptions(E,L)),W.render(U),W.setLayoutWidth("match_parent"),W.setLayoutHeight("match_parent"),i.addLayoutTemplate(W.renderParent,W,{type:1,node:W,controlName:k}),R){const t=n.addImageSrc(e.backgroundImage);if(""!==t){const a=this.controller,o=I(T.backgroundImage);let i;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":i="centerCrop";break;case"contain":case"100%":case"100% 100%":i="fitXY";break;case"auto":i="matrix";break;default:i="center";break}P=l(o,"app"),r(o,"android","id",`@+id/${e.controlId}_image`),r(o,"android","src","@drawable/"+t),r(o,"android","scaleType",i),r(o,"android","fitsSystemWindows","true"),r(P,"layout_collapseMode","parallax"),a.addBeforeOutsideTemplate(e.id,a.renderNodeStatic({controlName:m.IMAGE,width:"match_parent",height:"match_parent"},b.formatOptions(o,L))),e.setCacheValue("backgroundImage","")}}}else if(e.parent=U,R)e.data("android.widget.toolbar","background",U);e.data("android.widget.toolbar","outerParent",U.android("id")||U.documentId),e.render(e.parent)}else e.render(t);e.setLayoutWidth("match_parent"),e.apply(b.formatOptions(_,L));const G={type:1,node:e,controlName:C};if(U)return{output:G,outerParent:e.parent,renderAs:U,outputAs:V,include:true};else return{output:G,include:true}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:true}}postOptimize(e){var t,a;const o=null===(t=A.findNestedElement(e,"android.widget.menu"))||void 0===t?void 0:t.dataset["layoutName"+i(this.application.systemName)];if(o){const t=I(null===(a=this.options[e.elementId])||void 0===a?void 0:a.self),i=l(t,"app");r(i,"menu","@menu/"+o),e.app("menu",i.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=this.application.userSettings,t=T(this.options.resource),a=T({name:".NoActionBar",output:t.output}),o=T({name:".AppBarOverlay",output:t.output}),i=T({name:".PopupOverlay",output:t.output}),d=a.items;r(t,"name",e.manifestThemeName),r(t,"parent","Theme.AppCompat.Light.DarkActionBar"),r(d,"windowActionBar","false"),r(d,"windowNoTitle","true"),r(o,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),r(i,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),b.addTheme(t),b.addTheme(a),b.addTheme(o),b.addTheme(i)}const d=e.data("android.widget.toolbar","background");if(d){const t=e.android("background");if(""!==t)d.android("background",t),e.delete("android","background")}}createPlaceholder(e,t,a){const o=t.length>0,r=this.application.createNode({parent:e,children:t,delegate:o,cascade:true});if(r.inherit(e,"base"),o){let e=Number.POSITIVE_INFINITY;t.forEach(t=>e=Math.min(e,t.containerIndex)),r.containerIndex=e}if(a)r.dataset.androidTarget=a.id,r.innerWrapped=e;return r.exclude({resource:p.ALL}),r.positioned=true,r.renderExclude=false,r}}const _=new A("android.widget.toolbar",2);if(squared)squared.include(_);return _}();
