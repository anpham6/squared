this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=squared.lib,t=android.lib,{formatPX:a}=e.css,{getElementAsNode:o}=e.session,{assignEmptyValue:n,includes:r,isString:i,optionalAsString:d}=e.util,{NODE_PROCEDURE:s,NODE_RESOURCE:l}=squared.base.lib.enumeration,{CONTAINER_ANDROID:c,EXT_ANDROID:p,SUPPORT_ANDROID:u,SUPPORT_ANDROID_X:m}=t.constant,{CONTAINER_NODE:h}=t.enumeration,{createStyleAttribute:g,createViewAttribute:y,getDocumentId:O}=t.util,f=android.base.Resource;class A extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,a=t.length;for(let e=0;e<a;e++){const a=t[e];if("NAV"===a.tagName){const e=a.dataset.use;if(!r(e,p.EXTERNAL)){a.dataset.use=(e?e+", ":"")+p.EXTERNAL;break}}}const o=e.dataset.target;if(o){const t=document.getElementById(o);t&&e.parentElement!==t&&!r(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(e,t){const r=this.application,d=this.resource,g=r.userSettings,b=e.element,I=e.dataset.target,T=Object.assign({},this.options[b.id]),N=y(T.self),_=y(T.appBar),w=y(T.collapsingToolbar),E=r.extensionManager.optionValueAsBoolean(p.RESOURCE_STRINGS,"numberResourceValue"),L=A.findNestedElement(b,"android.widget.menu"),v=e.has("backgroundImage"),B=[],R=[],S=b.children,C=S.length;let P=N.app;void 0===P&&(P={},N.app=P);for(let t=0;t<C;t++){const a=S[t],r=a.dataset;if("IMG"===a.tagName){if(r.navigationIcon){const e=d.addImageSrc(a,"ic_menu_");""!==e&&n(P,"navigationIcon","@drawable/"+e)}if(r.collapseIcon){const e=d.addImageSrc(a,"ic_menu_");""!==e&&n(P,"collapseIcon","@drawable/"+e)}}if(!r.target){const t=o(a,e.sessionId);if(t)switch(r.targetModule){case"appBar":B.push(t);break;case"collapsingToolbar":R.push(t)}}}const[k,D,x]=e.api<29?[u.TOOLBAR,u.APPBAR,u.COLLAPSING_TOOLBAR]:[m.TOOLBAR,m.APPBAR,m.COLLAPSING_TOOLBAR],U="collapsingToolbar"in T||R.length>0,M="appBar"in T||B.length>0||U;let W,X,q,V="",G="";if(U?n(P,"layout_collapseMode","pin"):(n(P,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),v||n(P,"layout_scrollFlags","scroll|enterAlways")),M){if(L){const e=P.popupTheme;e&&(G=e.replace("@style/","")),P.popupTheme=`@style/${g.manifestThemeName}.PopupOverlay`}}else e.exclude({procedure:s.LAYOUT}),n(N,"android","fitsSystemWindows","true");if(n(N,"android","layout_height",M||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.setControlType(k,h.BLOCK),e.exclude({resource:l.FONT_STYLE}),M){let o=_.android;n(_,"android","id",e.documentId.replace("@","@+")+"_appbar"),n(_,"android","layout_height",e.hasHeight?a(e.actualHeight):"wrap_content"),n(_,"android","fitsSystemWindows","true"),L?(o.theme&&(V=o.theme),o.theme="@style/"+g.manifestThemeName+".AppBarOverlay",e.data("android.widget.toolbar","themeData",{appBarOverlay:V,popupOverlay:G})):n(_,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),W=this.createPlaceholder(e,B,I),W.parent=t;let r=o.id;i(r)&&(W.controlId=O(r),delete o.id),W.setControlType(D,h.BLOCK),U&&(P=w.app,void 0===P&&(P={},w.app=P),n(w,"android","id",e.documentId.replace("@","@+")+"_collapsingtoolbar"),n(w,"android","fitsSystemWindows","true"),v||n(P,"contentScrim","?attr/colorPrimary"),n(P,"layout_scrollFlags","scroll|exitUntilCollapsed"),n(P,"toolbarId",e.documentId),X=this.createPlaceholder(e,R,I),X&&(X.parent=W,o=w.android,r=o.id,r&&(W.controlId=O(r),delete o.id),X.setControlType(x,h.BLOCK),X.each(e=>e.dataset.target=X.controlId)))}if(W){if(W.setLayoutWidth("match_parent"),W.setLayoutHeight("wrap_content"),W.apply(f.formatOptions(_,E)),W.render(I?r.resolveTarget(I):t),q={type:1,node:W,controlName:D},X){if(e.parent=X,X.apply(f.formatOptions(w,E)),X.render(W),X.setLayoutWidth("match_parent"),X.setLayoutHeight("match_parent"),r.addLayoutTemplate(X.renderParent,X,{type:1,node:X,controlName:x}),v){const t=d.addImageSrc(e.backgroundImage);if(""!==t){const a=this.controller,o=y(T.backgroundImage);let r;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":r="centerCrop";break;case"contain":case"100%":case"100% 100%":r="fitXY";break;case"auto":r="matrix";break;default:r="center"}P=o.app,void 0===P&&(P={},o.app=P),n(o,"android","id",e.documentId.replace("@","@+")+"_image"),n(o,"android","src","@drawable/"+t),n(o,"android","scaleType",r),n(o,"android","fitsSystemWindows","true"),n(P,"layout_collapseMode","parallax"),a.addBeforeOutsideTemplate(e.id,a.renderNodeStatic(c.IMAGE,f.formatOptions(o,E),"match_parent","match_parent")),e.setCacheValue("backgroundImage","")}}}else e.parent=W,v&&e.data("android.widget.toolbar","background",W);e.data("android.widget.toolbar","outerParent",W.android("id")||W.documentId),e.render(e.parent)}else e.render(I?r.resolveTarget(I):t);e.setLayoutWidth("match_parent"),e.apply(f.formatOptions(N,E));const H={type:1,node:e,controlName:k};return W?{output:H,outerParent:e.parent,renderAs:W,outputAs:q}:{output:H}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){var t;const a=d(A.findNestedElement(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const o=y(null===(t=this.options[e.elementId])||void 0===t?void 0:t.self);let r=o.app;void 0===r&&(r={},o.app=r),n(r,"menu","@menu/"+a),e.app("menu",r.menu)}const o=e.data("android.widget.toolbar","themeData");if(o){const e=this.application.userSettings,t=g(this.options.resource),a=g({name:".NoActionBar",output:t.output}),r=g({name:".AppBarOverlay",output:t.output}),i=g({name:".PopupOverlay",output:t.output}),d=a.items;n(t,"name",e.manifestThemeName),n(t,"parent","Theme.AppCompat.Light.DarkActionBar"),n(d,"windowActionBar","false"),n(d,"windowNoTitle","true"),n(r,"parent",o.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),n(i,"parent",o.popupOverlay||"ThemeOverlay.AppCompat.Light"),f.addTheme(t,a,r,i)}const r=e.data("android.widget.toolbar","background");if(r){const t=e.android("background");""!==t&&(r.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const o=this.application.createNode({parent:e,children:t});if(o.inherit(e,"base"),t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);o.containerIndex=e}return a&&(o.dataset.target=a),o.exclude({resource:l.ALL}),o.positioned=!0,o.renderExclude=!1,o}}const b=new A("android.widget.toolbar",2);return squared&&squared.includeAsync(b),b}();
