this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{css:e,session:t,util:a}=squared.lib,{constant:n,enumeration:o,util:i}=android.lib,r=android.base.Resource,s=squared.base.lib.enumeration,d="ic_menu_";class l extends squared.base.ExtensionUI{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,o=t.length;for(let e=0;e<o;e++){const o=t[e];if("NAV"===o.tagName&&!a.includes(o.dataset.use,n.EXT_ANDROID.EXTERNAL)){o.dataset.use=(o.dataset.use?o.dataset.use+", ":"")+n.EXT_ANDROID.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!a.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(p,c){const u=this.application,m=this.controller,g=this.resource,h=u.userSettings,y=p.element,E=p.dataset.target,O=Object.assign({},this.options[y.id]),A=i.createViewAttribute(O.self),I=i.createViewAttribute(O.appBar),b=i.createViewAttribute(O.collapsingToolbar),N=u.extensionManager.optionValueAsBoolean(n.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),T=l.findNestedElement(y,"android.widget.menu"),f=p.has("backgroundImage"),_=[],R=[],V=y.children,w=V.length;for(let e=0;e<w;e++){const n=V[e],o=n.dataset;if("IMG"===n.tagName){if(o.navigationIcon){const e=g.addImageSrc(n,d);""!==e&&a.assignEmptyValue(A,"app","navigationIcon","@drawable/"+e)}if(o.collapseIcon){const e=g.addImageSrc(n,d);""!==e&&a.assignEmptyValue(A,"app","collapseIcon","@drawable/"+e)}}if(!o.target){const e=t.getElementAsNode(n,p.sessionId);if(e)switch(o.targetModule){case"appBar":_.push(e);break;case"collapsingToolbar":R.push(e)}}}const D="collapsingToolbar"in O||R.length>0,S="appBar"in O||_.length>0||D;let P,L,B,C,v,k,x="",U="";if(D?a.assignEmptyValue(A,"app","layout_collapseMode","pin"):(a.assignEmptyValue(A,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),f||a.assignEmptyValue(A,"app","layout_scrollFlags","scroll|enterAlways")),S){if(T){const e=A.app;e.popupTheme&&(U=e.popupTheme.replace("@style/","")),e.popupTheme="@style/"+h.manifestThemeName+".PopupOverlay"}}else p.exclude(0,s.NODE_PROCEDURE.LAYOUT),a.assignEmptyValue(A,"android","fitsSystemWindows","true");if(a.assignEmptyValue(A,"android","layout_height",S||!p.hasPX("height")?"?android:attr/actionBarSize":""),p.localSettings.targetAPI<29?(P=n.SUPPORT_ANDROID.TOOLBAR,L=n.SUPPORT_ANDROID.APPBAR,B=n.SUPPORT_ANDROID.COLLAPSING_TOOLBAR):(P=n.SUPPORT_ANDROID_X.TOOLBAR,L=n.SUPPORT_ANDROID_X.APPBAR,B=n.SUPPORT_ANDROID_X.COLLAPSING_TOOLBAR),p.setControlType(P,o.CONTAINER_NODE.BLOCK),p.exclude(s.NODE_RESOURCE.FONT_STYLE),S&&(a.assignEmptyValue(I,"android","id",p.documentId+"_appbar"),a.assignEmptyValue(I,"android","layout_height",p.hasHeight?e.formatPX(p.actualHeight):"wrap_content"),a.assignEmptyValue(I,"android","fitsSystemWindows","true"),T?(I.android.theme&&(x=I.android.theme),I.android.theme="@style/"+h.manifestThemeName+".AppBarOverlay",p.data("android.widget.toolbar","themeData",{appBarOverlay:x,popupOverlay:U})):a.assignEmptyValue(I,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(C=this.createPlaceholder(p,_,E)).parent=c,I.android.id&&(C.controlId=i.getDocumentId(I.android.id)),C.setControlType(L,o.CONTAINER_NODE.BLOCK),D&&(a.assignEmptyValue(b,"android","id",p.documentId+"_collapsingtoolbar"),a.assignEmptyValue(b,"android","fitsSystemWindows","true"),f||a.assignEmptyValue(b,"app","contentScrim","?attr/colorPrimary"),a.assignEmptyValue(b,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),a.assignEmptyValue(b,"app","toolbarId",p.documentId),(v=this.createPlaceholder(p,R,E))&&(v.parent=C,b.android.id&&(C.controlId=i.getDocumentId(b.android.id)),v.setControlType(B,o.CONTAINER_NODE.BLOCK),v.each(e=>e.dataset.target=v.controlId)))),C){if(C.setLayoutWidth("match_parent"),C.setLayoutHeight("wrap_content"),C.apply(r.formatOptions(I,N)),C.render(E?u.resolveTarget(E):c),k={type:1,node:C,controlName:L},v){if(p.parent=v,v.apply(r.formatOptions(b,N)),v.render(C),v.setLayoutWidth("match_parent"),v.setLayoutHeight("match_parent"),u.addLayoutTemplate(v.renderParent||c,v,{type:1,node:v,controlName:B}),f){const e=this.resource.addImageSrc(p.backgroundImage);if(""!==e){const t=i.createViewAttribute(O.backgroundImage);let o="center";switch(p.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":o="centerCrop";break;case"contain":case"100% 100%":o="fitXY";break;case"auto":o="matrix"}a.assignEmptyValue(t,"android","id",p.documentId+"_image"),a.assignEmptyValue(t,"android","src","@drawable/"+e),a.assignEmptyValue(t,"android","scaleType",o),a.assignEmptyValue(t,"android","fitsSystemWindows","true"),a.assignEmptyValue(t,"app","layout_collapseMode","parallax"),m.addBeforeOutsideTemplate(p.id,m.renderNodeStatic(n.CONTAINER_ANDROID.IMAGE,r.formatOptions(t,N),"match_parent","match_parent")),p.setCacheValue("backgroundImage","")}}}else p.parent=C,f&&p.data("android.widget.toolbar","background",C);p.data("android.widget.toolbar","outerParent",C.android("id")||C.documentId),p.render(p.parent)}else p.render(E?u.resolveTarget(E):c);p.setLayoutWidth("match_parent"),p.apply(r.formatOptions(A,N));const X={type:1,node:p,controlName:P};return C?{output:X,parentAs:p.parent,renderAs:C,outputAs:k}:{output:X}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){const t=a.optionalAsString(l.findNestedElement(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const n=i.createViewAttribute(this.options[e.elementId]&&this.options[e.elementId].self);a.assignEmptyValue(n,"app","menu","@menu/"+t),e.app("menu",n.app.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=this.application.userSettings,t=i.createStyleAttribute(this.options.resource),o=i.createStyleAttribute({name:".NoActionBar",output:t.output}),s=i.createStyleAttribute({name:".AppBarOverlay",output:t.output}),d=i.createStyleAttribute({name:".PopupOverlay",output:t.output});a.assignEmptyValue(t,"name",e.manifestThemeName),a.assignEmptyValue(t,"parent","Theme.AppCompat.Light.DarkActionBar"),a.assignEmptyValue(o.items,"windowActionBar","false"),a.assignEmptyValue(o.items,"windowNoTitle","true"),a.assignEmptyValue(s,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),a.assignEmptyValue(d,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),r.addTheme(t,o,s,d)}const o=e.data("android.widget.toolbar","background");if(o){const t=e.android("background");""!==t&&(o.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const n=this.application.createNode(void 0,!0,e,t);if(t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);n.containerIndex=e}return a&&(n.dataset.target=a),n.inherit(e,"base"),n.exclude(s.NODE_RESOURCE.ALL),n.positioned=!0,n.renderExclude=!1,n}}const p=new l("android.widget.toolbar",2);return squared&&squared.includeAsync(p),p}();
