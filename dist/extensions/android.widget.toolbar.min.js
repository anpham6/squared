this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{NODE_PROCEDURE:e,NODE_RESOURCE:t}=squared.base.lib.constant,{CONTAINER_TAGNAME:a,CONTAINER_NODE:o,SUPPORT_TAGNAME:r,SUPPORT_TAGNAME_X:n}=android.lib.constant,{formatPX:d}=squared.lib.css,{getElementAsNode:i}=squared.lib.session,{assignEmptyValue:s,capitalize:l,iterateArray:c}=squared.lib.util,{createThemeAttribute:p,createViewAttribute:u,getDocumentId:m}=android.lib.util,h=android.base.Resource,g="ic_menu_";class Toolbar extends squared.base.ExtensionUI{constructor(e,t,a){super(e,t,a),this.require({name:"android.widget.menu"})}beforeInsertNode(e,t){if(this.included(e)){const a=this.application;c(e.children,(e=>{if("NAV"===e.tagName){const t=a.getDatasetName("use",e);if(!Toolbar.includes(t,"android.external"))return a.setDatasetName("use",e,(t?t+", ":"")+"android.external"),!0}}));const o=e.dataset.androidTarget;if(o){const r=document.getElementById(o);r&&!Toolbar.includes(a.getDatasetName("use",r),"android.widget.coordinator")&&a.getProcessing(t).rootElements.add(e)}}return!1}processNode(l,p){const b=this.application,y=this.resource,T=b.userSettings,A=l.element,O=Object.assign({},this.options[A.id.trim()]),f=u(O.self),N=u(O.appBar),I=u(O.collapsingToolbar),w=b.extensionManager.valueAsBoolean("android.resource.strings","numberAsResource"),_=Toolbar.findNestedElement(l,"android.widget.menu"),B=l.has("backgroundImage"),L=[],E=[];let P=f.app||(f.app={});c(A.children,(e=>{const t=e.dataset;if("IMG"===e.tagName){if(t.navigationIcon){const t=y.addImageSrc(e,g);t&&s(P,"navigationIcon","@drawable/"+t)}if(t.collapseIcon){const t=y.addImageSrc(e,g);t&&s(P,"collapseIcon","@drawable/"+t)}}if(!t.androidTarget){const a=i(e,l.sessionId);if(a)switch(t.androidTargetModule){case"appBar":L.push(a);break;case"collapsingToolbar":E.push(a)}}}));const v="collapsingToolbar"in O||E.length>0,C="appBar"in O||L.length>0||v;let S="",k="",R,x,D,M,q,W;if(l.api<29?(M=r.TOOLBAR,q=r.APPBAR,W=r.COLLAPSING_TOOLBAR):(M=n.TOOLBAR,q=n.APPBAR,W=n.COLLAPSING_TOOLBAR),v?s(P,"layout_collapseMode","pin"):(s(P,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),B||s(P,"layout_scrollFlags","scroll|enterAlways")),C){if(_){const e=P.popupTheme;e&&(k=e.replace("@style/","")),P.popupTheme=`@style/${T.manifestThemeName}.PopupOverlay`}}else l.exclude({procedure:e.LAYOUT}),s(f,"android","fitsSystemWindows","true");if(s(f,"android","layout_height",C||!l.hasPX("height")?"?android:attr/actionBarSize":""),l.setControlType(M,o.BLOCK),l.exclude({resource:t.FONT_STYLE}),C){let e=N.android;s(N,"android","id",`@+id/${l.controlId}_appbar`),s(N,"android","layout_height",l.hasHeight?d(l.actualHeight):"wrap_content"),s(N,"android","fitsSystemWindows","true"),_?(e.theme&&(S=e.theme),e.theme=`@style/${T.manifestThemeName}.AppBarOverlay`,l.data("android.widget.toolbar","themeData",{appBarOverlay:S,popupOverlay:k})):s(N,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),R=this.createPlaceholder(l,L,l.target),R.parent=p,e.id&&(R.controlId=m(e.id),delete e.id),R.setControlType(q,o.BLOCK),v&&(P=I.app||(I.app={}),s(I,"android","id",`@+id/${l.controlId}_collapsingtoolbar`),s(I,"android","fitsSystemWindows","true"),B||s(P,"contentScrim","?attr/colorPrimary"),s(P,"layout_scrollFlags","scroll|exitUntilCollapsed"),s(P,"toolbarId",l.documentId),x=this.createPlaceholder(l,E),x&&(x.parent=R,e=I.android,e.id&&(R.controlId=m(e.id),delete e.id),x.setControlType(W,o.BLOCK)))}if(R){if(R.setLayoutWidth("match_parent"),R.setLayoutHeight("wrap_content"),R.apply(h.formatOptions(N,w)),R.render(p),D={type:1,node:R,controlName:q},x){if(l.parent=x,x.apply(h.formatOptions(I,w)),x.render(R),x.setLayoutWidth("match_parent"),x.setLayoutHeight("match_parent"),b.addLayoutTemplate(x.renderParent,x,{type:1,node:x,controlName:W}),B){const e=y.addImageSrc(l.backgroundImage);if(e){const t=this.controller,o=u(O.backgroundImage);let r;switch(l.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":r="centerCrop";break;case"contain":case"100%":case"100% 100%":r="fitXY";break;case"auto":r="matrix";break;default:r="center"}P=o.app||(o.app={}),s(o,"android","id",`@+id/${l.controlId}_image`),s(o,"android","src","@drawable/"+e),s(o,"android","scaleType",r),s(o,"android","fitsSystemWindows","true"),s(P,"layout_collapseMode","parallax"),t.addBeforeOutsideTemplate(l,t.renderNodeStatic({controlName:a.IMAGE,width:"match_parent",height:"match_parent"},h.formatOptions(o,w))),l.setCacheValue("backgroundImage","")}}}else l.parent=R,B&&l.data("android.widget.toolbar","background",R);l.data("android.widget.toolbar","outerParent",R.android("id")||R.documentId),l.render(l.parent)}else l.render(p);l.setLayoutWidth("match_parent"),l.apply(h.formatOptions(f,w));const G={type:1,node:l,controlName:M};return R?{output:G,outerParent:l.parent,renderAs:R,outputAs:D,include:!0}:{output:G,include:!0}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){var t,a;const o=null===(t=Toolbar.findNestedElement(e,"android.widget.menu"))||void 0===t?void 0:t.dataset["layoutName"+l(this.application.systemName)];if(o){const t=u(null===(a=this.options[e.elementId])||void 0===a?void 0:a.self),r=t.app||(t.app={});s(r,"menu","@menu/"+o),e.app("menu",r.menu)}const r=e.data("android.widget.toolbar","themeData");if(r){const e=p(this.options.resource),t=p({name:".NoActionBar",output:e.output}),a=p({name:".AppBarOverlay",output:e.output}),o=p({name:".PopupOverlay",output:e.output});s(e,"name",this.application.userSettings.manifestThemeName),s(e,"parent","Theme.AppCompat.Light.DarkActionBar"),s(t.items,"windowActionBar","false"),s(t.items,"windowNoTitle","true"),s(a,"parent",r.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),s(o,"parent",r.popupOverlay||"ThemeOverlay.AppCompat.Light"),h.addTheme(e),h.addTheme(t),h.addTheme(a),h.addTheme(o)}const n=e.data("android.widget.toolbar","background");if(n){const t=e.android("background");t&&(n.android("background",t),e.delete("android","background"))}}createPlaceholder(e,a,o){const r=this.application.createNode(e.sessionId,{parent:e,children:a,delegate:a.length>0,cascade:!0});return r.inherit(e,"base"),o&&(r.dataset.androidTarget=o.id,r.innerWrapped=e),r.exclude({resource:t.ALL}),r.positioned=!0,r.renderExclude=!1,r}}const b=new Toolbar("android.widget.toolbar",2);return squared&&squared.add(b),b}();
