this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=android.base.Resource,t=squared.lib.constant,a=squared.lib.css,s=squared.lib.session,n=squared.lib.util,o=android.lib.constant,i=android.lib.enumeration,r=android.lib.util,d=squared.base.lib.constant,l=squared.base.lib.enumeration,p="ic_menu_";class u extends squared.base.ExtensionUI{constructor(e,t,a,s){super(e,t,a,s),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,a=t.length;for(let e=0;e<a;e++){const a=t[e];if("NAV"===a.tagName&&!n.includes(a.dataset.use,d.EXT_NAME.EXTERNAL)){a.dataset.use=(a.dataset.use?`${a.dataset.use}, `:"")+d.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!n.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(d,c){const N=this.application,R=N.controllerHandler,A=this.application.resourceHandler,I=N.userSettings,m=d.element,D=d.dataset.target,O=Object.assign({},this.options[m.id]),T=r.createViewAttribute(O.self),g=r.createViewAttribute(O.appBar),E=r.createViewAttribute(O.collapsingToolbar),y=N.extensionManager.optionValueAsBoolean(o.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),_=u.findNestedElement(m,"android.widget.menu"),h=d.has("backgroundImage"),S=[],P=[],b=m.children,G=b.length;for(let e=0;e<G;e++){const t=b[e];if("IMG"===t.tagName){if(t.dataset.navigationIcon){const e=A.addImageSrc(t,p);""!==e&&n.assignEmptyValue(T,o.STRING_ANDROID.APP,"navigationIcon",`@drawable/${e}`)}if(t.dataset.collapseIcon){const e=A.addImageSrc(t,p);""!==e&&n.assignEmptyValue(T,o.STRING_ANDROID.APP,"collapseIcon",`@drawable/${e}`)}}if(!t.dataset.target){const e=s.getElementAsNode(t,d.sessionId);if(e)switch(t.dataset.targetModule){case"appBar":S.push(e);break;case"collapsingToolbar":P.push(e)}}}const f="collapsingToolbar"in O||P.length>0,C="appBar"in O||S.length>0||f;let V,w,L,B="",v="";if(f)n.assignEmptyValue(T,o.STRING_ANDROID.APP,"layout_collapseMode","pin");else if(n.assignEmptyValue(T,o.STRING_ANDROID.APP,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),h){const e=this.application.resourceHandler.addImageSrc(d.backgroundImage);""!==e&&(n.assignEmptyValue(C?g:T,o.STRING_ANDROID.ANDROID,"background",`@drawable/${e}`),d.exclude(l.NODE_RESOURCE.IMAGE_SOURCE))}else n.assignEmptyValue(T,o.STRING_ANDROID.APP,"layout_scrollFlags","scroll|enterAlways");if(C?_&&(T.app.popupTheme&&(v=T.app.popupTheme.replace("@style/","")),T.app.popupTheme=`@style/${I.manifestThemeName}.PopupOverlay`):(d.exclude(0,l.NODE_PROCEDURE.LAYOUT),n.assignEmptyValue(T,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true")),n.assignEmptyValue(T,o.STRING_ANDROID.ANDROID,"layout_height",C||!d.hasPX(t.CSS.HEIGHT)?"?android:attr/actionBarSize":""),d.setControlType(o.SUPPORT_ANDROID.TOOLBAR,i.CONTAINER_NODE.BLOCK),d.exclude(l.NODE_RESOURCE.FONT_STYLE),C&&(n.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"id",`${d.documentId}_appbar`),n.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"layout_height",d.hasHeight?a.formatPX(d.actualHeight):o.STRING_ANDROID.WRAP_CONTENT),n.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),_?(g.android.theme&&(B=g.android.theme),g.android.theme=`@style/${I.manifestThemeName}.AppBarOverlay`,d.data("android.widget.toolbar","themeData",{appBarOverlay:B,popupOverlay:v})):n.assignEmptyValue(g,o.STRING_ANDROID.ANDROID,"theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(V=this.createPlaceholder(d,S,D)).parent=c,g.android.id&&(V.controlId=r.getDocumentId(g.android.id)),V.setControlType(o.SUPPORT_ANDROID.APPBAR,i.CONTAINER_NODE.BLOCK),f&&(n.assignEmptyValue(E,o.STRING_ANDROID.ANDROID,"id",`${d.documentId}_collapsingtoolbar`),n.assignEmptyValue(E,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),h||n.assignEmptyValue(E,o.STRING_ANDROID.APP,"contentScrim","?attr/colorPrimary"),n.assignEmptyValue(E,o.STRING_ANDROID.APP,"layout_scrollFlags","scroll|exitUntilCollapsed"),n.assignEmptyValue(E,o.STRING_ANDROID.APP,"toolbarId",d.documentId),(w=this.createPlaceholder(d,P,D))&&(w.parent=V,E.android.id&&(V.controlId=r.getDocumentId(E.android.id)),w.setControlType(o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,i.CONTAINER_NODE.BLOCK),w.each(e=>e.dataset.target=w.controlId)))),V?(V.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),V.setLayoutHeight(o.STRING_ANDROID.WRAP_CONTENT),V.apply(e.formatOptions(g,y)),V.render(D?N.resolveTarget(D):c),L={type:1,node:V,controlName:o.SUPPORT_ANDROID.APPBAR},w?(d.parent=w,w.apply(e.formatOptions(E,y)),w.render(V),w.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),w.setLayoutHeight(o.STRING_ANDROID.MATCH_PARENT),N.addLayoutTemplate(w.renderParent||c,w,{type:1,node:w,controlName:o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR})):d.parent=V,d.data("android.widget.toolbar","outerParent",V.android("id")||V.documentId),d.render(d.parent)):d.render(D?N.resolveTarget(D):c),h&&f){const a=this.application.resourceHandler.addImageSrc(d.backgroundImage);if(""!==a){const s=r.createViewAttribute(O.backgroundImage);let i=t.CSS.CENTER;switch(d.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":i="centerCrop";break;case"contain":case"100% 100%":i="fitXY";break;case"auto":i="matrix"}n.assignEmptyValue(s,o.STRING_ANDROID.ANDROID,"id",`${d.documentId}_image`),n.assignEmptyValue(s,o.STRING_ANDROID.ANDROID,"src",`@drawable/${a}`),n.assignEmptyValue(s,o.STRING_ANDROID.ANDROID,"scaleType",i),n.assignEmptyValue(s,o.STRING_ANDROID.ANDROID,"fitsSystemWindows","true"),n.assignEmptyValue(s,o.STRING_ANDROID.APP,"layout_collapseMode","parallax"),R.addBeforeOutsideTemplate(d.id,R.renderNodeStatic(o.CONTAINER_ANDROID.IMAGE,e.formatOptions(s,y),o.STRING_ANDROID.MATCH_PARENT,o.STRING_ANDROID.MATCH_PARENT)),d.exclude(l.NODE_RESOURCE.IMAGE_SOURCE)}}d.setLayoutWidth(o.STRING_ANDROID.MATCH_PARENT),d.apply(e.formatOptions(T,y));const M={type:1,node:d,controlName:o.SUPPORT_ANDROID.TOOLBAR};return V?{output:M,parentAs:d.parent,renderAs:V,outputAs:L}:{output:M}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(t){const a=n.optionalAsString(u.findNestedElement(t.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const e=r.createViewAttribute(this.options[t.elementId]&&this.options[t.elementId].self);n.assignEmptyValue(e,o.STRING_ANDROID.APP,"menu",`@menu/${a}`),t.app("menu",e.app.menu)}const s=t.data("android.widget.toolbar","themeData");if(s){const t=this.application.userSettings,a=r.createStyleAttribute(this.options.resource),i=r.createStyleAttribute({name:".NoActionBar",output:a.output}),d=r.createStyleAttribute({name:".AppBarOverlay",output:a.output}),l=r.createStyleAttribute({name:".PopupOverlay",output:a.output});n.assignEmptyValue(a,"name",t.manifestThemeName),n.assignEmptyValue(a,o.STRING_ANDROID.PARENT,"Theme.AppCompat.Light.DarkActionBar"),n.assignEmptyValue(i.items,"windowActionBar","false"),n.assignEmptyValue(i.items,"windowNoTitle","true"),n.assignEmptyValue(d,o.STRING_ANDROID.PARENT,s.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),n.assignEmptyValue(l,o.STRING_ANDROID.PARENT,s.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,i,d,l)}}createPlaceholder(e,t,a){const s=this.application.createNode(void 0,!0,e,t);if(t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);s.containerIndex=e}return a&&(s.dataset.target=a),s.inherit(e,"base"),s.exclude(l.NODE_RESOURCE.ALL),s.positioned=!0,s.renderExclude=!1,s}}const c=new u("android.widget.toolbar",2);return squared&&squared.includeAsync(c),c}();
