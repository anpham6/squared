this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const t=squared.base.lib.constant,a=squared.lib.dom,n=squared.base.lib.enumeration,r=squared.lib.session,o=squared.lib.util,i=android.lib.constant,s=android.lib.enumeration,d=android.lib.util;class l extends squared.base.Extension{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)){for(let a=0;a<e.children.length;a++){const n=e.children[a];if("NAV"===n.tagName&&!o.includes(n.dataset.use,t.EXT_NAME.EXTERNAL)){n.dataset.use=(n.dataset.use?`${n.dataset.use}, `:"")+t.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!o.includes(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(t,a){const p=this.application,u=p.controllerHandler,c=p.userSettings,m=t.element,g=t.dataset.target,h=Object.assign({},this.options[m.id]),E=d.createViewAttribute(h.self),y=d.createViewAttribute(h.appBar),O=d.createViewAttribute(h.collapsingToolbar),A=p.extensionManager.optionValueAsBoolean(i.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),N=l.findNestedElement(m,"android.widget.menu"),b=t.has("backgroundImage"),I=[],R=[];for(let a=0;a<m.children.length;a++){const n=m.children[a];if("IMG"===n.tagName){if(n.dataset.navigationIcon){const t=e.addImageSrc(n,i.PREFIX_ANDROID.MENU);""!==t&&o.assignEmptyValue(E,"app","navigationIcon",`@drawable/${t}`)}if(n.dataset.collapseIcon){const t=e.addImageSrc(n,i.PREFIX_ANDROID.MENU);""!==t&&o.assignEmptyValue(E,"app","collapseIcon",`@drawable/${t}`)}}if(!n.dataset.target){const e=r.getElementAsNode(n,t.sessionId);if(e)switch(n.dataset.targetModule){case"appBar":I.push(e);break;case"collapsingToolbar":R.push(e)}}}const T="collapsingToolbar"in h||R.length>0,_="appBar"in h||I.length>0||T;let f,w,V,S="",D="";if(T?o.assignEmptyValue(E,"app","layout_collapseMode","pin"):(o.assignEmptyValue(E,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),b?(o.assignEmptyValue(_?y:E,"android","background",`@drawable/${e.addImageURL(t.css("backgroundImage"))}`),t.exclude({resource:n.NODE_RESOURCE.IMAGE_SOURCE})):o.assignEmptyValue(E,"app","layout_scrollFlags","scroll|enterAlways")),_?N&&(E.app.popupTheme&&(D=E.app.popupTheme.replace("@style/","")),E.app.popupTheme=`@style/${c.manifestThemeName}.PopupOverlay`):(t.exclude({procedure:n.NODE_PROCEDURE.LAYOUT}),o.assignEmptyValue(E,"android","fitsSystemWindows","true")),o.assignEmptyValue(E,"android","layout_height",_||!t.has("height")?"?android:attr/actionBarSize":""),t.setControlType(i.SUPPORT_ANDROID.TOOLBAR,s.CONTAINER_NODE.BLOCK),t.exclude({resource:n.NODE_RESOURCE.FONT_STYLE}),_&&(o.assignEmptyValue(y,"android","id",`${t.documentId}_appbar`),o.assignEmptyValue(y,"android","layout_height",t.hasHeight?o.formatPX(t.height):"wrap_content"),o.assignEmptyValue(y,"android","fitsSystemWindows","true"),N?(y.android.theme&&(S=y.android.theme),y.android.theme=`@style/${c.manifestThemeName}.AppBarOverlay`,t.data("android.widget.toolbar","themeData",{appBarOverlay:S,popupOverlay:D})):o.assignEmptyValue(y,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(f=this.createPlaceholder(t,I,g)).parent=a,f.controlId=d.stripId(y.android.id),f.setControlType(i.SUPPORT_ANDROID.APPBAR,s.CONTAINER_NODE.BLOCK),T&&(o.assignEmptyValue(O,"android","id",`${t.documentId}_collapsingtoolbar`),o.assignEmptyValue(O,"android","fitsSystemWindows","true"),b||o.assignEmptyValue(O,"app","contentScrim","?attr/colorPrimary"),o.assignEmptyValue(O,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),o.assignEmptyValue(O,"app","toolbarId",t.documentId),(w=this.createPlaceholder(t,R,g))&&(w.parent=f,w.each(e=>e.dataset.target=w.controlId),w.setControlType(i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,s.CONTAINER_NODE.BLOCK)))),f?(f.android("layout_width","match_parent"),f.android("layout_height","wrap_content"),f.apply(e.formatOptions(y,A)),f.render(g?p.resolveTarget(g):a),V={type:1,node:f,controlName:i.SUPPORT_ANDROID.APPBAR},w?(t.parent=w,w.apply(e.formatOptions(O,A)),w.render(f),w.android("layout_width","match_parent"),w.android("layout_height","match_parent"),p.addRenderTemplate(w.renderParent||a,w,{type:1,node:w,controlName:i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR})):t.parent=f,t.data("android.widget.toolbar","outerParent",f.android("id")||f.documentId),t.render(t.parent)):t.render(g?p.resolveTarget(g):a),b&&T){const a=e.addImageURL(t.css("backgroundImage"));if(""!==a){const r=d.createViewAttribute(h.backgroundImage);let s="center";switch(t.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":s="centerCrop";break;case"contain":case"100% 100%":s="fitXY";break;case"auto":s="matrix"}o.assignEmptyValue(r,"android","id",`${t.documentId}_image`),o.assignEmptyValue(r,"android","src",`@drawable/${a}`),o.assignEmptyValue(r,"android","scaleType",s),o.assignEmptyValue(r,"android","fitsSystemWindows","true"),o.assignEmptyValue(r,"app","layout_collapseMode","parallax"),u.addBeforeOutsideTemplate(t.id,u.renderNodeStatic(i.CONTAINER_ANDROID.IMAGE,e.formatOptions(r,A),"match_parent","match_parent")),t.exclude({resource:n.NODE_RESOURCE.IMAGE_SOURCE})}}t.android("layout_width","match_parent"),t.apply(e.formatOptions(E,A));const P={type:1,node:t,controlName:i.SUPPORT_ANDROID.TOOLBAR};return f?{output:P,parentAs:t.parent,renderAs:f,outputAs:V}:{output:P}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postProcedure(t){const a=o.optionalAsString(l.findNestedElement(t.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const e=d.createViewAttribute(this.options[t.elementId]&&this.options[t.elementId].self);o.assignEmptyValue(e,"app","menu",`@menu/${a}`),t.app("menu",e.app.menu)}const n=t.data("android.widget.toolbar","themeData");if(n){const t=this.application.userSettings,a=d.createStyleAttribute(this.options.resource),r=d.createStyleAttribute({name:".NoActionBar",output:a.output}),i=d.createStyleAttribute({name:".AppBarOverlay",output:a.output}),s=d.createStyleAttribute({name:".PopupOverlay",output:a.output});o.assignEmptyValue(a,"name",t.manifestThemeName),o.assignEmptyValue(a,"parent","Theme.AppCompat.Light.DarkActionBar"),o.assignEmptyValue(r.items,"windowActionBar","false"),o.assignEmptyValue(r.items,"windowNoTitle","true"),o.assignEmptyValue(i,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),o.assignEmptyValue(s,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,r,i,s)}}createPlaceholder(e,t,r){let o=1/0;for(const e of t)o=Math.min(o,e.siblingIndex);const i=this.application.createNode(a.createElement(e.actualParent&&e.actualParent.element,e.block?"div":"span"),!0,e,t);return i.siblingIndex=o,r&&(i.dataset.target=r),i.inherit(e,"base"),i.exclude({resource:n.NODE_RESOURCE.ALL}),i.positioned=!0,i}}const p=new l("android.widget.toolbar",2);return squared&&squared.includeAsync(p),p}();
