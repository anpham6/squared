this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{formatPX:e}=squared.lib.css,{getElementAsNode:t}=squared.lib.session,{assignEmptyValue:a,capitalize:o,includes:r,isString:i,iterateArray:n,safeNestedMap:d}=squared.lib.util,{createStyleAttribute:s,createViewAttribute:l,getDocumentId:c}=android.lib.util,{NODE_PROCEDURE:p,NODE_RESOURCE:u,NODE_TEMPLATE:m}=squared.base.lib.enumeration,{CONTAINER_ANDROID:h,EXT_ANDROID:g,SUPPORT_ANDROID:f,SUPPORT_ANDROID_X:b}=android.lib.constant,{BUILD_ANDROID:y,CONTAINER_NODE:O}=android.lib.enumeration,T=android.base.Resource;class Toolbar extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=this.application;n(e.children,e=>{if("NAV"===e.tagName){const a=t.getDatasetName("use",e);if(!r(a,g.EXTERNAL))return t.setDatasetName("use",e,(a?a+", ":"")+g.EXTERNAL),true}});const a=e.dataset.androidTarget;if(a){const o=document.getElementById(a);if(o&&!r(t.getDatasetName("use",o),"android.widget.coordinator"))t.rootElements.add(e)}}return false}processNode(o,r){const s=this.application,m=this.resource,y=s.userSettings,A=o.element,N=Object.assign({},this.options[A.id]),I=l(N.self),_=l(N.appBar),w=l(N.collapsingToolbar),E=s.extensionManager.optionValueAsBoolean(g.RESOURCE_STRINGS,"numberResourceValue"),L=Toolbar.findNestedElement(o,"android.widget.menu"),B=o.has("backgroundImage"),R=[],D=[];let S=d(I,"app");n(A.children,e=>{const r=e.dataset;if("IMG"===e.tagName){if(r.navigationIcon){const t=m.addImageSrc(e,"ic_menu_");if(""!==t)a(S,"navigationIcon","@drawable/"+t)}if(r.collapseIcon){const t=m.addImageSrc(e,"ic_menu_");if(""!==t)a(S,"collapseIcon","@drawable/"+t)}}if(!r.androidTarget){const a=t(e,o.sessionId);if(a)switch(r.androidTargetModule){case"appBar":R.push(a);break;case"collapsingToolbar":D.push(a);break}}});const[P,C,v]=o.api<29?[f.TOOLBAR,f.APPBAR,f.COLLAPSING_TOOLBAR]:[b.TOOLBAR,b.APPBAR,b.COLLAPSING_TOOLBAR],k="collapsingToolbar"in N||D.length>0,x="appBar"in N||R.length>0||k;let M,U,q,W="",X="";if(k)a(S,"layout_collapseMode","pin");else if(a(S,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),!B)a(S,"layout_scrollFlags","scroll|enterAlways");if(x){if(L){const e=S.popupTheme;if(e)X=e.replace("@style/","");S.popupTheme=`@style/${y.manifestThemeName}.PopupOverlay`}}else o.exclude({procedure:p.LAYOUT}),a(I,"android","fitsSystemWindows","true");if(a(I,"android","layout_height",x||!o.hasPX("height")?"?android:attr/actionBarSize":""),o.setControlType(P,O.BLOCK),o.exclude({resource:u.FONT_STYLE}),x){let t=_.android;if(a(_,"android","id",`@+id/${o.controlId}_appbar`),a(_,"android","layout_height",o.hasHeight?e(o.actualHeight):"wrap_content"),a(_,"android","fitsSystemWindows","true"),L){if(t.theme)W=t.theme;t.theme=`@style/${y.manifestThemeName}.AppBarOverlay`,o.data("android.widget.toolbar","themeData",{appBarOverlay:W,popupOverlay:X})}else a(_,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar");M=this.createPlaceholder(o,R,o.target),M.parent=r;let n=t.id;if(i(n))M.controlId=c(n),delete t.id;if(M.setControlType(C,O.BLOCK),k){if(S=d(w,"app"),a(w,"android","id",`@+id/${o.controlId}_collapsingtoolbar`),a(w,"android","fitsSystemWindows","true"),!B)a(S,"contentScrim","?attr/colorPrimary");if(a(S,"layout_scrollFlags","scroll|exitUntilCollapsed"),a(S,"toolbarId",o.documentId),U=this.createPlaceholder(o,D),U){if(U.parent=M,t=w.android,n=t.id,n)M.controlId=c(n),delete t.id;U.setControlType(v,O.BLOCK)}}}if(M){if(M.setLayoutWidth("match_parent"),M.setLayoutHeight("wrap_content"),M.apply(T.formatOptions(_,E)),M.render(r),q={type:1,node:M,controlName:C},U){if(o.parent=U,U.apply(T.formatOptions(w,E)),U.render(M),U.setLayoutWidth("match_parent"),U.setLayoutHeight("match_parent"),s.addLayoutTemplate(U.renderParent,U,{type:1,node:U,controlName:v}),B){const e=m.addImageSrc(o.backgroundImage);if(""!==e){const t=this.controller,r=l(N.backgroundImage);let i;switch(o.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":i="centerCrop";break;case"contain":case"100%":case"100% 100%":i="fitXY";break;case"auto":i="matrix";break;default:i="center";break}S=d(r,"app"),a(r,"android","id",`@+id/${o.controlId}_image`),a(r,"android","src","@drawable/"+e),a(r,"android","scaleType",i),a(r,"android","fitsSystemWindows","true"),a(S,"layout_collapseMode","parallax"),t.addBeforeOutsideTemplate(o.id,t.renderNodeStatic({controlName:h.IMAGE,width:"match_parent",height:"match_parent"},T.formatOptions(r,E))),o.setCacheValue("backgroundImage","")}}}else if(o.parent=M,B)o.data("android.widget.toolbar","background",M);o.data("android.widget.toolbar","outerParent",M.android("id")||M.documentId),o.render(o.parent)}else o.render(r);o.setLayoutWidth("match_parent"),o.apply(T.formatOptions(I,E));const V={type:1,node:o,controlName:P};if(M)return{output:V,outerParent:o.parent,renderAs:M,outputAs:q,include:true};else return{output:V,include:true}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:true}}postOptimize(e){var t,r;const i=null===(t=Toolbar.findNestedElement(e,"android.widget.menu"))||void 0===t?void 0:t.dataset["layoutName"+o(this.application.systemName)];if(i){const t=l(null===(r=this.options[e.elementId])||void 0===r?void 0:r.self),o=d(t,"app");a(o,"menu","@menu/"+i),e.app("menu",o.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=s(this.options.resource),t=s({name:".NoActionBar",output:e.output}),o=s({name:".AppBarOverlay",output:e.output}),r=s({name:".PopupOverlay",output:e.output});a(e,"name",this.application.userSettings.manifestThemeName),a(e,"parent","Theme.AppCompat.Light.DarkActionBar"),a(t.items,"windowActionBar","false"),a(t.items,"windowNoTitle","true"),a(o,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),a(r,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),T.addTheme(e),T.addTheme(t),T.addTheme(o),T.addTheme(r)}const c=e.data("android.widget.toolbar","background");if(c){const t=e.android("background");if(""!==t)c.android("background",t),e.delete("android","background")}}createPlaceholder(e,t,a){const o=t.length>0,r=this.application.createNode({parent:e,children:t,delegate:o,cascade:true});if(r.inherit(e,"base"),o){let e=1/0,a=0;while(a<t.length)e=Math.min(e,t[a++].containerIndex);r.containerIndex=e}if(a)r.dataset.androidTarget=a.id,r.innerWrapped=e;return r.exclude({resource:u.ALL}),r.positioned=true,r.renderExclude=false,r}}const A=new Toolbar("android.widget.toolbar",2);if(squared)squared.include(A);return A}();
