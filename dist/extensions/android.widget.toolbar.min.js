this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const a=squared.base.lib.constant,t=squared.base.lib.enumeration,r=squared.lib.css,n=squared.lib.dom,o=squared.lib.element,s=squared.lib.util,i=squared.lib.xml,d=android.lib.constant,l=android.lib.enumeration,p=android.lib.util;class c extends squared.base.Extension{constructor(e,a,t,r){super(e,a,t,r),this.require("android.widget.menu")}init(e){if(this.included(e)){for(let t=0;t<e.children.length;t++){const r=e.children[t];if("NAV"===r.tagName&&!s.includes(r.dataset.use,a.EXT_NAME.EXTERNAL)){r.dataset.use=(r.dataset.use?`${r.dataset.use}, `:"")+a.EXT_NAME.EXTERNAL;break}}if(e.dataset.target){const a=document.getElementById(e.dataset.target);a&&e.parentElement!==a&&!s.includes(a.dataset.use,"android.widget.coordinator")&&this.application.parseElements.add(e)}}return!1}processNode(a,o){const u=this.application,m=u.controllerHandler,g=a.element,h=a.dataset.target,E=Object.assign({},this.options[g.id]),y=p.createViewAttribute(E.self),O=p.createViewAttribute(E.appBar),A=p.createViewAttribute(E.collapsingToolbar),N=c.findNestedByName(g,"android.widget.menu"),b=a.has("backgroundImage"),I=[],R=[];let T=h?0:o.renderDepth+1,_=a.filter(e=>!e.positioned).length;for(let a=0;a<g.children.length;a++){const t=g.children[a];if("IMG"===t.tagName){if(s.hasValue(t.dataset.navigationIcon)){const a=e.addImageSrcSet(t,d.PREFIX_ANDROID.MENU);""!==a&&(s.assignEmptyValue(y,"app","navigationIcon",`@drawable/${a}`),"none"!==r.getStyle(t).display&&_--)}if(s.hasValue(t.dataset.collapseIcon)){const a=e.addImageSrcSet(t,d.PREFIX_ANDROID.MENU);""!==a&&(s.assignEmptyValue(y,"app","collapseIcon",`@drawable/${a}`),"none"!==r.getStyle(t).display&&_--)}}if(t.dataset.target)_--;else{const e=n.getElementAsNode(t);if(e)switch(t.dataset.targetModule){case"appBar":I.push(e),_--;break;case"collapsingToolbar":R.push(e),_--}}}const S="collapsingToolbar"in E||R.length>0,V="appBar"in E||I.length>0||S;let D="",w="";S?s.assignEmptyValue(y,"app","layout_collapseMode","pin"):(V||s.assignEmptyValue(y,"android","fitsSystemWindows","true"),s.assignEmptyValue(y,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),b?(s.assignEmptyValue(I.length?O:y,"android","background",`@drawable/${e.addImageUrl(a.css("backgroundImage"))}`),a.exclude({resource:t.NODE_RESOURCE.IMAGE_SOURCE})):s.assignEmptyValue(y,"app","layout_scrollFlags","scroll|enterAlways")),I.length?s.assignEmptyValue(O,"android","layout_height","?android:attr/actionBarSize"):(s.assignEmptyValue(y,"android","layout_height","?android:attr/actionBarSize"),a.exclude({procedure:t.NODE_PROCEDURE.LAYOUT})),N&&V&&(y.app.popupTheme&&(w=y.app.popupTheme.replace("@style/","")),y.app.popupTheme="@style/AppTheme.PopupOverlay");const P=T+(V?1:0)+(S?1:0),f=u.extensionManager.optionValueAsBoolean(d.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue");a.setControlType(d.SUPPORT_ANDROID.TOOLBAR,l.CONTAINER_NODE.BLOCK);let C=m.renderNodeStatic(d.SUPPORT_ANDROID.TOOLBAR,P,e.formatOptions(y,f),"match_parent","wrap_content",a,_>0);if(S&&b){const r=p.createViewAttribute(E.backgroundImage);let n="center";switch(a.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":n="centerCrop";break;case"contain":case"100% 100%":n="fitXY";break;case"auto":n="matrix"}s.assignEmptyValue(r,"android","id",`${a.documentId}_image`),s.assignEmptyValue(r,"android","src",`@drawable/${e.addImageUrl(a.css("backgroundImage"))}`),s.assignEmptyValue(r,"android","scaleType",n),s.assignEmptyValue(r,"android","fitsSystemWindows","true"),s.assignEmptyValue(r,"app","layout_collapseMode","parallax"),C=m.renderNodeStatic(d.CONTAINER_ANDROID.IMAGE,P,e.formatOptions(r,f),"match_parent","match_parent")+C,a.exclude({resource:t.NODE_RESOURCE.IMAGE_SOURCE})}let B,L,v="";if(V&&(s.assignEmptyValue(O,"android","id",`${a.documentId}_appbar`),s.assignEmptyValue(O,"android","layout_height",a.hasHeight?s.formatPX(a.height):"wrap_content"),s.assignEmptyValue(O,"android","fitsSystemWindows","true"),N?(O.android.theme&&(D=O.android.theme),O.android.theme="@style/AppTheme.AppBarOverlay",a.data("android.widget.toolbar","themeData",{appBarOverlay:D,popupOverlay:w})):s.assignEmptyValue(O,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(B=this.createPlaceholder(a,I)).parent=a.parent,B.controlId=p.stripId(O.android.id),B.setControlType(d.SUPPORT_ANDROID.APPBAR,l.CONTAINER_NODE.BLOCK),u.processing.cache.append(B,I.length>0),v=m.renderNodeStatic(d.SUPPORT_ANDROID.APPBAR,h?-1:T,e.formatOptions(O,f),"match_parent","wrap_content",B,!0),S&&(T++,s.assignEmptyValue(A,"android","id",`${a.documentId}_collapsingtoolbar`),s.assignEmptyValue(A,"android","fitsSystemWindows","true"),b||s.assignEmptyValue(A,"app","contentScrim","?attr/colorPrimary"),s.assignEmptyValue(A,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),s.assignEmptyValue(A,"app","toolbarId",a.documentId),(L=this.createPlaceholder(a,R)).parent=B,L))){L.each(e=>e.dataset.target=L.controlId),L.setControlType(d.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,l.CONTAINER_NODE.BLOCK),u.processing.cache.append(L,R.length>0);const a=m.renderNodeStatic(d.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,h&&!V?-1:T,e.formatOptions(A,f),"match_parent","match_parent",L,!0);v=i.replacePlaceholder(v,B.id,a)}return B?(C=i.replacePlaceholder(v,L?L.id:B.id,C),B.render(h?u.resolveTarget(h,B):o),L?(L.parent=B,L.render(B),a.parent=L):a.parent=B,a.data("android.widget.toolbar","outerParent",B.documentId),a.render(a.parent)):L?(L.render(h?u.resolveTarget(h,L):o),a.parent=L,a.render(L)):a.render(h?u.resolveTarget(h,a):o),a.containerType=l.CONTAINER_NODE.BLOCK,a.exclude({resource:t.NODE_RESOURCE.FONT_STYLE}),{output:C}}processChild(e){let a=!1;return e.imageElement&&(s.hasValue(e.dataset.navigationIcon)||s.hasValue(e.dataset.collapseIcon))&&(e.hide(),a=!0),{output:"",next:a}}postProcedure(a){const t=s.optionalAsString(c.findNestedByName(a.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const e=p.createViewAttribute((this.options[a.elementId]||{}).self);s.assignEmptyValue(e,"app","menu",`@menu/${t}`),a.app("menu",e.app.menu)}const r=a.data("android.widget.toolbar","themeData");if(r){const a=p.createStyleAttribute(this.options.resource),t=p.createStyleAttribute({name:".NoActionBar",output:a.output}),n=p.createStyleAttribute({name:".AppBarOverlay",output:a.output}),o=p.createStyleAttribute({name:".PopupOverlay",output:a.output});s.assignEmptyValue(a,"parent","Theme.AppCompat.Light.DarkActionBar"),s.assignEmptyValue(t.items,"windowActionBar","false"),s.assignEmptyValue(t.items,"windowNoTitle","true"),s.assignEmptyValue(n,"parent",r.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),s.assignEmptyValue(o,"parent",r.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,t,n,o)}}createPlaceholder(e,a){const r=this.application.createNode(o.createElement(e.actualParent?e.actualParent.element:null,e.block));r.inherit(e,"base"),r.exclude({resource:t.NODE_RESOURCE.ALL}),r.positioned=!0;let n=1/0;for(const e of a)n=Math.min(n,e.siblingIndex),e.parent=r;return r.siblingIndex=n,r}}const u=new c("android.widget.toolbar",2);return squared&&squared.includeAsync(u),u}();
