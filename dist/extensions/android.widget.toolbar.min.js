this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=squared.lib,{formatPX:t}=e.css,{getElementAsNode:a}=e.session,{assignEmptyValue:o,includes:n,isString:r,optionalAsString:i}=e.util,{NODE_PROCEDURE:d,NODE_RESOURCE:s}=squared.base.lib.enumeration,l=android.lib,{CONTAINER_ANDROID:p,EXT_ANDROID:c,SUPPORT_ANDROID:u,SUPPORT_ANDROID_X:m}=l.constant,{CONTAINER_NODE:h}=l.enumeration,{createStyleAttribute:g,createViewAttribute:y,getDocumentId:O}=l.util,{Resource:f}=android.base;class A extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e){if(this.included(e)){const t=e.children,a=t.length;for(let e=0;e<a;e++){const a=t[e];if("NAV"===a.tagName){const e=a.dataset.use;if(!n(e,c.EXTERNAL)){a.dataset.use=(e?e+", ":"")+c.EXTERNAL;break}}}const o=e.dataset.target;if(o){const t=document.getElementById(o);t&&e.parentElement!==t&&!n(t.dataset.use,"android.widget.coordinator")&&this.application.rootElements.add(e)}}return!1}processNode(e,n){const i=this.application,l=this.resource,g=i.userSettings,b=e.element,I=e.dataset.target,T=Object.assign({},this.options[b.id]),N=y(T.self),_=y(T.appBar),w=y(T.collapsingToolbar),E=i.extensionManager.optionValueAsBoolean(c.RESOURCE_STRINGS,"numberResourceValue"),L=A.findNestedElement(b,"android.widget.menu"),S=e.has("backgroundImage"),B=[],R=[],P=b.children,v=P.length;for(let t=0;t<v;t++){const n=P[t],r=n.dataset;if("IMG"===n.tagName){if(r.navigationIcon){const e=l.addImageSrc(n,"ic_menu_");""!==e&&o(N,"app","navigationIcon","@drawable/"+e)}if(r.collapseIcon){const e=l.addImageSrc(n,"ic_menu_");""!==e&&o(N,"app","collapseIcon","@drawable/"+e)}}if(!r.target){const t=a(n,e.sessionId);if(t)switch(r.targetModule){case"appBar":B.push(t);break;case"collapsingToolbar":R.push(t)}}}const C="collapsingToolbar"in T||R.length>0,k="appBar"in T||B.length>0||C;let D,x,U,M,W,X,q="",V="";if(C?o(N,"app","layout_collapseMode","pin"):(o(N,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),S||o(N,"app","layout_scrollFlags","scroll|enterAlways")),k){if(L){const e=N.app,t=e.popupTheme;t&&(V=t.replace("@style/","")),e.popupTheme="@style/"+g.manifestThemeName+".PopupOverlay"}}else e.exclude(0,d.LAYOUT),o(N,"android","fitsSystemWindows","true");if(o(N,"android","layout_height",k||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.localSettings.targetAPI<29?(D=u.TOOLBAR,x=u.APPBAR,U=u.COLLAPSING_TOOLBAR):(D=m.TOOLBAR,x=m.APPBAR,U=m.COLLAPSING_TOOLBAR),e.setControlType(D,h.BLOCK),e.exclude(s.FONT_STYLE),k){let a=_.android;o(_,"android","id",e.documentId.replace("@","@+")+"_appbar"),o(_,"android","layout_height",e.hasHeight?t(e.actualHeight):"wrap_content"),o(_,"android","fitsSystemWindows","true"),L?(a.theme&&(q=a.theme),a.theme="@style/"+g.manifestThemeName+".AppBarOverlay",e.data("android.widget.toolbar","themeData",{appBarOverlay:q,popupOverlay:V})):o(_,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),M=this.createPlaceholder(e,B,I),M.parent=n;let i=a.id;r(i)&&(M.controlId=O(i),delete a.id),M.setControlType(x,h.BLOCK),C&&(o(w,"android","id",e.documentId.replace("@","@+")+"_collapsingtoolbar"),o(w,"android","fitsSystemWindows","true"),S||o(w,"app","contentScrim","?attr/colorPrimary"),o(w,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),o(w,"app","toolbarId",e.documentId),W=this.createPlaceholder(e,R,I),W&&(W.parent=M,a=w.android,i=a.id,i&&(M.controlId=O(i),delete a.id),W.setControlType(U,h.BLOCK),W.each(e=>e.dataset.target=W.controlId)))}if(M){if(M.setLayoutWidth("match_parent"),M.setLayoutHeight("wrap_content"),M.apply(f.formatOptions(_,E)),M.render(I?i.resolveTarget(I):n),X={type:1,node:M,controlName:x},W){if(e.parent=W,W.apply(f.formatOptions(w,E)),W.render(M),W.setLayoutWidth("match_parent"),W.setLayoutHeight("match_parent"),i.addLayoutTemplate(W.renderParent||n,W,{type:1,node:W,controlName:U}),S){const t=l.addImageSrc(e.backgroundImage);if(""!==t){const a=this.controller,n=y(T.backgroundImage);let r;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":r="centerCrop";break;case"contain":case"100% 100%":r="fitXY";break;case"auto":r="matrix";break;default:r="center"}o(n,"android","id",e.documentId.replace("@","@+")+"_image"),o(n,"android","src","@drawable/"+t),o(n,"android","scaleType",r),o(n,"android","fitsSystemWindows","true"),o(n,"app","layout_collapseMode","parallax"),a.addBeforeOutsideTemplate(e.id,a.renderNodeStatic(p.IMAGE,f.formatOptions(n,E),"match_parent","match_parent")),e.setCacheValue("backgroundImage","")}}}else e.parent=M,S&&e.data("android.widget.toolbar","background",M);e.data("android.widget.toolbar","outerParent",M.android("id")||M.documentId),e.render(e.parent)}else e.render(I?i.resolveTarget(I):n);e.setLayoutWidth("match_parent"),e.apply(f.formatOptions(N,E));const G={type:1,node:e,controlName:D};return M?{output:G,outerParent:e.parent,renderAs:M,outputAs:X}:{output:G}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){var t;const a=i(A.findNestedElement(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const n=y(null===(t=this.options[e.elementId])||void 0===t?void 0:t.self);o(n,"app","menu","@menu/"+a),e.app("menu",n.app.menu)}const n=e.data("android.widget.toolbar","themeData");if(n){const e=this.application.userSettings,t=g(this.options.resource),a=g({name:".NoActionBar",output:t.output}),r=g({name:".AppBarOverlay",output:t.output}),i=g({name:".PopupOverlay",output:t.output}),d=a.items;o(t,"name",e.manifestThemeName),o(t,"parent","Theme.AppCompat.Light.DarkActionBar"),o(d,"windowActionBar","false"),o(d,"windowNoTitle","true"),o(r,"parent",n.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),o(i,"parent",n.popupOverlay||"ThemeOverlay.AppCompat.Light"),f.addTheme(t,a,r,i)}const r=e.data("android.widget.toolbar","background");if(r){const t=e.android("background");""!==t&&(r.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const o=this.application.createNode(void 0,!0,e,t);if(t.length){let e=1/0;for(const a of t)e=Math.min(e,a.containerIndex);o.containerIndex=e}return a&&(o.dataset.target=a),o.inherit(e,"base"),o.exclude(s.ALL),o.positioned=!0,o.renderExclude=!1,o}}const b=new A("android.widget.toolbar",2);return squared&&squared.includeAsync(b),b}();
