this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const e=android.lib,{isNumber:t,sameArray:n,safeNestedMap:a}=squared.lib.util,{NODE_PROCEDURE:i,NODE_RESOURCE:r}=squared.base.lib.enumeration,{EXT_ANDROID:o}=e.constant,{CONTAINER_NODE:s}=e.enumeration,{createViewAttribute:c}=e.util,d=android.base.Resource,l={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},u={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},m=["showAsAction","actionViewClass","actionProviderClass"],h="menu",p="item",f="group";function N(e,t,n){const i=t.dataset;for(const t in i){const r=e[t];if(r){const e=i[t];if(e){const i=r.exec(e);if(i){const e=m.includes(t)?"app":"android";a(n,e)[t]=Array.from(new Set(i)).join("|")}}}}}function g(e,t){const n=t.title;if(n)return n;for(const t of e.naturalChildren)if(t.textElement)return t.textContent.trim();return""}const A=(e,t)=>e.some(e=>e.toElementString("type")===t);class b extends squared.base.ExtensionUI{constructor(e,t,n,a){super(e,t,n,a),this.cascadeAll=!0,this.require(o.EXTERNAL,!0)}init(e){if(this.included(e)&&e.childElementCount){if(!n(e.children,e=>e.tagName))return!1;const t=this.application;let a=e.parentElement;for(;a;){if("NAV"===a.tagName&&t.rootElements.has(a))return!1;a=a.parentElement}t.rootElements.add(e)}return!1}condition(e){return this.included(e.element)}processNode(e,t){const n=this.application.createNode({parent:t,append:!1});n.childIndex=e.childIndex,n.actualParent=t.actualParent,e.documentRoot=!0,e.setControlType(h,s.INLINE),e.addAlign(4),e.exclude({resource:r.ALL,procedure:i.ALL}),e.render(n);for(const t of e.cascade())this.addDescendant(t);return e.dataset.pathname="res/menu",{output:{type:1,node:e,controlName:h},outerParent:n,complete:!0}}processChild(e,n){if(e.plainText)return e.hide(),{next:!0};const a=c(),m=a.android,b=e.element;let E,$;switch("NAV"===e.tagName?(E=h,$=g(e,b)):e.some(e=>e.length>0)?(e.some(e=>"NAV"===e.tagName)?E=p:(E=f,e.every(e=>A(e,"radio"))?m.checkableBehavior="single":e.every(e=>A(e,"checkbox"))&&(m.checkableBehavior="all")),$=g(e,b)):(E=p,$=(b.title||b.innerText).trim(),A(e,"checkbox")&&!n.android("checkableBehavior")&&(m.checkable="true")),E){case h:e.addAlign(4);break;case f:e.addAlign(4),N(u,b,a);break;case p:if(N(l,b,a),!m.icon){const t=this.resource;let n=t.addImageSrc(e.backgroundImage,"ic_menu_");if(""!==n)m.icon=`@drawable/${n}`;else{const a=e.find(e=>e.imageElement);a&&(n=t.addImageSrc(a.element,"ic_menu_"),""!==n&&(m.icon=`@drawable/${n}`))}}e.each(e=>"NAV"!==e.tagName&&e.hide())}if(""!==$){const e=this.application.extensionManager.optionValueAsBoolean(o.RESOURCE_STRINGS,"numberResourceValue"),n=d.addString($,"",e);m.title=e||!t(n)?`@string/${n}`:$}return e.setControlType(E,s.INLINE),e.exclude({resource:r.ALL,procedure:i.ALL}),e.render(n),e.apply(a),{output:{type:1,node:e,controlName:E},complete:!0,next:E===h}}}const E=new b("android.widget.menu",2,["NAV"]);return squared&&squared.includeAsync(E),E}();
