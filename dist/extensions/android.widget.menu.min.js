this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";var e=android.base.Resource;const t=squared.base.lib.constant,n=squared.base.lib.enumeration,a=squared.lib.css,i=squared.lib.dom,r=squared.lib.util,o=android.lib.constant,l=android.lib.enumeration,s=android.lib.util,d={MENU:"menu",ITEM:"item",GROUP:"group"},c={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^[0-9]+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^[0-9]+$/},u={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^[0-9]+$/},h=["showAsAction","actionViewClass","actionProviderClass"];function E(e,t){return e.some(e=>e.element.type===t)}function m(e,t,n){for(const a in t.dataset){const i=t.dataset[a];if(i&&e[a]){const t=i.match(e[a]);t&&(n[h.includes(a)?"app":"android"][a]=Array.from(new Set(t)).join("|"))}}}function N(e){if(""!==e.title)return e.title;for(let t=0;t<e.childNodes.length;t++){const n=i.getElementAsNode(e.childNodes[t]);if(n&&n.textElement)return n.textContent.trim()}return""}const p=new class extends squared.base.Extension{constructor(e,n,a,i){super(e,n,a,i),this.require(t.EXT_NAME.EXTERNAL,!0)}init(e){if(this.included(e)){let t=!1;if(e.children.length){t=!0;const n=e.children[0].tagName;for(let a=1;a<e.children.length;a++)if(e.children[a].tagName!==n){t=!1;break}if(t){let n=e.parentElement;for(;n;){if("NAV"===n.tagName&&this.application.parseElements.has(n)){t=!1;break}n=n.parentElement}}}t&&(e.querySelectorAll("NAV").forEach(t=>{"none"===a.getStyle(e).display&&(i.setElementCache(t,"squaredExternalDisplay","none"),t.style.display="block")}),this.application.parseElements.add(e))}return!1}condition(e){return this.included(e.element)}processNode(e){e.documentRoot=!0,e.alignmentType|=4,e.setControlType(d.MENU,l.CONTAINER_NODE.INLINE),e.exclude({procedure:n.NODE_PROCEDURE.ALL,resource:n.NODE_RESOURCE.ALL});const t=this.application.controllerHandler.renderNodeStatic(d.MENU,0,{},"","",e,!0);for(const t of e.cascade())this.subscribersChild.add(t);return{output:t,complete:!0}}processChild(t,i){if(t.plainText)return t.hide(),{output:"",next:!0};const h=s.createViewAttribute(),p=t.element;let g,b="",y=!1;switch("NAV"===t.tagName?(g=d.MENU,b=N(p),y=!0):t.some(e=>e.length>0)?(t.some(e=>"NAV"===e.tagName)?(g=d.ITEM,t.each(e=>"NAV"!==e.tagName&&e.hide())):(g=d.GROUP,t.every(e=>E(e,"radio"))?h.android.checkableBehavior="single":t.every(e=>E(e,"checkbox"))&&(h.android.checkableBehavior="all")),b=N(p),y=!0):(g=d.ITEM,b=(p.title||p.innerText).trim(),E(t,"checkbox")&&!i.android("checkableBehavior")&&(h.android.checkable="true")),g){case d.MENU:t.alignmentType|=4;break;case d.GROUP:t.alignmentType|=4,m(u,p,h);break;case d.ITEM:if(m(c,p,h),!r.hasValue(h.android.icon)){const n=a.getStyle(p);let i=e.addImageUrl("none"!==n.backgroundImage?n.backgroundImage:n.background,o.PREFIX_ANDROID.MENU);if(""!==i)h.android.icon=`@drawable/${i}`;else{const n=t.find(e=>e.imageElement);n&&""!==(i=e.addImageSrcSet(n.element,o.PREFIX_ANDROID.MENU))&&(h.android.icon=`@drawable/${i}`)}}}if(""!==b){const t=e.addString(b,"",this.application.extensionManager.optionValueAsBoolean(o.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"));h.android.title=""!==t?`@string/${t}`:b}return t.setControlType(g,l.CONTAINER_NODE.INLINE),t.exclude({procedure:n.NODE_PROCEDURE.ALL,resource:n.NODE_RESOURCE.ALL}),t.render(i),{output:this.application.controllerHandler.renderNodeStatic(g,t.renderDepth,h,"","",t,y),complete:!0,next:g===d.MENU}}postBaseLayout(e){const t=e.element;if(this.included(t)){t.querySelectorAll("NAV").forEach(e=>{const t=i.getElementCache(e,"squaredExternalDisplay");t&&(e.style.display=t,i.deleteElementCache(e,"squaredExternalDisplay"))});const n=this.application.processing;e===n.node&&n.layout&&(n.layout.pathname="res/menu")}}}("android.widget.menu",2,["NAV"]);return squared&&squared.includeAsync(p),p}();
