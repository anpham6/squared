this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const e=android.lib,{appendSeparator:t,capitalize:n,isNumber:a,sameArray:i,safeNestedMap:r}=squared.lib.util,{NODE_ALIGNMENT:o,NODE_PROCEDURE:s,NODE_RESOURCE:c,NODE_TEMPLATE:l}=squared.base.lib.enumeration,{EXT_ANDROID:d}=e.constant,{CONTAINER_NODE:u}=e.enumeration,{createViewAttribute:m}=e.util,h=android.base.Resource,f={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},p={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},N=["showAsAction","actionViewClass","actionProviderClass"],g="menu",A="item",E="group";function b(e,t,n){const a=t.dataset;for(const t in a){const i=e[t];if(i){const e=a[t];if(e){const a=i.exec(e);if(a)r(n,N.includes(t)?"app":"android")[t]=Array.from(new Set(a)).join("|")}}}}function C(e,t){const n=t.title;if(n)return n;else for(const t of e.naturalChildren)if(t.textElement)return t.textContent.trim();return""}const y=(e,t)=>e.some(e=>e.toElementString("type")===t);class T extends squared.base.ExtensionUI{constructor(e,t,n,a){super(e,t,n,a),this.cascadeAll=true,this.require(d.EXTERNAL,true)}init(e){if(this.included(e))if(e.childElementCount){if(!i(e.children,e=>e.tagName))return false;const t=this.application;let n=e.parentElement;while(n){if("NAV"===n.tagName&&t.rootElements.has(n))return false;n=n.parentElement}t.rootElements.add(e)}return false}condition(e){return this.included(e.element)}processNode(e,a){const i=this.application.createNode({parent:a,append:false});return i.childIndex=e.childIndex,i.actualParent=a.actualParent,e.documentRoot=true,e.setControlType(g,u.INLINE),e.addAlign(4),e.exclude({resource:c.ALL,procedure:s.ALL}),e.render(i),e.cascade(e=>(this.addDescendant(e),false)),e.dataset["pathname"+n(this.application.systemName)]=t(this.controller.userSettings.outputDirectory,"res/menu"),{outerParent:i,output:{type:1,node:e,controlName:g},complete:true}}processChild(e,t){if(e.plainText)return e.hide(),{next:true};const n=m(),i=n.android,r=e.element;let o,l;if("NAV"===e.tagName)o=g,l=C(e,r);else if(e.some(e=>e.length>0)){if(e.some(e=>"NAV"===e.tagName))o=A;else if(o=E,e.every(e=>y(e,"radio")))i.checkableBehavior="single";else if(e.every(e=>y(e,"checkbox")))i.checkableBehavior="all";l=C(e,r)}else if(o=A,l=(r.title||r.innerText).trim(),y(e,"checkbox")&&!t.android("checkableBehavior"))i.checkable="true";switch(o){case g:e.addAlign(4);break;case E:e.addAlign(4),b(p,r,n);break;case A:if(b(f,r,n),!i.icon){const t=this.resource;let n=t.addImageSrc(e.backgroundImage,"ic_menu_");if(""!==n)i.icon="@drawable/"+n;else{const a=e.find(e=>e.imageElement);if(a)if(n=t.addImageSrc(a.element,"ic_menu_"),""!==n)i.icon="@drawable/"+n}}e.each(e=>"NAV"!==e.tagName&&e.hide());break}if(""!==l){const e=this.application.extensionManager.optionValueAsBoolean(d.RESOURCE_STRINGS,"numberResourceValue"),t=h.addString(l,"",e);i.title=e||!a(t)?"@string/"+t:l}return e.setControlType(o,u.INLINE),e.exclude({resource:c.ALL,procedure:s.ALL}),e.render(t),e.apply(n),{output:{type:1,node:e,controlName:o},complete:true,next:o===g}}}const $=new T("android.widget.menu",2,["NAV"]);if(squared)squared.include($);return $}();
