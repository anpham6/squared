this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const{isNumber:e}=squared.lib.util,{NODE_PROCEDURE:t,NODE_RESOURCE:n}=squared.base.lib.enumeration,a=android.lib,{EXT_ANDROID:i}=a.constant,{CONTAINER_NODE:o}=a.enumeration,{createViewAttribute:r}=a.util,{Resource:s}=android.base,c={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},d={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},l=["showAsAction","actionViewClass","actionProviderClass"],u={MENU:"menu",ITEM:"item",GROUP:"group"},m="ic_menu_";function h(e,t,n){const a=t.dataset;for(const t in a)if(e[t]){const i=a[t];if(i){const a=e[t].exec(i);a&&(n[l.includes(t)?"app":"android"][t]=Array.from(new Set(a)).join("|"))}}}function N(e,t){var n;const a=t.title;if(a)return a;for(const t of e.naturalChildren)if(null===(n=t)||void 0===n?void 0:n.textElement)return t.textContent.trim();return""}const E=(e,t)=>e.some(e=>e.toElementString("type")===t);class g extends squared.base.ExtensionUI{constructor(e,t,n,a){super(e,t,n,a),this.cascadeAll=!0,this.require(i.EXTERNAL,!0)}init(e){if(this.included(e)){const t=e.children,n=t.length;if(n>0){const a=t[0].tagName;for(let e=1;e<n;e++)if(t[e].tagName!==a)return!1;const i=this.application;let o=e.parentElement;for(;o;){if("NAV"===o.tagName&&i.rootElements.has(o))return!1;o=o.parentElement}i.rootElements.add(e)}}return!1}condition(e){return this.included(e.element)}processNode(e,a){const i=this.application.createNode(void 0,!1);i.actualParent=a.actualParent,e.documentRoot=!0,e.addAlign(4),e.setControlType(u.MENU,o.INLINE),e.exclude(n.ALL,t.ALL);for(const t of e.cascade())this.addDescendant(t);return e.render(i),e.dataset.pathname="res/menu",{output:{type:1,node:e,controlName:u.MENU},outerParent:i,complete:!0}}processChild(a,l){if(a.plainText)return a.hide(),{next:!0};const g=r(),f=g.android,p=a.element;let A,b;switch("NAV"===a.tagName?(A=u.MENU,b=N(a,p)):a.some(e=>e.length>0)?(a.some(e=>"NAV"===e.tagName)?A=u.ITEM:(A=u.GROUP,a.every(e=>E(e,"radio"))?f.checkableBehavior="single":a.every(e=>E(e,"checkbox"))&&(f.checkableBehavior="all")),b=N(a,p)):(A=u.ITEM,b=(p.title||p.innerText).trim(),E(a,"checkbox")&&!l.android("checkableBehavior")&&(f.checkable="true")),A){case u.MENU:a.addAlign(4);break;case u.GROUP:a.addAlign(4),h(d,p,g);break;case u.ITEM:if(h(c,p,g),!f.icon){const e=this.resource;let t=e.addImageSrc(a.backgroundImage,m);if(""!==t)f.icon="@drawable/"+t;else{const n=a.find(e=>e.imageElement);n&&(t=e.addImageSrc(n.element,m),""!==t&&(f.icon="@drawable/"+t))}}a.each(e=>"NAV"!==e.tagName&&e.hide())}if(""!==b){const t=this.application.extensionManager.optionValueAsBoolean(i.RESOURCE_STRINGS,"numberResourceValue"),n=s.addString(b,"",t);f.title=t||!e(n)?"@string/"+n:b}return a.setControlType(A,o.INLINE),a.exclude(n.ALL,t.ALL),a.render(l),a.apply(g),{output:{type:1,node:a,controlName:A},complete:!0,next:A===u.MENU}}}const f=new g("android.widget.menu",2,["NAV"]);return squared&&squared.includeAsync(f),f}();
