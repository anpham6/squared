this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const{appendSeparator:e,capitalize:t,isNumber:n,sameArray:i,safeNestedMap:a}=squared.lib.util,{createViewAttribute:r}=android.lib.util,{NODE_ALIGNMENT:o,NODE_PROCEDURE:s,NODE_RESOURCE:c,NODE_TEMPLATE:l}=squared.base.lib.enumeration,{EXT_ANDROID:d}=android.lib.constant,{CONTAINER_NODE:u}=android.lib.enumeration,m=android.base.Resource,h={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},p={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},f="menu",N="item",g="group",b=["showAsAction","actionViewClass","actionProviderClass"];function A(e,t,n){const i=t.dataset;for(const t in i){const r=e[t];if(r){const e=i[t];if(e){const i=r.exec(e);if(i)a(n,b.includes(t)?"app":"android")[t]=Array.from(new Set(i)).join("|")}}}}function E(e,t){const n=t.title;if(n)return n;else{const t=e.naturalChildren,n=t.length;for(let e=0;e<n;++e){const n=t[e];if(n.textElement)return n.textContent.trim()}}return""}const C=(e,t)=>e.some(e=>e.toElementString("type")===t);class Menu extends squared.base.ExtensionUI{constructor(e,t,n,i){super(e,t,n,i),this.cascadeAll=true,this.require(d.EXTERNAL,true)}init(e){if(this.included(e))if(e.childElementCount){if(!i(e.children,e=>e.tagName))return false;const t=this.application;let n=e.parentElement;while(n){if("NAV"===n.tagName&&t.rootElements.has(n))return false;n=n.parentElement}t.rootElements.add(e)}return false}condition(e){return this.included(e.element)}processNode(n,i){const a=this.application.createNode({parent:i,append:false});return a.childIndex=n.childIndex,a.actualParent=i.actualParent,n.documentRoot=true,n.setControlType(f,u.INLINE),n.addAlign(4),n.exclude({resource:c.ALL,procedure:s.ALL}),n.render(a),n.cascade(e=>(this.addDescendant(e),false)),n.dataset["pathname"+t(this.application.systemName)]=e(this.controller.userSettings.outputDirectory,"res/menu"),{outerParent:a,output:{type:1,node:n,controlName:f},complete:true}}processChild(e,t){if(e.plainText)return e.hide(),{next:true};const i=r(),a=i.android,o=e.element;let l,b;if("NAV"===e.tagName)l=f,b=E(e,o);else if(e.some(e=>e.length>0)){if(e.some(e=>"NAV"===e.tagName))l=N;else if(l=g,e.every(e=>C(e,"radio")))a.checkableBehavior="single";else if(e.every(e=>C(e,"checkbox")))a.checkableBehavior="all";b=E(e,o)}else if(l=N,b=(o.title||o.innerText).trim(),C(e,"checkbox")&&!t.android("checkableBehavior"))a.checkable="true";switch(l){case f:e.addAlign(4);break;case g:e.addAlign(4),A(p,o,i);break;case N:if(A(h,o,i),!a.icon){const t=this.resource;let n=t.addImageSrc(e.backgroundImage,"ic_menu_");if(""!==n)a.icon="@drawable/"+n;else{const i=e.find(e=>e.imageElement);if(i)if(n=t.addImageSrc(i.element,"ic_menu_"),""!==n)a.icon="@drawable/"+n}}e.each(e=>"NAV"!==e.tagName&&e.hide());break}if(""!==b){const e=this.application.extensionManager.optionValueAsBoolean(d.RESOURCE_STRINGS,"numberResourceValue"),t=m.addString(b,"",e);a.title=e||!n(t)?"@string/"+t:b}return e.setControlType(l,u.INLINE),e.exclude({resource:c.ALL,procedure:s.ALL}),e.render(t),e.apply(i),{output:{type:1,node:e,controlName:l},complete:true,next:l===f}}}const y=new Menu("android.widget.menu",2,["NAV"]);if(squared)squared.include(y);return y}();
