this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";var e=android.base.Resource;const t=squared.lib.constant,a=squared.lib.css,n=squared.lib.session,i=squared.lib.util,r=android.lib.constant,o=android.lib.enumeration,s=android.lib.util,d=squared.base.lib.constant,l=squared.base.lib.enumeration,c={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},u={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},N=["showAsAction","actionViewClass","actionProviderClass"],E={MENU:"menu",ITEM:"item",GROUP:"group"},m="ic_menu_";function h(e,t,a){for(const n in t.dataset){const i=t.dataset[n];if(i&&e[n]){const t=e[n].exec(i);t&&(a[N.includes(n)?r.STRING_ANDROID.APP:r.STRING_ANDROID.ANDROID][n]=Array.from(new Set(t)).join("|"))}}}function p(e,t){if(""!==t.title)return t.title;for(const t of e.naturalChildren)if(t&&t.textElement)return t.textContent.trim();return""}const A=(e,t)=>e.some(e=>e.element.type===t);const b=new class extends squared.base.ExtensionUI{constructor(e,t,a,n){super(e,t,a,n),this.require(d.EXT_NAME.EXTERNAL,!0)}init(e){if(this.included(e)){const i=this.application,r=e.children,o=r.length;let s=!1;if(o){s=!0;const t=r[0].tagName;for(let e=1;e<o;e++)if(r[e].tagName!==t){s=!1;break}if(s){let t=e.parentElement;for(;t;){if("NAV"===t.tagName&&i.rootElements.has(t)){s=!1;break}t=t.parentElement}}}s&&(e.querySelectorAll("NAV").forEach(e=>{a.getStyle(e).display===t.CSS.NONE&&(n.setElementCache(e,"squaredExternalDisplay",i.processing.sessionId,t.CSS.NONE),e.style.setProperty("display","block"))}),i.rootElements.add(e))}return!1}condition(e){return this.included(e.element)}processNode(e,t){const a=this.application.createNode(void 0,!1);a.actualParent=t.actualParent,e.documentRoot=!0,e.addAlign(4),e.setControlType(E.MENU,o.CONTAINER_NODE.INLINE),e.exclude(l.NODE_RESOURCE.ALL,l.NODE_PROCEDURE.ALL);for(const t of e.cascade())this.addDescendant(t);return e.render(a),e.dataset.pathname="res/menu",{output:{type:1,node:e,controlName:E.MENU},parentAs:a,complete:!0}}processChild(t,a){if(t.plainText)return t.hide(),{next:!0};const n=s.createViewAttribute(),d=t.element;let N,b="";switch("NAV"===t.tagName?(N=E.MENU,b=p(t,d)):t.some(e=>e.length>0)?(t.some(e=>"NAV"===e.tagName)?N=E.ITEM:(N=E.GROUP,t.every(e=>A(e,"radio"))?n.android.checkableBehavior="single":t.every(e=>A(e,"checkbox"))&&(n.android.checkableBehavior="all")),b=p(t,d)):(N=E.ITEM,b=(d.title||d.innerText).trim(),A(t,"checkbox")&&!a.android("checkableBehavior")&&(n.android.checkable="true")),N){case E.MENU:t.addAlign(4);break;case E.GROUP:t.addAlign(4),h(u,d,n);break;case E.ITEM:if(h(c,d,n),!n.android.icon){const e=this.application.resourceHandler;let a=e.addImageSrc(t.backgroundImage,m);if(""!==a)n.android.icon=`@drawable/${a}`;else{const i=t.find(e=>e.imageElement);i&&""!==(a=e.addImageSrc(i.element,m))&&(n.android.icon=`@drawable/${a}`)}}t.each(e=>"NAV"!==e.tagName&&e.hide())}if(""!==b){const t=this.application.extensionManager.optionValueAsBoolean(r.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),a=e.addString(b,"",t);n.android.title=t||!i.isNumber(a)?`@string/${a}`:b}return t.setControlType(N,o.CONTAINER_NODE.INLINE),t.exclude(l.NODE_RESOURCE.ALL,l.NODE_PROCEDURE.ALL),t.render(a),t.apply(n),{output:{type:1,node:t,controlName:N},complete:!0,next:N===E.MENU}}postBaseLayout(e){e.element.querySelectorAll("NAV").forEach(t=>{const a=n.getElementCache(t,"squaredExternalDisplay",e.sessionId);a&&(t.style.setProperty("display",a),n.deleteElementCache(t,"squaredExternalDisplay",e.sessionId))})}}("android.widget.menu",2,["NAV"]);return squared&&squared.includeAsync(b),b}();
