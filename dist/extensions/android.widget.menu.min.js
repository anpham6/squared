this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const{appendSeparator:e,capitalize:t,sameArray:i,safeNestedMap:n}=squared.lib.util,{createViewAttribute:a}=android.lib.util,{NODE_ALIGNMENT:r,NODE_PROCEDURE:o,NODE_RESOURCE:s,NODE_TEMPLATE:l}=squared.base.lib.enumeration,{EXT_ANDROID:c}=android.lib.constant,{CONTAINER_NODE:d}=android.lib.enumeration,u=android.base.Resource,h={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},m={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},p="menu",f="item",N="group",g=["showAsAction","actionViewClass","actionProviderClass"];function A(e,t,i){const a=t.dataset;for(const t in a){const r=e[t];if(r){const e=a[t];if(e){const a=r.exec(e);if(a)n(i,g.includes(t)?"app":"android")[t]=Array.from(new Set(a)).join("|")}}}}function b(e,t){const i=t.title;if(i)return i;else{const t=e.naturalChildren,i=t.length;let n=0;while(n<i){const e=t[n++];if(e.textElement)return e.textContent.trim()}}return""}const E=(e,t)=>e.some(e=>e.toElementString("type")===t);class Menu extends squared.base.ExtensionUI{constructor(e,t,i,n){super(e,t,i,n),this.cascadeAll=true,this.require(c.EXTERNAL,true)}init(e,t){var n;if(this.included(e))if(e.childElementCount>0){if(!i(e.children,e=>e.tagName))return false;const a=null===(n=this.application.getProcessing(t))||void 0===n?void 0:n.rootElements;if(a){let t=e.parentElement;while(t){if("NAV"===t.tagName&&a.has(t))return false;t=t.parentElement}a.add(e)}}return false}condition(e){return this.included(e.element)}processNode(i,n){const a=this.application.createNode(i.sessionId,{parent:n,append:false});return a.childIndex=i.childIndex,a.actualParent=n.actualParent,i.documentRoot=true,i.setControlType(p,d.INLINE),i.addAlign(4),i.exclude({resource:s.ALL,procedure:o.ALL}),i.render(a),i.cascade(e=>(this.addDescendant(e),false)),i.dataset["pathname"+t(this.application.systemName)]=e(this.controller.userSettings.outputDirectory,"res/menu"),{outerParent:a,output:{type:1,node:i,controlName:p},complete:true}}processChild(e,t){if(e.plainText)return e.hide(),{next:true};const i=a(),n=i.android,r=e.element;let l,g;if("NAV"===e.tagName)l=p,g=b(e,r);else if(e.some(e=>e.length>0)){if(e.some(e=>"NAV"===e.tagName))l=f;else if(l=N,e.every(e=>E(e,"radio")))n.checkableBehavior="single";else if(e.every(e=>E(e,"checkbox")))n.checkableBehavior="all";g=b(e,r)}else if(l=f,g=(r.title||r.innerText).trim(),E(e,"checkbox")&&!t.android("checkableBehavior"))n.checkable="true";switch(l){case p:e.addAlign(4);break;case N:e.addAlign(4),A(m,r,i);break;case f:if(A(h,r,i),!n.icon){const t=this.resource;let i=t.addImageSrc(e.backgroundImage,"ic_menu_");if(""!==i)n.icon="@drawable/"+i;else{const a=e.find(e=>e.imageElement);if(a)if(i=t.addImageSrc(a.element,"ic_menu_"),""!==i)n.icon="@drawable/"+i}}e.each(e=>"NAV"!==e.tagName&&e.hide());break}if(""!==g)n.title=u.addString(g,"",this.application.extensionManager.optionValueAsBoolean(c.RESOURCE_STRINGS,"numberResourceValue"));return e.setControlType(l,d.INLINE),e.exclude({resource:s.ALL,procedure:o.ALL}),e.render(t),e.apply(i),{output:{type:1,node:e,controlName:l},complete:true,next:l===p}}}const C=new Menu("android.widget.menu",2,["NAV"]);if(squared)squared.include(C);return C}();
