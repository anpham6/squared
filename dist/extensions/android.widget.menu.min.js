this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const{isNumber:e}=squared.lib.util,t=android.lib,{NODE_PROCEDURE:n,NODE_RESOURCE:a}=squared.base.lib.enumeration,{EXT_ANDROID:i}=t.constant,{CONTAINER_NODE:r}=t.enumeration,{createViewAttribute:o}=t.util,s=android.base.Resource,c={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},d={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},l=["showAsAction","actionViewClass","actionProviderClass"],u="menu",m="item",h="group";function p(e,t,n){const a=t.dataset;for(const t in a){const i=e[t];if(i){const e=a[t];if(e){const a=i.exec(e);if(a){const e=l.includes(t)?"app":"android";let i=n[e];void 0===i&&(i={},n[e]=i),i[t]=Array.from(new Set(a)).join("|")}}}}}function f(e,t){var n;const a=t.title;if(a)return a;for(const t of e.naturalChildren)if(null===(n=t)||void 0===n?void 0:n.textElement)return t.textContent.trim();return""}const g=(e,t)=>e.some(e=>e.toElementString("type")===t);class N extends squared.base.ExtensionUI{constructor(e,t,n,a){super(e,t,n,a),this.cascadeAll=!0,this.require(i.EXTERNAL,!0)}init(e){if(this.included(e)){const t=e.children,n=t.length;if(n){const a=t[0].tagName;for(let e=1;e<n;e++)if(t[e].tagName!==a)return!1;const i=this.application;let r=e.parentElement;for(;r;){if("NAV"===r.tagName&&i.rootElements.has(r))return!1;r=r.parentElement}i.rootElements.add(e)}}return!1}condition(e){return this.included(e.element)}processNode(e,t){const i=this.application.createNode({parent:t,append:!1});i.childIndex=e.childIndex,i.actualParent=t.actualParent,e.documentRoot=!0,e.setControlType(u,r.INLINE),e.addAlign(4),e.exclude({resource:a.ALL,procedure:n.ALL}),e.render(i);for(const t of e.cascade())this.addDescendant(t);return e.dataset.pathname="res/menu",{output:{type:1,node:e,controlName:u},outerParent:i,complete:!0}}processChild(t,l){if(t.plainText)return t.hide(),{next:!0};const N=o(),A=N.android,b=t.element;let E,C;switch("NAV"===t.tagName?(E=u,C=f(t,b)):t.some(e=>e.length>0)?(t.some(e=>"NAV"===e.tagName)?E=m:(E=h,t.every(e=>g(e,"radio"))?A.checkableBehavior="single":t.every(e=>g(e,"checkbox"))&&(A.checkableBehavior="all")),C=f(t,b)):(E=m,C=(b.title||b.innerText).trim(),g(t,"checkbox")&&!l.android("checkableBehavior")&&(A.checkable="true")),E){case u:t.addAlign(4);break;case h:t.addAlign(4),p(d,b,N);break;case m:if(p(c,b,N),!A.icon){const e=this.resource;let n=e.addImageSrc(t.backgroundImage,"ic_menu_");if(""!==n)A.icon="@drawable/"+n;else{const a=t.find(e=>e.imageElement);a&&(n=e.addImageSrc(a.element,"ic_menu_"),""!==n&&(A.icon="@drawable/"+n))}}t.each(e=>"NAV"!==e.tagName&&e.hide())}if(""!==C){const t=this.application.extensionManager.optionValueAsBoolean(i.RESOURCE_STRINGS,"numberResourceValue"),n=s.addString(C,"",t);A.title=t||!e(n)?"@string/"+n:C}return t.setControlType(E,r.INLINE),t.exclude({resource:a.ALL,procedure:n.ALL}),t.render(l),t.apply(N),{output:{type:1,node:t,controlName:E},complete:!0,next:E===u}}}const A=new N("android.widget.menu",2,["NAV"]);return squared&&squared.includeAsync(A),A}();
