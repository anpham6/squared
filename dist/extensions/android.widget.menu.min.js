this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const{constant:e,enumeration:t,util:n}=android.lib,{constant:a,enumeration:i}=squared.base.lib,r=android.base.Resource,o=squared.lib.util,s={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},d={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},c=["showAsAction","actionViewClass","actionProviderClass"],l={MENU:"menu",ITEM:"item",GROUP:"group"},u="ic_menu_";function m(t,n,a){for(const i in n.dataset){const r=n.dataset[i];if(r&&t[i]){const n=t[i].exec(r);n&&(a[c.includes(i)?e.STRING_ANDROID.APP:e.STRING_ANDROID.ANDROID][i]=Array.from(new Set(n)).join("|"))}}}function N(e,t){if(""!==t.title)return t.title;for(const t of e.naturalChildren)if(t&&t.textElement)return t.textContent.trim();return""}const h=(e,t)=>e.some(e=>e.element.type===t);const E=new class extends squared.base.ExtensionUI{constructor(e,t,n,i){super(e,t,n,i),this.cascadeAll=!0,this.require(a.EXT_NAME.EXTERNAL,!0)}init(e){if(this.included(e)){const t=e.children,n=t.length;if(n){const a=t[0].tagName;for(let e=1;e<n;e++)if(t[e].tagName!==a)return!1;const i=this.application;let r=e.parentElement;for(;r;){if("NAV"===r.tagName&&i.rootElements.has(r))return!1;r=r.parentElement}i.rootElements.add(e)}}return!1}condition(e){return this.included(e.element)}processNode(e,n){const a=this.application.createNode(void 0,!1);a.actualParent=n.actualParent,e.documentRoot=!0,e.addAlign(4),e.setControlType(l.MENU,t.CONTAINER_NODE.INLINE),e.exclude(i.NODE_RESOURCE.ALL,i.NODE_PROCEDURE.ALL);for(const t of e.cascade())this.addDescendant(t);return e.render(a),e.dataset.pathname="res/menu",{output:{type:1,node:e,controlName:l.MENU},parentAs:a,complete:!0}}processChild(a,c){if(a.plainText)return a.hide(),{next:!0};const E=n.createViewAttribute(),A=a.element;let g,p="";switch("NAV"===a.tagName?(g=l.MENU,p=N(a,A)):a.some(e=>e.length>0)?(a.some(e=>"NAV"===e.tagName)?g=l.ITEM:(g=l.GROUP,a.every(e=>h(e,"radio"))?E.android.checkableBehavior="single":a.every(e=>h(e,"checkbox"))&&(E.android.checkableBehavior="all")),p=N(a,A)):(g=l.ITEM,p=(A.title||A.innerText).trim(),h(a,"checkbox")&&!c.android("checkableBehavior")&&(E.android.checkable="true")),g){case l.MENU:a.addAlign(4);break;case l.GROUP:a.addAlign(4),m(d,A,E);break;case l.ITEM:if(m(s,A,E),!E.android.icon){const e=this.application.resourceHandler;let t=e.addImageSrc(a.backgroundImage,u);if(""!==t)E.android.icon=`@drawable/${t}`;else{const n=a.find(e=>e.imageElement);n&&""!==(t=e.addImageSrc(n.element,u))&&(E.android.icon=`@drawable/${t}`)}}a.each(e=>"NAV"!==e.tagName&&e.hide())}if(""!==p){const t=this.application.extensionManager.optionValueAsBoolean(e.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),n=r.addString(p,"",t);E.android.title=t||!o.isNumber(n)?`@string/${n}`:p}return a.setControlType(g,t.CONTAINER_NODE.INLINE),a.exclude(i.NODE_RESOURCE.ALL,i.NODE_PROCEDURE.ALL),a.render(c),a.apply(E),{output:{type:1,node:a,controlName:g},complete:!0,next:g===l.MENU}}}("android.widget.menu",2,["NAV"]);return squared&&squared.includeAsync(E),E}();
