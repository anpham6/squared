this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const e=android.lib,{appendSeparator:t,isNumber:n,sameArray:a,safeNestedMap:i}=squared.lib.util,{NODE_ALIGNMENT:r,NODE_PROCEDURE:o,NODE_RESOURCE:s,NODE_TEMPLATE:c}=squared.base.lib.enumeration,{EXT_ANDROID:l}=e.constant,{CONTAINER_NODE:d}=e.enumeration,{createViewAttribute:u}=e.util,m=android.base.Resource,h={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},f={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},p=["showAsAction","actionViewClass","actionProviderClass"],N="menu",g="item",A="group";function E(e,t,n){const a=t.dataset;for(const t in a){const r=e[t];if(r){const e=a[t];if(e){const a=r.exec(e);if(a)i(n,p.includes(t)?"app":"android")[t]=Array.from(new Set(a)).join("|")}}}}function b(e,t){const n=t.title;if(n)return n;else for(const t of e.naturalChildren)if(t.textElement)return t.textContent.trim();return""}const C=(e,t)=>e.some(e=>e.toElementString("type")===t);class y extends squared.base.ExtensionUI{constructor(e,t,n,a){super(e,t,n,a),this.cascadeAll=true,this.require(l.EXTERNAL,true)}init(e){if(this.included(e))if(e.childElementCount){if(!a(e.children,e=>e.tagName))return false;const t=this.application;let n=e.parentElement;while(n){if("NAV"===n.tagName&&t.rootElements.has(n))return false;n=n.parentElement}t.rootElements.add(e)}return false}condition(e){return this.included(e.element)}processNode(e,n){const a=this.application.createNode({parent:n,append:false});return a.childIndex=e.childIndex,a.actualParent=n.actualParent,e.documentRoot=true,e.setControlType(N,d.INLINE),e.addAlign(4),e.exclude({resource:s.ALL,procedure:o.ALL}),e.render(a),e.cascade(e=>(this.addDescendant(e),false)),e.dataset.pathname=t(this.controller.userSettings.outputDirectory,"res/menu"),{output:{type:1,node:e,controlName:N},outerParent:a,complete:true}}processChild(e,t){if(e.plainText)return e.hide(),{next:true};const a=u(),i=a.android,r=e.element;let c,p;if("NAV"===e.tagName)c=N,p=b(e,r);else if(e.some(e=>e.length>0)){if(e.some(e=>"NAV"===e.tagName))c=g;else if(c=A,e.every(e=>C(e,"radio")))i.checkableBehavior="single";else if(e.every(e=>C(e,"checkbox")))i.checkableBehavior="all";p=b(e,r)}else if(c=g,p=(r.title||r.innerText).trim(),C(e,"checkbox")&&!t.android("checkableBehavior"))i.checkable="true";switch(c){case N:e.addAlign(4);break;case A:e.addAlign(4),E(f,r,a);break;case g:if(E(h,r,a),!i.icon){const t=this.resource;let n=t.addImageSrc(e.backgroundImage,"ic_menu_");if(""!==n)i.icon="@drawable/"+n;else{const a=e.find(e=>e.imageElement);if(a)if(n=t.addImageSrc(a.element,"ic_menu_"),""!==n)i.icon="@drawable/"+n}}e.each(e=>"NAV"!==e.tagName&&e.hide());break}if(""!==p){const e=this.application.extensionManager.optionValueAsBoolean(l.RESOURCE_STRINGS,"numberResourceValue"),t=m.addString(p,"",e);i.title=e||!n(t)?"@string/"+t:p}return e.setControlType(c,d.INLINE),e.exclude({resource:s.ALL,procedure:o.ALL}),e.render(t),e.apply(a),{output:{type:1,node:e,controlName:c},complete:true,next:c===N}}}const T=new y("android.widget.menu",2,["NAV"]);if(squared)squared.include(T);return T}();
