this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const e=android.lib,{appendSeparator:t,isNumber:n,sameArray:a,safeNestedMap:r}=squared.lib.util,{NODE_ALIGNMENT:i,NODE_PROCEDURE:o,NODE_RESOURCE:s,NODE_TEMPLATE:c}=squared.base.lib.enumeration,{EXT_ANDROID:d}=e.constant,{CONTAINER_NODE:l}=e.enumeration,{createViewAttribute:u}=e.util,m=android.base.Resource,h={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},p={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},N=["showAsAction","actionViewClass","actionProviderClass"],f="menu",g="item",A="group";function E(e,t,n){const a=t.dataset;for(const t in a){const i=e[t];if(i){const e=a[t];if(e){const a=i.exec(e);a&&(r(n,N.includes(t)?"app":"android")[t]=Array.from(new Set(a)).join("|"))}}}}function b(e,t){const n=t.title;if(n)return n;for(const t of e.naturalChildren)if(t.textElement)return t.textContent.trim();return""}const C=(e,t)=>e.some(e=>e.toElementString("type")===t);class y extends squared.base.ExtensionUI{constructor(e,t,n,a){super(e,t,n,a),this.cascadeAll=true,this.require(d.EXTERNAL,true)}init(e){if(this.included(e)&&e.childElementCount){if(!a(e.children,e=>e.tagName))return false;const t=this.application;let n=e.parentElement;while(n){if("NAV"===n.tagName&&t.rootElements.has(n))return false;n=n.parentElement}t.rootElements.add(e)}return false}condition(e){return this.included(e.element)}processNode(e,n){const a=this.application.createNode({parent:n,append:false});return a.childIndex=e.childIndex,a.actualParent=n.actualParent,e.documentRoot=true,e.setControlType(f,l.INLINE),e.addAlign(4),e.exclude({resource:s.ALL,procedure:o.ALL}),e.render(a),e.cascade(e=>(this.addDescendant(e),false)),e.dataset.pathname=t(this.controller.userSettings.outputDirectory,"res/menu"),{output:{type:1,node:e,controlName:f},outerParent:a,complete:true}}processChild(e,t){if(e.plainText)return e.hide(),{next:true};const a=u(),r=a.android,i=e.element;let c,N;switch("NAV"===e.tagName?(c=f,N=b(e,i)):e.some(e=>e.length>0)?(e.some(e=>"NAV"===e.tagName)?c=g:(c=A,e.every(e=>C(e,"radio"))?r.checkableBehavior="single":e.every(e=>C(e,"checkbox"))&&(r.checkableBehavior="all")),N=b(e,i)):(c=g,N=(i.title||i.innerText).trim(),C(e,"checkbox")&&!t.android("checkableBehavior")&&(r.checkable="true")),c){case f:e.addAlign(4);break;case A:e.addAlign(4),E(p,i,a);break;case g:if(E(h,i,a),!r.icon){const t=this.resource;let n=t.addImageSrc(e.backgroundImage,"ic_menu_");if(""!==n)r.icon="@drawable/"+n;else{const a=e.find(e=>e.imageElement);a&&(n=t.addImageSrc(a.element,"ic_menu_"),""!==n&&(r.icon="@drawable/"+n))}}e.each(e=>"NAV"!==e.tagName&&e.hide())}if(""!==N){const e=this.application.extensionManager.optionValueAsBoolean(d.RESOURCE_STRINGS,"numberResourceValue"),t=m.addString(N,"",e);r.title=e||!n(t)?"@string/"+t:N}return e.setControlType(c,l.INLINE),e.exclude({resource:s.ALL,procedure:o.ALL}),e.render(t),e.apply(a),{output:{type:1,node:e,controlName:c},complete:true,next:c===f}}}const T=new y("android.widget.menu",2,["NAV"]);return squared&&squared.include(T),T}();
