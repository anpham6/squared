this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";var e=android.base.Resource;const t=squared.base.lib.constant,n=squared.base.lib.enumeration,a=squared.lib.css,i=squared.lib.session,r=squared.lib.util,o=squared.lib.dom,s=android.lib.constant,l=android.lib.enumeration,d=android.lib.util,c={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^[0-9]+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^[0-9]+$/},u={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^[0-9]+$/},m=["showAsAction","actionViewClass","actionProviderClass"],E={MENU:"menu",ITEM:"item",GROUP:"group"};function h(e,t,n){for(const a in t.dataset){const i=t.dataset[a];if(i&&e[a]){const t=e[a].exec(i);t&&(n[m.includes(a)?"app":"android"][a]=Array.from(new Set(t)).join("|"))}}}function p(e,t){if(""!==t.title)return t.title;for(const t of e.actualChildren)if(t&&t.textElement)return t.textContent.trim();return""}const N=(e,t)=>e.some(e=>e.element.type===t);const y=new class extends squared.base.Extension{constructor(e,n,a,i){super(e,n,a,i),this.require(t.EXT_NAME.EXTERNAL,!0)}init(e){if(this.included(e)){let t=!1;if(e.children.length){t=!0;const n=e.children[0].tagName;for(let a=1;a<e.children.length;a++)if(e.children[a].tagName!==n){t=!1;break}if(t){let n=e.parentElement;for(;n;){if("NAV"===n.tagName&&this.application.rootElements.has(n)){t=!1;break}n=n.parentElement}}}t&&(e.querySelectorAll("NAV").forEach(t=>{"none"===a.getStyle(e).display&&(i.setElementCache(t,"squaredExternalDisplay",this.application.processing.sessionId,"none"),t.style.setProperty("display","block"))}),this.application.rootElements.add(e))}return!1}condition(e){return this.included(e.element)}processNode(e){const t=this.application.createNode(o.createElement(),!1);e.documentRoot=!0,e.alignmentType|=4,e.setControlType(E.MENU,l.CONTAINER_NODE.INLINE),e.exclude({procedure:n.NODE_PROCEDURE.ALL,resource:n.NODE_RESOURCE.ALL});for(const t of e.cascade())this.addDescendant(t);return e.render(t),e.dataset.pathname="res/menu",{output:{type:1,node:e,controlName:E.MENU},parentAs:t,complete:!0}}processChild(t,i){if(t.plainText)return t.hide(),{next:!0};const o=d.createViewAttribute(),m=t.element;let y,b="";switch("NAV"===t.tagName?(y=E.MENU,b=p(t,m)):t.some(e=>e.length>0)?(t.some(e=>"NAV"===e.tagName)?y=E.ITEM:(y=E.GROUP,t.every(e=>N(e,"radio"))?o.android.checkableBehavior="single":t.every(e=>N(e,"checkbox"))&&(o.android.checkableBehavior="all")),b=p(t,m)):(y=E.ITEM,b=(m.title||m.innerText).trim(),N(t,"checkbox")&&!i.android("checkableBehavior")&&(o.android.checkable="true")),y){case E.MENU:t.alignmentType|=4;break;case E.GROUP:t.alignmentType|=4,h(u,m,o);break;case E.ITEM:if(h(c,m,o),!o.android.icon){const n=a.getStyle(m),i=n.getPropertyValue("background-image");let r=e.addImageURL("none"!==i?i:n.getPropertyValue("background"),s.PREFIX_ANDROID.MENU);if(""!==r)o.android.icon=`@drawable/${r}`;else{const n=t.find(e=>e.imageElement);n&&""!==(r=e.addImageSrc(n.element,s.PREFIX_ANDROID.MENU))&&(o.android.icon=`@drawable/${r}`)}}t.each(e=>"NAV"!==e.tagName&&e.hide())}if(""!==b){const t=this.application.extensionManager.optionValueAsBoolean(s.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"),n=e.addString(b,"",t);o.android.title=t||!r.isNumber(n)?`@string/${n}`:b}return t.setControlType(y,l.CONTAINER_NODE.INLINE),t.exclude({procedure:n.NODE_PROCEDURE.ALL,resource:n.NODE_RESOURCE.ALL}),t.render(i),t.apply(o),{output:{type:1,node:t,controlName:y},complete:!0,next:y===E.MENU}}postBaseLayout(e){e.element.querySelectorAll("NAV").forEach(t=>{const n=i.getElementCache(t,"squaredExternalDisplay",e.sessionId);n&&(t.style.setProperty("display",n),i.deleteElementCache(t,"squaredExternalDisplay",e.sessionId))})}}("android.widget.menu",2,["NAV"]);return squared&&squared.includeAsync(y),y}();
