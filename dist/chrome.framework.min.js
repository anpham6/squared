!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).chrome=t()}(this,(function(){"use strict";class Resource extends squared.base.Resource{constructor(e,t){super(),this.application=e,this.cache=t}get userSettings(){return this.application.userSettings}}const{isTextNode:e}=squared.lib.dom;class Application extends squared.base.Application{constructor(){super(...arguments),this.builtInExtensions={},this.extensions=[],this.systemName="chrome",this.queryState=0}finalize(){}createNode(e){return new this.Node(this.nextId,this.processing.sessionId,e.element)}insertNode(t,s){if(e(t)){if(this.userSettings.excludePlainText)return;this.controllerHandler.applyDefaultStyles(t);const e=this.createNode({element:t});if(s)e.cssApply(s.textStyle);return e}return this.createNode({element:t})}afterCreateCache(e){switch(this.queryState){case 1:this.controllerHandler.cacheElement(e);break;default:this.controllerHandler.cacheElementList(this.processing.cache);break}}get length(){const e=Resource.ASSETS;let t=0;for(const s in e)t+=e[s].size;return t}}const t=squared.lib,{isTextNode:s}=t.dom,{setElementCache:i}=t.session;class Controller extends squared.base.Controller{constructor(e,t){super(),this.application=e,this.cache=t,this.localSettings={mimeType:{font:"*",image:"*",audio:"*",video:"*"}},this._elementMap=new Map}sortInitialCache(){}init(){this.application.processing.unusedStyles.clear()}reset(){this._elementMap.clear()}applyDefaultStyles(e){if(s(e))i(e,"styleMap",this.sessionId,{position:"static",display:"inline",verticalAlign:"baseline",float:"none",clear:"none"})}includeElement(){return true}cacheElement(e){this._elementMap.set(e.element,e)}cacheElementList(e){const t=this._elementMap;e.each(e=>t.set(e.element,e))}get elementMap(){return this._elementMap}get userSettings(){return this.application.userSettings}}const r=squared.lib,{CHAR:n,COMPONENT:o,FILE:a,XML:l}=r.regex,{appendSeparator:c,convertWord:p,fromLastIndexOf:u,isString:m,iterateReverseArray:f,objectMap:h,parseMimeType:g,partitionLastIndexOf:d,randomUUID:v,resolvePath:y,safeNestedArray:A,trimEnd:T}=r.util,S=Resource.ASSETS,E=/[\s\n]*(.+?\.[^\s,]+).*?,?/g;function x(e,t){if(t){const s=new RegExp(e+':\\s*((?:[^"]|\\\\")+)').exec(t.replace(/\\/g,"/"));if(s){const e=s[1].split("::").map(e=>e.trim());return[e[0],e[1]||void 0,"preserve"===e[2]]}}}function O(e){let t;if("/"===(e=e.replace(/\\/g,"/")).charAt(0))t="__serverroot__";else if(e.startsWith("../")){t="__serverroot__";const s=location.pathname.split("/");s.pop();for(let t=0;t<e.length&&s.length>0;t+=3)if("../"===e.substring(t,t+3))s.pop();else break;e=s.join("/")+"/"+e.split("../").pop()}else if(e.startsWith("./"))e=e.substring(2);const s=d(e,"/");return s.unshift(t),s}function b(e,t){const s=y(t.src);if(""!==s)e.set(t,s)}function C(e){var t,s;if(e){const i=e.dataset,r=(null===(t=i.useChrome)||void 0===t?void 0:t.trim())||(null===(s=i.use)||void 0===s?void 0:s.trim());if(r)return r.split(l.SEPARATOR)}return[]}function _(e,t){const s=[];this.application.extensions.forEach(t=>{if(t.processFile(e))s.push(t)});for(const i of t){const t=this.application.extensionManager.retrieve(i,true);if(t&&!s.includes(t))t.processFile(e,true)}}function F(e){for(const t in e){const s=e[t],i=s.length;if(i>1){let e=0;while(e<i)s[e].bundleIndex=e++}}}function P(e,t,s,i,r){const n=t.innerHTML.trim();if(n){const[t,o,a]=O(s);if(f(e,e=>{if((e.moveTo===t||!e.moveTo&&!t)&&e.pathname===o&&e.filename===a)return A(e,"trailingContent").push({value:n,format:i}),true})!==1/0)return{uri:y(s,location.href),pathname:o,filename:a,moveTo:t,content:n,format:i,preserve:r}}}class File extends squared.base.File{static parseUri(e,t={}){const{preserveCrossOrigin:s,saveTo:i}=t;let{saveAs:r,format:n,preserve:a}=t,l=T(e,"/");const c=l.startsWith(T(location.origin,"/"));if(!c&&s)return;let m;if(r){r=T(r.replace(/\\/g,"/"),"/");const e=x("saveAs",r);if(e)[m,n,a]=e;else m=r;if(c&&m)l=y(m,location.href)}const f=o.PROTOCOL.exec(l);if(f){const t=f[2],s=f[3],r=f[4],o=e.includes(".")?u(e,".").toLowerCase():void 0;let l,h,d,y="",A="";const T=e=>r.substring(e,r.lastIndexOf("/"));if(!c)if(i&&m)[h,y,A]=O(m+"/"+v()+(o?"."+o:""));else y=p(t)+(s?"/"+s.substring(1):"")+"/";else{d=location.pathname.substring(0,location.pathname.lastIndexOf("/")+1);let e=0;const t=Math.min(r.length,d.length);for(let s=0;s<t;++s)if(r.charAt(s)===d.charAt(s))e=s;else break;l=r.substring(0,e+1)}if(""===A)if(c&&m)[h,y,A]=O(m);else if(r&&"/"!==r)if(A=u(r,"/","\\"),c)if(r.startsWith(d))y=T(d.length);else h="__serverroot__",l="",y=T(0);else y+=T(1);else A="index.html";return{uri:e,rootDir:l,moveTo:h,pathname:y.replace(/\\/g,"/"),filename:A,mimeType:o&&g(o),format:n,preserve:a}}}reset(){super.reset(),this._outputFileExclusions=void 0}copyToDisk(e,t){return this.copying(Object.assign(Object.assign({},t),{assets:this.getAssetsAll().concat((null==t?void 0:t.assets)||[]),directory:e}))}appendToArchive(e,t){return this.archiving(Object.assign(Object.assign({filename:this.userSettings.outputArchiveName},t),{assets:this.getAssetsAll(t).concat((null==t?void 0:t.assets)||[]),appendTo:e}))}saveToArchive(e,t){return this.archiving(Object.assign(Object.assign({},t),{assets:this.getAssetsAll(t).concat((null==t?void 0:t.assets)||[]),filename:e}))}getHtmlPage(e){var t;const s=[],i=location.href,r=document.querySelector("html"),n=null===(t=null==e?void 0:e.saveAs)||void 0===t?void 0:t.html;let o,l;if(r)o=r.dataset.chromeFile;if(!m(o)&&(null==n?void 0:n.filename))o=u(n.filename),l=n.format;const p=File.parseUri(i,{preserveCrossOrigin:null==e?void 0:e.preserveCrossOrigin,saveAs:o,format:l});if(p){const t=null==e?void 0:e.name;if(t)p.filename=t;else{const e=p.filename;if(!a.NAME.test(e))p.pathname=c(p.pathname,e),p.filename="index.html"}if(this.validFile(p))p.requestMain=true,p.mimeType=g("html"),_.call(this,p,C(document.querySelector("html"))),s.push(p)}return s}getScriptAssets(e){var t;let s,i;if(e)s=e.preserveCrossOrigin,i=null===(t=e.saveAs)||void 0===t?void 0:t.script;const r=[],n={};return document.querySelectorAll("script").forEach(e=>{const t=e.src.trim();let o=e.dataset.chromeFile;if("exclude"!==o){let a,l,p;if(!m(o)&&i){const{pathname:t,filename:s}=i;if(s)o=c(t||"",s),a=i.format,l=e.outerHTML}if(""!==t)p=File.parseUri(y(t),{preserveCrossOrigin:s,saveAs:o,format:a});else if(m(o)){if(!l){const e=x("exportAs",o);if(e)[o,a]=e}if(o)p=P(r,e,o,a)}if(this.validFile(p)){if(A(n,(p.moveTo||"")+p.pathname+p.filename).push(p),p.mimeType=e.type.trim()||p.uri&&g(p.uri)||"text/javascript",l)p.outerHTML=l;_.call(this,p,C(e)),r.push(p)}}}),F(n),r}getLinkAssets(e){var t;let s,i,r;if(e)({rel:r,preserveCrossOrigin:s}=e),i=null===(t=e.saveAs)||void 0===t?void 0:t.link;const n=[],o={};document.querySelectorAll((r?`link[rel="${r}"]`:"link")+", style").forEach(e=>{let t=e.dataset.chromeFile;if("exclude"!==t){let r,a,l,p,u;if(!m(t)&&i&&("text/css"===a||e instanceof HTMLStyleElement)){const{pathname:s,filename:r}=i;if(r)t=c(s||"",r),l=i.format,p=i.preserve,u=e.outerHTML}if(e instanceof HTMLLinkElement){const i=e.href.trim();if(""!==i){switch(e.rel.trim()){case"stylesheet":a="text/css";break;case"icon":a="image/x-icon";break;default:a=e.type.trim()||g(i);break}r=File.parseUri(y(i),{preserveCrossOrigin:s,saveAs:t,format:l,preserve:p})}}else if(m(t)){if(!u){const e=x("exportAs",t);if(e)[t,l,p]=e}if(t)r=P(n,e,t,l,p)}if(this.validFile(r)){if(A(o,(r.moveTo||"")+r.pathname+r.filename).push(r),r.mimeType=a||"text/css",u)r.outerHTML=u;_.call(this,r,C(e)),n.push(r)}}});for(const[e,t]of S.rawData.entries()){const r=t.mimeType;if("text/css"===r){const t=File.parseUri(y(e),{preserveCrossOrigin:s,format:null==i?void 0:i.format});if(this.validFile(t))t.mimeType=r,_.call(this,t,[]),n.push(t)}}return F(o),n}getImageAssets(e){var t;let s,i;if(e)s=e.preserveCrossOrigin,i=null===(t=e.saveAs)||void 0===t?void 0:t.base64;const r=[],o=(e,t,i)=>{if(""!==t){let n;if(e){const t=x("saveTo",e.dataset.chromeFile);if(t)[n,i]=t}const o=File.parseUri(t,{preserveCrossOrigin:s,saveAs:n,saveTo:true});if(this.validFile(o)&&!r.find(e=>e.uri===t)){if(i)o.mimeType=n?i+":"+o.mimeType:i;return _.call(this,o,C(e)),r.push(o),o}}};document.querySelectorAll("video").forEach(e=>o(null,y(e.poster))),document.querySelectorAll("picture > source").forEach(e=>e.srcset.split(l.SEPARATOR).forEach(t=>o(e,y(t.split(n.SPACE)[0])))),document.querySelectorAll("img, input[type=image]").forEach(e=>{const t=e.src.trim();if(!t.startsWith("data:image/"))o(e,y(t))}),document.querySelectorAll("img[srcset], picture > source[srcset]").forEach(e=>{let t;E.lastIndex=0;while(null!==(t=E.exec(e.srcset.trim())))o(e,y(t[1]))});for(const e of S.image.keys())o(null,e);for(const e of S.rawData.values())if(!e.pathname){const{base64:t,content:s,filename:n}=e;let a,l=e.mimeType;if(t){if(i){const e=i.format;if(e&&(null==l?void 0:l.startsWith("image/")))switch(e){case"png":case"jpeg":case"bmp":case"gif":case"tiff":l=`@${e}:${l}`;break}const s=T(i.pathname||"","/").replace(/\\/g,"/");if(a=o(null,y(O(s+(""!==s?"/":"")+n)[1]+n,location.href),l),a){a.base64=t;continue}}a={pathname:"__generated__/base64",filename:n,mimeType:l,base64:t}}else if(s&&l)a={pathname:"__generated__/"+l.split("/").pop(),filename:n,content:s};else continue;if(this.validFile(a))a.mimeType=l,_.call(this,a,[]),r.push(a)}return r}getVideoAssets(e){return this.getRawAssets("video",e)}getAudioAssets(e){return this.getRawAssets("audio",e)}getFontAssets(e){const t=null==e?void 0:e.preserveCrossOrigin,s=[];for(const e of S.fonts.values())e.forEach(e=>{const i=e.srcUrl;if(i){const e=File.parseUri(i,{preserveCrossOrigin:t});if(this.validFile(e))_.call(this,e,[]),s.push(e)}});return s}getDataMap(e){if(e.removeUnusedStyles)return{unusedStyles:Array.from(this.application.processing.unusedStyles)}}getCopyQueryParameters(e){return e.productionRelease?"&release=1":""}getArchiveQueryParameters(e){return e.productionRelease?"&release=1":""}validFile(e){if(e){const t=e.pathname+"/"+e.filename;return!this.outputFileExclusions.some(e=>e.test(t))}return false}getRawAssets(e,t){const s=null==t?void 0:t.preserveCrossOrigin,i=[];return document.querySelectorAll(e).forEach(e=>{const t=new Map;b(t,e),e.querySelectorAll("source").forEach(e=>b(t,e));for(const[e,r]of t.entries()){const t=File.parseUri(r,{preserveCrossOrigin:s});if(this.validFile(t))_.call(this,t,C(e)),i.push(t)}}),i}getAssetsAll(e={}){const t=this.getHtmlPage(e).concat(this.getLinkAssets(e));if(e.saveAsWebPage)t.forEach(e=>{const t=e.mimeType;switch(t){case"text/html":case"application/xhtml+xml":case"text/css":e.mimeType="@"+t;break}});return t.concat(this.getScriptAssets(e)).concat(this.getImageAssets(e)).concat(this.getVideoAssets(e)).concat(this.getAudioAssets(e)).concat(this.getFontAssets(e))}get outputFileExclusions(){let e=this._outputFileExclusions;if(void 0===e)e=h(this.userSettings.outputFileExclusions,e=>function(e){return e=e.trim().replace(/([.|/\\{}()?])/g,(e,...t)=>"\\"+t[0]).replace(/\*/g,".*?"),new RegExp(e+"$")}(e)),this._outputFileExclusions=e;return e}get userSettings(){return this.resource.userSettings}get application(){return this.resource.application}}class View extends squared.base.Node{constructor(e,t,s){super(e,t,s),this._cached={},this._preferInitial=false,this.init()}}const R=e=>"("+Math.max(e.largerThan,0)+","+(e.smallerThan<1/0?e.smallerThan:"*")+")";class Extension extends squared.base.Extension{static getCompressOptions(e){const t=(e.whenSmaller?"%":"")+R(e);return"(0,*)"!==t?t:void 0}static getConvertOptions(e,t){let s="";if(t.replaceWith)s+="@";else if(t.whenSmaller)s+="%";return s+=R(t),e+("(0,*)"!==s?s:"")+":"}processFile(e,t=false){return false}}const{safeNestedArray:w}=squared.lib.util;class Brotli extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["text/css","text/javascript","text/plain","text/csv","application/json","application/javascript","application/ld+json","application/xml"],largerThan:0,smallerThan:1/0,whenSmaller:true,level:11}}processFile(e,t=false){if(!t){const s=e.mimeType;if(s){const e=this.options.mimeTypes;t="*"===e||Array.isArray(e)&&e.includes(s)}}if(t)return w(e,"compress").push({format:"br",level:this.options.level,condition:Extension.getCompressOptions(this.options)}),true;else return false}}const{safeNestedArray:M}=squared.lib.util;class Gzip extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["text/css","text/javascript","text/plain","text/csv","application/json","application/javascript","application/ld+json","application/xml"],largerThan:0,smallerThan:1/0,whenSmaller:true,level:9}}processFile(e,t=false){if(!t){const s=e.mimeType;if(s){const e=this.options.mimeTypes;t="*"===e||Array.isArray(e)&&e.includes(s)}}if(t)return M(e,"compress").push({format:"gz",level:this.options.level,condition:Extension.getCompressOptions(this.options)}),true;else return false}}const{safeNestedArray:N}=squared.lib.util;class Jpeg extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/jpeg"],largerThan:0,smallerThan:1/0,whenSmaller:true,level:100}}processFile(e,t=false){if(!t){const s=e.mimeType;if(s){const e=this.options.mimeTypes;t=s.includes("jpeg:")||"*"===e&&s.includes("image/")||Array.isArray(e)&&!!e.find(e=>s.endsWith(e))}}if(t)return N(e,"compress").push({format:"png",condition:Extension.getCompressOptions(this.options)},{format:"jpeg",level:this.options.level}),true;else return false}}const{safeNestedArray:I}=squared.lib.util;class Png extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png"],largerThan:0,smallerThan:1/0,whenSmaller:true}}processFile(e,t=false){if(!t){const s=e.mimeType;if(s){const e=this.options.mimeTypes;t=s.includes("png:")||"*"===e&&s.includes("image/")||Array.isArray(e)&&!!e.find(e=>s.endsWith(e))}}if(t)return I(e,"compress").push({format:"png",condition:Extension.getCompressOptions(this.options)}),true;else return false}}class Bmp extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png","image/jpeg","image/gif","image/tiff"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true}}processFile(e,t=false){const s=e.mimeType;if(s&&!/bmp[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("bmp",this.options)+s,true}return false}}class Jpeg$1 extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png","image/bmp","image/gif","image/tiff"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true}}processFile(e,t=false){const s=e.mimeType;if(s&&!/jpeg[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("jpeg",this.options)+s,true}return false}}class Png$1 extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/jpeg","image/bmp","image/gif","image/tiff"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true}}processFile(e,t=false){const s=e.mimeType;if(s&&!/png[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("png",this.options)+s,true}return false}}class Gif extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png","image/jpeg","image/bmp","image/tiff"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true}}processFile(e,t=false){const s=e.mimeType;if(s&&!/gif[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("gif",this.options)+s,true}return false}}class Tiff extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png","image/jpeg","image/gif","image/bmp"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true}}processFile(e,t=false){const s=e.mimeType;if(s&&!/tiff[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("tiff",this.options)+s,true}return false}}const q={builtInExtensions:[],preloadImages:false,excludePlainText:true,createQuerySelectorMap:true,showErrorMessages:false,outputFileExclusions:[],outputEmptyCopyDirectory:false,outputArchiveName:"chrome-data",outputArchiveFormat:"zip"};var j=Object.freeze({__proto__:null});const G={COMPRESS_BROTLI:"chrome.compress.brotli",COMPRESS_GZIP:"chrome.compress.gzip",COMPRESS_PNG:"chrome.compress.png",COMPRESS_JPEG:"chrome.compress.jpeg",CONVERT_PNG:"chrome.convert.png",CONVERT_JPEG:"chrome.convert.jpeg",CONVERT_BMP:"chrome.convert.bmp",CONVERT_GIF:"chrome.convert.gif",CONVERT_TIFF:"chrome.convert.tiff"};var k=Object.freeze({__proto__:null,EXT_CHROME:G});const{util:L,session:V}=squared.lib,{flatArray:W,isString:H,isObject:B,promisify:J}=L,{frameworkNotInstalled:D}=V;let U,z,$,Q,Z=false;function X(e,t){let s=function(e,t){if(t)return Q.get(e);else Q.clear()}(e,t);if(void 0===s)U.queryState=1,(async()=>{await U.parseDocument(e)})(),s=Q.get(e),U.queryState=0;return s||null}function K(e){U.queryState=2;let t=false;const s=e.length,i=new Array(s);if((async()=>{for(let r=0;r<s;++r){const s=e[r];let n=Q.get(s);if(n)i[r]=n;else if(await U.parseDocument(s),n=Q.get(s),n)i[r]=n;else t=true}})(),t)W(i);return U.queryState=0,i}function Y(e,t,s,i){if(B(t)){const s=t.assets;if(s)e=e.concat(s)}else t=void 0;return Object.assign(Object.assign({},t),{assets:e,directory:s,filename:i})}const ee={base:{Application:Application,Controller:Controller,File:File,Resource:Resource,View:View},lib:{constant:k,enumeration:j},extensions:{compress:{Brotli:Brotli,Gzip:Gzip,Jpeg:Jpeg,Png:Png},convert:{Bmp:Bmp,Gif:Gif,Jpeg:Jpeg$1,Png:Png$1,Tiff:Tiff}},system:{getElementById(e,t=true){if(U){const s=document.getElementById(e);if(s)return X(s,t)}return null},querySelector(e,t=true){if(U){const s=document.querySelector(e);if(s)return X(s,t)}return null},querySelectorAll(e,t=true){if(U){const s=document.querySelectorAll(e);if(s.length){if(!t)Q.clear();return K(s)}}return[]},getElement(e,t=false){if(U)return X(e,t);else return null},getElementMap:()=>(null==z?void 0:z.elementMap)||new Map,clearElementMap(){null==z||z.elementMap.clear()},copyHtmlPage(e,t){if(H(e))null==$||$.copying(Y($.getHtmlPage(t),t,e))},copyScriptAssets(e,t){if(H(e))null==$||$.copying(Y($.getScriptAssets(t),t,e))},copyLinkAssets(e,t){if(H(e))null==$||$.copying(Y($.getLinkAssets(t),t,e))},copyImageAssets(e,t){if($&&H(e))$.copying(Y($.getImageAssets(t),t,e))},copyVideoAssets(e,t){if(H(e))null==$||$.copying(Y($.getVideoAssets(t),t,e))},copyAudioAssets(e,t){if(H(e))null==$||$.copying(Y($.getAudioAssets(t),t,e))},copyFontAssets(e,t){if(H(e))null==$||$.copying(Y($.getFontAssets(t),t,e))},saveHtmlPage(e,t){null==$||$.archiving(Y($.getHtmlPage(t),t,void 0,(e||U.userSettings.outputArchiveName)+"-html"))},saveScriptAssets(e,t){null==$||$.archiving(Y($.getScriptAssets(t),t,void 0,(e||U.userSettings.outputArchiveName)+"-script"))},saveLinkAssets(e,t){null==$||$.archiving(Y($.getLinkAssets(t),t,void 0,(e||U.userSettings.outputArchiveName)+"-link"))},saveImageAssets(e,t){null==$||$.archiving(Y($.getImageAssets(t),t,void 0,(e||U.userSettings.outputArchiveName)+"-image"))},saveVideoAssets(e,t){null==$||$.archiving(Y($.getVideoAssets(t),t,void 0,(e||U.userSettings.outputArchiveName)+"-video"))},saveAudioAssets(e,t){null==$||$.archiving(Y($.getAudioAssets(t),t,void 0,(e||U.userSettings.outputArchiveName)+"-audio"))},saveFontAssets(e,t){null==$||$.archiving(Y($.getFontAssets(t),t,void 0,(e||U.userSettings.outputArchiveName)+"-font"))}},create(){const e=G;return U=new Application(4,View,Controller,Resource),z=U.controllerHandler,$=new File,U.resourceHandler.setFileHandler($),Q=z.elementMap,Object.assign(U.builtInExtensions,{[e.COMPRESS_BROTLI]:new Brotli(e.COMPRESS_BROTLI,4),[e.COMPRESS_GZIP]:new Gzip(e.COMPRESS_GZIP,4),[e.COMPRESS_JPEG]:new Jpeg(e.COMPRESS_JPEG,4),[e.COMPRESS_PNG]:new Png(e.COMPRESS_PNG,4),[e.CONVERT_BMP]:new Bmp(e.CONVERT_BMP,4),[e.CONVERT_GIF]:new Gif(e.CONVERT_GIF,4),[e.CONVERT_JPEG]:new Jpeg$1(e.CONVERT_JPEG,4),[e.CONVERT_PNG]:new Png$1(e.CONVERT_PNG,4),[e.CONVERT_TIFF]:new Tiff(e.CONVERT_TIFF,4)}),Z=true,{application:U,framework:4,userSettings:Object.assign({},q)}},cached(){if(Z)return{application:U,framework:4,userSettings:U.userSettings};else return ee.create()},getElementById:(e,t=true)=>{if(U){const s=document.getElementById(e);if(s)return J(X)(s,t)}return D()},querySelector:(e,t=true)=>{if(U){const s=document.querySelector(e);if(s)return J(X)(s,t)}return D()},querySelectorAll:(e,t=true)=>{if(U){const s=document.querySelectorAll(e);if(s.length){if(!t)Q.clear();return J(K)(s)}}return D()},getElement:(e,t=false)=>{if(U)return J(X)(e,t);else return D()},saveAsWebPage:(e,t)=>{if($){(t=!B(t)?{}:Object.assign({},t)).saveAsWebPage=true;const s=U.userSettings,i=s.preloadImages;return s.preloadImages=false,U.reset(),U.parseDocument(document.body).then(r=>($.saveToArchive(e||U.userSettings.outputArchiveName,t),s.preloadImages=i,r))}return D()}};return ee}));
