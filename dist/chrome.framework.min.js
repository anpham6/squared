var chrome=function(){"use strict";var e=squared.base.Resource,t=squared.lib.base.Pattern;const{convertWord:s,endsWith:n,parseMimeType:r,replaceMap:o,resolvePath:i,splitPair:a,splitPairEnd:c,splitPairStart:l,startsWith:u,trimEnd:p}=squared.lib.util,{appendSeparator:m,fromMimeType:d,parseTask:f,parseWatchInterval:h,randomUUID:g}=squared.base.lib.util,v=new t(/\s*(.+?\.[^\s,]+)(\s+[\d.]+[wx])?\s*,?/g),A=new WeakMap;let b=0;function y(e,t){if(t){const s=new RegExp(`^\\s*${e}\\s*:(.+)$`).exec(t);if(s){const e=o(s[1].split("::"),(e=>e.trim()));return{file:W(e[0]),format:e[1]}}}}function S(e){if(e){const t=/\bcompress\[\s*([a-z\d]+)\s*\]/g;let s,n;for(;n=t.exec(e);)(s||(s=[])).push({format:n[1]});return{preserve:e.includes("preserve"),inline:e.includes("inline"),blob:e.includes("blob"),compress:s}}return{}}function T(e,t,s){if(u(e,"./")&&(e=e.substring(2)),!e.includes("/"))return["","",e];let n;if("/"===e[0])n="__serverroot__",e=e.substring(1);else if(u(e,"../")){n="__serverroot__";let t=location.pathname.split("/");if(--t.length)for(let s=0,n=e.length;s<n&&("../"===e.substring(s,s+3)&&0!=--t.length);s+=3);t.shift(),t=t.join("/"),e=(t?t+"/":"")+e.split("../").pop()}const r=a(e,"/",!1,!0);return t&&(r[1]=w(r[1],s)),[n,r[0],r[1]]}function w(e,t){return t||(t=e&&P(e)),"__assign__"+(t?"."+t:"unknown")}function x(e,t){const s=i(e instanceof HTMLObjectElement?e.data:e.src);s&&t.set(e,s)}function E(e){for(const t in e){const s=e[t],n=s.length;if(n>1){const e=[],t=++b;for(let r=0;r<n;++r){const n=s[r];n.bundleId=t,n.bundleIndex=r,r>0&&delete n.cloudStorage,e&&n.uri&&e.push(new URL(n.uri))}e:if(e.length===n){const t=e[0].origin,r=e[0].pathname.split("/");for(let s=1;s<n;++s){const n=e[s];if(n.origin!==t)break e;if(r.length){const e=n.pathname.split("/");for(let t=0;t<e.length;++t)if(r[t]!==e[t]){r.splice(t,1/0);break}}}s[0].bundleRoot=t+r.join("/")+"/"}}}}function M(e,t,s,n,r,o,i,a){const c=t.innerHTML;if(c.trim()){const[l,u,p]=T(s),m=e[e.length-1],d={uri:location.href,pathname:u,filename:p,moveTo:l,content:c,mimeType:n,format:r,preserve:i,inlineContent:a?R(t):void 0};if(!m||!q(m,d,!0))return C(e,d),d;(m.trailingContent||(m.trailingContent=[])).push(c),F(e,{exclude:!0},t,o)}return null}function I(e,t){const s=(t.moveTo||"")+t.pathname+t.filename;(e[s]||(e[s]=[])).push(t)}function k(e,t){for(let s=0,n=e.length;s<n;++s)if(q(e[s],t)){for(let r=s+1;r<n;++r)if(!q(e[r],t))return C(e,t),!0;return!1}return C(e,t),!0}function C(e,t){const s=t.filename;let n=0;for(;e.find((e=>q(e,t)));){const[e,s]=a(t.filename,".");t.filename=e+"_"+ ++n+(s?"."+s:"")}n>0&&A.set(t,s)}function F(e,t,s,n){return t.exclude?(e.push({pathname:"",filename:"",exclude:!0,element:s,document:n}),!0):!!t.ignore}function U(e,t,s){const n=D(e,t,s||w(""));return n?[n,!1]:t&&"~"!==t?[t,!0]:["",!1]}function D(e,t,s){if(e&&(!t||"~"===t)){const s=new URL(e);if(location.origin===s.origin){const s=location.origin.length,n=e.substring(s+1).split("/");for(const e of location.href.substring(s+1).split("/"))if(e!==n.shift())return"";t=n.join("/")}}return m(t,s)}function j(e){return e||(e=H(location.href),/\.html?$/i.exec(e)?e:"index.html")}function O(e,t,s){var n,r;const o=(n=t.dataset)[r=s+"Id"]||(n[r]=g());(e.id||(e.id={}))[s]=o}const R=e=>"LINK"===e.tagName?"style":e.tagName.toLowerCase(),L=(e,t,s)=>Object.assign(Object.assign({},e),{attributes:t,append:s}),H=e=>e.split("?")[0].split("/").pop(),_=e=>Array.isArray(e)?e.slice(0):e,q=(e,t,s)=>e.pathname===t.pathname&&(e.filename===t.filename||A.get(e)===t.filename||s&&u(e.filename,"__assign__"))&&(e.moveTo||"")===(t.moveTo||""),N=(e,t,s)=>e.type.trim().toLowerCase()||t&&r(t)||s,P=e=>c(e,".",!0,!0).toLowerCase(),W=e=>e.replace(/\\+/g,"/");class File extends squared.base.File{static createTagNode(e,t,s){const n=e.tagName.toLowerCase(),r=s[n]||(s[n]=document.querySelectorAll(n)),o=r.length;let i=-1,a=-1;for(let s=0,n=t.length;s<n;++s)t[s]===e&&(i=s);for(let t=0;t<o;++t)if(r[t]===e){a=t;break}return{index:i,tagName:n,tagIndex:a,tagCount:o,lowerCase:!0}}static setDocumentId(e,t,s){if(Array.isArray(s))for(const n of s)O(e,t,n);else s&&O(e,t,s)}static parseUri(e,t,n){let o,c,m,d,f;n&&({saveAs:o,mimeType:c,format:m,saveTo:d,fromConfig:f}=n);let h=p(e,"/"),g;const v=u(h,location.origin);if(o){if(o=p(W(o),"/"),d||f)g=o;else{const e=y("saveAs",o);e?({file:g,format:m}=e):g=o}"~"===g&&(g=""),v&&g&&(h=i(g,location.href))}if(!v&&!g&&t)return null;try{const{host:t,port:n,pathname:o}=new URL(h),[i,u]=a(o,"/",!1,!0);let p="",f="",A;if(g?[A,p,f]=T(g,d,P(e)):v||(p=s(t)+(n?"/"+n.substring(1):"")+i),e!==location.href){if(v&&!p){let e=location.pathname;e.endsWith("/")||(e=l(e,"/",!1,!0)),i.startsWith(e)?p=i.substring(e.length+1):(A="__serverroot__",p=i)}f||(f=u)}return{uri:e,moveTo:A,pathname:decodeURIComponent(p),filename:decodeURIComponent(f),mimeType:c||r(e),format:m}}catch(e){}return null}copyTo(e,t){return this.copying(e,this.processAssets(t))}appendTo(e,t){return this.archiving(e,this.processAssets(t))}saveAs(e,t){return e&&(t.filename=e),this.archiving("",this.processAssets(t))}getHtmlPage(e){var t;const s=document.documentElement;let n=s.dataset.chromeFile,r,o;if("ignore"===n)return[];e&&(r=e.assetMap,o=null===(t=e.saveAs)||void 0===t?void 0:t.html);const i=r&&r.get(s);let a,c,l,u,p,m,d,h;if(i){if(i.ignore||i.exclude)return[];({filename:a,process:l,compress:u,tasks:p,attributes:m,cloudStorage:d,document:h}=i)}else if(o){if(o.ignore||o.exclude)return[];({filename:a,process:l,compress:u,tasks:p,attributes:m,cloudStorage:d,document:h}=o)}else p=f(s.dataset.chromeTasks);a&&(n=""),l&&(c=l.join("+"));const g=File.parseUri(location.href,!1,{saveAs:n,format:c,mimeType:"text/html"});return this.processExtensions(g,h,u,p,d,m,s)?(!a&&g.filename||(g.filename=j(a)),[g]):[]}getScriptAssets(e){var t,s;let n,r,i;e&&(({assetMap:n,preserveCrossOrigin:r}=e),i=null===(t=e.saveAs)||void 0===t?void 0:t.script);const a=[],c={};let l;if(n)for(const{selector:e,type:t,template:r}of n.values())if(r&&t&&!e)switch(t){case"html":case"js":case"css":{const{module:e,identifier:n}=r;let o=r.value;e&&n&&o&&(o=o.trim())&&u(o,"function")&&(((s=(l||(l={html:{},js:{},css:{}}))[t])[e]||(s[e]={}))[n]=o);break}}return document.querySelectorAll("script").forEach((e=>{var t;const s=e.dataset.chromeTemplate;if(s||"text/template"===e.type){const r=n&&n.get(e);let i,c,u;if(r?(i=r.type,r.template&&({module:c,identifier:u}=r.template),F(a,r,e,this.userSettings.outputDocumentHandler)):s&&([i,c,u]=o(s.split("::"),((e,t)=>(0===t?e.toLowerCase():e).trim()))),i&&c&&u)switch(i){case"html":case"js":case"css":((t=(l||(l={html:{},js:{},css:{}}))[i])[c]||(t[c]={}))[u]=e.textContent.trim(),e.dataset.chromeFile="exclude"}}else{const t=e.src;this.createBundle(a,e,t,N(e,t,"text/javascript"),r,c,n,void 0,i)}})),E(c),[a,l]}getLinkAssets(e){var t;let s,n,r,o;e&&(({resourceId:s,assetMap:n,preserveCrossOrigin:r}=e),o=null===(t=e.saveAs)||void 0===t?void 0:t.link);const a=[],c={};let l,u,p,m,d,f;document.querySelectorAll("link, style").forEach((e=>{let t,s;if(e instanceof HTMLLinkElement&&(t=e.href.trim()))switch(e.rel.trim().toLowerCase()){case"stylesheet":s="text/css";break;case"icon":s="image/x-icon"}this.createBundle(a,e,t,s||N(e,t,"text/css"),r,c,n,void 0,o,"text/css"===s||e instanceof HTMLStyleElement)})),o&&({process:l,compress:u,preserve:p,tasks:m,cloudStorage:d,document:f}=o);const h=this.getResourceAssets(s);if(h)for(const[e,t]of h.rawData)if("text/css"===t.mimeType){const s=File.parseUri(i(e),r,{format:l?l.join("+"):void 0});this.processExtensions(s,f,u,m,d)&&(p&&(s.preserve=!0),s.mimeType=t.mimeType,a.push(s))}return E(c),a}getImageAssets(t){var s;let o,a,c,l;t&&(({resourceId:o,assetMap:a,preserveCrossOrigin:c}=t),l=null===(s=t.saveAs)||void 0===s?void 0:s.image);const p=[];document.querySelectorAll("img, input[type=image], picture > source[src]").forEach((t=>{let s=t instanceof HTMLVideoElement?t.poster:t.src,n,r;const o=e.parseDataURI(s);if(o){if(r=o.base64,!r)return;n=o.mimeType,s=i(g()+"."+(n&&d(n)||"unknown"),location.href)}else s=i(s);this.processImageUri(p,t,s,l,c,a,n,r)})),document.querySelectorAll("img[srcset], picture > source[srcset]").forEach((e=>{for(v.matcher(e.srcset.trim());v.find();){const t=i(v.group(1));t!==i(e.src)&&this.processImageUri(p,e,t,l,c,a,void 0,void 0,!0)}}));const f=this.getResourceAssets(o);if(f){for(const t of f.image.keys()){const s=e.parseDataURI(t);s?s.base64&&this.resource.addRawData(o,t,s):p.find((e=>e.uri===t))||this.processImageUri(p,null,t,l,c)}for(const{base64:e,content:t,filename:s,mimeType:o=r(s)}of f.rawData.values())if(e){if((null==l?void 0:l.blob)&&!p.find((t=>t.base64===e))){let t;if(u(o,"image/")&&(t=l.commands))for(let e=0;e<t.length;++e){const s=/^\s*(?:(png|jpeg|webp|bmp)\s*[@%]?)(.*)$/.exec(t[e]);s?t[e]=s[1]+"@"+s[2].trim():t.splice(e--,1)}const r=l.pathname,a=this.processImageUri(p,null,i(r?m(r,s):s,location.href),l,c,void 0,o,e);a&&(n(a.filename,".unknown")&&(a.mimeType="image/unknown"),t&&t.length&&(a.commands||(a.commands=t)),a.cloudStorage=l.cloudStorage,r||delete a.uri)}}else if(t&&o){const e={pathname:`__generated__/${o.split("/").pop()}`,filename:w(s),content:t,mimeType:o};this.processExtensions(e)&&p.push(e)}}return p}getVideoAssets(e){return this.getRawAssets("video",e)}getAudioAssets(e){return this.getRawAssets("audio",e)}getFontAssets(e){var t;let s,n,r,o,a;if(e){({resourceId:s,preserveCrossOrigin:a}=e);const i=null===(t=e.saveAs)||void 0===t?void 0:t.font;i&&({pathname:n,inline:r,blob:o}=i)}const c=[],l=this.getResourceAssets(s);if(l)for(const e of l.fonts.values())for(const{srcUrl:t,srcBase64:s,mimeType:l}of e){let e=null;if(t)e=File.parseUri(t,a),e&&r&&(e.format="base64");else if(s&&o){const t=w("",d(l));e=File.parseUri(i(n?m(n,t):t,location.href)),e&&(e.format="blob",e.base64=s,delete e.watch)}this.processExtensions(e)&&c.push(e)}return c}finalizeRequestBody(e,t){if(e.database=t.database,e.baseUrl=t.baseUrl,e.unusedStyles=t.unusedStyles,e.templateMap=t.templateMap,e.document)for(const t of e.document){const e=t+"Id";document.querySelectorAll(`[data-${t}-id]`).forEach((t=>delete t.dataset[e]))}}getCopyQueryParameters(e){return this.getArchiveQueryParameters(e)+(e.watch?"&watch=1":"")}getArchiveQueryParameters(e){return e.productionRelease?"&release=1":""}getRawAssets(e,t){var s;let n,o,i;t&&(({assetMap:n,preserveCrossOrigin:o}=t),i=null===(s=t.saveAs)||void 0===s?void 0:s.image);const a=[];return document.querySelectorAll(e).forEach((e=>{const t=new Map;let s="";switch(e.tagName){case"VIDEO":case"AUDIO":e.querySelectorAll("source, track").forEach((e=>x(e,t)));break;case"OBJECT":case"EMBED":s=e.type;case"IFRAME":{const t="IFRAME"===e.tagName,c=e.dataset.chromeFile;if(!t||u(c,"saveTo")){const t=e instanceof HTMLObjectElement?e.data:e.src;if(u(s,"image/")||u(r(t),"image/"))return void this.processImageUri(a,e,t,i,o,n,s)}else if(t)return}}x(e,t);for(const[e,s]of t){const t=e.dataset.chromeFile;if("ignore"===t)continue;const r=n&&n.get(e);let i,c,l,u,p,m,d,g,v,A;if(r){if(({saveTo:i,filename:l,compress:u,tasks:p,watch:m,attributes:d,cloudStorage:g,document:v}=r),F(a,r,e,v||this.userSettings.outputDocumentHandler))continue;[i,c]=U(s,i||r.pathname,l||H(s)),i&&(l=""),A=!0}else{const s=y("saveAs",t);s&&(i=s.file);const{chromeOptions:n,chromeTasks:r,chromeWatch:o}=e.dataset;u=S(n).compress,p=f(r),m=h(o)}const b=File.parseUri(s,o,{saveAs:i,saveTo:c,fromConfig:A});this.processExtensions(b,v,u,p,g,d,e)&&(l&&(b.filename=l),m&&(b.watch=m),a.push(b))}})),a}processAssets(e){var t;const{appendMap:s,preserveCrossOrigin:n}=e,r=e.nodeMap||(e.nodeMap=new Map),o=document.querySelectorAll("*"),i={},a=this.getHtmlPage(e).concat(this.getLinkAssets(e));if(e.saveAsWebPage)for(const e of a)switch(e.mimeType){case"text/html":case"text/css":e.mimeType="@"+e.mimeType}const[l,u]=this.getScriptAssets(e);if(a.push(...l,...this.getImageAssets(e),...this.getVideoAssets(e),...this.getAudioAssets(e),...this.getRawAssets("object",e),...this.getRawAssets("embed",e),...this.getRawAssets("iframe",e),...this.getFontAssets(e)),s){const r={},l=(e,t,s,n)=>(e in r||(r[e]=document.querySelectorAll(e).length),{tagName:e,tagCount:r[e],textContent:s,order:t,prepend:n});for(const[r,u]of s){const s=File.createTagNode(r,o,i),p=null===(t=e.assetMap)||void 0===t?void 0:t.get(r),m=p&&p.document||this.userSettings.outputDocumentHandler;File.setDocumentId(s,r,m),s.outerXml=r.outerHTML.trim();let d=0;for(const e of u){const{type:t,attributes:o,preserve:i=n}=e;if(t){let n,u,p;switch(t){case"prepend/js":p=!0;case"append/js":o&&(u=o.src,o.type||(o.type="text/javascript"),n=!0);break;case"prepend/css":p=!0;case"append/css":o&&(u=o.href,o.type||(o.type="text/css"));break;default:{const n=l(c(t,"/",!0,!0).toLowerCase(),++d,e.textContent);let r;t.startsWith("append/")?r=L(s,o,n):t.startsWith("prepend/")&&(n.prepend=!0,r=L(s,o,n)),r&&a.push({pathname:"",filename:"",document:m,element:r});continue}}if(u&&o){const t=this.createBundle(a,r,u,o.type,void 0,void 0,void 0,e);t&&(i&&delete t.uri,t.element=L(s,o,l(n?"script":"link",++d,void 0,p)))}}}}}e.assets&&a.push(...e.assets);for(const e of a){const t=e.element;if(t instanceof Element){const s=File.createTagNode(t,o,i);File.setDocumentId(s,t,e.document),e.element=s,r.set(s,t)}}for(const[e,t]of r)"HTML"===t.tagName?e.innerXml=t.innerHTML:e.outerXml=t.outerHTML.trim();return e.assets=a,e.baseUrl=location.href,u&&(e.templateMap=u),delete e.assetMap,delete e.indexMap,delete e.nodeMap,delete e.appendMap,e}createBundle(e,t,s,n,r,o,a,c,l,u=!0){let p=c?"":t.dataset.chromeFile,m,d,g,v,A,b,T,w,x,E,C,j,O;if("exclude"===p||"ignore"===p)return;const L=a&&a.get(t)||c;if(L){let n;if(({filename:n,preserve:g,inline:v,process:A,compress:b,tasks:T,watch:w,attributes:x,cloudStorage:E,document:C}=L),F(e,L,t,C||this.userSettings.outputDocumentHandler))return;p=s?L.saveAs:L.exportAs,!p&&n&&(L.pathname?([p]=U(s,L.pathname,n),p||(m=n)):m=n),j=!0}else{if(u&&l){if(({preserve:g,inline:v,process:A,compress:b,tasks:T,watch:w,attributes:x,cloudStorage:E,document:C}=l),F(e,l,t,C||this.userSettings.outputDocumentHandler))return;m=l.filename,s?(p=m&&D(s,l.pathname,m))&&(m=""):m&&(p="./"+m,m="",O=!0)}const{chromeOptions:n,chromeTasks:r,chromeWatch:o}=t.dataset,i=S(n);null!=v||(v=i.inline),null!=b||(b=i.compress),null!=g||(g=i.preserve),T||(T=f(r)),w||(w=h(o))}A&&(d=A.join("+"));let H=null;if(s){if(H=File.parseUri(i(s),r,{saveAs:p,mimeType:n,format:d,fromConfig:j}),H)if(c){if(v)switch(c.type){case"append/js":H.inlineContent="script";break;case"append/css":H.inlineContent="style"}}else v&&(H.inlineContent=R(t)),k(e,H)&&(H.bundleIndex=-1)}else if(p){if(!j&&!O){const e=y("exportAs",p);e&&({file:p,format:d}=e)}(H=M(e,t,p,n,d,this.userSettings.outputDocumentHandler,g,v))&&(H.bundleIndex=-1)}return this.processExtensions(H,C,b,T,E,x,c?void 0:t)?(m&&(H.filename=m),g&&(H.preserve=!0),w&&(H.watch=w),o&&I(o,H),e.push(H),H):void 0}processImageUri(e,t,s,n,r,i,a,c,l){if(s){let u,p,m,d,g,v,A,b,T,w,x,E,M,I;if(t){const r=t.dataset.chromeFile;if("ignore"===r)return;const a=i&&i.get(t);if(a){if(({saveTo:u,pathname:m,filename:d,commands:b,inline:v,blob:g,compress:A,tasks:T,watch:w,attributes:x,cloudStorage:E,document:M}=a),F(e,a,t,M||this.userSettings.outputDocumentHandler))return;[u,p]=U(s,u||m,d||H(s)),u&&(d=""),I=!0}else{if(n){if(({pathname:m,commands:b,inline:v,blob:g,compress:A,tasks:T,watch:w,attributes:x,cloudStorage:E,document:M}=n),F(e,n,t,M||this.userSettings.outputDocumentHandler))return;[u,p]=U(s,m,H(s))}if(r&&!m){let e=y("saveTo",r);e?[u,p]=U(s,e.file,H(s)):(e=y("saveAs",r))&&(u=e.file)}const{chromeCommands:i,chromeOptions:a,chromeTasks:c,chromeWatch:l}=t.dataset;!b&&i&&(b=o(i.split("::"),(e=>e.trim())));const d=S(a);null!=v||(v=d.inline),null!=A||(A=d.compress),null!=g||(g=d.blob),T||(T=f(c)),w||(w=h(l))}}else n&&(({pathname:m,commands:b,inline:v,blob:g,compress:A,tasks:T,cloudStorage:E}=n),[u,p]=U(s,m,H(s)));if(c&&!g)return;const k=File.parseUri(s,r,{saveAs:u,saveTo:p,mimeType:a,fromConfig:I});if(this.processExtensions(k,M,A,T,E,x,t))return d&&(k.filename=d),b&&b.length&&"~"!==b[0]&&(k.commands=b),w&&(k.watch=w),c?(k.format="blob",k.base64=c,delete k.watch):l?k.format="srcset":v&&(k.format="base64"),e.push(k),k}}getResourceAssets(t){if(void 0!==t&&-1!==t)return e.ASSETS[t]}processExtensions(e,t,s,n,r,o,i){if(e){e.document=t||_(this.userSettings.outputDocumentHandler),s&&(e.compress=s),n&&(e.tasks=n),o&&(e.attributes=o),r&&(e.cloudStorage=r),i&&(e.element=i);for(const t of this.application.extensions)if(!t.processFile(e))return!1;return!0}return!1}get application(){return this.resource.application}get userSettings(){return this.resource.userSettings}}const{UNABLE_TO_FINALIZE_DOCUMENT:B,reject:V}=squared.lib.error,{isPlainObject:$}=squared.lib.util;class Application extends squared.base.Application{constructor(){super(...arguments),this.extensions=[],this.systemName="chrome"}insertNode(e,t){if("#"===t.nodeName[0]){if(this.userSettings.excludePlainText)return;this.controllerHandler.applyDefaultStyles(e,t)}return this.createNodeStatic(e,t)}saveAs(e,t){return this.processAssets("saveAs",e,t)}copyTo(e,t){return this.processAssets("copyTo",e,t)}appendTo(e,t){return this.processAssets("appendTo",e,t)}async processAssets(e,t,s){const n=await this.parseDocument();if(!n)return V(B);const{resourceId:r,unusedStyles:o}=this.getProcessing(n.sessionId),i=[],a=new Map,c=new Map,l=new Map;if(s=Object.assign(Object.assign({},s),{saveAsWebPage:!0,resourceId:r,assetMap:a,nodeMap:c,appendMap:l}),o){const{removeUnusedClasses:e,removeUnusedSelectors:t,retainUsedStyles:n=[]}=s;(e||t)&&(s.unusedStyles=Array.from(o).filter((s=>(s.includes(":")?t:e)&&!n.includes(s))))}if(s.configUri){const e=await this.fileHandler.loadData(s.configUri,{type:"json",cache:s.cache});if(e)if(e.success&&Array.isArray(e.data)){const t=this.userSettings.outputDocumentHandler,s=new Map,n=e=>{if(e&&"number"!=typeof e&&"boolean"!=typeof e){const t=e,n="object"==typeof e||Array.isArray(e);n&&(e=JSON.stringify(e));const r=e;for(const[t,n]of s.values())e=e.replace(t,n);if(r===e)return t;if(n)try{return JSON.parse(e)}catch(e){return t}}return e};location.href.includes("?")&&new URLSearchParams(location.search).forEach(((e,t)=>s.set(t,[new RegExp(`\\{\\{\\s*${t}\\s*\\}\\}`,"g"),e])));for(const r of e.data)if(r.selector){const e=$(r.cloudDatabase)&&r.cloudDatabase;if(e&&s.size)for(const t in e)"value"!==t&&(e[t]=n(e[t]));document.querySelectorAll(r.selector).forEach((s=>{const n=r.type;switch(n){case"text":case"attribute":e&&i.push([s,Object.assign({document:r.document||t},e)]);break;default:if(n&&(n.startsWith("append/")||n.startsWith("prepend/"))){const e=l.get(s)||[];e.push(Object.assign({},r)),l.set(s,e)}else a.set(s,Object.assign({},r))}}))}}else{const t=e.error;t&&this.writeError(t.message,t.hint)}}if(0===a.size&&delete s.assetMap,0===l.size&&delete s.appendMap,i.length){const e=document.querySelectorAll("*"),t={},n=s.database||(s.database=[]);for(let s=0,r=i.length;s<r;++s){const[r,o]=i[s],a=File.createTagNode(r,e,t);o.element=a,File.setDocumentId(a,r,o.document),c.set(a,r),n.push(o)}}return this.fileHandler[e](t,s)}get initializing(){return!1}get length(){return 1}}class Extension extends squared.base.Extension{processFile(e){return!0}}const z={builtInExtensions:[],preloadImages:!1,preloadFonts:!1,preloadCustomElements:!1,excludePlainText:!0,createElementMap:!0,createQuerySelectorMap:!0,pierceShadowRoot:!0,showErrorMessages:!1,outputDocumentHandler:"chrome",outputEmptyCopyDirectory:!1,outputTasks:{},outputWatch:{},outputArchiveName:"chrome-data",outputArchiveFormat:"zip",outputArchiveCache:!1},{DIRECTORY_NOT_PROVIDED:Q,FRAMEWORK_NOT_INSTALLED:J,reject:X}=squared.lib.error,{isString:K,isPlainObject:Y}=squared.lib.util;let Z=null,G=null;function ee(e,t,s){return Y(t)?t.assets&&e.push(...t.assets):t={},Object.assign(t,{assets:e,filename:s})}const te=(e,t)=>e||`${Z.userSettings.outputArchiveName}-${t}`,se=undefined;return{base:{Application:Application,Extension:Extension,File:File},lib:{},extensions:{},system:{copyHtmlPage:(e,t)=>K(e)?G?G.copying(e,ee(G.getHtmlPage(t),t)):X(J):X(Q),copyScriptAssets:(e,t)=>K(e)?G?G.copying(e,ee(G.getScriptAssets(t)[0],t)):X(J):X(Q),copyLinkAssets:(e,t)=>K(e)?G?G.copying(e,ee(G.getLinkAssets(t),t)):X(J):X(Q),copyImageAssets:(e,t)=>K(e)?G?G.copying(e,ee(G.getImageAssets(t),t)):X(J):X(Q),copyVideoAssets:(e,t)=>K(e)?G?G.copying(e,ee(G.getVideoAssets(t),t)):X(J):X(Q),copyAudioAssets:(e,t)=>K(e)?G?G.copying(e,ee(G.getAudioAssets(t),t)):X(J):X(Q),copyFontAssets:(e,t)=>K(e)?G?G.copying(e,ee(G.getFontAssets(t),t)):X(J):X(Q),saveHtmlPage:(e,t)=>G?G.archiving("",ee(G.getHtmlPage(t),t,te(e,"html"))):X(J),saveScriptAssets:(e,t)=>G?G.archiving("",ee(G.getScriptAssets(t)[0],t,te(e,"script"))):X(J),saveLinkAssets:(e,t)=>G?G.archiving("",ee(G.getLinkAssets(t),t,te(e,"link"))):X(J),saveImageAssets:(e,t)=>G?G.archiving("",ee(G.getImageAssets(t),t,te(e,"image"))):X(J),saveVideoAssets:(e,t)=>G?G.archiving("",ee(G.getVideoAssets(t),t,te(e,"video"))):X(J),saveAudioAssets:(e,t)=>G?G.archiving("",ee(G.getAudioAssets(t),t,te(e,"audio"))):X(J),saveFontAssets:(e,t)=>G?G.archiving("",ee(G.getFontAssets(t),t,te(e,"font"))):X(J)},create:()=>(Z=new Application(4,squared.base.Node,squared.base.Controller,squared.base.ExtensionManager,squared.base.Resource),G=new File,Z.resourceHandler.fileHandler=G,{application:Z,framework:4,userSettings:Object.assign({},z)}),cached(){return Z?{application:Z,framework:4,userSettings:Z.userSettings}:this.create()}}}();
