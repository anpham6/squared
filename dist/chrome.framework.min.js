var chrome=function(){"use strict";var e=squared.base.Resource;const{DOM:t}=squared.base.lib.regex,{createElement:s}=squared.lib.dom,{convertWord:n,escapePattern:o,findReverse:i,fromLastIndexOf:r,isPlainObject:a,hasValue:c,lastItemOf:l,replaceAll:u,resolvePath:d,splitPair:p,splitPairEnd:m,splitPairStart:f,splitSome:h,startsWith:g}=squared.lib.util,{parseTask:v,parseWatchInterval:b}=squared.base.lib.internal,{appendSeparator:y,fromMimeType:A,parseMimeType:x,generateUUID:S,getComponentEnd:w,trimEnd:T}=squared.base.lib.util,U=new WeakMap;let C=0;function E(e,t){if(t){const s=new RegExp(`^(?:^|\\s+)${e}\\s*:(.+)$`).exec(t);if(s){const[e,t]=p(s[1],"::",!0);return{file:u(e,"\\","/"),format:t}}}}function O(e){const t={};if(e){-1!==e.indexOf("inline")&&(t.inline=!0),-1!==e.indexOf("preserve")&&(t.preserve=!0),-1!==e.indexOf("blob")&&(t.blob=!0),-1!==e.indexOf("extract")&&(t.extract=!0),-1!==e.indexOf("crossorigin")&&(t.download=!1);const s=/\bcompress\[([^\]]+)\]/g;let n;for(;n=s.exec(e);)(t.compress||(t.compress=[])).push({format:n[1].trim()})}return t}function _(e,t,s){if(g(e,"./")&&(e=e.substring(2)),-1===e.indexOf("/"))return[void 0,"",e];let n;if("/"===e[0])n="__serverroot__",e=e.substring(1);else if(g(e,"../")){n="__serverroot__";const t=location.pathname.split("/");if(--t.length)for(let s=0,n=e.length;s<n&&("../"===e.substring(s,s+3)&&0!=--t.length);s+=3);e=(t.shift()?t.join("/")+"/":"")+e.split("../").pop()}const o=p(e,"/",!1,!0);return t&&(o[1]=V(o[1],s)),[n,...o]}function I(e,t){const s=d(e instanceof HTMLObjectElement?e.data:e.src);s&&t.set(e,s)}function k(e){for(const t in e){const s=e[t],n=s.length;if(n>1){const e=[],t=++C;for(let o=0;o<n;++o){const n=s[o];n.bundleId=t,n.bundleIndex=o,o>0&&delete n.cloudStorage,n.uri&&e.push(new URL(n.uri))}e:if(e.length===n){const{origin:t,pathname:o}=e[0];let i=o.split("/");for(let s=1;s<n;++s){const n=e[s];if(n.origin!==t)break e;if(i.length){const e=n.pathname.split("/");for(let t=0;t<e.length;++t)if(i[t]!==e[t]){i=i.slice(0,t);break}}}s[0].bundleRoot=t+i.join("/")+"/"}}}}function M(e,t,s,n,o,r,a,c){const l=t.innerHTML;if(l.trim()){const[u,d,p]=_(s),m={uri:X(),pathname:d,filename:p,moveTo:u,content:l,mimeType:n,format:o,preserve:r,document:c};a&&(m.inlineContent=z(t));const f=i(e,(e=>e.mimeType===n&&!e.exclude));if(!f||!G(f,m,!0))return R(e,m),m;(f.trailingContent||(f.trailingContent=[])).push(l),L(e,{exclude:!0},t,c)}return null}function F(e,t){const s=(t.moveTo||"")+t.pathname+t.filename;s&&(e[s]||(e[s]=[])).push(t)}function j(e,t){for(const s of e)if(G(s,t,!0)){if(s.mimeType===t.mimeType)return!1;R(e,t);break}return!0}function R(e,t){const s=t.filename;let n=0;for(;e.find((e=>G(e,t,!1)));){const[e,s]=p(t.filename,".");t.filename=e+"_"+ ++n+(s?"."+s:"")}n>0&&U.set(t,s)}function L(e,t,s,n){return t.exclude?(e.push({pathname:"",filename:"",exclude:!0,element:s,document:n}),!0):!!t.ignore}function q(e,t,s){const n=D(e,t,s||e&&V(e));return n?[n,!1]:t&&"~"!==t?[t,!0]:["",!1]}function D(e,t,s){if("~"===t&&(t=""),e&&!t&&s)try{const n=new URL(e);if(location.origin!==n.origin||!g(n.pathname,t=f(location.pathname,"/",!1,!0)))return"";{const e=n.pathname.substring(t.length+1);if(-1===e.indexOf("/"))return s;t=f(e,"/",!1,!0)}}catch(e){}return t&&s&&y(t,s)}function N(e,t,s){var n,o;const i=(n=t.dataset)[o=s+"Id"]||(n[o]=S());(e.id||(e.id={}))[s]=i}function P(e){return{pathname:"",filename:"",mimeType:e,format:"crossorigin"}}function H(e){if(e){switch(e){case"base64":case"crossorigin":case"blob":case"srcset":return!1}return!0}return!1}const V=(e,t)=>"__assign__."+(t||e&&J(e)||"unknown"),W=(e,t)=>"boolean"==typeof e?!e:!!t,z=e=>e instanceof HTMLLinkElement?"style":e.tagName.toLowerCase(),$=(e,t,s)=>Object.assign(Object.assign({},e),{attributes:t,append:s}),B=(e,t)=>e&&e.get(t),K=(e,t,s="")=>e.type.trim().toLowerCase()||t&&x(t)||s,J=e=>m(e,".",!0,!0).toLowerCase(),X=()=>location.origin+location.pathname,G=(e,t,s)=>e.pathname===t.pathname&&(e.filename===t.filename||U.get(e)===t.filename||s&&g(e.filename,"__assign__"))&&(e.moveTo||"")===(t.moveTo||"");class File extends squared.base.File{static createTagNode(e,t,s){const n=e.tagName.toLowerCase(),o=s[n]||(s[n]=document.querySelectorAll(n)),i=o.length;let r=-1,a=-1;for(let s=0,n=t.length;s<n;++s)t[s]===e&&(r=s);for(let t=0;t<i;++t)if(o[t]===e){a=t;break}return{index:r,tagName:n,tagIndex:a,tagCount:i,ignoreCase:!0}}static setDocumentId(e,t,s){Array.isArray(s)?s.forEach((s=>N(e,t,s))):s&&N(e,t,s)}static parseUri(e,t,s){let o,i,r,a,c;s&&({saveAs:o,mimeType:i,format:r,saveTo:a,fromConfig:c}=s),i||(i=x(e));let m=T(e,"/"),h;const v=g(m,location.origin);if(!v&&t)return P(i);if(o){if(o=T(u(o,"\\","/"),"/"),a||c)h=o;else{const e=E("saveAs",o);e?({file:h,format:r}=e):h=o}"~"===h?h="":v&&h&&(m=d(h))}try{const{host:t,port:s,pathname:o}=new URL(m),[c,u]=p(o,"/",!1,!0);let d="",b="",y;if(h?[y,d,b]=_(h,a,J(e)):v||(d=n(t)+(s?"/"+s.substring(1):"")+c),e!==location.href){if(v&&!d){let e=location.pathname;"/"!==l(e)&&(e=f(e,"/",!1,!0)),g(c,e)?d=c.substring(e.length+1):(y="__serverroot__",d="/"===c[0]?c.substring(1):c)}b||(b=u)}return{uri:e,moveTo:y,pathname:decodeURIComponent(d),filename:decodeURIComponent(b),mimeType:i,format:r}}catch(e){}return null}copyTo(e,t){return this.copying(e,this.processAssets(t))}appendTo(e,t){return this.archiving(e,this.processAssets(t))}saveAs(e,t){return e&&(t.filename=e),this.archiving("",this.processAssets(t))}getHtmlPage(e){var t;const s=document.documentElement;let n=s.dataset.chromeFile,o,i;if("ignore"===n)return[];e&&(o=e.assetMap,i=null===(t=e.saveAs)||void 0===t?void 0:t.html);const r=B(o,s)||i;let a,c,l,u,d,p,m,f;if(r){if(r.ignore||r.exclude)return[];({filename:a,compress:l,process:u,tasks:d,attributes:p,cloudStorage:m,document:f}=r)}else{const{chromeOptions:e,chromeTasks:t}=s.dataset;l=O(e).compress,d=v(t)}a&&(n=""),u&&(c=u.join("+"));const h=File.parseUri(location.href,!1,{saveAs:n,format:c,mimeType:"text/html"});if(this.processExtensions(h,f,l,d,m,p,s)){if(a)h.filename=a;else if(!h.filename){const e=location.pathname.split("/").pop();h.filename=/\.(?:html?|php|jsp|aspx?)$/i.exec(e)?e:"index.html"}return H(h.format)&&(h.willChange=!0),[h]}return[]}getScriptAssets(e){var t;let s,n,o;e&&(({assetMap:s,preserveCrossOrigin:n}=e),o=null===(t=e.saveAs)||void 0===t?void 0:t.script);const i=[],r={};let a;const c=(e,t,s,n)=>{var o;return((o=(a||(a={html:{},js:{},css:{}}))[e])[t]||(o[t]={}))[s]=n};if(s)for(const{template:e,type:t,selector:n}of s.values())if(e&&t&&!n)switch(t){case"html":case"js":case"css":{const{module:s,identifier:n}=e;let o=e.value;s&&n&&o&&(o=o.trim())&&-1!==o.indexOf("function")&&c(t,s,n,o);break}}return document.querySelectorAll("script").forEach((e=>{const t=e.dataset.chromeTemplate;let a=e.type.toLowerCase();if(t||"text/template"===a){const n=B(s,e);let o,r,a;if(n?(o=n.type,n.template&&({module:r,identifier:a}=n.template)):t&&([o,r,a]=t.split("::").map(((e,t)=>(0===t?e.toLowerCase():e).trim()))),o&&r&&a)switch(o){case"html":case"js":case"css":return c(o,r,a,e.textContent.trim()),void L(i,{exclude:!0},e)}n&&L(i,n,e)}else if("application/json"!==a&&"application/ld+json"!==a){const t=e.src;a=K(e,t,"text/javascript"),"application/javascript"===a&&(a="text/javascript"),a+="|"+(e.defer?"1":"0")+(e.async?"1":"0")+(e.noModule?"1":"0"),this.createBundle(!0,i,e,t,a,"js",{preserveCrossOrigin:n,bundleIndex:r,assetMap:s,saveAsOptions:o})}})),k(r),[i,a]}getLinkAssets(e){var t,s,n;let i,a,c,l;e&&(({resourceId:i,assetMap:a,preserveCrossOrigin:c}=e),l=null===(t=e.saveAs)||void 0===t?void 0:t.link);const u=[],p={},m=new WeakMap;document.querySelectorAll("link, style").forEach((e=>{let t="",s="text/css";if(e instanceof HTMLLinkElement){const n=e.rel.trim().toLowerCase();if(t=e.href,"stylesheet"!==n){const o=()=>{const n=r(t,"/");return-1!==n.indexOf(".")&&(s=K(e,n),!0)};if(B(a,e))o();else{if(!t||-1===n.indexOf("icon")||!o())return;try{if(new URL(t).origin!==location.origin)return}catch(e){return}}}}const n=this.createBundle("text/css"===s,u,e,t,s,"css",{preserveCrossOrigin:c,bundleIndex:p,assetMap:a,saveAsOptions:l});n&&m.set(e,n)}));const f=null===(s=this.getResourceAssets(i))||void 0===s?void 0:s.rawData;if(f){const e=document.styleSheets,t=e.length;for(const[s,i]of f)e:if("text/css"===i.mimeType){try{t:if(new URL(s).origin===location.origin)for(let i=0;i<t;++i){const t=e[i].cssRules;for(let e=0,i=t.length,r;e<i;++e){const i=t[e];if(i.type===i.IMPORT_RULE&&(r=null===(n=i.parentStyleSheet)||void 0===n?void 0:n.ownerNode)&&d(i.href,r.href)===s){const e=m.get(r);if(e){let t=a&&a.get(r),n;if(t||(null==l?void 0:l.extract)){const d={preserveCrossOrigin:c,bundleIndex:p};if(t){const e=r.dataset.chromeFile;(t.extract||e&&-1!==e.indexOf("extract"))&&(n=!0),d.assetMap=a}else if(null==l?void 0:l.extract){if(l.customize&&null===l.customize.call(null,s,"text/css",Object.assign({},l)))continue;t=Object.assign({},l),d.assetCommand=t,n=!0}if(t){n&&(t.pathname=(e.moveTo?"/":"")+e.pathname,t.filename=e.filename);const a=this.createBundle(!0,u,r,s,"text/css","css",d);if(a){n&&(a.bundleReplace=o(i.cssText).replace(/\("/,"(\\s*[\"']?\\s*").replace(/"\\\)/,"\\s*[\"']?\\s*\\)").replace(/\s+/g,"\\s+")),delete a.element;break e}}}}break t}}}}catch(e){}let i=l,r,f,h,g,v,b,A,x,S;if(i){if(i.customize){if(null===(f=i.customize.call(null,s,"text/css",i=Object.assign({},i))))continue;i.pathname&&f&&(r=y(i.pathname,f))}({compress:h,download:g,preserve:v,process:b,tasks:A,cloudStorage:x,document:S}=i)}const w=File.parseUri(d(s),W(g,c),{saveAs:r,mimeType:"text/css",format:b?b.join("+"):""});this.processExtensions(w,S,h,A,x)&&(f&&(w.filename=f),v&&(w.preserve=!0),u.push(w))}}return k(p),u}getImageAssets(s){var n;let o,i,r,a;s&&(({resourceId:o,assetMap:i,preserveCrossOrigin:r}=s),a=null===(n=s.saveAs)||void 0===n?void 0:n.image);const c=[];document.querySelectorAll("img, input[type=image], picture > source[src], video[poster]").forEach((t=>{let s=t instanceof HTMLVideoElement?t.poster:t.src,n,o;const l=e.parseDataURI(s);if(l){if(!(o=l.base64))return;s=V("",(n=l.mimeType)&&A(n))}this.processImageUri(c,t,d(s),a,r,i,n,o)})),document.querySelectorAll("img[srcset], picture > source[srcset]").forEach((e=>{h(e.srcset,(s=>{const n=t.SRCSET.exec(s);if(n){const t=d(n[1]);t!==d(e.src)&&this.processImageUri(c,e,t,a,r,i,void 0,void 0,!0)}}))}));const l=this.getResourceAssets(o);if(l){for(const t of l.image.keys()){const s=e.parseDataURI(t);s?s.base64&&this.resource.addRawData(o,t,s):this.processImageUri(c,null,t,a,r)}if(l.rawData)for(const e of l.rawData.values()){const{base64:t,content:s,mimeType:n=x(e.filename)}=e;if(t){if(null==a?void 0:a.blob){let s=a,o,i;if(s.customize&&null===(o=s.customize.call(null,"",n,s=Object.assign({},s))))continue;const r=s.pathname;if(o||(o=e.filename),g(n,"image/")&&(i=s.commands))for(let e=0;e<i.length;++e){const t=/^(?:^|\s+)(?:(png|jpeg|webp|bmp)\s*[@%]?)(.*)$/.exec(i[e]);t?i[e]=t[1]+"@"+t[2].trim():i.splice(e--,1)}const l=this.processImageUri(c,null,d(r?y(r,o):o),s,!1,void 0,n||"image/unknown",t);l&&(i&&i.length?l.commands=i:delete l.commands,r||delete l.uri,this.processExtensions(l)&&c.push(l))}}else if(s&&n){const t={pathname:"__generated__/"+n.split("/").pop(),filename:V(e.filename),content:s,mimeType:n};this.processExtensions(t)&&c.push(t)}}}return c}getVideoAssets(e){return this.getRawAssets("video",e)}getAudioAssets(e){return this.getRawAssets("audio",e)}getFontAssets(e){var t;let s,n,o;e&&(({resourceId:s,preserveCrossOrigin:n}=e),o=null===(t=e.saveAs)||void 0===t?void 0:t.font);const i=[],r=this.getResourceAssets(s);if(r)for(const e of r.fonts.values())for(const{srcUrl:t,srcBase64:s,mimeType:r}of e){let e=o,a,c,l,u,p;if(e){if(e.customize&&null===(l=e.customize.call(null,t||"",r,e=Object.assign({},e))))continue;({pathname:c,inline:u,blob:p}=e)}t?(a=File.parseUri(t,!0!==u&&n))&&u&&(a.format="base64"):s&&p&&(l||(l=V("",A(r))),(a=File.parseUri(d(c?y(c,l):l)))&&(a.format="blob",a.base64=s)),this.processExtensions(a)&&i.push(a)}return i}finalizeRequestBody(e){var t;const n=e.productionRelease;let o;if(!n&&e.watch){const n={},i=new URL(this.hostname).hostname,r=this.application.userSettings;for(const{watch:s}of e.assets)if(a(s)&&s.reload){const e=s.reload;let{socketId:o,secure:a,handler:l={},port:u=(a?r.webSocketSecurePort:r.webSocketPort)}=e;o&&c(u)&&Math.floor(u=+u)>0&&(n[t=o+`_${u}_`+(a?"0":"1")]||(n[t]=`socket=new WebSocket("${a?"wss":"ws"}://${i}:${u}");`+(l.open?`socket.onopen=${l.open};`:"")+"socket.onmessage="+(l.message||`function(e){var c=JSON.parse(e.data);if(c&&c.socketId==="${o}"&&c.module==="watch"&&c.action==="modified"){if(!c.errors||!c.errors.length){if(c.hot){if(c.type==="text/css"){var a=document.querySelectorAll('link[href^="'+c.src+'"]');if(a.length){a.forEach(function(b){b.href=c.src+c.hot;});return;}}else if(c.type.startsWith("image/")){var a=document.querySelectorAll('img[src^="'+c.src+'"]');if(a.length){a.forEach(function(b){b.src=c.src+c.hot;});return;}}}window.location.reload();}else{console.log("FAIL: "+c.errors.length+" errors\\n\\n"+c.errors.join("\\n"));}}}`)+";"+(l.error?`socket.onerror=${l.error};`:"")+(l.close?`socket.onclose=${l.close};`:""))),delete e.handler}if(Object.keys(n).length){let t='document.addEventListener("DOMContentLoaded", function(){var socket;';for(const e in n)t+=n[e];if(t+="});",e.useOriginalHtmlPage){const s=e.assets.find((e=>"@text/html"===e.mimeType));s&&(s.element.textContent=`<script>${t}<\/script>`)}else o=s("script",{parent:document.body,attributes:{textContent:t}})}}if(!e.useOriginalHtmlPage){let t;for(const s of e.assets){const e=s.element;if(e){switch(e.tagName){case"html":e.innerXml=document.documentElement.innerHTML;break;case"script":o&&++e.tagCount}o&&(t=e.append)&&"script"===t.tagName&&++t.tagCount}n&&s.watch&&delete s.watch}if(o&&document.body.removeChild(o),e.document)for(const t of e.document){const e=t+"Id";document.querySelectorAll(`[data-${t}-id]`).forEach((t=>delete t.dataset[e]))}e.removeInlineStyles&&document.querySelectorAll("[style]").forEach((e=>e.removeAttribute("style")))}}getCopyQueryParameters(e){return e.watch&&!e.productionRelease?"&watch=1":""}getRawAssets(e,t){var s;let n,o,i;t&&(({assetMap:n,preserveCrossOrigin:o}=t),i=null===(s=t.saveAs)||void 0===s?void 0:s.image);const r=[];return document.querySelectorAll(e).forEach((e=>{const t=new Map;switch(e.tagName.toUpperCase()){case"VIDEO":case"AUDIO":e.querySelectorAll("source, track").forEach((e=>I(e,t)));break;case"IFRAME":if(!B(n,e)&&!g(e.dataset.chromeFile,"saveTo"))return;case"OBJECT":case"EMBED":{const t=e instanceof HTMLObjectElement?e.data:e.src,s=e.type||x(t);if(g(s,"image/"))return void this.processImageUri(r,e,t,i,o,n,s);break}}I(e,t);for(const[e,s]of t){const t=e.dataset.chromeFile;if("ignore"===t)continue;const i=B(n,e);let a,c,l,u,d,p,m,f,h,g,y;if(i){if(({filename:l,compress:u,download:d,tasks:p,watch:m,attributes:f,cloudStorage:h,document:g}=i),L(r,i,e,g))continue;[a,c]=q(s,i.saveTo||i.pathname,l||w(s)),a&&(l=""),y=!0}else{const s=E("saveAs",t);s&&(a=s.file);const{chromeOptions:n,chromeTasks:o,chromeWatch:i}=e.dataset;({compress:u,download:d}=O(n)),p=v(o),m=b(i)}const A=File.parseUri(s,W(d,o),{saveAs:a,saveTo:c,fromConfig:y});this.processExtensions(A,g,u,p,h,f,e,m)&&(l&&(A.filename=l),r.push(A))}})),r}processAssets(e){var t;const{assetMap:s,appendMap:n,nodeMap:o=new Map,useOriginalHtmlPage:i,preserveCrossOrigin:r}=e,a=document.querySelectorAll("*"),c={},l=this.getHtmlPage(e).concat(this.getLinkAssets(e));e.saveAsWebPage&&l.forEach((e=>{switch(e.mimeType){case"text/html":case"text/css":e.mimeType="@"+e.mimeType,e.willChange=!0}}));const[u,d]=this.getScriptAssets(e);if(u.forEach((e=>{let t=e.mimeType;t&&(t=f(t,"|"),"module"===t&&(t="application/javascript"),e.mimeType=t),(H(e.format)||e.bundleId||e.trailingContent)&&(e.willChange=!0)})),l.push(...u,...this.getImageAssets(e),...this.getVideoAssets(e),...this.getAudioAssets(e),...this.getRawAssets("object",e),...this.getRawAssets("embed",e),...this.getRawAssets("iframe",e),...this.getFontAssets(e)),n){const e={},o=(t,s,n,o)=>(t in e||(e[t]=document.querySelectorAll(t).length),{tagName:t,tagCount:e[t],order:s,textContent:n,prepend:o});for(const[e,u]of n){const n=File.createTagNode(e,a,c),d=null===(t=B(s,e))||void 0===t?void 0:t.document,p=()=>n.index+e.querySelectorAll("*").length+1;i||File.setDocumentId(n,e,d),n.outerXml=e.outerHTML.trim();let f=0;for(const t of u){const{type:s,attributes:i,download:a,textContent:c}=t;let u,h,v;switch(s){case"prepend/js":v=!0;case"append/js":i&&(h=i.src,i.type||(i.type="text/javascript"),u=!0);break;case"prepend/css":v=!0;case"append/css":i&&(h=i.href,i.type||(i.type="text/css"));break;default:{let e;if("replace"===s)c&&(e=$(n,i),e.textContent=c);else{const t=o(m(s,"/",!0,!0).toLowerCase(),++f,c);g(s,"append/")?(t.nextSibling=p(),e=$(n,i,t)):g(s,"prepend/")&&(t.prepend=!0,e=$(n,i,t))}e&&l.push({pathname:"",filename:"",document:d,element:e});continue}}if(h&&i){t.document||(t.document=d),delete t.download;const s=this.createBundle(!1,l,e,h,i.type,u?"js":"css",{appendCommand:t});if(s){W(a,r)&&delete s.uri;const e=o(u?"script":"link",++f,void 0,v);v||(e.nextSibling=p()),s.element=$(n,i,e)}}}}}const p=this.application.userSettings.outputDocumentHandler,h=document.documentElement;for(const e of l){const t=e.element;if(t instanceof Element){const s=File.createTagNode(t,a,c);i||File.setDocumentId(s,t,e.document),e.element=s,o.set(s,t)}e.document||(e.document=File.copyDocument(p))}for(const[e,t]of o)t!==h&&(e.outerXml=t.outerHTML.trim());return e.assets&&l.push(...e.assets),e.assets=l,e.baseUrl=X(),d&&(e.templateMap=d),delete e.saveAs,delete e.assetMap,delete e.indexMap,delete e.nodeMap,delete e.appendMap,delete e.sessionId,delete e.resourceId,e}createBundle(e,t,s,n,o,i,r){const{preserveCrossOrigin:a,bundleIndex:c,assetMap:l,assetCommand:u,appendCommand:p}=r;let m=u||p?"":s.dataset.chromeFile;if("exclude"===m||"ignore"===m)return;const f=B(l,s)||p||u;let h,g,y,A,x,w,T,U,C,_,I,k,R,N,V;if(f){if(({inline:y,compress:x,download:w,preserve:T,process:A,tasks:U,watch:C,attributes:_,cloudStorage:I,document:k}=f),L(t,f,s,k))return;m=n?f.saveAs:f.exportAs,m||!f.filename||f.pathname&&(m=q(n,f.pathname,f.filename)[0])||(h=f.filename),R=!0}else{let a=e&&r.saveAsOptions;if(a){if(a.customize&&null===(h=a.customize.call(null,n||"",o,a=Object.assign({},a))))return;if(({inline:y,compress:x,download:w,preserve:T,process:A,tasks:U,watch:C,attributes:_,cloudStorage:I,document:k}=a),L(t,a,s,k))return;a.filename||(a.filename=h||S(this.userSettings.formatUUID,this.userSettings.formatDictionary)+"."+i),h||(h=a.filename),n?(m=D(n,a.pathname,h))&&(h=""):(m="./"+h,h="",N=!0)}const{chromeOptions:c,chromeTasks:l,chromeWatch:u}=s.dataset,d=O(c);null!=y||(y=d.inline),null!=T||(T=d.preserve),x||(x=d.compress),null!=w||(w=d.download),U||(U=v(l)),C||(C=b(u))}if(A&&(g=A.join("+")),n){if((V=File.parseUri(d(n),W(w,a)||p&&T,{saveAs:m,mimeType:o,format:g,fromConfig:R}))&&"crossorigin"!==V.format)if(p){if(y)switch(p.type){case"append/js":V.inlineContent="script";break;case"append/css":V.inlineContent="style"}}else y&&(V.inlineContent=z(s)),e&&j(t,V)&&(V.bundleIndex=-1)}else if(m&&e){if(!R&&!N){const e=E("exportAs",m);e&&({file:m,format:g}=e)}(V=M(t,s,m,o,g,T,y,k))&&(V.bundleIndex=-1)}else s instanceof HTMLScriptElement||(V=P(o));return this.processExtensions(V,k,x,U,I,_,u||p?void 0:s,C)?(h&&(V.filename=h),T&&(V.preserve=!0),c&&F(c,V),H(V.format)&&(V.willChange=!0),t.push(V),V):void 0}processImageUri(e,t,s,n,o,i,r,a,c){if(s){let l,u,d,p,m,f,h,g,y,A,x,S,T,U,C,_;const I=e=>!e.customize||null!==(m=e.customize.call(null,s,r||"",l=Object.assign({},e)));if(t){const o=t.dataset.chromeFile;if("ignore"===o)return;if(l=B(i,t)){if(({pathname:p,filename:m,inline:h,compress:g,download:y,blob:A,commands:f,tasks:x,watch:S,attributes:T,cloudStorage:U,document:C}=l),L(e,l,t,C))return;[u,d]=q(s,l.saveTo||p,m||w(s)),u&&(m=""),_=!0}else{if(n){if(!I(l=n))return;if(({pathname:p,inline:h,compress:g,download:y,blob:A,commands:f,tasks:x,watch:S,attributes:T,cloudStorage:U,document:C}=l),L(e,n,t,C))return;[u,d]=q(s,p,m||w(s))}if(o&&!p){let e=E("saveTo",o);e?[u,d]=q(s,e.file,m||w(s)):(e=E("saveAs",o))&&(u=e.file)}const{chromeCommands:i,chromeOptions:r,chromeTasks:a,chromeWatch:c}=t.dataset;i&&(f||(f=i.split("::").map((e=>e.trim()))));const _=O(r);null!=h||(h=_.inline),g||(g=_.compress),null!=y||(y=_.download),null!=A||(A=_.blob),x||(x=v(a)),S||(S=b(c))}}else if(n){if(!I(l=n))return;({pathname:p,inline:h,compress:g,download:y,blob:A,commands:f,tasks:x,cloudStorage:U}=l),[u,d]=q(s,p,m||w(s))}if(a&&!A)return;!f||0!==f.length&&"~"!==f[0]||(f=void 0);const k=File.parseUri(s,W(y,o),{saveAs:u,saveTo:d,mimeType:r,fromConfig:_});if(this.processExtensions(k,C,g,x,U,T,t,S,!!f)){if(m&&(k.filename=m),a){if(!_&&e.find((e=>e.base64===a)))return;k.format="blob",k.base64=a}else if(c)k.format="srcset";else if(h)k.format="base64";else if(!t&&e.find((e=>e.moveTo===k.moveTo&&e.pathname===k.pathname&&e.filename===k.filename&&-1===k.filename.indexOf("__assign__"))))return;return f?(k.commands=f,k.willChange=!0):g&&(k.willChange=!0),e.push(k),k}}}getResourceAssets(t){if(void 0!==t&&-1!==t)return e.ASSETS[t]}processExtensions(e,t,s,n,o,i,r,a,c){if(e){s&&(e.compress=s,c=!0),n&&(e.tasks=n,c=!0),i&&(e.attributes=i,c=!0),o&&(e.cloudStorage=o,c=!0),a&&(e.watch=a,c=!0),r&&(e.element=r),t&&(e.document=t);for(const t of this.application.extensions)if(!t.processFile(e))return!1;return c||"crossorigin"!==e.format}return!1}get application(){return this.resource.application}get userSettings(){return this.resource.application.userSettings}}const{STRING:Q}=squared.base.lib.regex,{UNABLE_TO_FINALIZE_DOCUMENT:Y,reject:Z}=squared.lib.error,{escapePattern:ee,isPlainObject:te,splitSome:se}=squared.lib.util,{trimBoth:ne}=squared.base.lib.util,oe=new RegExp(Q.CSS_VARVALUE+"|"+Q.CSS_VARNAME,"g"),ie=new RegExp(Q.CSS_VARNAME,"g"),re=new RegExp(Q.CSS_VARVALUE,"g");class Application extends squared.base.Application{constructor(){super(...arguments),this.extensions=[],this.systemName="chrome",this._cssVariables={},this._cssUsedVariables={},this._cssUsedFontFace={},this._cssUsedKeyframes={},this._cssUnusedSelectors={},this._cssUnusedMedia={},this._cssUnusedSupports={}}init(){this.session.usedSelector=function(e,t){var s,n,o,i,r;const{fontFamily:a,animationName:c}=t.style;let l,u,d,p,m;for(;m=oe.exec(t.cssText);)m[3]&&(u||(u=(s=this._cssUsedVariables)[e]||(s[e]=new Set)),u.add(m[3]));for(;m=re.exec(t.cssText);)l||(l=(n=this._cssVariables)[e]||(n[e]={})),(l[o=m[1]]||(l[o]=new Set)).add(m[2].trim());a&&(d||(d=(i=this._cssUsedFontFace)[e]||(i[e]=new Set)),se(a,(e=>{d.add(ne(e))}))),c&&(p||(p=(r=this._cssUsedKeyframes)[e]||(r[e]=new Set)),se(c,(e=>{p.add(e)}))),oe.lastIndex=0,re.lastIndex=0},this.session.unusedSelector=function(e,t,s,n){var o;n||((o=this._cssUnusedSelectors)[e]||(o[e]=new Set)).add(s)},this.session.unusedMedia=function(e,t,s,n){var o;n||((o=this._cssUnusedMedia)[e]||(o[e]=new Set)).add(s)},this.session.unusedSupports=function(e,t,s,n){var o;n||((o=this._cssUnusedSupports)[e]||(o[e]=new Set)).add(s)},super.init()}reset(){this._cssVariables={},this._cssUsedVariables={},this._cssUsedFontFace={},this._cssUsedKeyframes={},this._cssUnusedSelectors={},this._cssUnusedMedia={},this._cssUnusedSupports={},super.reset()}insertNode(e,t){if("#"===t.nodeName[0]){if(this.getUserSetting(e,"excludePlainText"))return;this.controllerHandler.applyDefaultStyles(e,t)}return this.createNodeStatic(e,t)}saveAs(e,t){return this.processAssets("saveAs",e,t)}copyTo(e,t){return this.processAssets("copyTo",e,t)}appendTo(e,t){return this.processAssets("appendTo",e,t)}async processAssets(e,t,s){var n;const o=await this.parseDocument();if(!o)return Z(Y);const i=o.sessionId,r=undefined,a=this.getProcessing(i).resourceId,c=[],l=new Map,u=new Map,d=new Map,p=(s=Object.assign(Object.assign({},s),{saveAsWebPage:!0,sessionId:i,resourceId:a,assetMap:l,nodeMap:u,appendMap:d})).retainUsedStyles,m=p?p.filter((e=>"string"==typeof e)):[],f=e=>{const t=[];return e.forEach((e=>!t.includes(e)&&t.push(e))),t};if(s.removeUnusedVariables){const e=this._cssVariables[i];let t=f(Array.from(this._cssUsedVariables[i]||[]).concat(m.filter((e=>e.startsWith("--")))));if(e){const s=new Set;for(const n of t)!function t(n){if(n){const o=new RegExp(ie);let i;for(const r of n){for(;i=o.exec(r);)s.add(i[1]),t(e[i[1]]);o.lastIndex=0}}}(e[n]);s.size&&(t.forEach((e=>s.add(e))),t=Array.from(s))}s.usedVariables=t,delete s.removeUnusedVariables}if(s.removeUnusedFontFace&&(s.usedFontFace=f(Array.from(this._cssUsedFontFace[i]||[]).concat(m.filter((e=>e.startsWith("|font-face:")&&e.endsWith("|"))).map((e=>ne(e,"|").substring(10).trim())))),delete s.removeUnusedFontFace),s.removeUnusedKeyframes&&(s.usedKeyframes=f(Array.from(this._cssUsedKeyframes[i]||[]).concat(m.filter((e=>e.startsWith("|keyframes:")&&e.endsWith("|"))).map((e=>ne(e,"|").substring(10).trim())))),delete s.removeUnusedKeyframes),s.removeUnusedMedia){const e=this._cssUnusedMedia[i];if(e){const t=[],n=m.filter((e=>e.startsWith("|media:")&&e.endsWith("|"))).map((e=>ne(e,"|").substring(6).trim()));e.forEach((e=>!n.includes(e)&&t.push(e))),t.length&&(s.unusedMedia=t)}delete s.removeUnusedMedia}if(s.removeUnusedSupports){const e=this._cssUnusedSupports[i];if(e){const t=[],n=m.filter((e=>e.startsWith("|supports:")&&e.endsWith("|"))).map((e=>ne(e,"|").substring(9).trim()));for(const s of e)n.includes(s)||t.push(s);t.length&&(s.unusedSupports=t)}delete s.removeUnusedSupports}if(s.removeUnusedClasses||s.removeUnusedPseudoClasses){const e=this._cssUnusedSelectors[i];if(e){const t=[];for(const n of e)!(-1!==n.indexOf(":")?s.removeUnusedPseudoClasses:s.removeUnusedClasses)||p&&p.find((e=>"string"==typeof e?e===n:e.test(n)))||t.push(n);t.length&&(s.unusedStyles=t)}delete s.removeUnusedClasses,delete s.removeUnusedPseudoClasses}const h=null===(n=s.config)||void 0===n?void 0:n.uri;if(h){const e=await this.fileHandler.loadConfig(h,s);if(e){const t=this.userSettings.outputDocumentHandler,s=new Map,n=e=>{const t=typeof e;if(e&&("object"===t||"string"===t)){const n="object"===t?JSON.stringify(e):e;let o=n;for(const[e,t]of s.values())o=o.replace(e,((...e)=>{const s=e[1];return s?s+t.replace(new RegExp(`(?:^${s}|([^\\\\])${s})`,"g"),((...e)=>(e[1]||"")+"\\"+s))+s:t}));if(o!==n){if("object"!==t)return o;try{return JSON.parse(o)}catch(e){}}}return e};location.search&&new URLSearchParams(location.search).forEach(((e,t)=>s.set(t,[new RegExp(`(["'])?\\{\\{\\s*${ee(t)}\\s*\\}\\}\\1`,"g"),e])));for(const o of e)if(o.selector){const e=o.type;let i=te(o.dataSource)?o.dataSource:null,r=te(o.cloudDatabase)?o.cloudDatabase:null;if(s.size){const e=e=>{if(e)for(const t in e)"value"!==t&&(e[t]=n(e[t]))};e(i),e(r)}i&&(i=Object.assign(Object.assign({document:o.document||File.copyDocument(t)},i),{type:e})),r&&(r=Object.assign(Object.assign({document:o.document||File.copyDocument(t)},i),{type:e,source:"cloud"})),document.querySelectorAll(o.selector).forEach((t=>{switch(e){case"text":case"attribute":case"display":i?c.push([t,i]):r&&c.push([t,r]);break;default:if(e&&("replace"===e||e.startsWith("append/")||e.startsWith("prepend/"))){let e=d.get(t);e||d.set(t,e=[]),e.push(Object.assign({},o))}else l.set(t,Object.assign({},o))}}))}}}if(0===l.size&&delete s.assetMap,0===d.size&&delete s.appendMap,c.length){const e=s.useOriginalHtmlPage,t=document.querySelectorAll("*"),n={},o=s.dataSource||(s.dataSource=[]);for(const[s,i]of c){const r=File.createTagNode(s,t,n);r.textContent=s.textContent,i.element=r,e||File.setDocumentId(r,s,i.document),u.set(r,s),o.push(i)}}return this.fileHandler[e](t,s)}get initializing(){return!1}get length(){return 1}}class Extension extends squared.base.Extension{processFile(e){return!0}}class Node extends squared.base.Node{}const ae={builtInExtensions:[],preloadImages:!1,preloadFonts:!1,preloadCustomElements:!1,excludePlainText:!0,createElementMap:!0,pierceShadowRoot:!0,showErrorMessages:!1,webSocketPort:80,webSocketSecurePort:443,formatUUID:"8-4-4-4-12",formatDictionary:"0123456789abcdef",outputDocumentHandler:"chrome",outputEmptyCopyDirectory:!1,outputTasks:{},outputWatch:{},outputArchiveName:"chrome-data",outputArchiveFormat:"zip",outputArchiveCache:!1},{DIRECTORY_NOT_PROVIDED:ce,FRAMEWORK_NOT_INSTALLED:le,reject:ue}=squared.lib.error,{isString:de,isPlainObject:pe}=squared.lib.util;let me=null,fe=null;function he(e,t,s){return pe(t)&&t.assets&&e.push(...t.assets),Object.assign(t={},{assets:e,filename:s})}const ge=(e,t)=>e||`${me.userSettings.outputArchiveName}-${t}`,ve=undefined;return{base:{Application:Application,Extension:Extension,File:File,Node:Node},lib:{},extensions:{},system:{copyHtmlPage:(e,t)=>de(e)?fe?fe.copying(e,he(fe.getHtmlPage(t),t)):ue(le):ue(ce),copyScriptAssets:(e,t)=>de(e)?fe?fe.copying(e,he(fe.getScriptAssets(t)[0],t)):ue(le):ue(ce),copyLinkAssets:(e,t)=>de(e)?fe?fe.copying(e,he(fe.getLinkAssets(t),t)):ue(le):ue(ce),copyImageAssets:(e,t)=>de(e)?fe?fe.copying(e,he(fe.getImageAssets(t),t)):ue(le):ue(ce),copyVideoAssets:(e,t)=>de(e)?fe?fe.copying(e,he(fe.getVideoAssets(t),t)):ue(le):ue(ce),copyAudioAssets:(e,t)=>de(e)?fe?fe.copying(e,he(fe.getAudioAssets(t),t)):ue(le):ue(ce),copyFontAssets:(e,t)=>de(e)?fe?fe.copying(e,he(fe.getFontAssets(t),t)):ue(le):ue(ce),saveHtmlPage:(e,t)=>fe?fe.archiving("",he(fe.getHtmlPage(t),t,ge(e,"html"))):ue(le),saveScriptAssets:(e,t)=>fe?fe.archiving("",he(fe.getScriptAssets(t)[0],t,ge(e,"script"))):ue(le),saveLinkAssets:(e,t)=>fe?fe.archiving("",he(fe.getLinkAssets(t),t,ge(e,"link"))):ue(le),saveImageAssets:(e,t)=>fe?fe.archiving("",he(fe.getImageAssets(t),t,ge(e,"image"))):ue(le),saveVideoAssets:(e,t)=>fe?fe.archiving("",he(fe.getVideoAssets(t),t,ge(e,"video"))):ue(le),saveAudioAssets:(e,t)=>fe?fe.archiving("",he(fe.getAudioAssets(t),t,ge(e,"audio"))):ue(le),saveFontAssets:(e,t)=>fe?fe.archiving("",he(fe.getFontAssets(t),t,ge(e,"font"))):ue(le)},create:()=>(me=new Application(4,Node,squared.base.Controller,squared.base.ExtensionManager,squared.base.Resource),fe=new File(me.resourceHandler),{application:me,framework:4,userSettings:Object.assign({},ae)}),cached(){return me?{application:me,framework:4,userSettings:me.userSettings}:this.create()}}}();
