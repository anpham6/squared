!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).chrome=t()}(this,(function(){"use strict";class Resource extends squared.base.Resource{constructor(e,t){super(),this.application=e,this.cache=t}get userSettings(){return this.application.userSettings}}class Application extends squared.base.Application{constructor(){super(...arguments),this.builtInExtensions={},this.extensions=[],this.queryState=0,this.systemName="chrome"}finalize(){}createNode(e){return new this.Node(this.nextId,this.processing.sessionId,e.element)}insertNode(e){if("#text"===e.nodeName){if(this.userSettings.excludePlainText)return;this.controllerHandler.applyDefaultStyles(e)}return this.createNode({element:e})}afterCreateCache(e){switch(this.queryState){case 1:this.controllerHandler.cacheElement(e);break;default:this.controllerHandler.cacheElementList(this.processing.cache);break}}get length(){const e=Resource.ASSETS;let t=0;for(const s in e)t+=e[s].size;return t}}const{setElementCache:e}=squared.lib.session;class Controller extends squared.base.Controller{constructor(e,t){super(),this.application=e,this.cache=t,this.localSettings={mimeType:{font:"*",image:"*",audio:"*",video:"*"}},this._elementMap=new Map}sortInitialCache(){}init(){this.application.processing.unusedStyles.clear()}reset(){this._elementMap.clear()}applyDefaultStyles(t){if("#text"===t.nodeName)e(t,"styleMap",this.sessionId,{position:"static",display:"inline",verticalAlign:"baseline",float:"none",clear:"none"})}includeElement(){return true}cacheElement(e){this._elementMap.set(e.element,e)}cacheElementList(e){const t=this._elementMap;e.each(e=>t.set(e.element,e))}get elementMap(){return this._elementMap}get userSettings(){return this.application.userSettings}}const{FILE:t}=squared.lib.regex,{appendSeparator:s,convertWord:i,fromLastIndexOf:r,isString:n,iterateReverseArray:o,parseMimeType:a,partitionLastIndexOf:l,randomUUID:c,resolvePath:p,safeNestedArray:u,trimEnd:m}=squared.lib.util;function f(e,t){if(t){const s=new RegExp(e+':\\s*((?:[^"]|\\\\")+)').exec(t.replace(/\\/g,"/"));if(s){const e=s[1].split("::").map(e=>e.trim());return[e[0],e[1]||void 0,"preserve"===e[2]]}}}function h(e,t=false){let s;if("/"===(e=e.replace(/\\/g,"/")).charAt(0))s="__serverroot__";else if(e.startsWith("../")){s="__serverroot__";const t=location.pathname.split("/");t.pop();for(let s=0;s<e.length&&t.length>0;s+=3)if("../"===e.substring(s,s+3))t.pop();else break;e=t.join("/")+"/"+e.split("../").pop()}else if(e.startsWith("./"))e=e.substring(2);const i=l(e,"/");if(t){const e=S(i[1]);i[1]=c()+(e?"."+e:"")}return[s,i[0],i[1]]}function g(e,t){const s=p(e instanceof HTMLObjectElement?e.data:e.src);if(""!==s)t.set(e,s)}function d(e){var t,s;if(e){const i=e.dataset,r=(null===(t=i.useChrome)||void 0===t?void 0:t.trim())||(null===(s=i.use)||void 0===s?void 0:s.trim());if(r)return r.split(/\s*,\s*/)}return[]}function v(e,t){const s=[];for(const t of this.application.extensions)if(t.processFile(e))s.push(t);for(const i of t){const t=this.application.extensionManager.retrieve(i,true);if(t&&!s.includes(t))t.processFile(e,true)}}function y(e){for(const t in e){const s=e[t],i=s.length;if(i>1){let e=0;while(e<i)s[e].bundleIndex=e++}}}function A(e,t,s,i,r){const n=t.innerHTML.trim();if(n){const[t,a,l]=h(s);if(o(e,e=>{if((e.moveTo===t||!e.moveTo&&!t)&&e.pathname===a&&e.filename===l)return u(e,"trailingContent").push({value:n,format:i,preserve:r}),true})!==1/0)return{uri:p(s,location.href),pathname:a,filename:l,moveTo:t,content:n,format:i,preserve:r}}}function T(e,t){if(0===e.bundleIndex)return 1;else if(0===t.bundleIndex)return-1;return 0}const S=e=>e.includes(".")?r(e,".").toLowerCase():"",E=(e,t)=>e.substring(t,e.lastIndexOf("/"));class File extends squared.base.File{static parseUri(e,s={}){let n,o,l;if(s)({saveAs:n,format:o,preserve:l}=s);let u,g=m(e,"/");const d=g.startsWith(m(location.origin,"/"));if(n){n=m(n.replace(/\\/g,"/"),"/");const e=f("saveAs",n);if(e)[u,o,l]=e;else u=n;if(d&&u)g=p(u,location.href)}if(s.preserveCrossOrigin&&!d&&!u)return;const v=t.PROTOCOL.exec(g);if(v){const t=v[2],n=v[3],p=v[4]||"",m=S(e);let f,g,y="",A="",T="";if(!d)if(s.saveTo&&u)[g,y,A]=h(u+"/"+c()+(m?"."+m:""));else y=i(t)+(n?"/"+n.substring(1):"")+"/";else{T=location.pathname.substring(0,location.pathname.lastIndexOf("/")+1);let e=p.length;if(e){let t=0;e=Math.min(e,T.length);for(let s=0;s<e;++s)if(p.charAt(s)===T.charAt(s))t=s;else break;f=p.substring(0,t+1)}}if(""===A)if(d&&u)[g,y,A]=h(u,s.saveTo);else if(p&&"/"!==p)if(A=r(p,"/","\\"),d)if(p.startsWith(T))y=E(p,T.length);else g="__serverroot__",f="",y=E(p,0);else y+=E(p,1);else A="index.html";return{uri:e,rootDir:f,moveTo:g,pathname:y.replace(/\\/g,"/"),filename:A,mimeType:m&&a(m),format:o,preserve:l}}}reset(){super.reset(),this._outputFileExclusions=void 0}copyToDisk(e,t){return this.copying(Object.assign(Object.assign({},t),{assets:this.getAssetsAll().concat((null==t?void 0:t.assets)||[]),directory:e}))}appendToArchive(e,t){return this.archiving(Object.assign(Object.assign({filename:this.userSettings.outputArchiveName},t),{assets:this.getAssetsAll(t).concat((null==t?void 0:t.assets)||[]),appendTo:e}))}saveToArchive(e,t){return this.archiving(Object.assign(Object.assign({},t),{assets:this.getAssetsAll(t).concat((null==t?void 0:t.assets)||[]),filename:e}))}getHtmlPage(e){var i;let o,l,c;if(e)({name:c,preserveCrossOrigin:o}=e),l=null===(i=e.saveAs)||void 0===i?void 0:i.html;const p=[],u=document.querySelector("html"),m=location.href;let f,h;if(u)f=u.dataset.chromeFile;if(!n(f)&&(null==l?void 0:l.filename))f=r(l.filename,"/","\\"),h=l.format;const g=File.parseUri(m,{preserveCrossOrigin:o,saveAs:f,format:h});if(g){if(c)g.filename=c;else{const e=g.filename;if(!t.NAME.test(e))g.pathname=s(g.pathname,e),g.filename="index.html"}if(this.validFile(g))g.requestMain=true,g.mimeType=a("html"),v.call(this,g,d(document.querySelector("html"))),p.push(g)}return p}getScriptAssets(e){var t;let i,r;if(e)i=e.preserveCrossOrigin,r=null===(t=e.saveAs)||void 0===t?void 0:t.script;const o=[],l={};return document.querySelectorAll("script").forEach(e=>{const t=e.src.trim();let c=e.dataset.chromeFile;if("exclude"!==c){let m,h,g,y;if(!n(c)&&(null==r?void 0:r.filename))c=s(r.pathname||"",r.filename),m=r.format,h=e.outerHTML;if(""!==t)y=File.parseUri(p(t),{preserveCrossOrigin:i,saveAs:c,format:m});else if(n(c)){if(!h){const e=f("exportAs",c);if(e)[c,m,g]=e}if(c)y=A(o,e,c,m,g)}if(this.validFile(y)){if(u(l,(y.moveTo||"")+y.pathname+y.filename).push(y),y.mimeType=e.type.trim()||y.uri&&a(y.uri)||"text/javascript",h)y.outerHTML=h;v.call(this,y,d(e)),o.push(y)}}}),y(l),o.sort(T)}getLinkAssets(e){var t;let i,r,o;if(e)({rel:o,preserveCrossOrigin:i}=e),r=null===(t=e.saveAs)||void 0===t?void 0:t.link;const l=[],c={};document.querySelectorAll((o?`link[rel="${o}"]`:"link")+", style").forEach(e=>{let t=e.dataset.chromeFile;if("exclude"!==t){let o,m,h,g,y,T;if(e instanceof HTMLLinkElement)if(m=e.href.trim(),""!==m)switch(e.rel.trim()){case"stylesheet":h="text/css";break;case"icon":h="image/x-icon";break;default:h=e.type.trim()||a(m);break}if(!n(t)&&(null==r?void 0:r.filename)&&("text/css"===h||e instanceof HTMLStyleElement))t=s(r.pathname||"",r.filename),g=r.format,y=r.preserve,T=e.outerHTML;if(m)o=File.parseUri(p(m),{preserveCrossOrigin:i,saveAs:t,format:g,preserve:y});else if(n(t)){if(!T){const e=f("exportAs",t);if(e)[t,g,y]=e}if(t)o=A(l,e,t,g,y)}if(this.validFile(o)){if(u(c,(o.moveTo||"")+o.pathname+o.filename).push(o),o.mimeType=h||"text/css",T)o.outerHTML=T;v.call(this,o,d(e)),l.push(o)}}});for(const[e,t]of Resource.ASSETS.rawData.entries()){const s=t.mimeType;if("text/css"===s){const t=File.parseUri(p(e),{preserveCrossOrigin:i,format:null==r?void 0:r.format});if(this.validFile(t))t.mimeType=s,v.call(this,t,[]),l.push(t)}}return y(c),l.sort(T)}getImageAssets(e){var t;let s,i;if(e)s=e.preserveCrossOrigin,i=null===(t=e.saveAs)||void 0===t?void 0:t.base64;const r=[],n=(e,t,i)=>{if(""!==(t=t.trim())){let n;if(e){const t=f("saveTo",e.dataset.chromeFile);if(t)[n,i]=t}const o=File.parseUri(t,{preserveCrossOrigin:s,saveAs:n,saveTo:true});if(this.validFile(o)&&!r.find(e=>e.uri===t)){if(i)o.mimeType=n?i+":"+o.mimeType:i;return v.call(this,o,d(e)),r.push(o),o}}};document.querySelectorAll("video").forEach(e=>n(null,p(e.poster))),document.querySelectorAll("picture > source").forEach(e=>{for(const t of e.srcset.trim().split(","))n(e,p(t.split(" ")[0]))}),document.querySelectorAll("img, input[type=image]").forEach(e=>{const t=e.src.trim();if(!t.startsWith("data:image/"))n(e,p(t))}),document.querySelectorAll("img[srcset], picture > source[srcset]").forEach(e=>{const t=/[\s\n]*(.+?\.[^\s,]+)(\s+[\d.]+[wx]\s*)?,?/g;let s;while(s=t.exec(e.srcset.trim()))n(e,p(s[1]))});for(const e of Resource.ASSETS.image.keys())n(null,e);for(const e of Resource.ASSETS.rawData.values())if(!e.pathname){const{base64:t,filename:s}=e;let o,a=e.mimeType;if(t){if(i){const e=i.format;if(e&&(null==a?void 0:a.startsWith("image/")))switch(e){case"png":case"jpeg":case"bmp":case"gif":case"tiff":a=`@${e}:${a}`;break}const r=m(i.pathname||"","/").replace(/\\/g,"/");if(o=n(null,p(h(r+(""!==r?"/":"")+s)[1]+s,location.href),a),o){o.base64=t;continue}}o={pathname:"__generated__/base64",filename:s,mimeType:a,base64:t}}else if(a&&e.content)o={pathname:"__generated__/"+a.split("/").pop(),filename:s,content:e.content};else continue;if(this.validFile(o))o.mimeType=a,v.call(this,o,[]),r.push(o)}return r}getVideoAssets(e){return this.getRawAssets("video",e)}getAudioAssets(e){return this.getRawAssets("audio",e)}getFontAssets(e){const t=null==e?void 0:e.preserveCrossOrigin,s=[];for(const e of Resource.ASSETS.fonts.values())for(let i=0;i<e.length;++i){const r=e[i].srcUrl;if(r){const e=File.parseUri(r,{preserveCrossOrigin:t});if(this.validFile(e))v.call(this,e,[]),s.push(e)}}return s}getDataMap(e){if(e.removeUnusedStyles)return{unusedStyles:Array.from(this.application.processing.unusedStyles)}}getCopyQueryParameters(e){return e.productionRelease?"&release=1":""}getArchiveQueryParameters(e){return e.productionRelease?"&release=1":""}validFile(e){if(e){const t=s(e.pathname,e.filename);return!this.outputFileExclusions.some(e=>e.test(t))}return false}getRawAssets(e,t){const s=null==t?void 0:t.preserveCrossOrigin,i=[];return document.querySelectorAll(e).forEach(e=>{var t;const r=new Map;switch(g(e,r),e.tagName){case"VIDEO":case"AUDIO":e.querySelectorAll("source, track").forEach(e=>g(e,r));break}for(const[e,n]of r.entries()){const r=null===(t=f("saveTo",e.dataset.chromeFile))||void 0===t?void 0:t[0],o=File.parseUri(n,{preserveCrossOrigin:s,saveAs:r,saveTo:true});if(this.validFile(o))v.call(this,o,d(e)),i.push(o)}}),i}getAssetsAll(e={}){const t=this.getHtmlPage(e).concat(this.getLinkAssets(e));if(e.saveAsWebPage)for(let e=0;e<t.length;++e){const s=t[e],i=s.mimeType;switch(i){case"text/html":case"application/xhtml+xml":case"text/css":s.mimeType="@"+i;break}}return t.concat(this.getScriptAssets(e)).concat(this.getImageAssets(e)).concat(this.getVideoAssets(e)).concat(this.getAudioAssets(e)).concat(this.getRawAssets("object",e)).concat(this.getRawAssets("embed",e)).concat(this.getFontAssets(e))}get outputFileExclusions(){let e=this._outputFileExclusions;if(void 0===e)e=this.userSettings.outputFileExclusions.map(e=>function(e){return e=e.trim().replace(/([.|/\\{}()?])/g,(e,...t)=>"\\"+t[0]).replace(/\*/g,".*?"),new RegExp(e+"$")}(e)),this._outputFileExclusions=e;return e}get userSettings(){return this.resource.userSettings}get application(){return this.resource.application}}class View extends squared.base.Node{constructor(e,t,s){super(e,t,s),this._cached={},this.init()}}const x=e=>"("+Math.max(e.largerThan,0)+","+(e.smallerThan<1/0?e.smallerThan:"*")+")";class Extension extends squared.base.Extension{static getCompressOptions(e){const t=(e.whenSmaller?"%":"")+x(e);return"(0,*)"!==t?t:void 0}static getConvertOptions(e,t){const s=t.opacity||1;let i="";if(t.replaceWith)i+="@";else if(t.whenSmaller)i+="%";return i+=x(t),e+("(0,*)"!==i?i:"")+(s>0&&s<1?`|${s}|`:"")+":"}processFile(e,t=false){return false}}const{safeNestedArray:O}=squared.lib.util;class Brotli extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["text/css","text/javascript","text/plain","text/csv","text/vtt","application/json","application/javascript","application/ld+json","application/xml"],largerThan:0,smallerThan:1/0,whenSmaller:true,level:11}}processFile(e,t=false){if(!t){const s=e.mimeType;if(s){const e=this.options.mimeTypes;t="*"===e||Array.isArray(e)&&e.includes(s)}}if(t)return O(e,"compress").push({format:"br",level:this.options.level,condition:Extension.getCompressOptions(this.options)}),true;else return false}}const{safeNestedArray:b}=squared.lib.util;class Gzip extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["text/css","text/javascript","text/plain","text/csv","text/vtt","application/json","application/javascript","application/ld+json","application/xml"],largerThan:0,smallerThan:1/0,whenSmaller:true,level:9}}processFile(e,t=false){if(!t){const s=e.mimeType;if(s){const e=this.options.mimeTypes;t="*"===e||Array.isArray(e)&&e.includes(s)}}if(t)return b(e,"compress").push({format:"gz",level:this.options.level,condition:Extension.getCompressOptions(this.options)}),true;else return false}}const{safeNestedArray:C}=squared.lib.util;class Jpeg extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/jpeg"],largerThan:0,smallerThan:1/0,whenSmaller:true,level:100}}processFile(e,t=false){if(!t){const s=e.mimeType;if(s){const e=this.options.mimeTypes;t=s.includes("jpeg:")||"*"===e&&s.includes("image/")||Array.isArray(e)&&!!e.find(e=>s.endsWith(e))}}if(t)return C(e,"compress").push({format:"png",condition:Extension.getCompressOptions(this.options)},{format:"jpeg",level:this.options.level}),true;else return false}}const{safeNestedArray:_}=squared.lib.util;class Png extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png"],largerThan:0,smallerThan:1/0,whenSmaller:true}}processFile(e,t=false){if(!t){const s=e.mimeType;if(s){const e=this.options.mimeTypes;t=s.includes("png:")||"*"===e&&s.includes("image/")||Array.isArray(e)&&!!e.find(e=>s.endsWith(e))}}if(t)return _(e,"compress").push({format:"png",condition:Extension.getCompressOptions(this.options)}),true;else return false}}class Bmp extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png","image/jpeg","image/gif","image/tiff"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true}}processFile(e,t=false){const s=e.mimeType;if(s&&!/bmp[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("bmp",this.options)+s,true}return false}}class Jpeg$1 extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png","image/bmp","image/gif","image/tiff"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true}}processFile(e,t=false){const s=e.mimeType;if(s&&!/jpeg[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("jpeg",this.options)+s,true}return false}}class Png$1 extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/jpeg","image/bmp","image/gif","image/tiff"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true,opacity:1}}processFile(e,t=false){const s=e.mimeType;if(s&&!/png[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("png",this.options)+s,true}return false}}class Gif extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png","image/jpeg","image/bmp","image/tiff"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true,opacity:1}}processFile(e,t=false){const s=e.mimeType;if(s&&!/gif[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("gif",this.options)+s,true}return false}}class Tiff extends Extension{constructor(){super(...arguments),this.options={mimeTypes:["image/png","image/jpeg","image/gif","image/bmp"],largerThan:0,smallerThan:1/0,whenSmaller:false,replaceWith:true}}processFile(e,t=false){const s=e.mimeType;if(s&&!/tiff[(%@:]/.test(s)){const i=this.options.mimeTypes;if(t||Array.isArray(i)&&i.find(e=>s.endsWith(e)))return e.mimeType=Extension.getConvertOptions("tiff",this.options)+s,true}return false}}const F={builtInExtensions:[],preloadImages:false,excludePlainText:true,createQuerySelectorMap:true,showErrorMessages:false,outputFileExclusions:[],outputEmptyCopyDirectory:false,outputArchiveName:"chrome-data",outputArchiveFormat:"zip"};var w=Object.freeze({__proto__:null});const P={COMPRESS_BROTLI:"chrome.compress.brotli",COMPRESS_GZIP:"chrome.compress.gzip",COMPRESS_PNG:"chrome.compress.png",COMPRESS_JPEG:"chrome.compress.jpeg",CONVERT_PNG:"chrome.convert.png",CONVERT_JPEG:"chrome.convert.jpeg",CONVERT_BMP:"chrome.convert.bmp",CONVERT_GIF:"chrome.convert.gif",CONVERT_TIFF:"chrome.convert.tiff"};var R=Object.freeze({__proto__:null,EXT_CHROME:P});const{util:M,session:N}=squared.lib,{flatArray:I,isString:j,isObject:q,promisify:k}=M,{frameworkNotInstalled:G}=N;let V,L,W,H,B=false;function D(e,t){let s=function(e,t){if(t)return H.get(e);else H.clear()}(e,t);if(void 0===s)V.queryState=1,(async()=>{await V.parseDocument(e)})(),s=H.get(e),V.queryState=0;return s||null}function J(e){V.queryState=2;let t=false;const s=e.length,i=new Array(s);if((async()=>{for(let r=0;r<s;++r){const s=e[r];let n=H.get(s);if(n)i[r]=n;else if(await V.parseDocument(s),n=H.get(s),n)i[r]=n;else t=true}})(),t)I(i);return V.queryState=0,i}function U(e,t,s,i){if(q(t)){const s=t.assets;if(s)e=e.concat(s)}else t=void 0;return Object.assign(Object.assign({},t),{assets:e,directory:s,filename:i})}const z={base:{Application:Application,Controller:Controller,File:File,Resource:Resource,View:View},lib:{constant:R,enumeration:w},extensions:{compress:{Brotli:Brotli,Gzip:Gzip,Jpeg:Jpeg,Png:Png},convert:{Bmp:Bmp,Gif:Gif,Jpeg:Jpeg$1,Png:Png$1,Tiff:Tiff}},system:{getElementById(e,t=true){if(V){const s=document.getElementById(e);if(s)return D(s,t)}return null},querySelector(e,t=true){if(V){const s=document.querySelector(e);if(s)return D(s,t)}return null},querySelectorAll(e,t=true){if(V){const s=document.querySelectorAll(e);if(s.length){if(!t)H.clear();return J(s)}}return[]},getElement(e,t=false){if(V)return D(e,t);else return null},getElementMap:()=>(null==L?void 0:L.elementMap)||new Map,clearElementMap(){null==L||L.elementMap.clear()},copyHtmlPage(e,t){if(j(e))null==W||W.copying(U(W.getHtmlPage(t),t,e))},copyScriptAssets(e,t){if(j(e))null==W||W.copying(U(W.getScriptAssets(t),t,e))},copyLinkAssets(e,t){if(j(e))null==W||W.copying(U(W.getLinkAssets(t),t,e))},copyImageAssets(e,t){if(W&&j(e))W.copying(U(W.getImageAssets(t),t,e))},copyVideoAssets(e,t){if(j(e))null==W||W.copying(U(W.getVideoAssets(t),t,e))},copyAudioAssets(e,t){if(j(e))null==W||W.copying(U(W.getAudioAssets(t),t,e))},copyFontAssets(e,t){if(j(e))null==W||W.copying(U(W.getFontAssets(t),t,e))},saveHtmlPage(e,t){null==W||W.archiving(U(W.getHtmlPage(t),t,void 0,(e||V.userSettings.outputArchiveName)+"-html"))},saveScriptAssets(e,t){null==W||W.archiving(U(W.getScriptAssets(t),t,void 0,(e||V.userSettings.outputArchiveName)+"-script"))},saveLinkAssets(e,t){null==W||W.archiving(U(W.getLinkAssets(t),t,void 0,(e||V.userSettings.outputArchiveName)+"-link"))},saveImageAssets(e,t){null==W||W.archiving(U(W.getImageAssets(t),t,void 0,(e||V.userSettings.outputArchiveName)+"-image"))},saveVideoAssets(e,t){null==W||W.archiving(U(W.getVideoAssets(t),t,void 0,(e||V.userSettings.outputArchiveName)+"-video"))},saveAudioAssets(e,t){null==W||W.archiving(U(W.getAudioAssets(t),t,void 0,(e||V.userSettings.outputArchiveName)+"-audio"))},saveFontAssets(e,t){null==W||W.archiving(U(W.getFontAssets(t),t,void 0,(e||V.userSettings.outputArchiveName)+"-font"))}},create(){const e=P;return V=new Application(4,View,Controller,Resource),L=V.controllerHandler,W=new File,V.resourceHandler.fileHandler=W,H=L.elementMap,Object.assign(V.builtInExtensions,{[e.COMPRESS_BROTLI]:new Brotli(e.COMPRESS_BROTLI,4),[e.COMPRESS_GZIP]:new Gzip(e.COMPRESS_GZIP,4),[e.COMPRESS_JPEG]:new Jpeg(e.COMPRESS_JPEG,4),[e.COMPRESS_PNG]:new Png(e.COMPRESS_PNG,4),[e.CONVERT_BMP]:new Bmp(e.CONVERT_BMP,4),[e.CONVERT_GIF]:new Gif(e.CONVERT_GIF,4),[e.CONVERT_JPEG]:new Jpeg$1(e.CONVERT_JPEG,4),[e.CONVERT_PNG]:new Png$1(e.CONVERT_PNG,4),[e.CONVERT_TIFF]:new Tiff(e.CONVERT_TIFF,4)}),B=true,{application:V,framework:4,userSettings:Object.assign({},F)}},cached(){if(B)return{application:V,framework:4,userSettings:V.userSettings};else return z.create()},getElementById:(e,t=true)=>{if(V){const s=document.getElementById(e);if(s)return k(D)(s,t)}return G()},querySelector:(e,t=true)=>{if(V){const s=document.querySelector(e);if(s)return k(D)(s,t)}return G()},querySelectorAll:(e,t=true)=>{if(V){const s=document.querySelectorAll(e);if(s.length){if(!t)H.clear();return k(J)(s)}}return G()},getElement:(e,t=false)=>{if(V)return k(D)(e,t);else return G()},saveAsWebPage:(e,t)=>{if(W){(t=!q(t)?{}:Object.assign({},t)).saveAsWebPage=true;const s=V.userSettings,i=s.preloadImages;return s.preloadImages=false,V.reset(),V.parseDocument(document.body).then(r=>(W.saveToArchive(e||V.userSettings.outputArchiveName,t),s.preloadImages=i,r))}return G()}};return z}));
